(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9768],{1822:function(qe,D,y){"use strict";var j=y(67294),b=y(71880),p=y(27199),E=y(30731),Z=y(4874),V=function(I,L){var _e={};for(var be in I)Object.prototype.hasOwnProperty.call(I,be)&&L.indexOf(be)<0&&(_e[be]=I[be]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Le=0,be=Object.getOwnPropertySymbols(I);Le<be.length;Le++)L.indexOf(be[Le])<0&&Object.prototype.propertyIsEnumerable.call(I,be[Le])&&(_e[be[Le]]=I[be[Le]]);return _e},G=(0,j.forwardRef)(function(I,L){var _e=I.style,be=_e===void 0?{height:"inherit"}:_e,Le=I.className,Je=I.loading,Dt=I.loadingTemplate,It=I.errorTemplate,Ut=V(I,["style","className","loading","loadingTemplate","errorTemplate"]),xt=(0,p.Z)(b.aC,Ut),bt=xt.chart,ct=xt.container;return(0,j.useImperativeHandle)(L,function(){return{getChart:function(){return bt.current}}}),j.createElement(E.Z,{errorTemplate:It},Je&&j.createElement(Z.Z,{loadingTemplate:Dt}),j.createElement("div",{className:Le,style:be,ref:ct}))});D.Z=G},28614:function(qe,D,y){"use strict";var j=y(67294),b=y(71880),p=y(27199),E=y(30731),Z=y(4874),V=function(I,L){var _e={};for(var be in I)Object.prototype.hasOwnProperty.call(I,be)&&L.indexOf(be)<0&&(_e[be]=I[be]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Le=0,be=Object.getOwnPropertySymbols(I);Le<be.length;Le++)L.indexOf(be[Le])<0&&Object.prototype.propertyIsEnumerable.call(I,be[Le])&&(_e[be[Le]]=I[be[Le]]);return _e},G=(0,j.forwardRef)(function(I,L){var _e=I.style,be=_e===void 0?{height:"inherit"}:_e,Le=I.className,Je=I.loading,Dt=I.loadingTemplate,It=I.errorTemplate,Ut=V(I,["style","className","loading","loadingTemplate","errorTemplate"]),xt=(0,p.Z)(b.Kj,Ut),bt=xt.chart,ct=xt.container;return(0,j.useImperativeHandle)(L,function(){return{getChart:function(){return bt.current}}}),j.createElement(E.Z,{errorTemplate:It},Je&&j.createElement(Z.Z,{loadingTemplate:Dt}),j.createElement("div",{className:Le,style:be,ref:ct}))});D.Z=G},98093:function(qe,D,y){"use strict";var j=y(67294),b=y(71880),p=y(27199),E=y(30731),Z=y(4874),V=function(I,L){var _e={};for(var be in I)Object.prototype.hasOwnProperty.call(I,be)&&L.indexOf(be)<0&&(_e[be]=I[be]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Le=0,be=Object.getOwnPropertySymbols(I);Le<be.length;Le++)L.indexOf(be[Le])<0&&Object.prototype.propertyIsEnumerable.call(I,be[Le])&&(_e[be[Le]]=I[be[Le]]);return _e},G=(0,j.forwardRef)(function(I,L){var _e=I.style,be=_e===void 0?{height:"inherit"}:_e,Le=I.className,Je=I.loading,Dt=I.loadingTemplate,It=I.errorTemplate,Ut=V(I,["style","className","loading","loadingTemplate","errorTemplate"]),xt=(0,p.Z)(b.TZ,Ut),bt=xt.chart,ct=xt.container;return(0,j.useImperativeHandle)(L,function(){return{getChart:function(){return bt.current}}}),j.createElement(E.Z,{errorTemplate:It},Je&&j.createElement(Z.Z,{loadingTemplate:Dt}),j.createElement("div",{className:Le,style:be,ref:ct}))});D.Z=G},57611:function(qe,D,y){"use strict";var j=y(67294),b=y(71880),p=y(27199),E=y(30731),Z=y(4874),V=function(I,L){var _e={};for(var be in I)Object.prototype.hasOwnProperty.call(I,be)&&L.indexOf(be)<0&&(_e[be]=I[be]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Le=0,be=Object.getOwnPropertySymbols(I);Le<be.length;Le++)L.indexOf(be[Le])<0&&Object.prototype.propertyIsEnumerable.call(I,be[Le])&&(_e[be[Le]]=I[be[Le]]);return _e},G=(0,j.forwardRef)(function(I,L){var _e=I.style,be=_e===void 0?{height:"inherit"}:_e,Le=I.className,Je=I.loading,Dt=I.loadingTemplate,It=I.errorTemplate,Ut=V(I,["style","className","loading","loadingTemplate","errorTemplate"]),xt=(0,p.Z)(b.m,Ut),bt=xt.chart,ct=xt.container;return(0,j.useImperativeHandle)(L,function(){return{getChart:function(){return bt.current}}}),j.createElement(E.Z,{errorTemplate:It},Je&&j.createElement(Z.Z,{loadingTemplate:Dt}),j.createElement("div",{className:Le,style:be,ref:ct}))});D.Z=G},99525:function(qe,D,y){"use strict";var j=y(67294),b=y(71880),p=y(27199),E=y(30731),Z=y(4874),V=function(I,L){var _e={};for(var be in I)Object.prototype.hasOwnProperty.call(I,be)&&L.indexOf(be)<0&&(_e[be]=I[be]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Le=0,be=Object.getOwnPropertySymbols(I);Le<be.length;Le++)L.indexOf(be[Le])<0&&Object.prototype.propertyIsEnumerable.call(I,be[Le])&&(_e[be[Le]]=I[be[Le]]);return _e},G=(0,j.forwardRef)(function(I,L){var _e=I.style,be=_e===void 0?{height:"inherit"}:_e,Le=I.className,Je=I.loading,Dt=I.loadingTemplate,It=I.errorTemplate,Ut=V(I,["style","className","loading","loadingTemplate","errorTemplate"]),xt=(0,p.Z)(b.kB,Ut),bt=xt.chart,ct=xt.container;return(0,j.useImperativeHandle)(L,function(){return{getChart:function(){return bt.current}}}),j.createElement(E.Z,{errorTemplate:It},Je&&j.createElement(Z.Z,{loadingTemplate:Dt}),j.createElement("div",{className:Le,style:be,ref:ct}))});D.Z=G},64335:function(qe,D,y){"use strict";var j=y(67294),b=(0,j.createContext)({});D.Z=b},21349:function(qe,D,y){"use strict";var j=y(84305),b=y(69224),p=y(53645),E=y.n(p),Z=y(67294),V=y(94184),G=y.n(V),I=y(64335),L=function(be){var Le=(0,Z.useContext)(I.Z),Je=be.children,Dt=be.contentWidth,It=be.className,Ut=be.style,xt=(0,Z.useContext)(b.ZP.ConfigContext),bt=xt.getPrefixCls,ct=be.prefixCls||bt("pro"),ir=Dt||Le.contentWidth,re="".concat(ct,"-grid-content");return Z.createElement("div",{className:G()(re,It,{wide:ir==="Fixed"}),style:Ut},Z.createElement("div",{className:"".concat(ct,"-grid-content-children")},Je))};D.Z=L},46343:function(qe,D,y){"use strict";y.d(D,{zj:function(){return Bt},oI:function(){return Ni},ni:function(){return ge},gg:function(){return mn}});var j=y(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function b(or,ve,Me,Ge){function Re(kt){return kt instanceof Me?kt:new Me(function(rr){rr(kt)})}return new(Me||(Me=Promise))(function(kt,rr){function yr(Rr){try{sr(Ge.next(Rr))}catch(w){rr(w)}}function Pr(Rr){try{sr(Ge.throw(Rr))}catch(w){rr(w)}}function sr(Rr){Rr.done?kt(Rr.value):Re(Rr.value).then(yr,Pr)}sr((Ge=Ge.apply(or,ve||[])).next())})}function p(or,ve){var Me={label:0,sent:function(){if(kt[0]&1)throw kt[1];return kt[1]},trys:[],ops:[]},Ge,Re,kt,rr;return rr={next:yr(0),throw:yr(1),return:yr(2)},typeof Symbol=="function"&&(rr[Symbol.iterator]=function(){return this}),rr;function yr(sr){return function(Rr){return Pr([sr,Rr])}}function Pr(sr){if(Ge)throw new TypeError("Generator is already executing.");for(;Me;)try{if(Ge=1,Re&&(kt=sr[0]&2?Re.return:sr[0]?Re.throw||((kt=Re.return)&&kt.call(Re),0):Re.next)&&!(kt=kt.call(Re,sr[1])).done)return kt;switch(Re=0,kt&&(sr=[sr[0]&2,kt.value]),sr[0]){case 0:case 1:kt=sr;break;case 4:return Me.label++,{value:sr[1],done:!1};case 5:Me.label++,Re=sr[1],sr=[0];continue;case 7:sr=Me.ops.pop(),Me.trys.pop();continue;default:if(kt=Me.trys,!(kt=kt.length>0&&kt[kt.length-1])&&(sr[0]===6||sr[0]===2)){Me=0;continue}if(sr[0]===3&&(!kt||sr[1]>kt[0]&&sr[1]<kt[3])){Me.label=sr[1];break}if(sr[0]===6&&Me.label<kt[1]){Me.label=kt[1],kt=sr;break}if(kt&&Me.label<kt[2]){Me.label=kt[2],Me.ops.push(sr);break}kt[2]&&Me.ops.pop(),Me.trys.pop();continue}sr=ve.call(or,Me)}catch(Rr){sr=[6,Rr],Re=0}finally{Ge=kt=0}if(sr[0]&5)throw sr[1];return{value:sr[0]?sr[1]:void 0,done:!0}}}function E(or,ve){var Me=typeof Symbol=="function"&&or[Symbol.iterator];if(!Me)return or;var Ge=Me.call(or),Re,kt=[],rr;try{for(;(ve===void 0||ve-- >0)&&!(Re=Ge.next()).done;)kt.push(Re.value)}catch(yr){rr={error:yr}}finally{try{Re&&!Re.done&&(Me=Ge.return)&&Me.call(Ge)}finally{if(rr)throw rr.error}}return kt}function Z(){for(var or=[],ve=0;ve<arguments.length;ve++)or=or.concat(E(arguments[ve]));return or}function V(or){return or&&or.__esModule&&Object.prototype.hasOwnProperty.call(or,"default")?or.default:or}function G(or,ve){return ve={exports:{}},or(ve,ve.exports),ve.exports}var I=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=Me;function Me(Ge){return Ge&&typeof Ge.length=="number"&&Ge.length>=0&&Ge.length%1==0}or.exports=ve.default});V(I);var L=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=function(Me){return function(){for(var Ge=[],Re=arguments.length;Re--;)Ge[Re]=arguments[Re];var kt=Ge.pop();return Me.call(this,Ge,kt)}},or.exports=ve.default});V(L);var _e=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.fallback=Re,ve.wrap=kt;var Me=ve.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Ge=ve.hasNextTick=typeof j=="object"&&typeof j.nextTick=="function";function Re(yr){setTimeout(yr,0)}function kt(yr){return function(Pr){for(var sr=[],Rr=arguments.length-1;Rr-- >0;)sr[Rr]=arguments[Rr+1];return yr(function(){return Pr.apply(void 0,sr)})}}var rr;Me?rr=setImmediate:Ge?rr=j.nextTick:rr=Re,ve.default=kt(rr)});V(_e);var be=_e.fallback,Le=_e.wrap,Je=_e.hasSetImmediate,Dt=_e.hasNextTick,It=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=kt;var Me=Re(L),Ge=Re(_e);function Re(Pr){return Pr&&Pr.__esModule?Pr:{default:Pr}}function kt(Pr){return(0,Ut.isAsync)(Pr)?function(){for(var sr=[],Rr=arguments.length;Rr--;)sr[Rr]=arguments[Rr];var w=sr.pop(),X=Pr.apply(this,sr);return rr(X,w)}:(0,Me.default)(function(sr,Rr){var w;try{w=Pr.apply(this,sr)}catch(X){return Rr(X)}if(w&&typeof w.then=="function")return rr(w,Rr);Rr(null,w)})}function rr(Pr,sr){return Pr.then(function(Rr){yr(sr,null,Rr)},function(Rr){yr(sr,Rr&&Rr.message?Rr:new Error(Rr))})}function yr(Pr,sr,Rr){try{Pr(sr,Rr)}catch(w){(0,Ge.default)(function(X){throw X},w)}}or.exports=ve.default});V(It);var Ut=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.isAsyncIterable=ve.isAsyncGenerator=ve.isAsync=void 0;var Me=Ge(It);function Ge(Pr){return Pr&&Pr.__esModule?Pr:{default:Pr}}function Re(Pr){return Pr[Symbol.toStringTag]==="AsyncFunction"}function kt(Pr){return Pr[Symbol.toStringTag]==="AsyncGenerator"}function rr(Pr){return typeof Pr[Symbol.asyncIterator]=="function"}function yr(Pr){if(typeof Pr!="function")throw new Error("expected a function");return Re(Pr)?(0,Me.default)(Pr):Pr}ve.default=yr,ve.isAsync=Re,ve.isAsyncGenerator=kt,ve.isAsyncIterable=rr});V(Ut);var xt=Ut.isAsyncIterable,bt=Ut.isAsyncGenerator,ct=Ut.isAsync,ir=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=Me;function Me(Ge,Re){if(Re===void 0&&(Re=Ge.length),!Re)throw new Error("arity is undefined");function kt(){for(var rr=this,yr=[],Pr=arguments.length;Pr--;)yr[Pr]=arguments[Pr];return typeof yr[Re-1]=="function"?Ge.apply(this,yr):new Promise(function(sr,Rr){yr[Re-1]=function(w){for(var X=[],Ue=arguments.length-1;Ue-- >0;)X[Ue]=arguments[Ue+1];if(w)return Rr(w);sr(X.length>1?X:X[0])},Ge.apply(rr,yr)})}return Object.defineProperty(kt,"name",{configurable:!0,value:"awaitable("+Ge.name+")"}),kt}or.exports=ve.default});V(ir);var re=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0});var Me=kt(I),Ge=kt(Ut),Re=kt(ir);function kt(rr){return rr&&rr.__esModule?rr:{default:rr}}ve.default=(0,Re.default)(function(rr,yr,Pr){var sr=(0,Me.default)(yr)?[]:{};rr(yr,function(Rr,w,X){(0,Ge.default)(Rr)(function(Ue){for(var Ve,ot=[],At=arguments.length-1;At-- >0;)ot[At]=arguments[At+1];ot.length<2&&(Ve=ot,ot=Ve[0]),sr[w]=ot,X(Ue)})},function(Rr){return Pr(Rr,sr)})},3),or.exports=ve.default});V(re);var cr=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=Me;function Me(Ge){function Re(){for(var kt=[],rr=arguments.length;rr--;)kt[rr]=arguments[rr];if(Ge!==null){var yr=Ge;Ge=null,yr.apply(this,kt)}}return Object.assign(Re,Ge),Re}or.exports=ve.default});V(cr);var Ct=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=function(Me){return Me[Symbol.iterator]&&Me[Symbol.iterator]()},or.exports=ve.default});V(Ct);var Qe=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=Pr;var Me=Re(I),Ge=Re(Ct);function Re(sr){return sr&&sr.__esModule?sr:{default:sr}}function kt(sr){var Rr=-1,w=sr.length;return function(){return++Rr<w?{value:sr[Rr],key:Rr}:null}}function rr(sr){var Rr=-1;return function(){var X=sr.next();return X.done?null:(Rr++,{value:X.value,key:Rr})}}function yr(sr){var Rr=sr?Object.keys(sr):[],w=-1,X=Rr.length;return function(){var Ve=Rr[++w];return w<X?{value:sr[Ve],key:Ve}:null}}function Pr(sr){if((0,Me.default)(sr))return kt(sr);var Rr=(0,Ge.default)(sr);return Rr?rr(Rr):yr(sr)}or.exports=ve.default});V(Qe);var Tt=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=Me;function Me(Ge){return function(){for(var Re=[],kt=arguments.length;kt--;)Re[kt]=arguments[kt];if(Ge===null)throw new Error("Callback was already called.");var rr=Ge;Ge=null,rr.apply(this,Re)}}or.exports=ve.default});V(Tt);var je=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0});var Me={};ve.default=Me,or.exports=ve.default});V(je);var Pt=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=Re;var Me=Ge(je);function Ge(kt){return kt&&kt.__esModule?kt:{default:kt}}function Re(kt,rr,yr,Pr){var sr=!1,Rr=!1,w=!1,X=0,Ue=0;function Ve(){X>=rr||w||sr||(w=!0,kt.next().then(function(Q){var Rt=Q.value,dr=Q.done;if(!(Rr||sr)){if(w=!1,dr){sr=!0,X<=0&&Pr(null);return}X++,yr(Rt,Ue,ot),Ue++,Ve()}}).catch(At))}function ot(Q,Rt){if(X-=1,!Rr){if(Q)return At(Q);if(Q===!1){sr=!0,Rr=!0;return}if(Rt===Me.default||sr&&X<=0)return sr=!0,Pr(null);Ve()}}function At(Q){Rr||(w=!1,sr=!0,Pr(Q))}Ve()}or.exports=ve.default});V(Pt);var fr=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0});var Me=yr(cr),Ge=yr(Qe),Re=yr(Tt),kt=yr(Pt),rr=yr(je);function yr(Pr){return Pr&&Pr.__esModule?Pr:{default:Pr}}ve.default=function(Pr){return function(sr,Rr,w){if(w=(0,Me.default)(w),Pr<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!sr)return w(null);if((0,Ut.isAsyncGenerator)(sr))return(0,kt.default)(sr,Pr,Rr,w);if((0,Ut.isAsyncIterable)(sr))return(0,kt.default)(sr[Symbol.asyncIterator](),Pr,Rr,w);var X=(0,Ge.default)(sr),Ue=!1,Ve=!1,ot=0,At=!1;function Q(dr,Cr){if(!Ve)if(ot-=1,dr)Ue=!0,w(dr);else if(dr===!1)Ue=!0,Ve=!0;else{if(Cr===rr.default||Ue&&ot<=0)return Ue=!0,w(null);At||Rt()}}function Rt(){for(At=!0;ot<Pr&&!Ue;){var dr=X();if(dr===null){Ue=!0,ot<=0&&w(null);return}ot+=1,Rr(dr.value,dr.key,(0,Re.default)(Q))}At=!1}Rt()}},or.exports=ve.default});V(fr);var $t=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0});var Me=kt(fr),Ge=kt(Ut),Re=kt(ir);function kt(yr){return yr&&yr.__esModule?yr:{default:yr}}function rr(yr,Pr,sr,Rr){return(0,Me.default)(Pr)(yr,(0,Ge.default)(sr),Rr)}ve.default=(0,Re.default)(rr,4),or.exports=ve.default});V($t);var zr=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0});var Me=Re($t),Ge=Re(ir);function Re(rr){return rr&&rr.__esModule?rr:{default:rr}}function kt(rr,yr,Pr){return(0,Me.default)(rr,1,yr,Pr)}ve.default=(0,Ge.default)(kt,3),or.exports=ve.default});V(zr);var fe=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=kt;var Me=Re(re),Ge=Re(zr);function Re(rr){return rr&&rr.__esModule?rr:{default:rr}}function kt(rr,yr){return(0,Me.default)(Ge.default,rr,yr)}or.exports=ve.default}),ke=V(fe),ge=function(){function or(){for(var ve=arguments,Me=[],Ge=0;Ge<arguments.length;Ge++)Me[Ge]=ve[Ge];this.args=[],this.tasks=[]}return or.prototype.call=function(){for(var ve=arguments,Me=[],Ge=0;Ge<arguments.length;Ge++)Me[Ge]=ve[Ge];return this.args=Me,ke(this.tasks)},or.prototype.tap=function(ve,Me){var Ge=this;this.tasks.push(function(Re){Me.apply(void 0,Z(Ge.args)),Re(null,ve)})},or}(),_t=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0});var Me=sr(I),Ge=sr(je),Re=sr($t),kt=sr(cr),rr=sr(Tt),yr=sr(Ut),Pr=sr(ir);function sr(Ue){return Ue&&Ue.__esModule?Ue:{default:Ue}}function Rr(Ue,Ve,ot){ot=(0,kt.default)(ot);var At=0,Q=0,Rt=Ue.length,dr=!1;Rt===0&&ot(null);function Cr(Xe,rt){Xe===!1&&(dr=!0),dr!==!0&&(Xe?ot(Xe):(++Q===Rt||rt===Ge.default)&&ot(null))}for(;At<Rt;At++)Ve(Ue[At],At,(0,rr.default)(Cr))}function w(Ue,Ve,ot){return(0,Re.default)(Ue,Infinity,Ve,ot)}function X(Ue,Ve,ot){var At=(0,Me.default)(Ue)?Rr:w;return At(Ue,(0,yr.default)(Ve),ot)}ve.default=(0,Pr.default)(X,3),or.exports=ve.default});V(_t);var vt=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=kt;var Me=Re(_t),Ge=Re(re);function Re(rr){return rr&&rr.__esModule?rr:{default:rr}}function kt(rr,yr){return(0,Ge.default)(Me.default,rr,yr)}or.exports=ve.default}),jt=V(vt),Bt=function(){function or(){for(var ve=arguments,Me=[],Ge=0;Ge<arguments.length;Ge++)Me[Ge]=ve[Ge];this.tasks=[]}return or.prototype.promise=function(){for(var ve=arguments,Me=[],Ge=0;Ge<arguments.length;Ge++)Me[Ge]=ve[Ge];return jt(this.tasks)},or.prototype.tapPromise=function(ve,Me){var Ge=this;this.tasks.push(function(Re){return b(Ge,void 0,void 0,function(){return p(this,function(kt){switch(kt.label){case 0:return[4,Me()];case 1:return kt.sent(),Re(null,ve),[2]}})})})},or}(),Nr=G(function(or,ve){Object.defineProperty(ve,"__esModule",{value:!0});var Me=rr(cr),Ge=rr(Tt),Re=rr(Ut),kt=rr(ir);function rr(Pr){return Pr&&Pr.__esModule?Pr:{default:Pr}}function yr(Pr,sr){if(sr=(0,Me.default)(sr),!Array.isArray(Pr))return sr(new Error("First argument to waterfall must be an array of functions"));if(!Pr.length)return sr();var Rr=0;function w(Ue){var Ve=(0,Re.default)(Pr[Rr++]);Ve.apply(void 0,Ue.concat([(0,Ge.default)(X)]))}function X(Ue){for(var Ve=[],ot=arguments.length-1;ot-- >0;)Ve[ot]=arguments[ot+1];if(Ue!==!1){if(Ue||Rr===Pr.length)return sr.apply(void 0,[Ue].concat(Ve));w(Ve)}}w([])}ve.default=(0,kt.default)(yr),or.exports=ve.default}),pn=V(Nr),mn=function(){function or(){for(var ve=arguments,Me=[],Ge=0;Ge<arguments.length;Ge++)Me[Ge]=ve[Ge];this.tasks=[]}return or.prototype.call=function(){for(var ve=arguments,Me=[],Ge=0;Ge<arguments.length;Ge++)Me[Ge]=ve[Ge];return pn(this.tasks)},or.prototype.tap=function(ve,Me){this.tasks.length===0?this.tasks.push(function(Ge){var Re=Me();Ge(Re?null:!1,Re)}):this.tasks.push(function(Ge,Re){var kt=Me();Re(kt?null:!1,ve)})},or}(),Ni=function(){function or(){for(var ve=arguments,Me=[],Ge=0;Ge<arguments.length;Ge++)Me[Ge]=ve[Ge];this.tasks=[]}return or.prototype.call=function(){for(var ve=arguments,Me=[],Ge=0;Ge<arguments.length;Ge++)Me[Ge]=ve[Ge];return ke(this.tasks)},or.prototype.tap=function(ve,Me){this.tasks.push(function(Ge){var Re=Me();Ge(Re,ve)})},or}()},58881:function(qe,D,y){"use strict";y.d(D,{nC:function(){return j.ZP},Hp:function(){return j.Hp},e7:function(){return j.e7},yT:function(){return j.yT},vK:function(){return p.v},BlendType:function(){return Z.h},AttributeType:function(){return V.GC},ScaleTypes:function(){return V.vY},StyleScaleType:function(){return V.ee},MapServiceEvent:function(){return L.I},CoordinateSystem:function(){return _e.l},CoordinateUniform:function(){return _e.k},CameraUniform:function(){return Je.l},SceneEventList:function(){return Ut.P},PositionType:function(){return Ct.d},gl:function(){return rr.gl}});var j=y(12250),b=y(69530),p=y(72302),E=y(76915),Z=y(77252),V=y(31251),G=y(8628),I=y.n(G);y.o(G,"CameraUniform")&&y.d(D,{CameraUniform:function(){return G.CameraUniform}}),y.o(G,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return G.CityBuildingLayer}}),y.o(G,"CoordinateSystem")&&y.d(D,{CoordinateSystem:function(){return G.CoordinateSystem}}),y.o(G,"CoordinateUniform")&&y.d(D,{CoordinateUniform:function(){return G.CoordinateUniform}}),y.o(G,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return G.HeatmapLayer}}),y.o(G,"ImageLayer")&&y.d(D,{ImageLayer:function(){return G.ImageLayer}}),y.o(G,"LineLayer")&&y.d(D,{LineLayer:function(){return G.LineLayer}}),y.o(G,"MapServiceEvent")&&y.d(D,{MapServiceEvent:function(){return G.MapServiceEvent}}),y.o(G,"Marker")&&y.d(D,{Marker:function(){return G.Marker}}),y.o(G,"PointLayer")&&y.d(D,{PointLayer:function(){return G.PointLayer}}),y.o(G,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return G.PolygonLayer}}),y.o(G,"Popup")&&y.d(D,{Popup:function(){return G.Popup}}),y.o(G,"PositionType")&&y.d(D,{PositionType:function(){return G.PositionType}}),y.o(G,"RasterLayer")&&y.d(D,{RasterLayer:function(){return G.RasterLayer}}),y.o(G,"Scene")&&y.d(D,{Scene:function(){return G.Scene}}),y.o(G,"SceneEventList")&&y.d(D,{SceneEventList:function(){return G.SceneEventList}}),y.o(G,"gl")&&y.d(D,{gl:function(){return G.gl}});var L=y(16606),_e=y(47282),be=y(41906),Le=y.n(be);y.o(be,"CameraUniform")&&y.d(D,{CameraUniform:function(){return be.CameraUniform}}),y.o(be,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return be.CityBuildingLayer}}),y.o(be,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return be.HeatmapLayer}}),y.o(be,"ImageLayer")&&y.d(D,{ImageLayer:function(){return be.ImageLayer}}),y.o(be,"LineLayer")&&y.d(D,{LineLayer:function(){return be.LineLayer}}),y.o(be,"Marker")&&y.d(D,{Marker:function(){return be.Marker}}),y.o(be,"PointLayer")&&y.d(D,{PointLayer:function(){return be.PointLayer}}),y.o(be,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return be.PolygonLayer}}),y.o(be,"Popup")&&y.d(D,{Popup:function(){return be.Popup}}),y.o(be,"PositionType")&&y.d(D,{PositionType:function(){return be.PositionType}}),y.o(be,"RasterLayer")&&y.d(D,{RasterLayer:function(){return be.RasterLayer}}),y.o(be,"Scene")&&y.d(D,{Scene:function(){return be.Scene}}),y.o(be,"SceneEventList")&&y.d(D,{SceneEventList:function(){return be.SceneEventList}}),y.o(be,"gl")&&y.d(D,{gl:function(){return be.gl}});var Je=y(4594),Dt=y(1910),It=y.n(Dt);y.o(Dt,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return Dt.CityBuildingLayer}}),y.o(Dt,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return Dt.HeatmapLayer}}),y.o(Dt,"ImageLayer")&&y.d(D,{ImageLayer:function(){return Dt.ImageLayer}}),y.o(Dt,"LineLayer")&&y.d(D,{LineLayer:function(){return Dt.LineLayer}}),y.o(Dt,"Marker")&&y.d(D,{Marker:function(){return Dt.Marker}}),y.o(Dt,"PointLayer")&&y.d(D,{PointLayer:function(){return Dt.PointLayer}}),y.o(Dt,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return Dt.PolygonLayer}}),y.o(Dt,"Popup")&&y.d(D,{Popup:function(){return Dt.Popup}}),y.o(Dt,"PositionType")&&y.d(D,{PositionType:function(){return Dt.PositionType}}),y.o(Dt,"RasterLayer")&&y.d(D,{RasterLayer:function(){return Dt.RasterLayer}}),y.o(Dt,"Scene")&&y.d(D,{Scene:function(){return Dt.Scene}}),y.o(Dt,"SceneEventList")&&y.d(D,{SceneEventList:function(){return Dt.SceneEventList}}),y.o(Dt,"gl")&&y.d(D,{gl:function(){return Dt.gl}});var Ut=y(19793),xt=y(93102),bt=y.n(xt);y.o(xt,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return xt.CityBuildingLayer}}),y.o(xt,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return xt.HeatmapLayer}}),y.o(xt,"ImageLayer")&&y.d(D,{ImageLayer:function(){return xt.ImageLayer}}),y.o(xt,"LineLayer")&&y.d(D,{LineLayer:function(){return xt.LineLayer}}),y.o(xt,"Marker")&&y.d(D,{Marker:function(){return xt.Marker}}),y.o(xt,"PointLayer")&&y.d(D,{PointLayer:function(){return xt.PointLayer}}),y.o(xt,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return xt.PolygonLayer}}),y.o(xt,"Popup")&&y.d(D,{Popup:function(){return xt.Popup}}),y.o(xt,"PositionType")&&y.d(D,{PositionType:function(){return xt.PositionType}}),y.o(xt,"RasterLayer")&&y.d(D,{RasterLayer:function(){return xt.RasterLayer}}),y.o(xt,"Scene")&&y.d(D,{Scene:function(){return xt.Scene}}),y.o(xt,"gl")&&y.d(D,{gl:function(){return xt.gl}});var ct=y(64532),ir=y.n(ct);y.o(ct,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return ct.CityBuildingLayer}}),y.o(ct,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return ct.HeatmapLayer}}),y.o(ct,"ImageLayer")&&y.d(D,{ImageLayer:function(){return ct.ImageLayer}}),y.o(ct,"LineLayer")&&y.d(D,{LineLayer:function(){return ct.LineLayer}}),y.o(ct,"Marker")&&y.d(D,{Marker:function(){return ct.Marker}}),y.o(ct,"PointLayer")&&y.d(D,{PointLayer:function(){return ct.PointLayer}}),y.o(ct,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return ct.PolygonLayer}}),y.o(ct,"Popup")&&y.d(D,{Popup:function(){return ct.Popup}}),y.o(ct,"PositionType")&&y.d(D,{PositionType:function(){return ct.PositionType}}),y.o(ct,"RasterLayer")&&y.d(D,{RasterLayer:function(){return ct.RasterLayer}}),y.o(ct,"Scene")&&y.d(D,{Scene:function(){return ct.Scene}}),y.o(ct,"gl")&&y.d(D,{gl:function(){return ct.gl}});var re=y(2811),cr=y.n(re);y.o(re,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return re.CityBuildingLayer}}),y.o(re,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return re.HeatmapLayer}}),y.o(re,"ImageLayer")&&y.d(D,{ImageLayer:function(){return re.ImageLayer}}),y.o(re,"LineLayer")&&y.d(D,{LineLayer:function(){return re.LineLayer}}),y.o(re,"Marker")&&y.d(D,{Marker:function(){return re.Marker}}),y.o(re,"PointLayer")&&y.d(D,{PointLayer:function(){return re.PointLayer}}),y.o(re,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return re.PolygonLayer}}),y.o(re,"Popup")&&y.d(D,{Popup:function(){return re.Popup}}),y.o(re,"PositionType")&&y.d(D,{PositionType:function(){return re.PositionType}}),y.o(re,"RasterLayer")&&y.d(D,{RasterLayer:function(){return re.RasterLayer}}),y.o(re,"Scene")&&y.d(D,{Scene:function(){return re.Scene}}),y.o(re,"gl")&&y.d(D,{gl:function(){return re.gl}});var Ct=y(66690),Qe=y(81732),Tt=y.n(Qe);y.o(Qe,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return Qe.CityBuildingLayer}}),y.o(Qe,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return Qe.HeatmapLayer}}),y.o(Qe,"ImageLayer")&&y.d(D,{ImageLayer:function(){return Qe.ImageLayer}}),y.o(Qe,"LineLayer")&&y.d(D,{LineLayer:function(){return Qe.LineLayer}}),y.o(Qe,"Marker")&&y.d(D,{Marker:function(){return Qe.Marker}}),y.o(Qe,"PointLayer")&&y.d(D,{PointLayer:function(){return Qe.PointLayer}}),y.o(Qe,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return Qe.PolygonLayer}}),y.o(Qe,"Popup")&&y.d(D,{Popup:function(){return Qe.Popup}}),y.o(Qe,"RasterLayer")&&y.d(D,{RasterLayer:function(){return Qe.RasterLayer}}),y.o(Qe,"Scene")&&y.d(D,{Scene:function(){return Qe.Scene}}),y.o(Qe,"gl")&&y.d(D,{gl:function(){return Qe.gl}});var je=y(84007),Pt=y.n(je);y.o(je,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return je.CityBuildingLayer}}),y.o(je,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return je.HeatmapLayer}}),y.o(je,"ImageLayer")&&y.d(D,{ImageLayer:function(){return je.ImageLayer}}),y.o(je,"LineLayer")&&y.d(D,{LineLayer:function(){return je.LineLayer}}),y.o(je,"Marker")&&y.d(D,{Marker:function(){return je.Marker}}),y.o(je,"PointLayer")&&y.d(D,{PointLayer:function(){return je.PointLayer}}),y.o(je,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return je.PolygonLayer}}),y.o(je,"Popup")&&y.d(D,{Popup:function(){return je.Popup}}),y.o(je,"RasterLayer")&&y.d(D,{RasterLayer:function(){return je.RasterLayer}}),y.o(je,"Scene")&&y.d(D,{Scene:function(){return je.Scene}}),y.o(je,"gl")&&y.d(D,{gl:function(){return je.gl}});var fr=y(89648),$t=y(90919),zr=y.n($t);y.o($t,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return $t.CityBuildingLayer}}),y.o($t,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return $t.HeatmapLayer}}),y.o($t,"ImageLayer")&&y.d(D,{ImageLayer:function(){return $t.ImageLayer}}),y.o($t,"LineLayer")&&y.d(D,{LineLayer:function(){return $t.LineLayer}}),y.o($t,"Marker")&&y.d(D,{Marker:function(){return $t.Marker}}),y.o($t,"PointLayer")&&y.d(D,{PointLayer:function(){return $t.PointLayer}}),y.o($t,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return $t.PolygonLayer}}),y.o($t,"Popup")&&y.d(D,{Popup:function(){return $t.Popup}}),y.o($t,"RasterLayer")&&y.d(D,{RasterLayer:function(){return $t.RasterLayer}}),y.o($t,"Scene")&&y.d(D,{Scene:function(){return $t.Scene}}),y.o($t,"gl")&&y.d(D,{gl:function(){return $t.gl}});var fe=y(75925),ke=y.n(fe);y.o(fe,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return fe.CityBuildingLayer}}),y.o(fe,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return fe.HeatmapLayer}}),y.o(fe,"ImageLayer")&&y.d(D,{ImageLayer:function(){return fe.ImageLayer}}),y.o(fe,"LineLayer")&&y.d(D,{LineLayer:function(){return fe.LineLayer}}),y.o(fe,"Marker")&&y.d(D,{Marker:function(){return fe.Marker}}),y.o(fe,"PointLayer")&&y.d(D,{PointLayer:function(){return fe.PointLayer}}),y.o(fe,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return fe.PolygonLayer}}),y.o(fe,"Popup")&&y.d(D,{Popup:function(){return fe.Popup}}),y.o(fe,"RasterLayer")&&y.d(D,{RasterLayer:function(){return fe.RasterLayer}}),y.o(fe,"Scene")&&y.d(D,{Scene:function(){return fe.Scene}}),y.o(fe,"gl")&&y.d(D,{gl:function(){return fe.gl}});var ge=y(85040),_t=y.n(ge);y.o(ge,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return ge.CityBuildingLayer}}),y.o(ge,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return ge.HeatmapLayer}}),y.o(ge,"ImageLayer")&&y.d(D,{ImageLayer:function(){return ge.ImageLayer}}),y.o(ge,"LineLayer")&&y.d(D,{LineLayer:function(){return ge.LineLayer}}),y.o(ge,"Marker")&&y.d(D,{Marker:function(){return ge.Marker}}),y.o(ge,"PointLayer")&&y.d(D,{PointLayer:function(){return ge.PointLayer}}),y.o(ge,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return ge.PolygonLayer}}),y.o(ge,"Popup")&&y.d(D,{Popup:function(){return ge.Popup}}),y.o(ge,"RasterLayer")&&y.d(D,{RasterLayer:function(){return ge.RasterLayer}}),y.o(ge,"Scene")&&y.d(D,{Scene:function(){return ge.Scene}}),y.o(ge,"gl")&&y.d(D,{gl:function(){return ge.gl}});var vt=y(8594),jt=y.n(vt);y.o(vt,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return vt.CityBuildingLayer}}),y.o(vt,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return vt.HeatmapLayer}}),y.o(vt,"ImageLayer")&&y.d(D,{ImageLayer:function(){return vt.ImageLayer}}),y.o(vt,"LineLayer")&&y.d(D,{LineLayer:function(){return vt.LineLayer}}),y.o(vt,"Marker")&&y.d(D,{Marker:function(){return vt.Marker}}),y.o(vt,"PointLayer")&&y.d(D,{PointLayer:function(){return vt.PointLayer}}),y.o(vt,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return vt.PolygonLayer}}),y.o(vt,"Popup")&&y.d(D,{Popup:function(){return vt.Popup}}),y.o(vt,"RasterLayer")&&y.d(D,{RasterLayer:function(){return vt.RasterLayer}}),y.o(vt,"Scene")&&y.d(D,{Scene:function(){return vt.Scene}}),y.o(vt,"gl")&&y.d(D,{gl:function(){return vt.gl}});var Bt=y(67571),Nr=y.n(Bt);y.o(Bt,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return Bt.CityBuildingLayer}}),y.o(Bt,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return Bt.HeatmapLayer}}),y.o(Bt,"ImageLayer")&&y.d(D,{ImageLayer:function(){return Bt.ImageLayer}}),y.o(Bt,"LineLayer")&&y.d(D,{LineLayer:function(){return Bt.LineLayer}}),y.o(Bt,"Marker")&&y.d(D,{Marker:function(){return Bt.Marker}}),y.o(Bt,"PointLayer")&&y.d(D,{PointLayer:function(){return Bt.PointLayer}}),y.o(Bt,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return Bt.PolygonLayer}}),y.o(Bt,"Popup")&&y.d(D,{Popup:function(){return Bt.Popup}}),y.o(Bt,"RasterLayer")&&y.d(D,{RasterLayer:function(){return Bt.RasterLayer}}),y.o(Bt,"Scene")&&y.d(D,{Scene:function(){return Bt.Scene}}),y.o(Bt,"gl")&&y.d(D,{gl:function(){return Bt.gl}});var pn=y(66718),mn=y.n(pn);y.o(pn,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return pn.CityBuildingLayer}}),y.o(pn,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return pn.HeatmapLayer}}),y.o(pn,"ImageLayer")&&y.d(D,{ImageLayer:function(){return pn.ImageLayer}}),y.o(pn,"LineLayer")&&y.d(D,{LineLayer:function(){return pn.LineLayer}}),y.o(pn,"Marker")&&y.d(D,{Marker:function(){return pn.Marker}}),y.o(pn,"PointLayer")&&y.d(D,{PointLayer:function(){return pn.PointLayer}}),y.o(pn,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return pn.PolygonLayer}}),y.o(pn,"Popup")&&y.d(D,{Popup:function(){return pn.Popup}}),y.o(pn,"RasterLayer")&&y.d(D,{RasterLayer:function(){return pn.RasterLayer}}),y.o(pn,"Scene")&&y.d(D,{Scene:function(){return pn.Scene}}),y.o(pn,"gl")&&y.d(D,{gl:function(){return pn.gl}});var Ni=y(92364),or=y(78010),ve=y.n(or);y.o(or,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return or.CityBuildingLayer}}),y.o(or,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return or.HeatmapLayer}}),y.o(or,"ImageLayer")&&y.d(D,{ImageLayer:function(){return or.ImageLayer}}),y.o(or,"LineLayer")&&y.d(D,{LineLayer:function(){return or.LineLayer}}),y.o(or,"Marker")&&y.d(D,{Marker:function(){return or.Marker}}),y.o(or,"PointLayer")&&y.d(D,{PointLayer:function(){return or.PointLayer}}),y.o(or,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return or.PolygonLayer}}),y.o(or,"Popup")&&y.d(D,{Popup:function(){return or.Popup}}),y.o(or,"RasterLayer")&&y.d(D,{RasterLayer:function(){return or.RasterLayer}}),y.o(or,"Scene")&&y.d(D,{Scene:function(){return or.Scene}}),y.o(or,"gl")&&y.d(D,{gl:function(){return or.gl}});var Me=y(68116),Ge=y.n(Me);y.o(Me,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return Me.CityBuildingLayer}}),y.o(Me,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return Me.HeatmapLayer}}),y.o(Me,"ImageLayer")&&y.d(D,{ImageLayer:function(){return Me.ImageLayer}}),y.o(Me,"LineLayer")&&y.d(D,{LineLayer:function(){return Me.LineLayer}}),y.o(Me,"Marker")&&y.d(D,{Marker:function(){return Me.Marker}}),y.o(Me,"PointLayer")&&y.d(D,{PointLayer:function(){return Me.PointLayer}}),y.o(Me,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return Me.PolygonLayer}}),y.o(Me,"Popup")&&y.d(D,{Popup:function(){return Me.Popup}}),y.o(Me,"RasterLayer")&&y.d(D,{RasterLayer:function(){return Me.RasterLayer}}),y.o(Me,"Scene")&&y.d(D,{Scene:function(){return Me.Scene}}),y.o(Me,"gl")&&y.d(D,{gl:function(){return Me.gl}});var Re=y(23067),kt=y.n(Re);y.o(Re,"CityBuildingLayer")&&y.d(D,{CityBuildingLayer:function(){return Re.CityBuildingLayer}}),y.o(Re,"HeatmapLayer")&&y.d(D,{HeatmapLayer:function(){return Re.HeatmapLayer}}),y.o(Re,"ImageLayer")&&y.d(D,{ImageLayer:function(){return Re.ImageLayer}}),y.o(Re,"LineLayer")&&y.d(D,{LineLayer:function(){return Re.LineLayer}}),y.o(Re,"Marker")&&y.d(D,{Marker:function(){return Re.Marker}}),y.o(Re,"PointLayer")&&y.d(D,{PointLayer:function(){return Re.PointLayer}}),y.o(Re,"PolygonLayer")&&y.d(D,{PolygonLayer:function(){return Re.PolygonLayer}}),y.o(Re,"Popup")&&y.d(D,{Popup:function(){return Re.Popup}}),y.o(Re,"RasterLayer")&&y.d(D,{RasterLayer:function(){return Re.RasterLayer}}),y.o(Re,"Scene")&&y.d(D,{Scene:function(){return Re.Scene}}),y.o(Re,"gl")&&y.d(D,{gl:function(){return Re.gl}});var rr=y(7648)},12250:function(qe,D,y){"use strict";y.d(D,{e7:function(){return Ui},Hp:function(){return Si},ZP:function(){return sa},yT:function(){return fi}});var j=y(28660),b=y(26729),p=y.n(b),E=y(86700),Z=y(84879),V=y(72302),G=y(6610),I=y(5991),L=y(96156),_e=y(6901),be=y(49296),Le=y.n(be);function Je(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function Dt(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?Je(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):Je(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}function It(ee,ne){var k=typeof Symbol!="undefined"&&ee[Symbol.iterator]||ee["@@iterator"];if(!k){if(Array.isArray(ee)||(k=Ut(ee))||ne&&ee&&typeof ee.length=="number"){k&&(ee=k);var F=0,ie=function(){};return{s:ie,n:function(){return F>=ee.length?{done:!0}:{done:!1,value:ee[F++]}},e:function(Qt){throw Qt},f:ie}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Te=!0,ft=!1,Gt;return{s:function(){k=k.call(ee)},n:function(){var Qt=k.next();return Te=Qt.done,Qt},e:function(Qt){ft=!0,Gt=Qt},f:function(){try{!Te&&k.return!=null&&k.return()}finally{if(ft)throw Gt}}}}function Ut(ee,ne){if(!!ee){if(typeof ee=="string")return xt(ee,ne);var k=Object.prototype.toString.call(ee).slice(8,-1);if(k==="Object"&&ee.constructor&&(k=ee.constructor.name),k==="Map"||k==="Set")return Array.from(ee);if(k==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k))return xt(ee,ne)}}function xt(ee,ne){(ne==null||ne>ee.length)&&(ne=ee.length);for(var k=0,F=new Array(ne);k<ne;k++)F[k]=ee[k];return F}var bt=30;function ct(ee){var ne=ee.characterSet,k=ee.getFontWidth,F=ee.fontHeight,ie=ee.buffer,Te=ee.maxCanvasWidth,ft=ee.mapping,Gt=ft===void 0?{}:ft,Et=ee.xOffset,Qt=Et===void 0?0:Et,Fr=ee.yOffset,Bn=Fr===void 0?0:Fr,zn=0,hi=Qt;Array.from(ne).forEach(function(yi,Ki){if(!Gt[yi]){var _a=k(yi,Ki);hi+bt>Te&&(hi=0,zn++),Gt[yi]={x:hi,y:Bn+zn*bt,width:bt,height:bt,advance:_a},hi+=bt}});var ui=F+ie*2;return{mapping:Gt,xOffset:hi,yOffset:Bn+zn*ui,canvasHeight:cr(Bn+(zn+1)*ui)}}function ir(ee,ne,k){var F=0,ie=0,Te=0,ft=[],Gt={},Et=It(ee),Qt;try{for(Et.s();!(Qt=Et.n()).done;){var Fr=Qt.value;if(!Gt[Fr.id]){var Bn=Fr.size;F+Bn+ne>k&&(re(Gt,ft,ie),F=0,ie=Te+ie+ne,Te=0,ft=[]),ft.push({icon:Fr,xOffset:F}),F=F+Bn+ne,Te=Math.max(Te,Bn)}}}catch(hi){Et.e(hi)}finally{Et.f()}ft.length>0&&re(Gt,ft,ie);var zn=cr(Te+ie+ne);return{mapping:Gt,canvasHeight:zn}}function re(ee,ne,k){var F=It(ne),ie;try{for(F.s();!(ie=F.n()).done;){var Te=ie.value,ft=Te.icon,Gt=Te.xOffset;ee[ft.id]=Dt(Dt({},ft),{},{x:Gt,y:k,image:ft.image,width:ft.width,height:ft.height})}}catch(Et){F.e(Et)}finally{F.f()}}function cr(ee){return Math.pow(2,Math.ceil(Math.log2(ee)))}var Ct,Qe;function Tt(ee,ne){var k=typeof Symbol!="undefined"&&ee[Symbol.iterator]||ee["@@iterator"];if(!k){if(Array.isArray(ee)||(k=je(ee))||ne&&ee&&typeof ee.length=="number"){k&&(ee=k);var F=0,ie=function(){};return{s:ie,n:function(){return F>=ee.length?{done:!0}:{done:!1,value:ee[F++]}},e:function(Qt){throw Qt},f:ie}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Te=!0,ft=!1,Gt;return{s:function(){k=k.call(ee)},n:function(){var Qt=k.next();return Te=Qt.done,Qt},e:function(Qt){ft=!0,Gt=Qt},f:function(){try{!Te&&k.return!=null&&k.return()}finally{if(ft)throw Gt}}}}function je(ee,ne){if(!!ee){if(typeof ee=="string")return Pt(ee,ne);var k=Object.prototype.toString.call(ee).slice(8,-1);if(k==="Object"&&ee.constructor&&(k=ee.constructor.name),k==="Map"||k==="Set")return Array.from(ee);if(k==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k))return Pt(ee,ne)}}function Pt(ee,ne){(ne==null||ne>ee.length)&&(ne=ee.length);for(var k=0,F=new Array(ne);k<ne;k++)F[k]=ee[k];return F}function fr(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function $t(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?fr(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):fr(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}var zr=or(),fe="sans-serif",ke="normal",ge=24,_t=3,vt=.25,jt=8,Bt=1024,Nr=1,pn=1,mn=3,Ni=null;function or(){for(var ee=[],ne=32;ne<128;ne++)ee.push(String.fromCharCode(ne));return ee}function ve(ee,ne,k,F){ee.font="".concat(F," ").concat(k,"px ").concat(ne),ee.fillStyle="black",ee.textBaseline="middle"}function Me(ee,ne){for(var k=0;k<ee.length;k++)ne.data[4*k+3]=ee[k]}var Ge=(Ct=(0,E.b2)(),Ct(Qe=function(){function ee(){(0,G.Z)(this,ee),(0,L.Z)(this,"fontAtlas",void 0),(0,L.Z)(this,"iconFontMap",void 0),(0,L.Z)(this,"iconFontGlyphs",{}),(0,L.Z)(this,"fontOptions",void 0),(0,L.Z)(this,"key",void 0),(0,L.Z)(this,"cache",new _e.z6(mn))}return(0,I.Z)(ee,[{key:"scale",get:function(){return pn}},{key:"canvas",get:function(){var k=this.cache.get(this.key);return k&&k.data}},{key:"mapping",get:function(){var k=this.cache.get(this.key);return k&&k.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:fe,fontWeight:ke,characterSet:zr,fontSize:ge,buffer:_t,sdf:!0,cutoff:vt,radius:jt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(k){var F=this;k.forEach(function(ie){F.iconFontGlyphs[ie.name]=ie.unicode})}},{key:"addIconFont",value:function(k,F){this.iconFontMap.set(k,F)}},{key:"getIconFontKey",value:function(k){return this.iconFontMap.get(k)||k}},{key:"getGlyph",value:function(k){return this.iconFontGlyphs[k]?String.fromCharCode(parseInt(this.iconFontGlyphs[k],16)):""}},{key:"setFontOptions",value:function(k){this.fontOptions=$t($t({},this.fontOptions),k),this.key=this.getKey();var F=this.getNewChars(this.key,this.fontOptions.characterSet),ie=this.cache.get(this.key);if(!(ie&&F.length===0)){var Te=this.generateFontAtlas(this.key,F,ie);this.fontAtlas=Te,this.cache.set(this.key,Te)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(k,F,ie){var Te=this.fontOptions,ft=Te.fontFamily,Gt=Te.fontWeight,Et=Te.fontSize,Qt=Te.buffer,Fr=Te.sdf,Bn=Te.radius,zn=Te.cutoff,hi=Te.iconfont,ui=ie&&ie.data;ui||(ui=document.createElement("canvas"),ui.width=Bt);var yi=ui.getContext("2d");ve(yi,ft,Et,Gt);var Ki=ct($t({getFontWidth:function(Ac){return yi.measureText(Ac).width},fontHeight:Et*pn,buffer:Qt,characterSet:F,maxCanvasWidth:Bt},ie&&{mapping:ie.mapping,xOffset:ie.xOffset,yOffset:ie.yOffset})),_a=Ki.mapping,xa=Ki.canvasHeight,Ya=Ki.xOffset,Na=Ki.yOffset,wo=yi.getImageData(0,0,ui.width,ui.height);if(ui.height=xa,yi.putImageData(wo,0,0),ve(yi,ft,Et,Gt),Fr){var La=new(Le())(Et,Qt,Bn,zn,ft,Gt),Ea=yi.getImageData(0,0,La.size,La.size),fa=Tt(F),ma;try{for(fa.s();!(ma=fa.n()).done;){var Ga=ma.value;if(hi){var za=String.fromCharCode(parseInt(Ga.replace("&#x","").replace(";",""),16)),ko=La.draw(za);Me(ko,Ea)}else Me(La.draw(Ga),Ea);yi.putImageData(Ea,_a[Ga].x,_a[Ga].y)}}catch(To){fa.e(To)}finally{fa.f()}}else{var Zi=Tt(F),$o;try{for(Zi.s();!($o=Zi.n()).done;){var Po=$o.value;yi.fillText(Po,_a[Po].x,_a[Po].y+Et*Nr)}}catch(To){Zi.e(To)}finally{Zi.f()}}return{xOffset:Ya,yOffset:Na,mapping:_a,data:ui,width:ui.width,height:ui.height}}},{key:"getKey",value:function(){return"key";var k,F,ie,Te,ft,Gt,Et,Qt}},{key:"getNewChars",value:function(k,F){var ie=this.cache.get(k);if(!ie)return F;var Te=[],ft=ie.mapping,Gt=new Set(Object.keys(ft)),Et=new Set(F);return Et.forEach(function(Qt){Gt.has(Qt)||Te.push(Qt)}),Te}}]),ee}())||Qe),Re=y(63349),kt=y(10379),rr=y(46070),yr=y(77608),Pr,sr;function Rr(ee){var ne=w();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function w(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var X=3,Ue=1024,Ve=64,ot=(Pr=(0,E.b2)(),Pr(sr=function(ee){(0,kt.Z)(k,ee);var ne=Rr(k);function k(){var F;(0,G.Z)(this,k);for(var ie=arguments.length,Te=new Array(ie),ft=0;ft<ie;ft++)Te[ft]=arguments[ft];return F=ne.call.apply(ne,[this].concat(Te)),(0,L.Z)((0,Re.Z)(F),"canvasHeight",128),(0,L.Z)((0,Re.Z)(F),"texture",void 0),(0,L.Z)((0,Re.Z)(F),"canvas",void 0),(0,L.Z)((0,Re.Z)(F),"iconData",void 0),(0,L.Z)((0,Re.Z)(F),"iconMap",void 0),(0,L.Z)((0,Re.Z)(F),"ctx",void 0),(0,L.Z)((0,Re.Z)(F),"loadingImageCount",0),F}return(0,I.Z)(k,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(ie,Te){var ft=this,Gt=new Image;if(this.loadingImageCount++,this.hasImage(ie))throw new Error("Image Id already exists");this.iconData.push({id:ie,size:Ve}),this.updateIconMap(),this.loadImage(Te).then(function(Et){Gt=Et;var Qt=ft.iconData.find(function(Fr){return Fr.id===ie});Qt&&(Qt.image=Gt,Qt.width=Gt.width,Qt.height=Gt.height),ft.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(ie){return this.iconMap.hasOwnProperty(ie)}},{key:"removeImage",value:function(ie){this.hasImage(ie)&&(this.iconData=this.iconData.filter(function(Te){return Te.id!==ie}),delete this.iconMap[ie],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var ie=this;this.canvas.width=Ue,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(Te){var ft=ie.iconMap[Te],Gt=ft.x,Et=ft.y,Qt=ft.image,Fr=ft.width,Bn=Fr===void 0?64:Fr,zn=ft.height,hi=zn===void 0?64:zn,ui=Math.max(Bn,hi),yi=ui/Ve,Ki=hi/yi,_a=Bn/yi;Qt&&ie.ctx.drawImage(Qt,Gt+(Ve-_a)/2,Et+(Ve-Ki)/2,_a,Ki)})}},{key:"updateIconMap",value:function(){var ie=ir(this.iconData,X,Ue),Te=ie.mapping,ft=ie.canvasHeight;this.iconMap=Te,this.canvasHeight=ft}},{key:"loadImage",value:function(ie){return new Promise(function(Te,ft){if(ie instanceof HTMLImageElement){Te(ie);return}var Gt=new Image;Gt.crossOrigin="anonymous",Gt.onload=function(){Te(Gt)},Gt.onerror=function(){ft(new Error("Could not load image at "+ie))},Gt.src=ie instanceof File?URL.createObjectURL(ie):ie})}}]),k}(b.EventEmitter))||sr),At=y(28481),Q=y(85975),Rt,dr,Cr=(Rt=(0,E.b2)(),Rt(dr=function(){function ee(){(0,G.Z)(this,ee),(0,L.Z)(this,"viewport",void 0),(0,L.Z)(this,"overridedViewProjectionMatrix",void 0),(0,L.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,L.Z)(this,"jitteredProjectionMatrix",void 0),(0,L.Z)(this,"viewMatrixInverse",void 0),(0,L.Z)(this,"cameraPosition",void 0)}return(0,I.Z)(ee,[{key:"init",value:function(){}},{key:"update",value:function(k){this.viewport=k,this.viewMatrixInverse=Q.create(),Q.invert(this.viewMatrixInverse,k.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var k=this.viewport.getCenter(),F=(0,At.Z)(k,2),ie=F[0],Te=F[1];return[ie,Te]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(k,F){return this.viewport.projectFlat(k,F)}},{key:"setViewProjectionMatrix",value:function(k){this.overridedViewProjectionMatrix=k}},{key:"jitterProjectionMatrix",value:function(k,F){var ie=Q.fromTranslation(Q.create(),[k,F,0]);this.jitteredProjectionMatrix=Q.multiply(Q.create(),ie,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Q.multiply(Q.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),ee}())||dr),Xe,rt;function wt(ee,ne){var k=typeof Symbol!="undefined"&&ee[Symbol.iterator]||ee["@@iterator"];if(!k){if(Array.isArray(ee)||(k=Ot(ee))||ne&&ee&&typeof ee.length=="number"){k&&(ee=k);var F=0,ie=function(){};return{s:ie,n:function(){return F>=ee.length?{done:!0}:{done:!1,value:ee[F++]}},e:function(Qt){throw Qt},f:ie}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Te=!0,ft=!1,Gt;return{s:function(){k=k.call(ee)},n:function(){var Qt=k.next();return Te=Qt.done,Qt},e:function(Qt){ft=!0,Gt=Qt},f:function(){try{!Te&&k.return!=null&&k.return()}finally{if(ft)throw Gt}}}}function Ot(ee,ne){if(!!ee){if(typeof ee=="string")return gr(ee,ne);var k=Object.prototype.toString.call(ee).slice(8,-1);if(k==="Object"&&ee.constructor&&(k=ee.constructor.name),k==="Map"||k==="Set")return Array.from(ee);if(k==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k))return gr(ee,ne)}}function gr(ee,ne){(ne==null||ne>ee.length)&&(ne=ee.length);for(var k=0,F=new Array(ne);k<ne;k++)F[k]=ee[k];return F}var br=(Xe=(0,E.b2)(),Xe(rt=function(){function ee(){(0,G.Z)(this,ee),(0,L.Z)(this,"container",void 0),(0,L.Z)(this,"controlCorners",void 0),(0,L.Z)(this,"controlContainer",void 0),(0,L.Z)(this,"scene",void 0),(0,L.Z)(this,"mapsService",void 0),(0,L.Z)(this,"controls",[]),(0,L.Z)(this,"unAddControls",[])}return(0,I.Z)(ee,[{key:"init",value:function(k,F){this.container=k.container,this.scene=F,this.mapsService=F.get(V.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(k,F){var ie=F.get(V.v.IMapService);ie.map?(k.addTo(this.scene),this.controls.push(k)):this.unAddControls.push(k)}},{key:"getControlByName",value:function(k){return this.controls.find(function(F){return F.controlOption.name===k})}},{key:"removeControl",value:function(k){var F=this.controls.indexOf(k);return F>-1&&this.controls.splice(F,1),k.remove(),this}},{key:"addControls",value:function(){var k=this;this.unAddControls.forEach(function(F){F.addTo(k.scene),k.controls.push(F)}),this.unAddControls=[]}},{key:"destroy",value:function(){var k=wt(this.controls),F;try{for(k.s();!(F=k.n()).done;){var ie=F.value;ie.remove()}}catch(Te){k.e(Te)}finally{k.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var k=this.controlCorners={},F="l7-",ie=this.controlContainer=_e.SO.create("div",F+"control-container",this.container);function Te(){var ft=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],Gt=ft.map(function(Et){return F+Et}).join(" ");k[ft.join("")]=_e.SO.create("div",Gt,ie)}Te(["top","left"]),Te(["top","right"]),Te(["bottom","left"]),Te(["bottom","right"]),Te(["top","center"]),Te(["right","center"]),Te(["left","center"]),Te(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var k in this.controlCorners)this.controlCorners[k]&&_e.SO.remove(this.controlCorners[k]);this.controlContainer&&_e.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),ee}())||rt),Xt,kr,Mr=(Xt=(0,E.b2)(),Xt(kr=function(){function ee(){(0,G.Z)(this,ee),(0,L.Z)(this,"container",void 0),(0,L.Z)(this,"scene",void 0),(0,L.Z)(this,"mapsService",void 0),(0,L.Z)(this,"markers",[]),(0,L.Z)(this,"markerLayers",[]),(0,L.Z)(this,"unAddMarkers",[]),(0,L.Z)(this,"unAddMarkerLayers",[])}return(0,I.Z)(ee,[{key:"addMarkerLayer",value:function(k){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(k),k.addTo(this.scene)):this.unAddMarkerLayers.push(k)}},{key:"removeMarkerLayer",value:function(k){k.destroy(),this.markerLayers.indexOf(k);var F=this.markerLayers.indexOf(k);F>-1&&this.markerLayers.splice(F,1)}},{key:"addMarker",value:function(k){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(k),k.addTo(this.scene)):this.unAddMarkers.push(k)}},{key:"addMarkers",value:function(){var k=this;this.unAddMarkers.forEach(function(F){F.addTo(k.scene),k.markers.push(F)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var k=this;this.unAddMarkerLayers.forEach(function(F){k.markerLayers.push(F),F.addTo(k.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(k){k.remove(),this.markers.indexOf(k);var F=this.markers.indexOf(k);F>-1&&this.markers.splice(F,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(k){this.scene=k,this.mapsService=k.get(V.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(k){k.remove()}),this.markers=[],this.markerLayers.forEach(function(k){k.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(k){k.destroy()}}]),ee}())||kr),un,an,Kn=(un=(0,E.b2)(),un(an=function(){function ee(){(0,G.Z)(this,ee),(0,L.Z)(this,"scene",void 0),(0,L.Z)(this,"popup",void 0),(0,L.Z)(this,"mapsService",void 0),(0,L.Z)(this,"unAddPopup",void 0)}return(0,I.Z)(ee,[{key:"removePopup",value:function(k){k.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(k){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(k.addTo(this.scene),this.popup=k):this.unAddPopup=k}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(k){this.scene=k,this.mapsService=k.get(V.v.IMapService)}}]),ee}())||an),ti=y(82492),Qi=y.n(ti),Ai={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Pi=Ai,q,le;function pe(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function U(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?pe(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):pe(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}var ae={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},de={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Pe=(q=(0,E.b2)(),q(le=function(){function ee(){(0,G.Z)(this,ee),(0,L.Z)(this,"sceneConfigCache",{}),(0,L.Z)(this,"layerConfigCache",{})}return(0,I.Z)(ee,[{key:"getSceneConfig",value:function(k){return this.sceneConfigCache[k]}},{key:"getSceneWarninfo",value:function(k){return Pi[k]}},{key:"setSceneConfig",value:function(k,F){this.sceneConfigCache[k]=U(U({},ae),F)}},{key:"getLayerConfig",value:function(k){return this.layerConfigCache[k]}},{key:"setLayerConfig",value:function(k,F,ie){this.layerConfigCache[F]=U({},Qi()({},this.sceneConfigCache[k],de,ie))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),ee}())||le),ue=y(55770),Ee=y(3473),mt=y(98333),wr=Math.PI/180,Yt=512,tr=4003e4;function Ur(ee){var ne=ee.latitude,k=ne===void 0?0:ne,F=ee.zoom,ie=F===void 0?0:F,Te=ee.scale,ft=ee.highPrecision,Gt=ft===void 0?!1:ft,Et=ee.flipY,Qt=Et===void 0?!1:Et;Te=Te!==void 0?Te:Math.pow(2,ie);var Fr={},Bn=Yt*Te,zn=Math.cos(k*wr),hi=Bn/360,ui=hi/zn,yi=Bn/tr/zn;if(Fr.pixelsPerMeter=[yi,-yi,yi],Fr.metersPerPixel=[1/yi,-1/yi,1/yi],Fr.pixelsPerDegree=[hi,-ui,yi],Fr.degreesPerPixel=[1/hi,-1/ui,1/yi],Gt){var Ki=wr*Math.tan(k*wr)/zn,_a=hi*Ki/2,xa=Bn/tr*Ki,Ya=xa/ui*yi;Fr.pixelsPerDegree2=[0,-_a,xa],Fr.pixelsPerMeter2=[Ya,0,Ya],Qt&&(Fr.pixelsPerDegree2[1]=-Fr.pixelsPerDegree2[1],Fr.pixelsPerMeter2[1]=-Fr.pixelsPerMeter2[1])}return Qt&&(Fr.pixelsPerMeter[1]=-Fr.pixelsPerMeter[1],Fr.metersPerPixel[1]=-Fr.metersPerPixel[1],Fr.pixelsPerDegree[1]=-Fr.pixelsPerDegree[1],Fr.degreesPerPixel[1]=-Fr.degreesPerPixel[1]),Fr}var Fn=y(47282),Rn,qt,Tn,ln,on,Li=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],bn=(Rn=(0,E.b2)(),qt=(0,E.f3)(V.v.ICameraService),Rn(Tn=(ln=function(){function ee(){(0,G.Z)(this,ee),(0,L.Z)(this,"needRefresh",!0),(0,ue.Z)(this,"cameraService",on,this),(0,L.Z)(this,"coordinateSystem",void 0),(0,L.Z)(this,"viewportCenter",void 0),(0,L.Z)(this,"viewportCenterProjection",void 0),(0,L.Z)(this,"pixelsPerDegree",void 0),(0,L.Z)(this,"pixelsPerDegree2",void 0),(0,L.Z)(this,"pixelsPerMeter",void 0)}return(0,I.Z)(ee,[{key:"refresh",value:function(){var k=this.cameraService.getZoom(),F=this.cameraService.getZoomScale(),ie=this.cameraService.getCenter(),Te=Ur({latitude:ie[1],zoom:k}),ft=Te.pixelsPerMeter,Gt=Te.pixelsPerDegree;this.viewportCenter=ie,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=ft,this.pixelsPerDegree=Gt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Fn.l.LNGLAT||this.coordinateSystem===Fn.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Fn.l.LNGLAT_OFFSET?this.calculateLnglatOffset(ie,k):this.coordinateSystem===Fn.l.P20_OFFSET&&this.calculateLnglatOffset(ie,k,F,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(k){this.coordinateSystem=k}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(k,F,ie,Te){var ft=Ur({latitude:k[1],zoom:F,scale:ie,flipY:Te,highPrecision:!0}),Gt=ft.pixelsPerMeter,Et=ft.pixelsPerDegree,Qt=ft.pixelsPerDegree2,Fr=this.cameraService.getViewMatrix(),Bn=this.cameraService.getProjectionMatrix(),zn=Q.multiply([],Bn,Fr),hi=this.cameraService.projectFlat([Math.fround(k[0]),Math.fround(k[1])],Math.pow(2,F));this.viewportCenterProjection=mt.fF([],[hi[0],hi[1],0,1],zn),Fr=this.cameraService.getViewMatrixUncentered()||Fr,zn=Q.multiply([],Bn,Fr),zn=Q.multiply([],zn,Li),this.cameraService.setViewProjectionMatrix(zn),this.pixelsPerMeter=Gt,this.pixelsPerDegree=Et,this.pixelsPerDegree2=Qt}}]),ee}(),on=(0,Ee.Z)(ln.prototype,"cameraService",[qt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ln))||Tn),Ii=y(50840),ea=y.n(Ii),ci=y(89648),qi,zi,Mi,la,Bi;function ai(ee){var ne=ki();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function ki(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var wi={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},ro=(qi=(0,E.b2)(),zi=(0,E.f3)(V.v.IMapService),qi(Mi=(la=function(ee){(0,kt.Z)(k,ee);var ne=ai(k);function k(){var F;(0,G.Z)(this,k);for(var ie=arguments.length,Te=new Array(ie),ft=0;ft<ie;ft++)Te[ft]=arguments[ft];return F=ne.call.apply(ne,[this].concat(Te)),(0,ue.Z)((0,Re.Z)(F),"mapService",Bi,(0,Re.Z)(F)),(0,L.Z)((0,Re.Z)(F),"hammertime",void 0),(0,L.Z)((0,Re.Z)(F),"lastClickTime",0),(0,L.Z)((0,Re.Z)(F),"lastClickXY",[-1,-1]),(0,L.Z)((0,Re.Z)(F),"clickTimer",void 0),(0,L.Z)((0,Re.Z)(F),"$containter",void 0),(0,L.Z)((0,Re.Z)(F),"onDrag",function(Gt){var Et=F.interactionEvent(Gt);Et.type=wi[Et.type],F.emit(ci.s.Drag,Et)}),(0,L.Z)((0,Re.Z)(F),"onHammer",function(Gt){Gt.srcEvent.stopPropagation();var Et=F.interactionEvent(Gt);F.emit(ci.s.Hover,Et)}),(0,L.Z)((0,Re.Z)(F),"onTouch",function(Gt){var Et=Gt.touches[0];F.onHover({x:Et.pageX,y:Et.pageY,type:"touch"})}),(0,L.Z)((0,Re.Z)(F),"onHover",function(Gt){var Et=Gt.clientX,Qt=Gt.clientY,Fr=Et,Bn=Qt,zn=Gt.type,hi=F.mapService.getMapContainer();if(hi){var ui=hi.getBoundingClientRect(),yi=ui.top,Ki=ui.left;Fr=Fr-Ki-hi.clientLeft,Bn=Bn-yi-hi.clientTop}var _a=F.mapService.containerToLngLat([Fr,Bn]);if(zn==="click"){if("ontouchstart"in document.documentElement)return;F.isDoubleTap(Fr,Bn,_a);return}if(zn==="touch"){F.isDoubleTap(Fr,Bn,_a);return}zn!=="click"&&zn!=="dblclick"&&F.emit(ci.s.Hover,{x:Fr,y:Bn,lngLat:_a,type:zn,target:Gt})}),F}return(0,I.Z)(k,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ci.s.Hover)}},{key:"triggerHover",value:function(ie){var Te=ie.x,ft=ie.y;this.emit(ci.s.Hover,{x:Te,y:ft})}},{key:"triggerSelect",value:function(ie){this.emit(ci.s.Select,{featureId:ie})}},{key:"triggerActive",value:function(ie){this.emit(ci.s.Active,{featureId:ie})}},{key:"addEventListenerOnMap",value:function(){var ie=this.mapService.getMapContainer();if(ie){var Te=new(ea()).Manager(ie);Te.add(new(ea()).Tap({event:"dblclick",taps:2})),Te.add(new(ea()).Tap({event:"click"})),Te.add(new(ea()).Pan({threshold:0,pointers:0})),Te.add(new(ea()).Press({})),Te.on("dblclick click",this.onHammer),Te.on("panstart panmove panend pancancel",this.onDrag),ie.addEventListener("mousemove",this.onHover),ie.addEventListener("mousedown",this.onHover,!0),ie.addEventListener("mouseup",this.onHover),ie.addEventListener("contextmenu",this.onHover),this.hammertime=Te}}},{key:"removeEventListenerOnMap",value:function(){var ie=this.mapService.getMapContainer();ie&&(ie.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),ie.removeEventListener("mousedown",this.onHover),ie.removeEventListener("mouseup",this.onHover),ie.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(ie){var Te=ie.type,ft=ie.pointerType,Gt,Et;ft==="touch"?(Et=Math.floor(ie.pointers[0].clientY),Gt=Math.floor(ie.pointers[0].clientX)):(Et=Math.floor(ie.srcEvent.y),Gt=Math.floor(ie.srcEvent.x));var Qt=this.mapService.getMapContainer();if(Qt){var Fr=Qt.getBoundingClientRect(),Bn=Fr.top,zn=Fr.left;Gt-=zn,Et-=Bn}var hi=this.mapService.containerToLngLat([Gt,Et]);return{x:Gt,y:Et,lngLat:hi,type:Te,target:ie.srcEvent}}},{key:"isDoubleTap",value:function(ie,Te,ft){var Gt=this,Et=new Date().getTime(),Qt="click";Et-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-ie)<10&&Math.abs(this.lastClickXY[1]-Te)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),Qt="dblclick",this.emit(ci.s.Hover,{x:ie,y:Te,lngLat:ft,type:Qt})):(this.lastClickTime=Et,this.lastClickXY=[ie,Te],this.clickTimer=setTimeout(function(){Qt="click",Gt.emit(ci.s.Hover,{x:ie,y:Te,lngLat:ft,type:Qt})},400))}}]),k}(p()),Bi=(0,Ee.Z)(la.prototype,"mapService",[zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),la))||Mi),po=y(92137),ia=y(87757),Gi=y.n(ia),Zs=window.document.documentElement.style,nu=0;function Aa(ee){var ne=ee;if(typeof ee=="string"&&(ne=document.getElementById(ee)),ne){var k=document.createElement("div");return k.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,k.id="l7-scene-".concat(nu++),k.classList.add("l7-scene"),ne.appendChild(k),k}return null}function No(ee){var ne,k,F=!0;return ee==null||(ne=ee.target)===null||ne===void 0||(k=ne.path)===null||k===void 0||k.map(function(ie){if(ie!=null&&ie.classList){var Te;ie==null||(Te=ie.classList)===null||Te===void 0||Te.forEach(function(ft){(ft==="l7-marker"||ft==="l7-popup")&&(F=!1)})}}),F}var Hi=y(7648),Wa,ao,ga,Lo,Fa,Cs,Fi,Ko,ya,vo,Da;function So(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function xe(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?So(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):So(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}var Fe=(Wa=(0,E.b2)(),ao=(0,E.f3)(V.v.IRendererService),ga=(0,E.f3)(V.v.IGlobalConfigService),Lo=(0,E.f3)(V.v.IInteractionService),Fa=(0,E.f3)(V.v.ILayerService),Wa(Cs=(Fi=function(){function ee(){var ne=this;(0,G.Z)(this,ee),(0,ue.Z)(this,"rendererService",Ko,this),(0,ue.Z)(this,"configService",ya,this),(0,ue.Z)(this,"interactionService",vo,this),(0,ue.Z)(this,"layerService",Da,this),(0,L.Z)(this,"pickingFBO",void 0),(0,L.Z)(this,"width",0),(0,L.Z)(this,"height",0),(0,L.Z)(this,"alreadyInPicking",!1),(0,L.Z)(this,"pickBufferScale",1),(0,L.Z)(this,"pickFromPickingFBO",function(k,F){var ie,Te=F.x,ft=F.y,Gt=F.lngLat,Et=F.type,Qt=F.target,Fr=!1,Bn=ne.rendererService,zn=Bn.getViewportSize,hi=Bn.readPixels,ui=Bn.getContainer,yi=ui().getBoundingClientRect(),Ki=yi.width,_a=yi.height;Ki*=_e.SO.DPR,_a*=_e.SO.DPR;var xa=k.getLayerConfig(),Ya=xa.enableHighlight,Na=xa.enableSelect,wo=Te*_e.SO.DPR,La=ft*_e.SO.DPR;if(wo>Ki-1*_e.SO.DPR||wo<0||La>_a-1*_e.SO.DPR||La<0)return!1;var Ea;if(Ea=hi({x:Math.floor(wo/ne.pickBufferScale),y:Math.floor((_a-(ft+1)*_e.SO.DPR)/ne.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:ne.pickingFBO}),Ea[0]!==0||Ea[1]!==0||Ea[2]!==0){var fa=(0,_e.W0)(Ea),ma=k.getSource().getFeatureById(fa);fa!==k.getCurrentPickId()&&Et==="mousemove"&&(Et="mouseenter");var Ga={x:Te,y:ft,type:Et,lngLat:Gt,featureId:fa,feature:ma,target:Qt};ma&&(Fr=!0,k.setCurrentPickId(fa),ne.triggerHoverOnLayer(k,Ga))}else{var za={x:Te,y:ft,lngLat:Gt,type:k.getCurrentPickId()!==null&&Et==="mousemove"?"mouseout":"un"+Et,featureId:null,target:Qt,feature:null};ne.triggerHoverOnLayer(k,xe(xe({},za),{},{type:"unpick"})),ne.triggerHoverOnLayer(k,za),k.setCurrentPickId(null)}if(Ya&&ne.highlightPickedFeature(k,Ea),Na&&Et==="click"&&((ie=Ea)===null||ie===void 0?void 0:ie.toString())!==[0,0,0,0].toString()){var ko=(0,_e.W0)(Ea);k.getCurrentSelectedId()===null||ko!==k.getCurrentSelectedId()?(ne.selectFeature(k,Ea),k.setCurrentSelectedId(ko)):(ne.selectFeature(k,new Uint8Array([0,0,0,0])),k.setCurrentSelectedId(null))}return Fr})}return(0,I.Z)(ee,[{key:"init",value:function(k){var F=this.rendererService,ie=F.createTexture2D,Te=F.createFramebuffer,ft=F.getViewportSize,Gt=F.getContainer,Et=Gt().getBoundingClientRect(),Qt=Et.width,Fr=Et.height;Qt*=_e.SO.DPR,Fr*=_e.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(k).pickBufferScale||1,this.pickingFBO=Te({color:ie({width:Math.round(Qt/this.pickBufferScale),height:Math.round(Fr/this.pickBufferScale),wrapS:Hi.gl.CLAMP_TO_EDGE,wrapT:Hi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(ci.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var ne=(0,po.Z)(Gi().mark(function F(ie,Te,ft){var Gt=this,Et,Qt,Fr,Bn;return Gi().wrap(function(hi){for(;;)switch(hi.prev=hi.next){case 0:Et=this.rendererService,Qt=Et.useFramebuffer,Fr=Et.clear,Bn=Et.getContainer,this.resizePickingFBO(),Qt(this.pickingFBO,function(){Fr({framebuffer:Gt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),ie.hooks.beforePickingEncode.call(),ie.renderModels(),ie.hooks.afterPickingEncode.call();var ui=Gt.pickBox(ie,Te);ft(ui)});case 3:case"end":return hi.stop()}},F,this)}));function k(F,ie,Te){return ne.apply(this,arguments)}return k}()},{key:"pickBox",value:function(k,F){var ie=this,Te=F.map(function(za){var ko=za<0?0:za;return Math.floor(ko*_e.SO.DPR/ie.pickBufferScale)}),ft=(0,At.Z)(Te,4),Gt=ft[0],Et=ft[1],Qt=ft[2],Fr=ft[3],Bn=this.rendererService,zn=Bn.getViewportSize,hi=Bn.readPixels,ui=Bn.getContainer,yi=ui().getBoundingClientRect(),Ki=yi.width,_a=yi.height;if(Ki*=_e.SO.DPR,_a*=_e.SO.DPR,Gt>(Ki-1)*_e.SO.DPR/this.pickBufferScale||Qt<0||Et>(_a-1)*_e.SO.DPR/this.pickBufferScale||Fr<0)return[];var xa,Ya=Math.min(Ki/this.pickBufferScale,Qt)-Gt,Na=Math.min(_a/this.pickBufferScale,Fr)-Et;xa=hi({x:Gt,y:Math.floor(_a/this.pickBufferScale-(Fr+1)),width:Ya,height:Na,data:new Uint8Array(Ya*Na*4),framebuffer:this.pickingFBO});for(var wo=[],La={},Ea=0;Ea<xa.length/4;Ea=Ea+1){var fa=xa.slice(Ea*4,Ea*4+4),ma=(0,_e.W0)(fa);if(ma!==-1&&!La[ma]){var Ga=k.getSource().getFeatureById(ma);wo.push(Ga),La[ma]=!0}}return wo}},{key:"pickingAllLayer",value:function(){var ne=(0,po.Z)(Gi().mark(function F(ie){return Gi().wrap(function(ft){for(;;)switch(ft.prev=ft.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){ft.next=2;break}return ft.abrupt("return");case 2:return this.alreadyInPicking=!0,ft.next=5,this.pickingLayers(ie);case 5:this.layerService.renderLayers("picking"),this.alreadyInPicking=!1;case 7:case"end":return ft.stop()}},F,this)}));function k(F){return ne.apply(this,arguments)}return k}()},{key:"resizePickingFBO",value:function(){var k=this.rendererService.getContainer,F=k().getBoundingClientRect(),ie=F.width,Te=F.height;ie*=_e.SO.DPR,Te*=_e.SO.DPR,(this.width!==ie||this.height!==Te)&&(this.pickingFBO.resize({width:Math.round(ie/this.pickBufferScale),height:Math.round(Te/this.pickBufferScale)}),this.width=ie,this.height=Te)}},{key:"pickingLayers",value:function(){var ne=(0,po.Z)(Gi().mark(function F(ie){var Te=this,ft,Gt,Et,Qt,Fr;return Gi().wrap(function(zn){for(;;)switch(zn.prev=zn.next){case 0:ft=this.rendererService,Gt=ft.getViewportSize,Et=ft.useFramebuffer,Qt=ft.clear,Fr=ft.getContainer,this.resizePickingFBO(),Et(this.pickingFBO,function(){var hi=Te.layerService.getLayers();hi.filter(function(ui){return ui.needPick(ie.type)}).reverse().some(function(ui){Qt({framebuffer:Te.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),ui.hooks.beforePickingEncode.call(),ui.renderModels(),ui.hooks.afterPickingEncode.call();var yi=Te.pickFromPickingFBO(ui,ie);return yi&&!ui.getLayerConfig().enablePropagation})});case 3:case"end":return zn.stop()}},F,this)}));function k(F){return ne.apply(this,arguments)}return k}()},{key:"triggerHoverOnLayer",value:function(k,F){No(F)&&k.emit(F.type,F)}},{key:"highlightPickedFeature",value:function(k,F){var ie=(0,At.Z)(F,3),Te=ie[0],ft=ie[1],Gt=ie[2];k.hooks.beforeHighlight.call([Te,ft,Gt])}},{key:"selectFeature",value:function(k,F){var ie=(0,At.Z)(F,3),Te=ie[0],ft=ie[1],Gt=ie[2];k.hooks.beforeSelect.call([Te,ft,Gt])}}]),ee}(),Ko=(0,Ee.Z)(Fi.prototype,"rendererService",[ao],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ya=(0,Ee.Z)(Fi.prototype,"configService",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vo=(0,Ee.Z)(Fi.prototype,"interactionService",[Lo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Da=(0,Ee.Z)(Fi.prototype,"layerService",[Fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fi))||Cs),pt=function(){function ee(){var ne=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,G.Z)(this,ee),(0,L.Z)(this,"autoStart",void 0),(0,L.Z)(this,"startTime",0),(0,L.Z)(this,"oldTime",0),(0,L.Z)(this,"running",!1),(0,L.Z)(this,"elapsedTime",0),this.autoStart=ne}return(0,I.Z)(ee,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var k=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var F=(typeof performance=="undefined"?Date:performance).now();k=(F-this.oldTime)/1e3,this.oldTime=F,this.elapsedTime+=k}return k}}]),ee}(),Jt,Yr,Qn,Ci,Za,mo,oo,es=(Jt=(0,E.b2)(),Yr=(0,E.f3)(V.v.IRendererService),Qn=(0,E.f3)(V.v.IGlobalConfigService),Jt(Ci=(Za=function(){function ee(){(0,G.Z)(this,ee),(0,L.Z)(this,"clock",new pt),(0,L.Z)(this,"alreadyInRendering",!1),(0,L.Z)(this,"layers",[]),(0,L.Z)(this,"layerRenderID",void 0),(0,L.Z)(this,"sceneInited",!1),(0,L.Z)(this,"animateInstanceCount",0),(0,L.Z)(this,"lastRenderType",void 0),(0,L.Z)(this,"lastPickRenderTime",void 0),(0,ue.Z)(this,"renderService",mo,this),(0,ue.Z)(this,"configService",oo,this)}return(0,I.Z)(ee,[{key:"add",value:function(k){this.sceneInited&&k.init(),this.layers.push(k)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(k){k.inited||k.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(k){return this.layers.find(function(F){return F.id===k})}},{key:"getLayerByName",value:function(k){return this.layers.find(function(F){return F.name===k})}},{key:"remove",value:function(k){var F=this.layers.indexOf(k);F>-1&&this.layers.splice(F,1),k.emit("remove",null),k.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(k){!this.renderTest(k)||this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(F){return F.inited}).filter(function(F){return F.isVisible()}).forEach(function(F){F.hooks.beforeRenderData.call(),F.hooks.beforeRender.call(),F.render(),F.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(k,F){return k.zIndex-F.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(k){return k.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"renderTest",value:function(k){var F=new Date().getTime(),ie=F-this.lastPickRenderTime;if(k==="picking"&&(this.lastPickRenderTime=new Date().getTime()),k)switch(k){case"picking":return this.lastRenderType==="mapRender"||this.lastRenderType==="animate"?(this.lastRenderType="picking",ie>48):(this.lastRenderType="picking",!0);case"animate":return this.lastRenderType==="mapRender"?(this.lastRenderType="animate",!1):(this.lastRenderType="animate",!0);case"mapRender":return this.lastRenderType="mapRender",!0;default:return!0}return!0}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers("animate"),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),ee}(),mo=(0,Ee.Z)(Za.prototype,"renderService",[Yr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oo=(0,Ee.Z)(Za.prototype,"configService",[Qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Za))||Ci),$s=y(81253),ja=y(85061),Fu=y(14293),ts=y.n(Fu),zo=function(){function ee(ne){var k=this;(0,G.Z)(this,ee),(0,L.Z)(this,"name",void 0),(0,L.Z)(this,"type",void 0),(0,L.Z)(this,"scale",void 0),(0,L.Z)(this,"descriptor",void 0),(0,L.Z)(this,"featureBufferLayout",[]),(0,L.Z)(this,"needRescale",!1),(0,L.Z)(this,"needRemapping",!1),(0,L.Z)(this,"needRegenerateVertices",!1),(0,L.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,L.Z)(this,"vertexAttribute",void 0),(0,L.Z)(this,"defaultCallback",function(F){if(F.length===0){var ie;return((ie=k.scale)===null||ie===void 0?void 0:ie.defaultValues)||[]}return F.map(function(Te,ft){var Gt,Et=(Gt=k.scale)===null||Gt===void 0?void 0:Gt.scalers[ft].func,Qt=Et(Te);return Qt})}),this.setProps(ne)}return(0,I.Z)(ee,[{key:"setProps",value:function(k){Object.assign(this,k)}},{key:"mapping",value:function(k){var F;if((F=this.scale)!==null&&F!==void 0&&F.callback){var ie,Te=(ie=this.scale)===null||ie===void 0?void 0:ie.callback.apply(ie,(0,ja.Z)(k));if(!ts()(Te))return[Te]}return this.defaultCallback(k)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),ee}(),so,oi,ys,rs,Bs,ns;function Pa(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function uo(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?Pa(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):Pa(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}function yl(ee){return new Promise(function(ne){return setTimeout(ne,ee)})}var _l=(so={},(0,L.Z)(so,Hi.gl.FLOAT,4),(0,L.Z)(so,Hi.gl.UNSIGNED_BYTE,1),(0,L.Z)(so,Hi.gl.UNSIGNED_SHORT,2),so),Bu=(oi=(0,E.b2)(),ys=(0,E.f3)(V.v.IRendererService),oi(rs=(Bs=function(){function ee(){(0,G.Z)(this,ee),(0,L.Z)(this,"attributesAndIndices",void 0),(0,ue.Z)(this,"rendererService",ns,this),(0,L.Z)(this,"attributes",[]),(0,L.Z)(this,"triangulation",void 0),(0,L.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,I.Z)(ee,[{key:"registerStyleAttribute",value:function(k){var F=this.getLayerStyleAttribute(k.name||"");return F?F.setProps(k):(F=new zo(k),this.attributes.push(F)),F}},{key:"updateStyleAttribute",value:function(k,F,ie){var Te=this.getLayerStyleAttribute(k);Te||(Te=this.registerStyleAttribute(uo(uo({},F),{},{name:k})));var ft=F.scale;ft&&Te&&(Te.scale=ft,Te.needRescale=!0,Te.needRemapping=!0,Te.needRegenerateVertices=!0,ie&&ie.featureRange&&(Te.featureRange=ie.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(k){return this.attributes.find(function(F){return F.name===k})}},{key:"getLayerAttributeScale",value:function(k){var F,ie=this.getLayerStyleAttribute(k),Te=ie==null||(F=ie.scale)===null||F===void 0?void 0:F.scalers;return Te&&Te[0]?Te[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(k,F){var ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,Te=arguments.length>3?arguments[3]:void 0,ft=this.attributes.find(function(Na){return Na.name===k});if(ft&&ft.descriptor){var Gt=ft.descriptor,Et=Gt.update,Qt=Gt.buffer,Fr=Gt.size,Bn=Fr===void 0?0:Fr,zn=_l[Qt.type||Hi.gl.FLOAT];if(Et){var hi=this.featureLayout,ui=hi.elements,yi=hi.sizePerElement,Ki=ui.slice(ie,Te);if(!Ki.length)return;var _a=Ki[0].offset,xa=_a*Bn*zn,Ya=Ki.map(function(Na,wo){for(var La=Na.featureIdx,Ea=Na.vertices,fa=Na.normals,ma=Ea.length/yi,Ga=[],za=0;za<ma;za++){var ko=fa?fa.slice(za*3,za*3+3):[];Ga.push.apply(Ga,(0,ja.Z)(Et(F[La],La,Ea.slice(za*yi,za*yi+yi),wo,ko)))}return Ga}).reduce(function(Na,wo){return Na.push.apply(Na,(0,ja.Z)(wo)),Na},[]);ft.vertexAttribute.updateBuffer({data:Ya,offset:xa})}}}},{key:"createAttributesAndIndices",value:function(k,F,ie){var Te=this;this.featureLayout={sizePerElement:0,elements:[]},F&&(this.triangulation=F);var ft=this.attributes.map(function(xa){return xa.resetDescriptor(),xa.descriptor}),Gt=0,Et=[],Qt=[],Fr=[],Bn=3;k.forEach(function(xa,Ya){var Na=Te.triangulation(xa,ie),wo=Na.indices,La=Na.vertices,Ea=Na.normals,fa=Na.size;wo.forEach(function(ko){Qt.push(ko+Gt)}),Bn=fa;var ma=La.length/fa;Te.featureLayout.sizePerElement=Bn,Te.featureLayout.elements.push({featureIdx:Ya,vertices:La,normals:Ea,offset:Gt}),Gt+=ma;for(var Ga=function(Zi){var $o=(Ea==null?void 0:Ea.slice(Zi*3,Zi*3+3))||[],Po=La.slice(Zi*fa,Zi*fa+fa);ft.forEach(function(To,Ac){if(To&&To.update){var Du;(Du=To.buffer.data).push.apply(Du,(0,ja.Z)(To.update(xa,Ya,Po,Zi,$o)))}})},za=0;za<ma;za++)Ga(za)});var zn=this.rendererService,hi=zn.createAttribute,ui=zn.createBuffer,yi=zn.createElements,Ki={};ft.forEach(function(xa,Ya){if(xa){var Na=xa.buffer,wo=xa.update,La=xa.name,Ea=(0,$s.Z)(xa,["buffer","update","name"]),fa=hi(uo({buffer:ui(Na)},Ea));Ki[xa.name||""]=fa,Te.attributes[Ya].vertexAttribute=fa}});var _a=yi({data:Qt,type:Hi.gl.UNSIGNED_INT,count:Qt.length});return this.attributesAndIndices={attributes:Ki,elements:_a},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var k;this.attributes.forEach(function(F){F.vertexAttribute&&F.vertexAttribute.destroy()}),(k=this.attributesAndIndices)===null||k===void 0||k.elements.destroy(),this.attributes=[]}}]),ee}(),ns=(0,Ee.Z)(Bs.prototype,"rendererService",[ys],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bs))||rs),Vl=y(46343),Eu=y(67709),lo=y.n(Eu),js,ws,m,T,H,R,ce,ye,lt,Vt,Mt,Ir,Hr,qn,bi,di,ca,Wi,ka,Xi,Yi,Js,Cu,xl,wu,ds,vs,ms,Ts,co,Gl,Hl,is;function Wl(ee){var ne=As();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function As(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var _s=(js=(0,E.b2)(),ws=(0,E.f3)(V.v.SceneID),m=(0,E.f3)(V.v.IIconService),T=(0,E.f3)(V.v.IFontService),H=(0,E.f3)(V.v.IControlService),R=(0,E.f3)(V.v.IGlobalConfigService),ce=(0,E.f3)(V.v.IMapService),ye=(0,E.f3)(V.v.ICoordinateSystemService),lt=(0,E.f3)(V.v.IRendererService),Vt=(0,E.f3)(V.v.ILayerService),Mt=(0,E.f3)(V.v.ICameraService),Ir=(0,E.f3)(V.v.IInteractionService),Hr=(0,E.f3)(V.v.IPickingService),qn=(0,E.f3)(V.v.IShaderModuleService),bi=(0,E.f3)(V.v.IMarkerService),di=(0,E.f3)(V.v.IPopupService),js(ca=(Wi=function(ee){(0,kt.Z)(k,ee);var ne=Wl(k);function k(){var F;return(0,G.Z)(this,k),F=ne.call(this),(0,L.Z)((0,Re.Z)(F),"destroyed",!1),(0,L.Z)((0,Re.Z)(F),"loaded",!1),(0,L.Z)((0,Re.Z)(F),"loadFont",!1),(0,L.Z)((0,Re.Z)(F),"fontFamily",""),(0,ue.Z)((0,Re.Z)(F),"id",ka,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"iconService",Xi,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"fontService",Yi,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"controlService",Js,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"configService",Cu,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"map",xl,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"coordinateSystemService",wu,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"rendererService",ds,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"layerService",vs,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"cameraService",ms,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"interactionService",Ts,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"pickingService",co,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"shaderModuleService",Gl,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"markerService",Hl,(0,Re.Z)(F)),(0,ue.Z)((0,Re.Z)(F),"popupService",is,(0,Re.Z)(F)),(0,L.Z)((0,Re.Z)(F),"inited",!1),(0,L.Z)((0,Re.Z)(F),"initPromise",void 0),(0,L.Z)((0,Re.Z)(F),"rendering",!1),(0,L.Z)((0,Re.Z)(F),"$container",void 0),(0,L.Z)((0,Re.Z)(F),"canvas",void 0),(0,L.Z)((0,Re.Z)(F),"markerContainer",void 0),(0,L.Z)((0,Re.Z)(F),"hooks",void 0),(0,L.Z)((0,Re.Z)(F),"handleWindowResized",function(){F.emit("resize"),F.$container&&(F.initContainer(),_e.SO.triggerResize(),F.coordinateSystemService.needRefresh=!0,F.render())}),(0,L.Z)((0,Re.Z)(F),"handleMapCameraChanged",function(ie){F.cameraService.update(ie),F.render("mapRender")}),F.hooks={init:new Vl.zj},F}return(0,I.Z)(k,[{key:"init",value:function(ie){var Te=this;this.configService.setSceneConfig(this.id,ie),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,po.Z)(Gi().mark(function ft(){return Gi().wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:return Et.next=2,new Promise(function(Qt){Te.map.onCameraChanged(function(Fr){Te.cameraService.init(),Te.cameraService.update(Fr),Te.map.version!=="GAODE2.x"&&Qt()}),Te.map.version!=="GAODE2.x"?Te.map.init():Qt()});case 2:if(!(Te.map.version==="GAODE2.x"&&Te.map.initViewPort)){Et.next=6;break}return Et.next=5,Te.map.init();case 5:Te.map.initViewPort();case 6:Te.map.onCameraChanged(Te.handleMapCameraChanged),Te.map.addMarkerContainer(),Te.markerService.addMarkers(),Te.markerService.addMarkerLayers(),Te.popupService.initPopup(),Te.interactionService.init(),Te.interactionService.on(ci.s.Drag,Te.addSceneEvent.bind(Te));case 13:case"end":return Et.stop()}},ft)}))),this.hooks.init.tapPromise("initRenderer",(0,po.Z)(Gi().mark(function ft(){var Gt;return Gi().wrap(function(Qt){for(;;)switch(Qt.prev=Qt.next){case 0:if(Gt=Aa(Te.configService.getSceneConfig(Te.id).id||""),Te.$container=Gt,!Gt){Qt.next=11;break}return Te.canvas=_e.SO.create("canvas","",Gt),Te.setCanvas(),Qt.next=7,Te.rendererService.init(Te.canvas,Te.configService.getSceneConfig(Te.id));case 7:lo()(Te.$container,Te.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(Te.handleWindowResized),Qt.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:Te.pickingService.init(Te.id);case 13:case"end":return Qt.stop()}},ft)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(ie){this.layerService.add(ie),this.render()}},{key:"render",value:function(){var F=(0,po.Z)(Gi().mark(function Te(ft){return Gi().wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:if(!(this.rendering||this.destroyed)){Et.next=2;break}return Et.abrupt("return");case 2:if(this.rendering=!0,this.inited){Et.next=15;break}return Et.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){Et.next=10;break}return Et.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(ft),this.rendering=!1;case 17:case"end":return Et.stop()}},Te,this)}));function ie(Te){return F.apply(this,arguments)}return ie}()},{key:"addFontFace",value:function(ie,Te){this.fontFamily=ie;var ft=document.createElement("style");ft.type="text/css",ft.innerText=`
        @font-face{
            font-family: '`.concat(ie,`';
            src: url('`).concat(Te,`') format('woff2'),
            url('`).concat(Te,`') format('woff'),
            url('`).concat(Te,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(ft),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(ie){var Te,ft=(Te=this.$container)===null||Te===void 0?void 0:Te.getElementsByTagName("canvas")[0];this.render();var Gt=ie==="jpg"?ft==null?void 0:ft.toDataURL("image/jpeg"):ft==null?void 0:ft.toDataURL("image/png");return Gt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var ie=this.$container.parentElement;ie!==null&&(this.markerContainer=_e.SO.create("div","l7-marker-container",ie))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var ie,Te;if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(ie=this.$container)===null||ie===void 0||(Te=ie.parentNode)===null||Te===void 0||Te.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Eu.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var ie,Te,ft=_e.SO.DPR,Gt=((ie=this.$container)===null||ie===void 0?void 0:ie.clientWidth)||400,Et=((Te=this.$container)===null||Te===void 0?void 0:Te.clientHeight)||300,Qt=this.canvas;Qt&&(Qt.width=Gt*ft,Qt.height=Et*ft,Qt.style.width="".concat(Gt,"px"),Qt.style.height="".concat(Et,"px")),this.rendererService.viewport({x:0,y:0,width:ft*Gt,height:ft*Et})}},{key:"setCanvas",value:function(){var ie,Te,ft=_e.SO.DPR,Gt=((ie=this.$container)===null||ie===void 0?void 0:ie.clientWidth)||400,Et=((Te=this.$container)===null||Te===void 0?void 0:Te.clientHeight)||300,Qt=this.canvas;Qt.width=Gt*ft,Qt.height=Et*ft,Qt.style.width="".concat(Gt,"px"),Qt.style.height="".concat(Et,"px")}},{key:"addSceneEvent",value:function(ie){this.emit(ie.type,ie)}}]),k}(b.EventEmitter),ka=(0,Ee.Z)(Wi.prototype,"id",[ws],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xi=(0,Ee.Z)(Wi.prototype,"iconService",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yi=(0,Ee.Z)(Wi.prototype,"fontService",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Js=(0,Ee.Z)(Wi.prototype,"controlService",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cu=(0,Ee.Z)(Wi.prototype,"configService",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xl=(0,Ee.Z)(Wi.prototype,"map",[ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wu=(0,Ee.Z)(Wi.prototype,"coordinateSystemService",[ye],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ds=(0,Ee.Z)(Wi.prototype,"rendererService",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vs=(0,Ee.Z)(Wi.prototype,"layerService",[Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ms=(0,Ee.Z)(Wi.prototype,"cameraService",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ts=(0,Ee.Z)(Wi.prototype,"interactionService",[Ir],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),co=(0,Ee.Z)(Wi.prototype,"pickingService",[Hr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gl=(0,Ee.Z)(Wi.prototype,"shaderModuleService",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hl=(0,Ee.Z)(Wi.prototype,"markerService",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),is=(0,Ee.Z)(Wi.prototype,"popupService",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wi))||ca),Xl=y(44908),Nu=y.n(Xl);function Ia(ee){var ne=0;switch(ee){case"vec2":case"ivec2":ne=2;break;case"vec3":case"ivec3":ne=3;break;case"vec4":case"ivec4":case"mat2":ne=4;break;case"mat3":ne=9;break;case"mat4":ne=16;break;default:}return ne}var zu=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Fc(ee){var ne={};return ee=ee.replace(zu,function(k,F,ie){var Te=ie.split(":"),ft=Te[0].trim(),Gt="";switch(Te.length>1&&(Gt=Te[1].trim()),F){case"bool":Gt=Gt==="true";break;case"float":case"int":Gt=Number(Gt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":Gt?Gt=Gt.replace("[","").replace("]","").split(",").reduce(function(Et,Qt){return Et.push(Number(Qt.trim())),Et},[]):Gt=new Array(Ia(F)).fill(0);break;default:}return ne[ft]=Gt,"uniform ".concat(F," ").concat(ft,`;
`)}),{content:ee,uniforms:ne}}var Tu,Yl;function Bc(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function rl(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?Bc(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):Bc(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}var nl="#define PI 3.14159265359",bl=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,il=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Sl=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,al=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,ol=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,sl=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,iu=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Qs=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,gc=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,yc=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Nc=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Uu=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,El=/precision\s+(high|low|medium)p\s+float/,Kl=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,_c=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,$l=(Tu=(0,E.b2)(),Tu(Yl=function(){function ee(){(0,G.Z)(this,ee),(0,L.Z)(this,"moduleCache",{}),(0,L.Z)(this,"rawContentCache",{})}return(0,I.Z)(ee,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:nl,fs:nl}),this.registerModule("decode",{vs:bl,fs:""}),this.registerModule("projection",{vs:iu,fs:""}),this.registerModule("project",{vs:sl,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Qs}),this.registerModule("lighting",{vs:Sl,fs:""}),this.registerModule("light",{vs:il,fs:""}),this.registerModule("picking",{vs:ol,fs:al}),this.registerModule("styleMapping",{vs:gc,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:yc,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Nc,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Uu,fs:""})}},{key:"registerModule",value:function(k,F){if(!this.rawContentCache[k]){var ie=F.vs,Te=F.fs,ft=F.uniforms,Gt=Fc(ie),Et=Gt.content,Qt=Gt.uniforms,Fr=Fc(Te),Bn=Fr.content,zn=Fr.uniforms;this.rawContentCache[k]={fs:Bn,uniforms:rl(rl(rl({},Qt),zn),ft),vs:Et}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(k){var F=this;if(this.moduleCache[k])return this.moduleCache[k];var ie=this.rawContentCache[k].vs,Te=this.rawContentCache[k].fs,ft=this.processModule(ie,[],"vs"),Gt=ft.content,Et=ft.includeList,Qt=this.processModule(Te,[],"fs"),Fr=Qt.content,Bn=Qt.includeList,zn=Fr,hi=Nu()(Et.concat(Bn).concat(k)).reduce(function(ui,yi){return rl(rl({},ui),F.rawContentCache[yi].uniforms)},{});return El.test(Fr)||(zn=Kl+Fr),this.moduleCache[k]={fs:zn.trim(),uniforms:hi,vs:Gt.trim()},this.moduleCache[k]}},{key:"processModule",value:function(k,F,ie){var Te=this,ft=k.replace(_c,function(Gt,Et){var Qt=Et.split(" "),Fr=Qt[0].replace(/"/g,"");if(F.indexOf(Fr)>-1)return"";var Bn=Te.rawContentCache[Fr][ie];F.push(Fr);var zn=Te.processModule(Bn,F,ie),hi=zn.content;return hi});return{content:ft,includeList:F}}}]),ee}())||Yl),Jl=y(66213),Au=y(92364),Pu,Ql,ql,pu,xc,Cl=(Pu=(0,E.b2)(),Ql=(0,E.f3)(V.v.IShaderModuleService),Pu(ql=(pu=function(){function ee(){(0,G.Z)(this,ee),(0,ue.Z)(this,"shaderModuleService",xc,this),(0,L.Z)(this,"rendererService",void 0),(0,L.Z)(this,"cameraService",void 0),(0,L.Z)(this,"mapService",void 0),(0,L.Z)(this,"interactionService",void 0),(0,L.Z)(this,"layerService",void 0),(0,L.Z)(this,"config",void 0)}return(0,I.Z)(ee,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Au.G.Normal}},{key:"init",value:function(k,F){this.config=F,this.rendererService=k.getContainer().get(V.v.IRendererService),this.cameraService=k.getContainer().get(V.v.ICameraService),this.mapService=k.getContainer().get(V.v.IMapService),this.interactionService=k.getContainer().get(V.v.IInteractionService),this.layerService=k.getContainer().get(V.v.ILayerService)}},{key:"render",value:function(k){}}]),ee}(),xc=(0,Ee.Z)(pu.prototype,"shaderModuleService",[Ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pu))||ql),bc,Zu;function Va(ee){var ne=ul();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function ul(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var Xa=(bc=(0,E.b2)(),bc(Zu=function(ee){(0,kt.Z)(k,ee);var ne=Va(k);function k(){return(0,G.Z)(this,k),ne.apply(this,arguments)}return(0,I.Z)(k,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(ie,Te){(0,Jl.Z)((0,yr.Z)(k.prototype),"init",this).call(this,ie,Te)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),k}(Cl))||Zu),ju,Mu,qs,aa,Ba;function Ps(ee,ne){var k=typeof Symbol!="undefined"&&ee[Symbol.iterator]||ee["@@iterator"];if(!k){if(Array.isArray(ee)||(k=ec(ee))||ne&&ee&&typeof ee.length=="number"){k&&(ee=k);var F=0,ie=function(){};return{s:ie,n:function(){return F>=ee.length?{done:!0}:{done:!1,value:ee[F++]}},e:function(Qt){throw Qt},f:ie}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Te=!0,ft=!1,Gt;return{s:function(){k=k.call(ee)},n:function(){var Qt=k.next();return Te=Qt.done,Qt},e:function(Qt){ft=!0,Gt=Qt},f:function(){try{!Te&&k.return!=null&&k.return()}finally{if(ft)throw Gt}}}}function ec(ee,ne){if(!!ee){if(typeof ee=="string")return du(ee,ne);var k=Object.prototype.toString.call(ee).slice(8,-1);if(k==="Object"&&ee.constructor&&(k=ee.constructor.name),k==="Map"||k==="Set")return Array.from(ee);if(k==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k))return du(ee,ne)}}function du(ee,ne){(ne==null||ne>ee.length)&&(ne=ee.length);for(var k=0,F=new Array(ne);k<ne;k++)F[k]=ee[k];return F}var tc=(ju=(0,E.b2)(),Mu=(0,E.f3)(V.v.IPostProcessor),ju(qs=(aa=function(){function ee(){(0,G.Z)(this,ee),(0,L.Z)(this,"passes",[]),(0,ue.Z)(this,"postProcessor",Ba,this),(0,L.Z)(this,"layer",void 0),(0,L.Z)(this,"renderFlag",void 0),(0,L.Z)(this,"width",0),(0,L.Z)(this,"height",0)}return(0,I.Z)(ee,[{key:"setLayer",value:function(k){this.layer=k}},{key:"setRenderFlag",value:function(k){this.renderFlag=k}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var ne=(0,po.Z)(Gi().mark(function F(){var ie,Te,ft;return Gi().wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:ie=Ps(this.passes),Et.prev=1,ie.s();case 3:if((Te=ie.n()).done){Et.next=9;break}return ft=Te.value,Et.next=7,ft.render(this.layer);case 7:Et.next=3;break;case 9:Et.next=14;break;case 11:Et.prev=11,Et.t0=Et.catch(1),ie.e(Et.t0);case 14:return Et.prev=14,ie.f(),Et.finish(14);case 17:this.layer.renderModels();case 18:case"end":return Et.stop()}},F,this,[[1,11,14,17]])}));function k(){return ne.apply(this,arguments)}return k}()},{key:"resize",value:function(k,F){(this.width!==k||this.height!==F)&&(this.width=k,this.height=F)}},{key:"add",value:function(k,F){k.getType()===Au.G.PostProcessing?this.postProcessor.add(k,this.layer,F):(k.init(this.layer,F),this.passes.push(k))}},{key:"insert",value:function(k,F,ie){k.init(this.layer,F),this.passes.splice(ie,0,k)}},{key:"destroy",value:function(){this.passes.length=0}}]),ee}(),Ba=(0,Ee.Z)(aa.prototype,"postProcessor",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aa))||qs),nf,af;function ll(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function wl(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?ll(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):ll(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}function Iu(ee){var ne=Ro();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function Ro(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var Tl=(nf=(0,E.b2)(),nf(af=function(ee){(0,kt.Z)(k,ee);var ne=Iu(k);function k(){var F;(0,G.Z)(this,k);for(var ie=arguments.length,Te=new Array(ie),ft=0;ft<ie;ft++)Te[ft]=arguments[ft];return F=ne.call.apply(ne,[this].concat(Te)),(0,L.Z)((0,Re.Z)(F),"pickingFBO",void 0),(0,L.Z)((0,Re.Z)(F),"layer",void 0),(0,L.Z)((0,Re.Z)(F),"width",0),(0,L.Z)((0,Re.Z)(F),"height",0),(0,L.Z)((0,Re.Z)(F),"alreadyInRendering",!1),(0,L.Z)((0,Re.Z)(F),"pickFromPickingFBO",function(Gt){var Et=Gt.x,Qt=Gt.y,Fr=Gt.lngLat,Bn=Gt.type;if(!(!F.layer.isVisible()||!F.layer.needPick(Bn))){var zn=F.rendererService,hi=zn.getViewportSize,ui=zn.readPixels,yi=zn.useFramebuffer,Ki=hi(),_a=Ki.width,xa=Ki.height,Ya=F.layer.getLayerConfig(),Na=Ya.enableHighlight,wo=Ya.enableSelect,La=Et*_e.SO.DPR,Ea=Qt*_e.SO.DPR;if(!(La>_a||La<0||Ea>xa||Ea<0)){var fa;yi(F.pickingFBO,function(){var ma;if(fa=ui({x:Math.round(La),y:Math.round(xa-(Qt+1)*_e.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:F.pickingFBO}),fa[0]!==0||fa[1]!==0||fa[2]!==0){var Ga=(0,_e.W0)(fa),za=F.layer.getSource().getFeatureById(Ga),ko={x:Et,y:Qt,type:Bn,lngLat:Fr,featureId:Ga,feature:za};za&&(F.layer.setCurrentPickId(Ga),F.triggerHoverOnLayer(ko))}else{var Zi={x:Et,y:Qt,lngLat:Fr,type:F.layer.getCurrentPickId()===null?"un"+Bn:"mouseout",featureId:null,feature:null};F.triggerHoverOnLayer(wl(wl({},Zi),{},{type:"unpick"})),F.triggerHoverOnLayer(Zi),F.layer.setCurrentPickId(null)}Na&&F.highlightPickedFeature(fa),wo&&Bn==="click"&&((ma=fa)===null||ma===void 0?void 0:ma.toString())!==[0,0,0,0].toString()&&F.selectFeature(fa)})}}}),F}return(0,I.Z)(k,[{key:"getType",value:function(){return Au.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(ie,Te){(0,Jl.Z)((0,yr.Z)(k.prototype),"init",this).call(this,ie,Te),this.layer=ie;var ft=this.rendererService,Gt=ft.createTexture2D,Et=ft.createFramebuffer,Qt=ft.getViewportSize,Fr=Qt(),Bn=Fr.width,zn=Fr.height;this.pickingFBO=Et({color:Gt({width:Bn,height:zn,wrapS:Hi.gl.CLAMP_TO_EDGE,wrapT:Hi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(ci.s.Hover,this.pickFromPickingFBO),this.interactionService.on(ci.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ci.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(ie){var Te=this;if(!this.alreadyInRendering){var ft=this.rendererService,Gt=ft.getViewportSize,Et=ft.useFramebuffer,Qt=ft.clear,Fr=Gt(),Bn=Fr.width,zn=Fr.height;this.alreadyInRendering=!0,(this.width!==Bn||this.height!==zn)&&(this.pickingFBO.resize({width:Bn,height:zn}),this.width=Bn,this.height=zn),Et(this.pickingFBO,function(){Qt({framebuffer:Te.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var hi=Te.layer.multiPassRenderer.getRenderFlag();Te.layer.multiPassRenderer.setRenderFlag(!1),ie.hooks.beforePickingEncode.call(),ie.render(),ie.hooks.afterPickingEncode.call(),Te.layer.multiPassRenderer.setRenderFlag(hi),Te.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(ie){this.layer.emit(ie.type,ie)}},{key:"highlightPickedFeature",value:function(ie){var Te=(0,At.Z)(ie,3),ft=Te[0],Gt=Te[1],Et=Te[2];this.layer.hooks.beforeHighlight.call([ft,Gt,Et]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(ie){var Te=(0,At.Z)(ie,3),ft=Te[0],Gt=Te[1],Et=Te[2];this.layer.hooks.beforeSelect.call([ft,Gt,Et]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(ie){var Te=ie.featureId,ft=(0,_e.Z6)(Te);this.selectFeature(new Uint8Array(ft))}},{key:"highlightFeatureHandle",value:function(ie){var Te=ie.featureId,ft=(0,_e.Z6)(Te);this.highlightPickedFeature(new Uint8Array(ft))}}]),k}(Cl))||af),Vs=y(69530),Eo,Nn;function fo(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function vu(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?fo(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):fo(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}function cl(ee){var ne=eu();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function eu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var Ms=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Sc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gn=(Eo=(0,E.b2)(),Eo(Nn=function(ee){(0,kt.Z)(k,ee);var ne=cl(k);function k(){return(0,G.Z)(this,k),ne.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Sc,fs:Ms});var ie=this.shaderModuleService.getModule("blur-pass"),Te=ie.vs,ft=ie.fs,Gt=ie.uniforms,Et=this.rendererService.getViewportSize(),Qt=Et.width,Fr=Et.height;return{vs:Te,fs:ft,uniforms:vu(vu({},Gt),{},{u_ViewportSize:[Qt,Fr]})}}},{key:"convertOptionsToUniforms",value:function(ie){var Te={};return ts()(ie.blurRadius)||(Te.u_BlurDir=[ie.blurRadius,0]),Te}}]),k}(Vs.Z))||Nn),rc,nc;function Ou(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function Ua(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?Ou(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):Ou(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}function Is(ee){var ne=ic();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function ic(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var mu=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Os=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gu=(rc=(0,E.b2)(),rc(nc=function(ee){(0,kt.Z)(k,ee);var ne=Is(k);function k(){return(0,G.Z)(this,k),ne.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Os,fs:mu});var ie=this.shaderModuleService.getModule("blur-pass"),Te=ie.vs,ft=ie.fs,Gt=ie.uniforms,Et=this.rendererService.getViewportSize(),Qt=Et.width,Fr=Et.height;return{vs:Te,fs:ft,uniforms:Ua(Ua({},Gt),{},{u_ViewportSize:[Qt,Fr]})}}},{key:"convertOptionsToUniforms",value:function(ie){var Te={};return ts()(ie.blurRadius)||(Te.u_BlurDir=[0,ie.blurRadius]),Te}}]),k}(Vs.Z))||nc),zc,Al;function Ec(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function Cc(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?Ec(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):Ec(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}function Gs(ee){var ne=Ls();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function Ls(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var ta=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,yu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Hs=(zc=(0,E.b2)(),zc(Al=function(ee){(0,kt.Z)(k,ee);var ne=Gs(k);function k(){return(0,G.Z)(this,k),ne.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:yu,fs:ta});var ie=this.shaderModuleService.getModule("colorhalftone-pass"),Te=ie.vs,ft=ie.fs,Gt=ie.uniforms,Et=this.rendererService.getViewportSize(),Qt=Et.width,Fr=Et.height;return{vs:Te,fs:ft,uniforms:Cc(Cc({},Gt),{},{u_ViewportSize:[Qt,Fr]})}}}]),k}(Vs.Z))||Al),Uo,Vu;function au(ee){var ne=ou();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function ou(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var Co=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Gu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ni=(Uo=(0,E.b2)(),Uo(Vu=function(ee){(0,kt.Z)(k,ee);var ne=au(k);function k(){return(0,G.Z)(this,k),ne.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Gu,fs:Co}),this.shaderModuleService.getModule("copy-pass")}}]),k}(Vs.Z))||Vu),$n,Pl;function as(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function Ws(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?as(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):as(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}function Zo(ee){var ne=su();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function su(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var wc=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,ac=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,oa=($n=(0,E.b2)(),$n(Pl=function(ee){(0,kt.Z)(k,ee);var ne=Zo(k);function k(){return(0,G.Z)(this,k),ne.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:ac,fs:wc});var ie=this.shaderModuleService.getModule("hexagonalpixelate-pass"),Te=ie.vs,ft=ie.fs,Gt=ie.uniforms,Et=this.rendererService.getViewportSize(),Qt=Et.width,Fr=Et.height;return{vs:Te,fs:ft,uniforms:Ws(Ws({},Gt),{},{u_ViewportSize:[Qt,Fr]})}}}]),k}(Vs.Z))||Pl),Do,Uc;function xs(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function Ml(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?xs(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):xs(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}function Rs(ee){var ne=os();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function os(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var fl=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,uu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,oc=(Do=(0,E.b2)(),Do(Uc=function(ee){(0,kt.Z)(k,ee);var ne=Rs(k);function k(){return(0,G.Z)(this,k),ne.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:uu,fs:fl});var ie=this.shaderModuleService.getModule("ink-pass"),Te=ie.vs,ft=ie.fs,Gt=ie.uniforms,Et=this.rendererService.getViewportSize(),Qt=Et.width,Fr=Et.height;return{vs:Te,fs:ft,uniforms:Ml(Ml({},Gt),{},{u_ViewportSize:[Qt,Fr]})}}}]),k}(Vs.Z))||Uc),Hu,Wu;function Zc(ee){var ne=Il();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function Il(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var hl=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,jc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Xu=(Hu=(0,E.b2)(),Hu(Wu=function(ee){(0,kt.Z)(k,ee);var ne=Zc(k);function k(){return(0,G.Z)(this,k),ne.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:jc,fs:hl}),this.shaderModuleService.getModule("noise-pass")}}]),k}(Vs.Z))||Wu),Lu,sc;function Ru(ee){var ne=Xs();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function Xs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var Tc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,uc=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,lc=(Lu=(0,E.b2)(),Lu(sc=function(ee){(0,kt.Z)(k,ee);var ne=Ru(k);function k(){return(0,G.Z)(this,k),ne.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Tc,fs:uc}),this.shaderModuleService.getModule("sepia-pass")}}]),k}(Vs.Z))||sc),Yu,i,u,o,h,_,C=(Yu=(0,E.b2)(),i=(0,E.f3)(V.v.IRendererService),u=(0,E.zY)(),Yu(o=(h=function(){function ee(){(0,G.Z)(this,ee),(0,ue.Z)(this,"rendererService",_,this),(0,L.Z)(this,"passes",[]),(0,L.Z)(this,"readFBO",void 0),(0,L.Z)(this,"writeFBO",void 0)}return(0,I.Z)(ee,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var ne=(0,po.Z)(Gi().mark(function F(ie){var Te,ft;return Gi().wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:Te=0;case 1:if(!(Te<this.passes.length)){Et.next=10;break}return ft=this.passes[Te],ft.setRenderToScreen(this.isLastEnabledPass(Te)),Et.next=6,ft.render(ie);case 6:Te!==this.passes.length-1&&this.swap();case 7:Te++,Et.next=1;break;case 10:case"end":return Et.stop()}},F,this)}));function k(F){return ne.apply(this,arguments)}return k}()},{key:"resize",value:function(k,F){this.readFBO.resize({width:k,height:F}),this.writeFBO.resize({width:k,height:F})}},{key:"add",value:function(k,F,ie){k.init(F,ie),this.passes.push(k)}},{key:"insert",value:function(k,F,ie,Te){k.init(ie,Te),this.passes.splice(F,0,k)}},{key:"getPostProcessingPassByName",value:function(k){return this.passes.find(function(F){return F.getName()===k})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(k){for(var F=k+1;F<this.passes.length;F++)if(this.passes[F].isEnabled())return!1;return!0}},{key:"swap",value:function(){var k=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=k}}]),ee}(),_=(0,Ee.Z)(h.prototype,"rendererService",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,Ee.Z)(h.prototype,"init",[u],Object.getOwnPropertyDescriptor(h.prototype,"init"),h.prototype),h))||o),P,N;function K(ee){var ne=se();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function se(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var Ce=(P=(0,E.b2)(),P(N=function(ee){(0,kt.Z)(k,ee);var ne=K(k);function k(){return(0,G.Z)(this,k),ne.apply(this,arguments)}return(0,I.Z)(k,[{key:"getType",value:function(){return Au.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(ie,Te){(0,Jl.Z)((0,yr.Z)(k.prototype),"init",this).call(this,ie,Te)}},{key:"render",value:function(ie){var Te=this.rendererService,ft=Te.useFramebuffer,Gt=Te.clear;ft(null,function(){Gt({color:[0,0,0,0],depth:1,stencil:0}),ie.multiPassRenderer.setRenderFlag(!1),ie.render(),ie.multiPassRenderer.setRenderFlag(!0)})}}]),k}(Cl))||N),Ae,Ie,Ke,We,at;function Ze(ee,ne){var k=Object.keys(ee);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ee);ne&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),k.push.apply(k,F)}return k}function st(ee){for(var ne=1;ne<arguments.length;ne++){var k=arguments[ne]!=null?arguments[ne]:{};ne%2?Ze(Object(k),!0).forEach(function(F){(0,L.Z)(ee,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(k)):Ze(Object(k)).forEach(function(F){Object.defineProperty(ee,F,Object.getOwnPropertyDescriptor(k,F))})}return ee}function St(ee){var ne=Wt();return function(){var F=(0,yr.Z)(ee),ie;if(ne){var Te=(0,yr.Z)(this).constructor;ie=Reflect.construct(F,arguments,Te)}else ie=F.apply(this,arguments);return(0,rr.Z)(this,ie)}}function Wt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ee){return!1}}var xr=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,hr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Sr=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Gr(ee,ne){for(var k=0,F=1/ne,ie=ee;ie>0;)k=k+F*(ie%ne),ie=Math.floor(ie/ne),F=F/ne;return k}var sn=1,qr=(Ae=(0,E.b2)(),Ie=(0,E.f3)(V.v.IShaderModuleService),Ae(Ke=(We=function(ee){(0,kt.Z)(k,ee);var ne=St(k);function k(){var F;(0,G.Z)(this,k);for(var ie=arguments.length,Te=new Array(ie),ft=0;ft<ie;ft++)Te[ft]=arguments[ft];return F=ne.call.apply(ne,[this].concat(Te)),(0,ue.Z)((0,Re.Z)(F),"shaderModuleService",at,(0,Re.Z)(F)),(0,L.Z)((0,Re.Z)(F),"haltonSequence",[]),(0,L.Z)((0,Re.Z)(F),"accumulatingId",0),(0,L.Z)((0,Re.Z)(F),"frame",0),(0,L.Z)((0,Re.Z)(F),"timer",void 0),(0,L.Z)((0,Re.Z)(F),"sampleRenderTarget",void 0),(0,L.Z)((0,Re.Z)(F),"prevRenderTarget",void 0),(0,L.Z)((0,Re.Z)(F),"outputRenderTarget",void 0),(0,L.Z)((0,Re.Z)(F),"copyRenderTarget",void 0),(0,L.Z)((0,Re.Z)(F),"blendModel",void 0),(0,L.Z)((0,Re.Z)(F),"outputModel",void 0),(0,L.Z)((0,Re.Z)(F),"copyModel",void 0),F}return(0,I.Z)(k,[{key:"getType",value:function(){return Au.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(ie,Te){(0,Jl.Z)((0,yr.Z)(k.prototype),"init",this).call(this,ie,Te);var ft=this.rendererService,Gt=ft.createFramebuffer,Et=ft.createTexture2D;this.sampleRenderTarget=Gt({color:Et({width:1,height:1,wrapS:Hi.gl.CLAMP_TO_EDGE,wrapT:Hi.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=Gt({color:Et({width:1,height:1,wrapS:Hi.gl.CLAMP_TO_EDGE,wrapT:Hi.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=Gt({color:Et({width:1,height:1,wrapS:Hi.gl.CLAMP_TO_EDGE,wrapT:Hi.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=Gt({color:Et({width:1,height:1,wrapS:Hi.gl.CLAMP_TO_EDGE,wrapT:Hi.gl.CLAMP_TO_EDGE})});for(var Qt=0;Qt<30;Qt++)this.haltonSequence.push([Gr(Qt,2),Gr(Qt,3)]);this.blendModel=this.createTriangleModel("blend-pass",xr),this.outputModel=this.createTriangleModel("copy-pass",hr,{blend:{enable:!0,func:{srcRGB:Hi.gl.ONE,dstRGB:Hi.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:Hi.gl.ONE,dstAlpha:Hi.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:Hi.gl.FUNC_ADD,alpha:Hi.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",hr)}},{key:"render",value:function(ie){var Te=this,ft=this.rendererService,Gt=ft.clear,Et=ft.getViewportSize,Qt=ft.useFramebuffer,Fr=Et(),Bn=Fr.width,zn=Fr.height;this.sampleRenderTarget.resize({width:Bn,height:zn}),this.prevRenderTarget.resize({width:Bn,height:zn}),this.outputRenderTarget.resize({width:Bn,height:zn}),this.copyRenderTarget.resize({width:Bn,height:zn}),this.resetFrame(),this.stopAccumulating();var hi=ie.multiPassRenderer.getPostProcessor().getReadFBO();Qt(hi,function(){Gt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:hi}),ie.multiPassRenderer.setRenderFlag(!1),ie.render(),ie.multiPassRenderer.setRenderFlag(!0)});var ui=function yi(Ki){!Te.accumulatingId||Ki!==Te.accumulatingId||Te.isFinished()||(Te.doRender(ie),requestAnimationFrame(function(){yi(Ki)}))};this.accumulatingId=sn++,this.timer=window.setTimeout(function(){ui(Te.accumulatingId)},50)}},{key:"doRender",value:function(ie){var Te=this,ft=this.rendererService,Gt=ft.clear,Et=ft.getViewportSize,Qt=ft.useFramebuffer,Fr=Et(),Bn=Fr.width,zn=Fr.height,hi=ie.getLayerConfig(),ui=hi.jitterScale,yi=ui===void 0?1:ui,Ki=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Ki[0]*2-1)/Bn*yi,(Ki[1]*2-1)/zn*yi),ie.multiPassRenderer.setRenderFlag(!1),ie.hooks.beforeRender.call(),Qt(this.sampleRenderTarget,function(){Gt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Te.sampleRenderTarget}),ie.render()}),ie.hooks.afterRender.call(),ie.multiPassRenderer.setRenderFlag(!0);var _a=ie.getLayerConfig();Qt(this.outputRenderTarget,function(){Te.blendModel.draw({uniforms:{u_opacity:_a.opacity||1,u_MixRatio:Te.frame===0?1:.9,u_Diffuse1:Te.sampleRenderTarget,u_Diffuse2:Te.frame===0?ie.multiPassRenderer.getPostProcessor().getReadFBO():Te.prevRenderTarget}})}),this.frame===0&&Gt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(Qt(this.copyRenderTarget,function(){Te.outputModel.draw({uniforms:{u_Texture:Te.outputRenderTarget}})}),Qt(ie.multiPassRenderer.getPostProcessor().getReadFBO(),function(){Te.copyModel.draw({uniforms:{u_Texture:Te.copyRenderTarget}})}),ie.multiPassRenderer.getPostProcessor().render(ie));var xa=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=xa,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(ie,Te,ft){this.shaderModuleService.registerModule(ie,{vs:Sr,fs:Te});var Gt=this.shaderModuleService.getModule(ie),Et=Gt.vs,Qt=Gt.fs,Fr=Gt.uniforms,Bn=this.rendererService,zn=Bn.createAttribute,hi=Bn.createBuffer,ui=Bn.createModel;return ui(st({vs:Et,fs:Qt,attributes:{a_Position:zn({buffer:hi({data:[-4,-4,4,-4,0,4],type:Hi.gl.FLOAT}),size:2})},uniforms:st({},Fr),depth:{enable:!1},count:3},ft))}}]),k}(Cl),at=(0,Ee.Z)(We.prototype,"shaderModuleService",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),We))||Ke),Mn=new E.W2;Mn.bind(V.v.IGlobalConfigService).to(Pe).inSingletonScope(),Mn.bind(V.v.IShaderModuleService).to($l).inSingletonScope(),(0,E.GW)((0,E.b2)(),b.EventEmitter),Mn.bind(V.v.IEventEmitter).to(b.EventEmitter);var ei=(0,Z.Z)(Mn,!1),fi=function(ne){var k=ei.lazyInject(ne);return function(F,ie,Te){k.call(this,F,ie),Te&&(Te.initializer=function(){return F[ie]})}},ri=function(ne){var k=ei.lazyMultiInject(ne);return function(F,ie,Te){k.call(this,F,ie),Te&&(Te.initializer=function(){return F[ie]})}},sa=Mn,Vn=0;function Si(){var ee=new E.W2;return ee.parent=Mn,ee.bind(V.v.SceneID).toConstantValue("".concat(Vn++)),ee.bind(V.v.ILayerService).to(es).inSingletonScope(),ee.bind(V.v.ISceneService).to(_s).inSingletonScope(),ee.bind(V.v.ICameraService).to(Cr).inSingletonScope(),ee.bind(V.v.ICoordinateSystemService).to(bn).inSingletonScope(),ee.bind(V.v.IInteractionService).to(ro).inSingletonScope(),ee.bind(V.v.IPickingService).to(Fe).inSingletonScope(),ee.bind(V.v.IControlService).to(br).inSingletonScope(),ee.bind(V.v.IMarkerService).to(Mr).inSingletonScope(),ee.bind(V.v.IIconService).to(ot).inSingletonScope(),ee.bind(V.v.IFontService).to(Ge).inSingletonScope(),ee.bind(V.v.IPopupService).to(Kn).inSingletonScope(),ee.bind(V.v.INormalPass).to(Xa).whenTargetNamed("clear"),ee.bind(V.v.INormalPass).to(Tl).whenTargetNamed("pixelPicking"),ee.bind(V.v.INormalPass).to(Ce).whenTargetNamed("render"),ee.bind(V.v.INormalPass).to(qr).whenTargetNamed("taa"),ee.bind(V.v.IFactoryNormalPass).toFactory(function(ne){return function(k){return ne.container.getNamed(V.v.INormalPass,k)}}),ee.bind(V.v.IPostProcessingPass).to(ni).whenTargetNamed("copy"),ee.bind(V.v.IPostProcessingPass).to(gn).whenTargetNamed("blurH"),ee.bind(V.v.IPostProcessingPass).to(gu).whenTargetNamed("blurV"),ee.bind(V.v.IPostProcessingPass).to(Xu).whenTargetNamed("noise"),ee.bind(V.v.IPostProcessingPass).to(lc).whenTargetNamed("sepia"),ee.bind(V.v.IPostProcessingPass).to(Hs).whenTargetNamed("colorHalftone"),ee.bind(V.v.IPostProcessingPass).to(oa).whenTargetNamed("hexagonalPixelate"),ee.bind(V.v.IPostProcessingPass).to(oc).whenTargetNamed("ink"),ee.bind(V.v.IFactoryPostProcessingPass).toFactory(function(ne){return function(k){var F=ne.container.getNamed(V.v.IPostProcessingPass,k);return F.setName(k),F}}),ee}function Ui(ee){var ne=new E.W2;return ne.parent=ee,ne.bind(V.v.IStyleAttributeService).to(Bu).inSingletonScope(),ne.bind(V.v.IMultiPassRenderer).to(tc).inSingletonScope(),ne.bind(V.v.IPostProcessor).to(C).inSingletonScope(),ne}},2811:function(){},64532:function(){},4594:function(qe,D,y){"use strict";y.d(D,{l:function(){return j}});var j={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(qe,D,y){"use strict";y.d(D,{d:function(){return j}});var j;(function(b){b.TOPRIGHT="topright",b.TOPLEFT="topleft",b.BOTTOMRIGHT="bottomright",b.BOTTOMLEFT="bottomleft",b.TOPCENTER="topcenter",b.BOTTOMCENTER="bottomcenter",b.LEFTCENTER="leftcenter",b.RIGHTCENTER="rightcenter"})(j||(j={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(qe,D,y){"use strict";y.d(D,{l:function(){return j},k:function(){return b}});var j;(function(p){p[p.LNGLAT=1]="LNGLAT",p[p.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",p[p.VECTOR_TILE=3]="VECTOR_TILE",p[p.IDENTITY=4]="IDENTITY",p[p.P20=5]="P20",p[p.P20_OFFSET=6]="P20_OFFSET",p[p.METER_OFFSET=7]="METER_OFFSET",p[p.P20_2=8]="P20_2"})(j||(j={}));var b={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(qe,D,y){"use strict";y.d(D,{s:function(){return j}});var j;(function(b){b.Hover="hover",b.Click="click",b.Select="select",b.Active="active",b.Drag="drag"})(j||(j={}))},90919:function(){},77252:function(qe,D,y){"use strict";y.d(D,{h:function(){return j}});var j;(function(b){b.normal="normal",b.additive="additive",b.subtractive="subtractive",b.min="min",b.max="max",b.none="none"})(j||(j={}))},31251:function(qe,D,y){"use strict";y.d(D,{vY:function(){return j},ee:function(){return b},GC:function(){return p}});var j;(function(E){E.LINEAR="linear",E.POWER="power",E.LOG="log",E.IDENTITY="identity",E.TIME="time",E.QUANTILE="quantile",E.QUANTIZE="quantize",E.THRESHOLD="threshold",E.CAT="cat"})(j||(j={}));var b;(function(E){E.CONSTANT="constant",E.VARIABLE="variable"})(b||(b={}));var p;(function(E){E[E.Attribute=0]="Attribute",E[E.InstancedAttribute=1]="InstancedAttribute",E[E.Uniform=2]="Uniform"})(p||(p={}))},16606:function(qe,D,y){"use strict";y.d(D,{I:function(){return j}});var j=["mapload"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(qe,D,y){"use strict";y.d(D,{G:function(){return j}});var j;(function(b){b.Normal="normal",b.PostProcessing="post-processing"})(j||(j={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(qe,D,y){"use strict";y.d(D,{gl:function(){return j}});var j;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",b[b.POINTS=0]="POINTS",b[b.LINES=1]="LINES",b[b.LINE_LOOP=2]="LINE_LOOP",b[b.LINE_STRIP=3]="LINE_STRIP",b[b.TRIANGLES=4]="TRIANGLES",b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN",b[b.ZERO=0]="ZERO",b[b.ONE=1]="ONE",b[b.SRC_COLOR=768]="SRC_COLOR",b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",b[b.SRC_ALPHA=770]="SRC_ALPHA",b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",b[b.DST_ALPHA=772]="DST_ALPHA",b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",b[b.DST_COLOR=774]="DST_COLOR",b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",b[b.FUNC_ADD=32774]="FUNC_ADD",b[b.BLEND_EQUATION=32777]="BLEND_EQUATION",b[b.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",b[b.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",b[b.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",b[b.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",b[b.MAX_EXT=32776]="MAX_EXT",b[b.MIN_EXT=32775]="MIN_EXT",b[b.BLEND_DST_RGB=32968]="BLEND_DST_RGB",b[b.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",b[b.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",b[b.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR",b[b.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",b[b.BLEND_COLOR=32773]="BLEND_COLOR",b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER",b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",b[b.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",b[b.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",b[b.STREAM_DRAW=35040]="STREAM_DRAW",b[b.STATIC_DRAW=35044]="STATIC_DRAW",b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",b[b.BUFFER_SIZE=34660]="BUFFER_SIZE",b[b.BUFFER_USAGE=34661]="BUFFER_USAGE",b[b.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",b[b.FRONT=1028]="FRONT",b[b.BACK=1029]="BACK",b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK",b[b.CULL_FACE=2884]="CULL_FACE",b[b.BLEND=3042]="BLEND",b[b.DITHER=3024]="DITHER",b[b.STENCIL_TEST=2960]="STENCIL_TEST",b[b.DEPTH_TEST=2929]="DEPTH_TEST",b[b.SCISSOR_TEST=3089]="SCISSOR_TEST",b[b.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",b[b.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",b[b.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",b[b.NO_ERROR=0]="NO_ERROR",b[b.INVALID_ENUM=1280]="INVALID_ENUM",b[b.INVALID_VALUE=1281]="INVALID_VALUE",b[b.INVALID_OPERATION=1282]="INVALID_OPERATION",b[b.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",b[b.CW=2304]="CW",b[b.CCW=2305]="CCW",b[b.LINE_WIDTH=2849]="LINE_WIDTH",b[b.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",b[b.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",b[b.CULL_FACE_MODE=2885]="CULL_FACE_MODE",b[b.FRONT_FACE=2886]="FRONT_FACE",b[b.DEPTH_RANGE=2928]="DEPTH_RANGE",b[b.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",b[b.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",b[b.DEPTH_FUNC=2932]="DEPTH_FUNC",b[b.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",b[b.STENCIL_FUNC=2962]="STENCIL_FUNC",b[b.STENCIL_FAIL=2964]="STENCIL_FAIL",b[b.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",b[b.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",b[b.STENCIL_REF=2967]="STENCIL_REF",b[b.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",b[b.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",b[b.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",b[b.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",b[b.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",b[b.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",b[b.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",b[b.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",b[b.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",b[b.VIEWPORT=2978]="VIEWPORT",b[b.SCISSOR_BOX=3088]="SCISSOR_BOX",b[b.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",b[b.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",b[b.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",b[b.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",b[b.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",b[b.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",b[b.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",b[b.RED_BITS=3410]="RED_BITS",b[b.GREEN_BITS=3411]="GREEN_BITS",b[b.BLUE_BITS=3412]="BLUE_BITS",b[b.ALPHA_BITS=3413]="ALPHA_BITS",b[b.DEPTH_BITS=3414]="DEPTH_BITS",b[b.STENCIL_BITS=3415]="STENCIL_BITS",b[b.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",b[b.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",b[b.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",b[b.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",b[b.SAMPLES=32937]="SAMPLES",b[b.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",b[b.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",b[b.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",b[b.DONT_CARE=4352]="DONT_CARE",b[b.FASTEST=4353]="FASTEST",b[b.NICEST=4354]="NICEST",b[b.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",b[b.BYTE=5120]="BYTE",b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",b[b.SHORT=5122]="SHORT",b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",b[b.INT=5124]="INT",b[b.UNSIGNED_INT=5125]="UNSIGNED_INT",b[b.FLOAT=5126]="FLOAT",b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",b[b.ALPHA=6406]="ALPHA",b[b.RGB=6407]="RGB",b[b.RGBA=6408]="RGBA",b[b.LUMINANCE=6409]="LUMINANCE",b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",b[b.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",b[b.VERTEX_SHADER=35633]="VERTEX_SHADER",b[b.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",b[b.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",b[b.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",b[b.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",b[b.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",b[b.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",b[b.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",b[b.SHADER_TYPE=35663]="SHADER_TYPE",b[b.DELETE_STATUS=35712]="DELETE_STATUS",b[b.LINK_STATUS=35714]="LINK_STATUS",b[b.VALIDATE_STATUS=35715]="VALIDATE_STATUS",b[b.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",b[b.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",b[b.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",b[b.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",b[b.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",b[b.NEVER=512]="NEVER",b[b.LESS=513]="LESS",b[b.EQUAL=514]="EQUAL",b[b.LEQUAL=515]="LEQUAL",b[b.GREATER=516]="GREATER",b[b.NOTEQUAL=517]="NOTEQUAL",b[b.GEQUAL=518]="GEQUAL",b[b.ALWAYS=519]="ALWAYS",b[b.KEEP=7680]="KEEP",b[b.REPLACE=7681]="REPLACE",b[b.INCR=7682]="INCR",b[b.DECR=7683]="DECR",b[b.INVERT=5386]="INVERT",b[b.INCR_WRAP=34055]="INCR_WRAP",b[b.DECR_WRAP=34056]="DECR_WRAP",b[b.VENDOR=7936]="VENDOR",b[b.RENDERER=7937]="RENDERER",b[b.VERSION=7938]="VERSION",b[b.NEAREST=9728]="NEAREST",b[b.LINEAR=9729]="LINEAR",b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",b[b.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",b[b.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",b[b.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",b[b.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",b[b.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",b[b.TEXTURE_2D=3553]="TEXTURE_2D",b[b.TEXTURE=5890]="TEXTURE",b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",b[b.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",b[b.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",b[b.TEXTURE0=33984]="TEXTURE0",b[b.TEXTURE1=33985]="TEXTURE1",b[b.TEXTURE2=33986]="TEXTURE2",b[b.TEXTURE3=33987]="TEXTURE3",b[b.TEXTURE4=33988]="TEXTURE4",b[b.TEXTURE5=33989]="TEXTURE5",b[b.TEXTURE6=33990]="TEXTURE6",b[b.TEXTURE7=33991]="TEXTURE7",b[b.TEXTURE8=33992]="TEXTURE8",b[b.TEXTURE9=33993]="TEXTURE9",b[b.TEXTURE10=33994]="TEXTURE10",b[b.TEXTURE11=33995]="TEXTURE11",b[b.TEXTURE12=33996]="TEXTURE12",b[b.TEXTURE13=33997]="TEXTURE13",b[b.TEXTURE14=33998]="TEXTURE14",b[b.TEXTURE15=33999]="TEXTURE15",b[b.TEXTURE16=34e3]="TEXTURE16",b[b.TEXTURE17=34001]="TEXTURE17",b[b.TEXTURE18=34002]="TEXTURE18",b[b.TEXTURE19=34003]="TEXTURE19",b[b.TEXTURE20=34004]="TEXTURE20",b[b.TEXTURE21=34005]="TEXTURE21",b[b.TEXTURE22=34006]="TEXTURE22",b[b.TEXTURE23=34007]="TEXTURE23",b[b.TEXTURE24=34008]="TEXTURE24",b[b.TEXTURE25=34009]="TEXTURE25",b[b.TEXTURE26=34010]="TEXTURE26",b[b.TEXTURE27=34011]="TEXTURE27",b[b.TEXTURE28=34012]="TEXTURE28",b[b.TEXTURE29=34013]="TEXTURE29",b[b.TEXTURE30=34014]="TEXTURE30",b[b.TEXTURE31=34015]="TEXTURE31",b[b.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",b[b.REPEAT=10497]="REPEAT",b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",b[b.FLOAT_VEC2=35664]="FLOAT_VEC2",b[b.FLOAT_VEC3=35665]="FLOAT_VEC3",b[b.FLOAT_VEC4=35666]="FLOAT_VEC4",b[b.INT_VEC2=35667]="INT_VEC2",b[b.INT_VEC3=35668]="INT_VEC3",b[b.INT_VEC4=35669]="INT_VEC4",b[b.BOOL=35670]="BOOL",b[b.BOOL_VEC2=35671]="BOOL_VEC2",b[b.BOOL_VEC3=35672]="BOOL_VEC3",b[b.BOOL_VEC4=35673]="BOOL_VEC4",b[b.FLOAT_MAT2=35674]="FLOAT_MAT2",b[b.FLOAT_MAT3=35675]="FLOAT_MAT3",b[b.FLOAT_MAT4=35676]="FLOAT_MAT4",b[b.SAMPLER_2D=35678]="SAMPLER_2D",b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE",b[b.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",b[b.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",b[b.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",b[b.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",b[b.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",b[b.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",b[b.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",b[b.COMPILE_STATUS=35713]="COMPILE_STATUS",b[b.LOW_FLOAT=36336]="LOW_FLOAT",b[b.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",b[b.HIGH_FLOAT=36338]="HIGH_FLOAT",b[b.LOW_INT=36339]="LOW_INT",b[b.MEDIUM_INT=36340]="MEDIUM_INT",b[b.HIGH_INT=36341]="HIGH_INT",b[b.FRAMEBUFFER=36160]="FRAMEBUFFER",b[b.RENDERBUFFER=36161]="RENDERBUFFER",b[b.RGBA4=32854]="RGBA4",b[b.RGB5_A1=32855]="RGB5_A1",b[b.RGB565=36194]="RGB565",b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",b[b.STENCIL_INDEX=6401]="STENCIL_INDEX",b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8",b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL",b[b.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",b[b.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",b[b.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",b[b.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",b[b.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",b[b.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",b[b.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",b[b.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",b[b.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",b[b.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",b[b.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",b[b.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",b[b.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",b[b.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",b[b.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",b[b.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",b[b.NONE=0]="NONE",b[b.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",b[b.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",b[b.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",b[b.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",b[b.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",b[b.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",b[b.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",b[b.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",b[b.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",b[b.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",b[b.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",b[b.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",b[b.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",b[b.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(j||(j={}))},69530:function(qe,D,y){"use strict";y.d(D,{Z:function(){return je}});var j=y(55770),b=y(6610),p=y(5991),E=y(96156),Z=y(3473),V=y(11700),G=y.n(V),I=y(14293),L=y.n(I),_e=y(68929),be=y.n(_e),Le=y(86700),Je=y(28660),Dt=y.n(Je),It=y(7648),Ut=y(72302),xt=y(92364),bt,ct,ir,re,cr;function Ct(Pt,fr){var $t=Object.keys(Pt);if(Object.getOwnPropertySymbols){var zr=Object.getOwnPropertySymbols(Pt);fr&&(zr=zr.filter(function(fe){return Object.getOwnPropertyDescriptor(Pt,fe).enumerable})),$t.push.apply($t,zr)}return $t}function Qe(Pt){for(var fr=1;fr<arguments.length;fr++){var $t=arguments[fr]!=null?arguments[fr]:{};fr%2?Ct(Object($t),!0).forEach(function(zr){(0,E.Z)(Pt,zr,$t[zr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Pt,Object.getOwnPropertyDescriptors($t)):Ct(Object($t)).forEach(function(zr){Object.defineProperty(Pt,zr,Object.getOwnPropertyDescriptor($t,zr))})}return Pt}var Tt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,je=(bt=(0,Le.b2)(),ct=(0,Le.f3)(Ut.v.IShaderModuleService),bt(ir=(re=function(){function Pt(){(0,b.Z)(this,Pt),(0,j.Z)(this,"shaderModuleService",cr,this),(0,E.Z)(this,"rendererService",void 0),(0,E.Z)(this,"config",void 0),(0,E.Z)(this,"quad",Tt),(0,E.Z)(this,"enabled",!0),(0,E.Z)(this,"renderToScreen",!1),(0,E.Z)(this,"model",void 0),(0,E.Z)(this,"name",void 0),(0,E.Z)(this,"optionsToUpdate",{})}return(0,p.Z)(Pt,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function($t){this.name=$t}},{key:"getType",value:function(){return xt.G.PostProcessing}},{key:"init",value:function($t,zr){this.config=zr,this.rendererService=$t.getContainer().get(Ut.v.IRendererService);var fe=this.rendererService,ke=fe.createAttribute,ge=fe.createBuffer,_t=fe.createModel,vt=this.setupShaders(),jt=vt.vs,Bt=vt.fs,Nr=vt.uniforms;this.model=_t({vs:jt,fs:Bt,attributes:{a_Position:ke({buffer:ge({data:[-4,-4,4,-4,0,4],type:It.gl.FLOAT}),size:2})},uniforms:Qe(Qe({u_Texture:null},Nr),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function($t){var zr=this,fe=$t.multiPassRenderer.getPostProcessor(),ke=this.rendererService,ge=ke.useFramebuffer,_t=ke.getViewportSize,vt=ke.clear,jt=_t(),Bt=jt.width,Nr=jt.height;ge(this.renderToScreen?null:fe.getWriteFBO(),function(){vt({framebuffer:fe.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),zr.model.draw({uniforms:Qe({u_Texture:fe.getReadFBO(),u_ViewportSize:[Bt,Nr]},zr.convertOptionsToUniforms(zr.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function($t){this.enabled=$t}},{key:"setRenderToScreen",value:function($t){this.renderToScreen=$t}},{key:"updateOptions",value:function($t){this.optionsToUpdate=Qe(Qe({},this.optionsToUpdate),$t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function($t){var zr={};return Object.keys($t).forEach(function(fe){L()($t[fe])||(zr["u_".concat(G()(be()(fe)))]=$t[fe])}),zr}}]),Pt}(),cr=(0,Z.Z)(re.prototype,"shaderModuleService",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),re))||ir)},19793:function(qe,D,y){"use strict";y.d(D,{P:function(){return j}});var j=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(qe,D,y){"use strict";y.d(D,{v:function(){return j}});var j={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(qe,D,y){"use strict";var j=y(74691),b=null;function p(je){return b.indexOf(je)}var E=2,Z=4,V=64,G=128,I=256,L=512,_e=8192,be=16384,Le=32768,Je=null,Dt=131072,It=262144,Ut=524288,xt=1048576,bt=2097152,ct=4194304,ir=8388608,re=16777216,cr=null;function Ct(je,Pt){return je=_clamp(Math.floor(je),0,255),Pt=_clamp(Math.floor(Pt),0,255),256*je+Pt}function Qe(je){var Pt=je.color,fr=je.radius,$t=je.tileX,zr=je.tileY,fe=je.shape,ke=je.opacity,ge=je.stroke,_t=je.strokeWidth,vt=je.strokeOpacity,jt=[],Bt=[],Nr=[],pn=[Ct(Pt[0],Pt[1]),Ct(Pt[2],Pt[3])],mn=[Ct(ge[0],ge[1]),Ct(ge[2],ge[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Ni){var or=_slicedToArray(Ni,2),ve=or[0],Me=or[1];jt.push([].concat(pn,[(ve+1)*ir+(Me+1)*bt+getShapeIndex(fe)*Dt+fr,($t+512)*Ut+(zr+512)*V])),Bt.push([].concat(mn,[_t,vt])),Nr.push([ke,0,0,0])}),{packedBuffer:jt,packedBuffer2:Bt,packedBuffer3:Nr}}function Tt(je,Pt){if(je===0&&!Pt)return 0;if(je===1&&Pt)return 4294967295;var fr=Pt?1:0,$t=Math.floor(je*127);return $t*cr+fr*re+$t*Dt+fr*Je+$t*L+fr*I+$t*E+fr}},37427:function(qe,D,y){"use strict";y.d(D,{zP:function(){return wg},JE:function(){return w0},ns:function(){return Cg}});var j=y(67294),b=(0,j.createContext)({});function p(){return(0,j.useContext)(b)}var E=y(58881),Z=y(28481),V=y(6610),G=y(5991),I=y(96156),L=y(63349),_e=y(10379),be=y(46070),Le=y(77608),Je=y(6901),Dt=y(26729);function It(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ut(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?It(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):It(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function xt(n){var c=bt();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function bt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ct=0,ir=function(n){(0,_e.Z)(a,n);var c=xt(a);function a(s){var l;return(0,V.Z)(this,a),l=c.call(this),(0,I.Z)((0,L.Z)(l),"controlOption",void 0),(0,I.Z)((0,L.Z)(l),"container",void 0),(0,I.Z)((0,L.Z)(l),"sceneContainer",void 0),(0,I.Z)((0,L.Z)(l),"mapsService",void 0),(0,I.Z)((0,L.Z)(l),"renderService",void 0),(0,I.Z)((0,L.Z)(l),"layerService",void 0),(0,I.Z)((0,L.Z)(l),"controlService",void 0),(0,I.Z)((0,L.Z)(l),"isShow",void 0),l.controlOption=Ut(Ut({},l.getDefault()),s||{}),l}return(0,G.Z)(a,[{key:"getDefault",value:function(){return{position:E.PositionType.TOPRIGHT,name:"".concat(ct++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E.PositionType.BOTTOMRIGHT,d=this.controlService;return d&&d.removeControl(this),this.controlOption.position=l,d&&d.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(E.vK.IMapService),this.renderService=l.get(E.vK.IRendererService),this.layerService=l.get(E.vK.ILayerService),this.controlService=l.get(E.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var d=this.container,x=this.controlOption.position,A=this.controlService.controlCorners[x];return Je.SO.addClass(d,"l7-control"),x.indexOf("bottom")!==-1?A.insertBefore(d,A.firstChild):A.appendChild(d),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;Je.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;Je.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Je.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var d=this.mapsService.getContainer();d!==null&&d.focus()}}}]),a}(Dt.EventEmitter);function re(n){var c=cr();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function cr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ct=function(n){(0,_e.Z)(a,n);var c=re(a);function a(s){var l;return(0,V.Z)(this,a),l=c.call(this,s),(0,I.Z)((0,L.Z)(l),"layerControlInputs",void 0),(0,I.Z)((0,L.Z)(l),"layers",void 0),(0,I.Z)((0,L.Z)(l),"lastZIndex",void 0),(0,I.Z)((0,L.Z)(l),"handlingClick",void 0),(0,I.Z)((0,L.Z)(l),"layersLink",void 0),(0,I.Z)((0,L.Z)(l),"baseLayersList",void 0),(0,I.Z)((0,L.Z)(l),"separator",void 0),(0,I.Z)((0,L.Z)(l),"overlaysList",void 0),(0,I.Z)((0,L.Z)(l),"form",void 0),l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,Je.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,L.Z)(l)),l}return(0,G.Z)(a,[{key:"getDefault",value:function(){return{collapsed:!0,position:E.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(d){d.layer.on("remove",l.onLayerChange),d.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,d){return this.addLayer(l,d,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),d=l.height;Je.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var x=d-(this.container.offsetTop+50);return x<this.form.clientHeight?(Je.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=x+"px"):Je.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Je.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(d){d.layer.off("remove",l.onLayerChange),d.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",d=this.container=Je.SO.create("div",l),x=this.controlOption.collapsed;d.setAttribute("aria-haspopup","true");var A=this.form=Je.SO.create("form",l+"-list");x&&(this.mapsService.on("click",this.collapse),d.addEventListener("mouseenter",this.expand),d.addEventListener("mouseleave",this.collapse)),this.layersLink=Je.SO.create("a",l+"-toggle",d);var O=this.layersLink;O.title="Layers",x||this.expand(),this.baseLayersList=Je.SO.create("div",l+"-base",A),this.separator=Je.SO.create("div",l+"-separator",A),this.overlaysList=Je.SO.create("div",l+"-overlays",A),d.appendChild(A)}},{key:"initLayers",value:function(){var l=this,d=this.controlOption,x=d.baseLayers,A=x===void 0?{}:x,O=d.overlayers,B=O===void 0?{}:O;Object.keys(A).forEach(function(te,$){l.addLayer(A[te],te,!1)}),Object.keys(B).forEach(function(te,$){l.addLayer(B[te],te,!0)})}},{key:"update",value:function(){if(!this.container)return this;Je.SO.empty(this.baseLayersList),Je.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,d,x,A,O=0;for(x=0;x<this.layers.length;x++)A=this.layers[x],this.addItem(A),d=d||A.overlay,l=l||!A.overlay,O+=A.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&O>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=d&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,d,x,A=this.mapsService.getZoom(),O=l.length-1;O>=0;O--)if(d=l[O],x=this.layerService.getLayer(d.layerId),x&&x.inited){var B=x.getMinZoom(),te=x.getMaxZoom();d.disabled=A<B||A>te}}},{key:"addLayer",value:function(l,d,x){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:d,overlay:x});var A=this.controlOption,O=A.sortLayers,B=A.sortFunction,te=A.autoZIndex;O&&this.layers.sort(function($,me){return B($.layer,me.layer,$.name,me.name)}),te&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var d=this.layerService.getLayer(l.target.layerId),x=d!=null&&d.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;x&&this.emit(x,d)}},{key:"createRadioElement",value:function(l,d){var x='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(d?' checked="checked"':"")+"/>",A=document.createElement("div");return A.innerHTML=x,A.firstChild}},{key:"addItem",value:function(l){var d=document.createElement("label"),x=this.layerService.getLayer(l.layer.id),A=x&&x.inited&&l.layer.isVisible(),O;l.overlay?(O=document.createElement("input"),O.type="checkbox",O.className="l7-control-layers-selector",O.defaultChecked=A):O=this.createRadioElement("l7-base-layers",A),this.layerControlInputs.push(O),O.layerId=l.layer.id,O.addEventListener("click",this.onInputClick);var B=document.createElement("span");B.innerHTML=" "+l.name;var te=document.createElement("div");d.appendChild(te),te.appendChild(O),te.appendChild(B);var $=l.overlay?this.overlaysList:this.baseLayersList;return $.appendChild(d),this.checkDisabledLayers(),d}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,d,x,A=[],O=[];this.handlingClick=!0;for(var B=l.length-1;B>=0;B--)d=l[B],x=this.layerService.getLayer(d.layerId),d.checked?A.push(x):d.checked||O.push(x);O.forEach(function(te){te.hide()}),A.forEach(function(te){te.show()}),this.handlingClick=!1}}]),a}(ir);function Qe(n){var c=Tt();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Tt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var je=function(n){(0,_e.Z)(a,n);var c=Qe(a);function a(){return(0,V.Z)(this,a),c.apply(this,arguments)}return(0,G.Z)(a,[{key:"getDefault",value:function(){return{position:E.PositionType.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",d=Je.SO.create("div",l),x=Je.SO.create("a","l7-ctrl-logo");return x.target="_blank",x.rel="noopener nofollow",x.href="https://antv.alipay.com/l7",x.setAttribute("aria-label","AntV logo"),x.setAttribute("rel","noopener nofollow"),d.appendChild(x),d}},{key:"onRemove",value:function(){return null}}]),a}(ir);function Pt(n){var c=fr();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function fr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var $t=function(n){(0,_e.Z)(a,n);var c=Pt(a);function a(s){var l;return(0,V.Z)(this,a),l=c.call(this,s),(0,I.Z)((0,L.Z)(l),"mScale",void 0),(0,I.Z)((0,L.Z)(l),"iScale",void 0),(0,Je.Ev)(["update"],(0,L.Z)(l)),l}return(0,G.Z)(a,[{key:"getDefault",value:function(){return{position:E.PositionType.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",d=Je.SO.create("div",l);this.addScales(l+"-line",d);var x=this.controlOption.updateWhenIdle;return this.mapsService.on(x?"moveend":"mapmove",this.update),this.mapsService.on(x?"zoomend":"zoomchange",this.update),this.update(),d}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,d=this.controlOption.maxWidth,x=l.getSize()[1]/2,A=l.containerToLngLat([0,x]),O=l.containerToLngLat([d,x]),B=(0,Je.yM)([A.lng,A.lat],[O.lng,O.lat]);this.updateScales(B)}},{key:"updateScales",value:function(l){var d=this.controlOption,x=d.metric,A=d.imperial;x&&l&&this.updateMetric(l),A&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var d=this.getRoundNum(l),x=d<1e3?d+" m":d/1e3+" km";this.updateScale(this.mScale,x,d/l)}},{key:"updateImperial",value:function(l){var d=l*3.2808399,x,A,O;d>5280?(x=d/5280,A=this.getRoundNum(x),this.updateScale(this.iScale,A+" mi",A/x)):(O=this.getRoundNum(d),this.updateScale(this.iScale,O+" ft",O/d))}},{key:"updateScale",value:function(l,d,x){var A=this.controlOption.maxWidth;l.style.width=Math.round(A*x)+"px",l.innerHTML=d}},{key:"getRoundNum",value:function(l){var d=Math.pow(10,(Math.floor(l)+"").length-1),x=l/d;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:1,d*x}},{key:"addScales",value:function(l,d){var x=this.controlOption,A=x.metric,O=x.imperial;A&&(this.mScale=Je.SO.create("div",l,d)),O&&(this.iScale=Je.SO.create("div",l,d))}}]),a}(ir);function zr(n){var c=fe();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function fe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ke=function(n){(0,_e.Z)(a,n);var c=zr(a);function a(s){var l;return(0,V.Z)(this,a),l=c.call(this,s),(0,I.Z)((0,L.Z)(l),"disabled",void 0),(0,I.Z)((0,L.Z)(l),"zoomInButton",void 0),(0,I.Z)((0,L.Z)(l),"zoomOutButton",void 0),(0,Je.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,L.Z)(l)),l}return(0,G.Z)(a,[{key:"getDefault",value:function(){return{position:E.PositionType.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",d=Je.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",d,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",d,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),d}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,d,x,A,O){var B=Je.SO.create("a",x,A);return B.innerHTML=l,B.title=d,B.href="javascript:void(0)",B.addEventListener("click",O),B}},{key:"updateDisabled",value:function(){var l=this.mapsService,d="l7-disabled";Je.SO.removeClass(this.zoomInButton,d),Je.SO.removeClass(this.zoomOutButton,d),(this.disabled||l.getZoom()<=l.getMinZoom())&&Je.SO.addClass(this.zoomOutButton,d),(this.disabled||l.getZoom()>=l.getMaxZoom())&&Je.SO.addClass(this.zoomInButton,d)}}]),a}(ir);function ge(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function _t(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ge(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ge(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function vt(n){var c=jt();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function jt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Bt=function(n){(0,_e.Z)(a,n);var c=vt(a);function a(s){var l;return(0,V.Z)(this,a),l=c.call(this),(0,I.Z)((0,L.Z)(l),"markerOption",void 0),(0,I.Z)((0,L.Z)(l),"defaultMarker",void 0),(0,I.Z)((0,L.Z)(l),"popup",void 0),(0,I.Z)((0,L.Z)(l),"mapsService",void 0),(0,I.Z)((0,L.Z)(l),"sceneSerive",void 0),(0,I.Z)((0,L.Z)(l),"lngLat",void 0),(0,I.Z)((0,L.Z)(l),"scene",void 0),(0,I.Z)((0,L.Z)(l),"added",!1),(0,I.Z)((0,L.Z)(l),"eventHandle",function(d){l.emit(d.type,{target:d,data:l.markerOption.extData,lngLat:l.lngLat})}),l.markerOption=_t(_t({},l.getDefault()),s),(0,Je.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,L.Z)(l)),l.init(),l}return(0,G.Z)(a,[{key:"getDefault",value:function(){return{element:void 0,anchor:Je.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(E.vK.IMapService),this.sceneSerive=l.get(E.vK.ISceneService);var d=this.markerOption,x=d.element,A=d.draggable;return this.mapsService.getMarkerContainer().appendChild(x),this.registerMarkerEvent(x),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&Je.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var d=this;if(!this.added)return this.once("added",function(){d.setElement(l)}),this;var x=this.markerOption.element;return x&&Je.SO.remove(x),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var d=this.popup;return d?(d.isOpen()||d.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var d=this.popup;return d&&d.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,x=l.anchor;this.updatePosition(),Je.SO.setTransform(d,"".concat(Je.rQ[x]))}}},{key:"onMapClick",value:function(l){var d=this.markerOption.element;this.popup&&d&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,x=l.offsets,A=this.lngLat,O=A.lng,B=A.lat,te=this.mapsService.getBounds(),$=this.mapsService.lngLatToContainer([O,B]);if(d){d.style.display="block";var me=this.mapsService.getContainer(),ze=0,ht=0;if(me&&(ze=me.scrollWidth,ht=me.scrollHeight),Math.abs(te[0][0])>180||Math.abs(te[1][0])>180){if($.x>ze){var Ft=this.mapsService.lngLatToContainer([O-360,B]);$.x=Ft.x}if($.x<0){var mr=this.mapsService.lngLatToContainer([O+360,B]);$.x=mr.x}}($.x>ze||$.x<0||$.y>ht||$.y<0)&&(d.style.display="none"),d.style.left=$.x+x[0]+"px",d.style.top=$.y-x[1]+"px"}}}},{key:"init",value:function(){var l=this,d=this.markerOption.element,x=this.markerOption,A=x.color,O=x.anchor;if(!d){this.defaultMarker=!0,d=Je.SO.create("div"),this.markerOption.element=d;var B=document.createElementNS("http://www.w3.org/2000/svg","svg");B.setAttributeNS(null,"display","block"),B.setAttributeNS(null,"height","48px"),B.setAttributeNS(null,"width","48px"),B.setAttributeNS(null,"viewBox","0 0 1024 1024");var te=document.createElementNS("http://www.w3.org/2000/svg","path");te.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),te.setAttributeNS(null,"fill",A),B.appendChild(te),d.appendChild(B)}Je.SO.addClass(d,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function($){var me,ze,ht=((me=l.markerOption)===null||me===void 0?void 0:me.style)&&((ze=l.markerOption)===null||ze===void 0?void 0:ze.style[$]);d&&(d.style[$]=ht)}),d.addEventListener("click",function($){l.onMapClick($)}),d.addEventListener("click",this.eventHandle),(0,Je.zi)(d,O,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),a}(Dt.EventEmitter),Nr=y(82492),pn=y.n(Nr),mn=y(69848),Ni=y.n(mn);function or(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ve(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?or(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):or(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Me(n){var c=Ge();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Ge(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Re=function(n){(0,_e.Z)(a,n);var c=Me(a);function a(s){var l,d;return(0,V.Z)(this,a),d=c.call(this),(0,I.Z)((0,L.Z)(d),"markers",[]),(0,I.Z)((0,L.Z)(d),"markerLayerOption",void 0),(0,I.Z)((0,L.Z)(d),"clusterIndex",void 0),(0,I.Z)((0,L.Z)(d),"points",[]),(0,I.Z)((0,L.Z)(d),"clusterMarkers",[]),(0,I.Z)((0,L.Z)(d),"mapsService",void 0),(0,I.Z)((0,L.Z)(d),"scene",void 0),(0,I.Z)((0,L.Z)(d),"zoom",void 0),(0,I.Z)((0,L.Z)(d),"bbox",void 0),d.markerLayerOption=pn()(d.getDefault(),s),(0,Je.Ev)(["update"],(0,L.Z)(d)),d.zoom=((l=d.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,d}return(0,G.Z)(a,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(E.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var d=this.markerLayerOption.cluster;d&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var d=this.markers.indexOf(l);d>-1&&this.markers.splice(d,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(d){d.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,d){var x=l.getLnglat(),A=x.lng,O=x.lat,B={geometry:{type:"Point",coordinates:[A,O]},properties:ve(ve({},l.getExtData()),{},{marker_id:d})};this.points.push(B)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,d=l.radius,x=l.minZoom,A=x===void 0?0:x,O=l.maxZoom;this.clusterIndex=new(Ni())({radius:d,minZoom:A,maxZoom:O}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,d){var x=this,A=l[0].concat(l[1]),O=this.clusterIndex.getClusters(A,d);this.clusterMarkers.forEach(function(B){B.remove()}),this.clusterMarkers=[],O.forEach(function(B){var te,$=x.markerLayerOption.clusterOption,me=$.field,ze=$.method;if(B.properties&&(te=B.properties)!==null&&te!==void 0&&te.cluster_id){var ht,Ft=x.getLeaves((ht=B.properties)===null||ht===void 0?void 0:ht.cluster_id);if(B.properties.clusterData=Ft,me&&ze){var mr=Ft==null?void 0:Ft.map(function(On){var ii=(0,I.Z)({},me,On.properties[me]);return ii}),Er=Je.a5.getColumn(mr,me),Zr=Je.a5.getSatByColumn(ze,Er),vn="point_"+ze;B.properties[vn]=Zr.toFixed(2)}}var hn=x.clusterMarker(B);x.clusterMarkers.push(hn),hn.addTo(x.scene)})}},{key:"getLeaves",value:function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,d,x):null}},{key:"clusterMarker",value:function(l){var d=this.markerLayerOption.clusterOption,x=d,A=x.element,O=A===void 0?this.generateElement.bind(this):A,B=new Bt({element:O(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return B}},{key:"normalMarker",value:function(l){var d=l.properties.marker_id;return this.markers[d]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),d=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,Je.oO)(this.bbox,d))&&(this.bbox=(0,Je.yA)(d,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var d=Je.SO.create("div","l7-marker-cluster"),x=Je.SO.create("div","",d),A=Je.SO.create("span","",x),O=this.markerLayerOption.clusterOption,B=O.field,te=O.method;l.properties.point_count=l.properties.point_count||1;var $=B&&te?l.properties["point_"+te]||l.properties[B]:l.properties.point_count;return A.textContent=$,d}}]),a}(Dt.EventEmitter);function kt(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function rr(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?kt(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):kt(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function yr(n){var c=Pr();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Pr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var sr=function(n){(0,_e.Z)(a,n);var c=yr(a);function a(s){var l;return(0,V.Z)(this,a),l=c.call(this),(0,I.Z)((0,L.Z)(l),"popupOption",void 0),(0,I.Z)((0,L.Z)(l),"mapsService",void 0),(0,I.Z)((0,L.Z)(l),"sceneSerive",void 0),(0,I.Z)((0,L.Z)(l),"lngLat",void 0),(0,I.Z)((0,L.Z)(l),"content",void 0),(0,I.Z)((0,L.Z)(l),"closeButton",void 0),(0,I.Z)((0,L.Z)(l),"timeoutInstance",void 0),(0,I.Z)((0,L.Z)(l),"container",void 0),(0,I.Z)((0,L.Z)(l),"tip",void 0),(0,I.Z)((0,L.Z)(l),"scene",void 0),l.popupOption=rr(rr({},l.getdefault()),s),(0,Je.Ev)(["update","onClickClose","remove"],(0,L.Z)(l)),l}return(0,G.Z)(a,[{key:"addTo",value:function(l){var d=this;return this.mapsService=l.get(E.vK.IMapService),this.sceneSerive=l.get(E.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){d.mapsService.on("click",d.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var d=window.document.createDocumentFragment(),x=window.document.createElement("body"),A;for(x.innerHTML=l;A=x.firstChild,!!A;)d.appendChild(A);return this.setDOMContent(d)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Je.SO.remove(this.content),this.content=Je.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Je.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,d,x){var A=window.document.createElement(l);return d!==void 0&&(A.className=d),x&&x.appendChild(A),A}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Je.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,d=this.lngLat,x=this.popupOption,A=x.className,O=x.maxWidth,B=x.anchor;if(!(!this.mapsService||!d||!this.content)){var te=this.mapsService.getMarkerContainer();if(!this.container&&te){this.container=this.creatDom("div","l7-popup",te),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),A&&A.split(" ").forEach(function(me){return l.container.classList.add(me)});var $=this.popupOption.stopPropagation;$&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(me){l.container.addEventListener(me,function(ze){ze.stopPropagation()})})}O&&this.container.style.maxWidth!==O&&(this.container.style.maxWidth=O),this.updatePosition(),Je.SO.setTransform(this.container,"".concat(Je.rQ[B])),(0,Je.zi)(this.container,B,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,d=l.lng,x=l.lat,A=this.popupOption.offsets,O=this.mapsService.lngLatToContainer([d,x]);this.container.style.left=O.x+A[0]+"px",this.container.style.top=O.y-A[1]+"px"}}}]),a}(Dt.EventEmitter);function Rr(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}Rr(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var w=y(92137),X=y(87757),Ue=y.n(X),Ve=y(86700),ot=y(88307),At=y.n(ot),Q=y(28660),Rt=function(){function n(c,a){(0,V.Z)(this,n),(0,I.Z)(this,"attribute",void 0),(0,I.Z)(this,"buffer",void 0);var s=a.buffer,l=a.offset,d=a.stride,x=a.normalized,A=a.size,O=a.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:d||0,normalized:x||!1,divisor:O||0},A&&(this.attribute.size=A)}return(0,G.Z)(n,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(a){this.buffer.subData(a)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),n}(),dr,Cr,Xe,rt,wt,Ot,gr,br,Xt,kr,Mr,un,an,Kn,ti=(dr={},(0,I.Z)(dr,E.gl.POINTS,"points"),(0,I.Z)(dr,E.gl.LINES,"lines"),(0,I.Z)(dr,E.gl.LINE_LOOP,"line loop"),(0,I.Z)(dr,E.gl.LINE_STRIP,"line strip"),(0,I.Z)(dr,E.gl.TRIANGLES,"triangles"),(0,I.Z)(dr,E.gl.TRIANGLE_FAN,"triangle fan"),(0,I.Z)(dr,E.gl.TRIANGLE_STRIP,"triangle strip"),dr),Qi=(Cr={},(0,I.Z)(Cr,E.gl.STATIC_DRAW,"static"),(0,I.Z)(Cr,E.gl.DYNAMIC_DRAW,"dynamic"),(0,I.Z)(Cr,E.gl.STREAM_DRAW,"stream"),Cr),Ai=(Xe={},(0,I.Z)(Xe,E.gl.BYTE,"int8"),(0,I.Z)(Xe,E.gl.UNSIGNED_INT,"int16"),(0,I.Z)(Xe,E.gl.INT,"int32"),(0,I.Z)(Xe,E.gl.UNSIGNED_BYTE,"uint8"),(0,I.Z)(Xe,E.gl.UNSIGNED_SHORT,"uint16"),(0,I.Z)(Xe,E.gl.UNSIGNED_INT,"uint32"),(0,I.Z)(Xe,E.gl.FLOAT,"float"),Xe),Pi=(rt={},(0,I.Z)(rt,E.gl.ALPHA,"alpha"),(0,I.Z)(rt,E.gl.LUMINANCE,"luminance"),(0,I.Z)(rt,E.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,I.Z)(rt,E.gl.RGB,"rgb"),(0,I.Z)(rt,E.gl.RGBA,"rgba"),(0,I.Z)(rt,E.gl.RGBA4,"rgba4"),(0,I.Z)(rt,E.gl.RGB5_A1,"rgb5 a1"),(0,I.Z)(rt,E.gl.RGB565,"rgb565"),(0,I.Z)(rt,E.gl.DEPTH_COMPONENT,"depth"),(0,I.Z)(rt,E.gl.DEPTH_STENCIL,"depth stencil"),rt),q=(wt={},(0,I.Z)(wt,E.gl.DONT_CARE,"dont care"),(0,I.Z)(wt,E.gl.NICEST,"nice"),(0,I.Z)(wt,E.gl.FASTEST,"fast"),wt),le=(Ot={},(0,I.Z)(Ot,E.gl.NEAREST,"nearest"),(0,I.Z)(Ot,E.gl.LINEAR,"linear"),(0,I.Z)(Ot,E.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,I.Z)(Ot,E.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,I.Z)(Ot,E.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,I.Z)(Ot,E.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Ot),pe=(gr={},(0,I.Z)(gr,E.gl.REPEAT,"repeat"),(0,I.Z)(gr,E.gl.CLAMP_TO_EDGE,"clamp"),(0,I.Z)(gr,E.gl.MIRRORED_REPEAT,"mirror"),gr),U=(br={},(0,I.Z)(br,E.gl.NONE,"none"),(0,I.Z)(br,E.gl.BROWSER_DEFAULT_WEBGL,"browser"),br),ae=(Xt={},(0,I.Z)(Xt,E.gl.NEVER,"never"),(0,I.Z)(Xt,E.gl.ALWAYS,"always"),(0,I.Z)(Xt,E.gl.LESS,"less"),(0,I.Z)(Xt,E.gl.LEQUAL,"lequal"),(0,I.Z)(Xt,E.gl.GREATER,"greater"),(0,I.Z)(Xt,E.gl.GEQUAL,"gequal"),(0,I.Z)(Xt,E.gl.EQUAL,"equal"),(0,I.Z)(Xt,E.gl.NOTEQUAL,"notequal"),Xt),de=(kr={},(0,I.Z)(kr,E.gl.FUNC_ADD,"add"),(0,I.Z)(kr,E.gl.MIN_EXT,"min"),(0,I.Z)(kr,E.gl.MAX_EXT,"max"),(0,I.Z)(kr,E.gl.FUNC_SUBTRACT,"subtract"),(0,I.Z)(kr,E.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),kr),Pe=(Mr={},(0,I.Z)(Mr,E.gl.ZERO,"zero"),(0,I.Z)(Mr,E.gl.ONE,"one"),(0,I.Z)(Mr,E.gl.SRC_COLOR,"src color"),(0,I.Z)(Mr,E.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,I.Z)(Mr,E.gl.SRC_ALPHA,"src alpha"),(0,I.Z)(Mr,E.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,I.Z)(Mr,E.gl.DST_COLOR,"dst color"),(0,I.Z)(Mr,E.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,I.Z)(Mr,E.gl.DST_ALPHA,"dst alpha"),(0,I.Z)(Mr,E.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,I.Z)(Mr,E.gl.CONSTANT_COLOR,"constant color"),(0,I.Z)(Mr,E.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,I.Z)(Mr,E.gl.CONSTANT_ALPHA,"constant alpha"),(0,I.Z)(Mr,E.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,I.Z)(Mr,E.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),Mr),ue=(un={},(0,I.Z)(un,E.gl.NEVER,"never"),(0,I.Z)(un,E.gl.ALWAYS,"always"),(0,I.Z)(un,E.gl.LESS,"less"),(0,I.Z)(un,E.gl.LEQUAL,"lequal"),(0,I.Z)(un,E.gl.GREATER,"greater"),(0,I.Z)(un,E.gl.GEQUAL,"gequal"),(0,I.Z)(un,E.gl.EQUAL,"equal"),(0,I.Z)(un,E.gl.NOTEQUAL,"notequal"),un),Ee=(an={},(0,I.Z)(an,E.gl.ZERO,"zero"),(0,I.Z)(an,E.gl.KEEP,"keep"),(0,I.Z)(an,E.gl.REPLACE,"replace"),(0,I.Z)(an,E.gl.INVERT,"invert"),(0,I.Z)(an,E.gl.INCR,"increment"),(0,I.Z)(an,E.gl.DECR,"decrement"),(0,I.Z)(an,E.gl.INCR_WRAP,"increment wrap"),(0,I.Z)(an,E.gl.DECR_WRAP,"decrement wrap"),an),mt=(Kn={},(0,I.Z)(Kn,E.gl.FRONT,"front"),(0,I.Z)(Kn,E.gl.BACK,"back"),Kn),wr=function(){function n(c,a){(0,V.Z)(this,n),(0,I.Z)(this,"buffer",void 0);var s=a.data,l=a.usage,d=a.type;this.buffer=c.buffer({data:s,usage:Qi[l||E.gl.STATIC_DRAW],type:Ai[d||E.gl.UNSIGNED_BYTE]})}return(0,G.Z)(n,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(a){var s=a.data,l=a.offset;this.buffer.subdata(s,l)}}]),n}(),Yt=function(){function n(c,a){(0,V.Z)(this,n),(0,I.Z)(this,"elements",void 0);var s=a.data,l=a.usage,d=a.type,x=a.count;this.elements=c.elements({data:s,usage:Qi[l||E.gl.STATIC_DRAW],type:Ai[d||E.gl.UNSIGNED_BYTE],count:x})}return(0,G.Z)(n,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(a){var s=a.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),n}(),tr=function(){function n(c,a){(0,V.Z)(this,n),(0,I.Z)(this,"framebuffer",void 0);var s=a.width,l=a.height,d=a.color,x=a.colors,A=a.depth,O=a.stencil,B={width:s,height:l};Array.isArray(x)&&(B.colors=x.map(function(te){return te.get()})),d&&typeof d!="boolean"&&(B.color=d.get()),this.framebuffer=c.framebuffer(B)}return(0,G.Z)(n,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.framebuffer.resize(s,l)}}]),n}(),Ur=y(90484),Fn=y(36719),Rn=y.n(Fn),qt=y(68630),Tn=y.n(qt);function ln(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function on(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ln(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ln(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Li=function(){function n(c,a){(0,V.Z)(this,n),(0,I.Z)(this,"reGl",void 0),(0,I.Z)(this,"destroyed",!1),(0,I.Z)(this,"drawCommand",void 0),(0,I.Z)(this,"drawParams",void 0),(0,I.Z)(this,"options",void 0),(0,I.Z)(this,"uniforms",{}),this.reGl=c;var s=a.vs,l=a.fs,d=a.attributes,x=a.uniforms,A=a.primitive,O=a.count,B=a.elements,te=a.depth,$=a.blend,me=a.stencil,ze=a.cull,ht=a.instances,Ft={};this.options=a,x&&(this.uniforms=this.extractUniforms(x),Object.keys(x).forEach(function(Zr){Ft[Zr]=c.prop(Zr)}));var mr={};Object.keys(d).forEach(function(Zr){mr[Zr]=d[Zr].get()});var Er={attributes:mr,frag:l,uniforms:Ft,vert:s,primitive:ti[A===void 0?E.gl.TRIANGLES:A]};ht&&(Er.instances=ht),O&&(Er.count=O),B&&(Er.elements=B.get()),this.initDepthDrawParams({depth:te},Er),this.initBlendDrawParams({blend:$},Er),this.initStencilDrawParams({stencil:me},Er),this.initCullDrawParams({cull:ze},Er),this.drawCommand=c(Er),this.drawParams=Er}return(0,G.Z)(n,[{key:"addUniforms",value:function(a){this.uniforms=on(on({},this.uniforms),this.extractUniforms(a))}},{key:"draw",value:function(a){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=on(on({},this.uniforms),this.extractUniforms(a.uniforms||{})),l={};Object.keys(s).forEach(function(d){var x=(0,Ur.Z)(s[d]);x==="boolean"||x==="number"||Array.isArray(s[d])||s[d].BYTES_PER_ELEMENT?l[d]=s[d]:l[d]=s[d].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(a){a.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(a,s){var l=a.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:ae[l.func||E.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(a,s){var l=a.blend;if(l){var d=l.enable,x=l.func,A=l.equation,O=l.color,B=O===void 0?[0,0,0,0]:O;s.blend={enable:!!d,func:{srcRGB:Pe[x&&x.srcRGB||E.gl.SRC_ALPHA],srcAlpha:Pe[x&&x.srcAlpha||E.gl.SRC_ALPHA],dstRGB:Pe[x&&x.dstRGB||E.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:Pe[x&&x.dstAlpha||E.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:de[A&&A.rgb||E.gl.FUNC_ADD],alpha:de[A&&A.alpha||E.gl.FUNC_ADD]},color:B}}}},{key:"initStencilDrawParams",value:function(a,s){var l=a.stencil;if(l){var d=l.enable,x=l.mask,A=x===void 0?-1:x,O=l.func,B=O===void 0?{cmp:E.gl.ALWAYS,ref:0,mask:-1}:O,te=l.opFront,$=te===void 0?{fail:E.gl.KEEP,zfail:E.gl.KEEP,zpass:E.gl.KEEP}:te,me=l.opBack,ze=me===void 0?{fail:E.gl.KEEP,zfail:E.gl.KEEP,zpass:E.gl.KEEP}:me;s.stencil={enable:!!d,mask:A,func:on(on({},B),{},{cmp:ue[B.cmp]}),opFront:{fail:Ee[$.fail],zfail:Ee[$.zfail],zpass:Ee[$.zpass]},opBack:{fail:Ee[ze.fail],zfail:Ee[ze.zfail],zpass:Ee[ze.zpass]}}}}},{key:"initCullDrawParams",value:function(a,s){var l=a.cull;if(l){var d=l.enable,x=l.face,A=x===void 0?E.gl.BACK:x;s.cull={enable:!!d,face:mt[A]}}}},{key:"extractUniforms",value:function(a){var s=this,l={};return Object.keys(a).forEach(function(d){s.extractUniformsRecursively(d,a[d],l,"")}),l}},{key:"extractUniformsRecursively",value:function(a,s,l,d){var x=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||Rn()(s)||s===""||"resize"in s){l["".concat(d&&d+".").concat(a)]=s;return}Tn()(s)&&Object.keys(s).forEach(function(A){x.extractUniformsRecursively(A,s[A],l,"".concat(d&&d+".").concat(a))}),Array.isArray(s)&&s.forEach(function(A,O){Object.keys(A).forEach(function(B){x.extractUniformsRecursively(B,A[B],l,"".concat(d&&d+".").concat(a,"[").concat(O,"]"))})})}}]),n}(),bn=function(){function n(c,a){(0,V.Z)(this,n),(0,I.Z)(this,"texture",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0);var s=a.data,l=a.type,d=l===void 0?E.gl.UNSIGNED_BYTE:l,x=a.width,A=a.height,O=a.flipY,B=O===void 0?!1:O,te=a.format,$=te===void 0?E.gl.RGBA:te,me=a.mipmap,ze=me===void 0?!1:me,ht=a.wrapS,Ft=ht===void 0?E.gl.CLAMP_TO_EDGE:ht,mr=a.wrapT,Er=mr===void 0?E.gl.CLAMP_TO_EDGE:mr,Zr=a.aniso,vn=Zr===void 0?0:Zr,hn=a.alignment,On=hn===void 0?1:hn,ii=a.premultiplyAlpha,wn=ii===void 0?!1:ii,xi=a.mag,Ji=xi===void 0?E.gl.NEAREST:xi,Sa=a.min,gi=Sa===void 0?E.gl.NEAREST:Sa,Oa=a.colorSpace,eo=Oa===void 0?E.gl.BROWSER_DEFAULT_WEBGL:Oa;this.width=x,this.height=A;var Ks={width:x,height:A,type:Ai[d],format:Pi[$],wrapS:pe[Ft],wrapT:pe[Er],mag:le[Ji],min:le[gi],alignment:On,flipY:B,colorSpace:U[eo],premultiplyAlpha:wn,aniso:vn};s&&(Ks.data=s),typeof ze=="number"?Ks.mipmap=q[ze]:typeof ze=="boolean"&&(Ks.mipmap=ze),this.texture=c.texture(Ks)}return(0,G.Z)(n,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(a)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),n}(),Ii,ea,ci=(Ii=(0,Ve.b2)(),Ii(ea=function(){function n(){var c=this;(0,V.Z)(this,n),(0,I.Z)(this,"extensionObject",void 0),(0,I.Z)(this,"gl",void 0),(0,I.Z)(this,"$container",void 0),(0,I.Z)(this,"canvas",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDirty",void 0),(0,I.Z)(this,"createModel",function(a){return new Li(c.gl,a)}),(0,I.Z)(this,"createAttribute",function(a){return new Rt(c.gl,a)}),(0,I.Z)(this,"createBuffer",function(a){return new wr(c.gl,a)}),(0,I.Z)(this,"createElements",function(a){return new Yt(c.gl,a)}),(0,I.Z)(this,"createTexture2D",function(a){return new bn(c.gl,a)}),(0,I.Z)(this,"createFramebuffer",function(a){return new tr(c.gl,a)}),(0,I.Z)(this,"useFramebuffer",function(a,s){c.gl({framebuffer:a?a.get():null})(s)}),(0,I.Z)(this,"clear",function(a){var s=a.color,l=a.depth,d=a.stencil,x=a.framebuffer,A=x===void 0?null:x,O={color:s,depth:l,stencil:d};O.framebuffer=A===null?A:A.get(),c.gl.clear(O)}),(0,I.Z)(this,"viewport",function(a){var s=a.x,l=a.y,d=a.width,x=a.height;c.gl._gl.viewport(s,l,d,x),c.width=d,c.height=x,c.gl._refresh()}),(0,I.Z)(this,"readPixels",function(a){var s=a.framebuffer,l=a.x,d=a.y,x=a.width,A=a.height,O={x:l,y:d,width:x,height:A};return s&&(O.framebuffer=s.get()),c.gl.read(O)}),(0,I.Z)(this,"getViewportSize",function(){return{width:c.gl._gl.drawingBufferWidth,height:c.gl._gl.drawingBufferHeight}}),(0,I.Z)(this,"getContainer",function(){var a;return(a=c.canvas)===null||a===void 0?void 0:a.parentElement}),(0,I.Z)(this,"getCanvas",function(){return c.canvas}),(0,I.Z)(this,"getGLContext",function(){return c.gl._gl}),(0,I.Z)(this,"destroy",function(){c.gl.destroy()})}return(0,G.Z)(n,[{key:"init",value:function(){var c=(0,w.Z)(Ue().mark(function s(l,d){var x=this;return Ue().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return this.canvas=l,O.next=3,new Promise(function(B,te){At()({canvas:x.canvas,attributes:{alpha:!0,antialias:d.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(me,ze){(me||!ze)&&te(me),B(ze)}})});case 3:this.gl=O.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return O.stop()}},s,this)}));function a(s,l){return c.apply(this,arguments)}return a}()},{key:"testExtension",value:function(a){return!!this.getGLContext().getExtension(a)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var a=this.getGLContext();a.disable(a.CULL_FACE)}},{key:"setDirty",value:function(a){this.isDirty=a}},{key:"getDirty",value:function(){return this.isDirty}}]),n}())||ea);function qi(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function zi(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?qi(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):qi(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Mi=function(){function n(c){(0,V.Z)(this,n),(0,I.Z)(this,"sceneService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"controlService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"markerService",void 0),(0,I.Z)(this,"popupService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"container",void 0);var a=c.id,s=c.map,l=(0,E.Hp)();this.container=l,s.setContainer(l,a),l.bind(E.vK.IRendererService).to(ci).inSingletonScope(),this.sceneService=l.get(E.vK.ISceneService),this.mapService=l.get(E.vK.IMapService),this.iconService=l.get(E.vK.IIconService),this.fontService=l.get(E.vK.IFontService),this.controlService=l.get(E.vK.IControlService),this.layerService=l.get(E.vK.ILayerService),this.markerService=l.get(E.vK.IMarkerService),this.interactionService=l.get(E.vK.IInteractionService),this.popupService=l.get(E.vK.IPopupService),this.initComponent(a),this.sceneService.init(c),this.initControl()}return(0,G.Z)(n,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(a){return this.sceneService.exportPng(a)}},{key:"exportMap",value:function(a){return this.sceneService.exportPng(a)}},{key:"registerRenderService",value:function(a){var s=this;if(this.sceneService.loaded){var l=new a(this);l.init()}else this.on("loaded",function(){var d=new a(s);d.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(a){var s=(0,E.e7)(this.container);a.setContainer(s),this.sceneService.addLayer(a)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(a){return this.layerService.getLayer(a)}},{key:"getLayerByName",value:function(a){return this.layerService.getLayerByName(a)}},{key:"removeLayer",value:function(a){this.layerService.remove(a)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(a,s){this.fontService.addIconFont(a,s)}},{key:"addIconFonts",value:function(a){var s=this;a.forEach(function(l){var d=(0,Z.Z)(l,2),x=d[0],A=d[1];s.fontService.addIconFont(x,A)})}},{key:"addFontFace",value:function(a,s){this.sceneService.addFontFace(a,s)}},{key:"addImage",value:function(a,s){this.iconService.addImage(a,s)}},{key:"hasImage",value:function(a){return this.iconService.hasImage(a)}},{key:"removeImage",value:function(a){this.iconService.removeImage(a)}},{key:"addIconFontGlyphs",value:function(a,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(a){this.controlService.addControl(a,this.container)}},{key:"removeControl",value:function(a){this.controlService.removeControl(a)}},{key:"getControlByName",value:function(a){return this.controlService.getControlByName(a)}},{key:"addMarker",value:function(a){this.markerService.addMarker(a)}},{key:"addMarkerLayer",value:function(a){this.markerService.addMarkerLayer(a)}},{key:"removeMarkerLayer",value:function(a){this.markerService.removeMarkerLayer(a)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(a){this.popupService.addPopup(a)}},{key:"on",value:function(a,s){E.SceneEventList.indexOf(a)===-1?this.mapService.on(a,s):this.sceneService.on(a,s)}},{key:"once",value:function(a,s){E.SceneEventList.indexOf(a)===-1?this.mapService.once(a,s):this.sceneService.once(a,s)}},{key:"off",value:function(a,s){E.SceneEventList.indexOf(a)===-1?this.mapService.off(a,s):this.sceneService.off(a,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(a){return this.mapService.getCenter(a)}},{key:"setCenter",value:function(a,s){return this.mapService.setCenter(a,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(a){return this.mapService.setPitch(a)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(a){this.mapService.setRotation(a)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(a){this.mapService.panTo(a)}},{key:"panBy",value:function(a,s){this.mapService.panBy(a,s)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(a){this.mapService.setZoom(a)}},{key:"fitBounds",value:function(a,s){var l=this.sceneService.getSceneConfig(),d=l.fitBoundsOptions,x=l.animate;this.mapService.fitBounds(a,s||zi(zi({},d),{},{animate:x}))}},{key:"setZoomAndCenter",value:function(a,s){this.mapService.setZoomAndCenter(a,s)}},{key:"setMapStyle",value:function(a){this.mapService.setMapStyle(a)}},{key:"setMapStatus",value:function(a){this.mapService.setMapStatus(a)}},{key:"pixelToLngLat",value:function(a){return this.mapService.pixelToLngLat(a)}},{key:"lngLatToPixel",value:function(a){return this.mapService.lngLatToPixel(a)}},{key:"containerToLngLat",value:function(a){return this.mapService.containerToLngLat(a)}},{key:"lngLatToContainer",value:function(a){return this.mapService.lngLatToContainer(a)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(a,s){this.container.bind(E.vK.IPostProcessingPass).to(a).whenTargetNamed(s)}},{key:"initComponent",value:function(a){this.controlService.init({container:Je.SO.getContainer(a)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var a=this.sceneService.getSceneConfig(),s=a.logoVisible,l=a.logoPosition;s&&this.addControl(new je({position:l}))}}]),n}(),la=y(81253),Bi=y(55770),ai=y(3473),ki=y(13218),wi=y.n(ki),ro=y(23560),po=y.n(ro),ia=y(46343),Gi,Zs,nu,Aa,No;function Hi(n){return n.map(function(c){return typeof c=="string"&&(c=[c,{}]),c})}var Wa=(Gi=(0,Ve.b2)(),Zs=(0,Ve.f3)(E.vK.IGlobalConfigService),Gi(nu=(Aa=function(){function n(){(0,V.Z)(this,n),(0,Bi.Z)(this,"configService",No,this),(0,I.Z)(this,"enabled",void 0)}return(0,G.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.rendererService,x=s.postProcessingPassFactory,A=s.normalPassFactory;a.hooks.init.tap("MultiPassRendererPlugin",function(){var O=a.getLayerConfig(),B=O.enableMultiPassRenderer,te=O.passes,$=te===void 0?[]:te;l.enabled=!!B&&a.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(a.multiPassRenderer=l.createMultiPassRenderer(a,$,x,A),a.multiPassRenderer.setRenderFlag(!0))}),a.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(a,s,l,d){var x=a.multiPassRenderer,A=a.getLayerConfig(),O=A.enablePicking,B=A.enableTAA;return O&&x.add(d("pixelPicking")),x}}]),n}(),No=(0,ai.Z)(Aa.prototype,"configService",[Zs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aa))||nu),ao,ga=(ao={},(0,I.Z)(ao,E.BlendType.additive,{enable:!0,func:{srcRGB:E.gl.ONE,dstRGB:E.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(ao,E.BlendType.none,{enable:!1}),(0,I.Z)(ao,E.BlendType.normal,{enable:!0,func:{srcRGB:E.gl.SRC_ALPHA,dstRGB:E.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(ao,E.BlendType.subtractive,{enable:!0,func:{srcRGB:E.gl.ONE,dstRGB:E.gl.ONE,srcAlpha:E.gl.ZERO,dstAlpha:E.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:E.gl.FUNC_SUBTRACT,alpha:E.gl.FUNC_SUBTRACT}}),(0,I.Z)(ao,E.BlendType.max,{enable:!0,func:{srcRGB:E.gl.ONE,dstRGB:E.gl.ONE},equation:{rgb:E.gl.MAX_EXT}}),(0,I.Z)(ao,E.BlendType.min,{enable:!0,func:{srcRGB:E.gl.ONE,dstRGB:E.gl.ONE},equation:{rgb:E.gl.MIN_EXT}}),ao),Lo=y(47037),Fa=y.n(Lo),Cs=y(81763),Fi=y.n(Cs),Ko=y(1469),ya=y.n(Ko),vo=1024;function Da(n,c,a,s,l){c.updateStyleAttribute(n,a,s,l)}function So(n,c){n.opacity&&xe("opacity",c,n.opacity),n.strokeWidth&&xe("strokeWidth",c,n.strokeWidth),n.strokeOpacity&&xe("strokeOpacity",c,n.strokeOpacity),n.stroke&&pt("stroke",c,n.stroke),n.offsets&&Fe("offsets",c,n.offsets),n.textOffset&&Fe("textOffset",c,n.textOffset)}function xe(n,c,a){Fa()(a)?Da(n,c,a,function(s){return s}):Fi()(a)?Da(n,c,[a],void 0):ya()(a)&&a.length===2?Fa()(a[0])&&po()(a[1])||Fa()(a[0])&&ya()(a[1])&&Fi()(a[1][0])&&Fi()(a[1][1])?Da(n,c,a[0],a[1]):Da(n,c,[1],void 0):Da(n,c,[1],void 0)}function Fe(n,c,a){Fa()(a)?Da(n,c,a,function(s){return s}):ya()(a)&&a.length===2&&Fa()(a[0])&&po()(a[1])?Da(n,c,a[0],a[1]):ya()(a)&&a.length===2&&Fi()(a[0])&&Fi()(a[1])?Da(n,c,a,void 0):Da(n,c,[0,0],void 0)}function pt(n,c,a){Fa()(a)?Da(n,c,a,void 0):ya()(a)&&a.length===2&&(Fa()(a[0])&&po()(a[1])||Fa()(a[0])&&ya()(a[1])&&a[1].length>0)?Da(n,c,a[0],a[1]):Da(n,c,"#fff",void 0)}var Jt,Yr,Qn,Ci,Za;function mo(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=oo(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(B){throw B},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){a=a.call(n)},n:function(){var B=a.next();return d=B.done,B},e:function(B){x=!0,A=B},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(x)throw A}}}}function oo(n,c){if(!!n){if(typeof n=="string")return es(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return es(n,c)}}function es(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function $s(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ja(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?$s(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):$s(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Fu(n){var c=ts();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var zo=0,so=(Jt=(0,E.yT)(E.vK.IGlobalConfigService),Yr=(0,E.yT)(E.vK.IShaderModuleService),Qn=function(n){(0,_e.Z)(a,n);var c=Fu(a);function a(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,V.Z)(this,a),s=c.call(this),(0,I.Z)((0,L.Z)(s),"id","".concat(zo++)),(0,I.Z)((0,L.Z)(s),"name","".concat(zo)),(0,I.Z)((0,L.Z)(s),"type",void 0),(0,I.Z)((0,L.Z)(s),"visible",!0),(0,I.Z)((0,L.Z)(s),"zIndex",0),(0,I.Z)((0,L.Z)(s),"minZoom",void 0),(0,I.Z)((0,L.Z)(s),"maxZoom",void 0),(0,I.Z)((0,L.Z)(s),"inited",!1),(0,I.Z)((0,L.Z)(s),"layerModelNeedUpdate",!1),(0,I.Z)((0,L.Z)(s),"pickedFeatureID",null),(0,I.Z)((0,L.Z)(s),"selectedFeatureID",null),(0,I.Z)((0,L.Z)(s),"styleNeedUpdate",!1),(0,I.Z)((0,L.Z)(s),"rendering",void 0),(0,I.Z)((0,L.Z)(s),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,I.Z)((0,L.Z)(s),"hooks",{init:new ia.oI,afterInit:new ia.oI,beforeRender:new ia.oI,beforeRenderData:new ia.gg,afterRender:new ia.ni,beforePickingEncode:new ia.ni,afterPickingEncode:new ia.ni,beforeHighlight:new ia.ni(["pickedColor"]),afterHighlight:new ia.ni,beforeSelect:new ia.ni(["pickedColor"]),afterSelect:new ia.ni,beforeDestroy:new ia.ni,afterDestroy:new ia.ni}),(0,I.Z)((0,L.Z)(s),"models",[]),(0,I.Z)((0,L.Z)(s),"multiPassRenderer",void 0),(0,I.Z)((0,L.Z)(s),"plugins",void 0),(0,I.Z)((0,L.Z)(s),"sourceOption",void 0),(0,I.Z)((0,L.Z)(s),"layerModel",void 0),(0,Bi.Z)((0,L.Z)(s),"configService",Ci,(0,L.Z)(s)),(0,Bi.Z)((0,L.Z)(s),"shaderModuleService",Za,(0,L.Z)(s)),(0,I.Z)((0,L.Z)(s),"cameraService",void 0),(0,I.Z)((0,L.Z)(s),"coordinateService",void 0),(0,I.Z)((0,L.Z)(s),"iconService",void 0),(0,I.Z)((0,L.Z)(s),"fontService",void 0),(0,I.Z)((0,L.Z)(s),"pickingService",void 0),(0,I.Z)((0,L.Z)(s),"rendererService",void 0),(0,I.Z)((0,L.Z)(s),"layerService",void 0),(0,I.Z)((0,L.Z)(s),"interactionService",void 0),(0,I.Z)((0,L.Z)(s),"mapService",void 0),(0,I.Z)((0,L.Z)(s),"styleAttributeService",void 0),(0,I.Z)((0,L.Z)(s),"layerSource",void 0),(0,I.Z)((0,L.Z)(s),"postProcessingPassFactory",void 0),(0,I.Z)((0,L.Z)(s),"normalPassFactory",void 0),(0,I.Z)((0,L.Z)(s),"animateOptions",{enable:!1}),(0,I.Z)((0,L.Z)(s),"container",void 0),(0,I.Z)((0,L.Z)(s),"encodedData",void 0),(0,I.Z)((0,L.Z)(s),"configSchema",void 0),(0,I.Z)((0,L.Z)(s),"currentPickId",null),(0,I.Z)((0,L.Z)(s),"rawConfig",void 0),(0,I.Z)((0,L.Z)(s),"needUpdateConfig",void 0),(0,I.Z)((0,L.Z)(s),"pendingStyleAttributes",[]),(0,I.Z)((0,L.Z)(s),"scaleOptions",{}),(0,I.Z)((0,L.Z)(s),"animateStartTime",void 0),(0,I.Z)((0,L.Z)(s),"aniamateStatus",!1),(0,I.Z)((0,L.Z)(s),"sourceEvent",function(){s.dataState.dataSourceNeedUpdate=!0;var d=s.getLayerConfig(),x=d.autoFit,A=d.fitBoundsOptions;x&&s.fitBounds(A),s.emit("dataUpdate"),s.reRender()}),s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,G.Z)(a,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=ja(ja({},this.needUpdateConfig),l);else{var d=this.container.get(E.vK.SceneID);So(l,this),this.configService.setLayerConfig(d,this.id,ja(ja(ja({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,d=this.container.get(E.vK.SceneID),x=this.rawConfig.enableMultiPassRenderer,A=x===void 0?!1:x;this.configService.setLayerConfig(d,this.id,{enableMultiPassRenderer:A}),this.iconService=this.container.get(E.vK.IIconService),this.fontService=this.container.get(E.vK.IFontService),this.rendererService=this.container.get(E.vK.IRendererService),this.layerService=this.container.get(E.vK.ILayerService),this.interactionService=this.container.get(E.vK.IInteractionService),this.pickingService=this.container.get(E.vK.IPickingService),this.mapService=this.container.get(E.vK.IMapService),this.cameraService=this.container.get(E.vK.ICameraService),this.coordinateService=this.container.get(E.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(E.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(E.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(E.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(E.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function($){var me=$.attributeName,ze=$.attributeField,ht=$.attributeValues,Ft=$.updateOptions;l.styleAttributeService.updateStyleAttribute(me,{scale:ja({field:ze},l.splitValuesAndCallbackInAttribute(ht,l.getLayerConfig()[me]))},Ft)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(E.vK.ILayerPlugin);var O=mo(this.plugins),B;try{for(O.s();!(B=O.n()).done;){var te=B.value;te.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch($){O.e($)}finally{O.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(ja(ja({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),d=l.animateOption;d!=null&&d.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,d,x){return this.updateStyleAttribute("color",l,d,x),this}},{key:"texture",value:function(l,d,x){return this.updateStyleAttribute("texture",l,d,x),this}},{key:"rotate",value:function(l,d,x){return this.updateStyleAttribute("rotate",l,d,x),this}},{key:"size",value:function(l,d,x){return this.updateStyleAttribute("size",l,d,x),this}},{key:"filter",value:function(l,d,x){return this.updateStyleAttribute("filter",l,d,x),this}},{key:"shape",value:function(l,d,x){return this.updateStyleAttribute("shape",l,d,x),this}},{key:"label",value:function(l,d,x){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:d,updateOptions:x}),this}},{key:"animate",value:function(l){var d={};return wi()(l)?(d.enable=!0,d=ja(ja({},d),l)):d.enable=l,this.updateLayerConfig({animateOption:d}),this}},{key:"source",value:function(l,d){return this.sourceOption={data:l,options:d},this}},{key:"setData",value:function(l,d){var x=this;return this.inited?this.layerSource.setData(l,d):this.on("inited",function(){x.layerSource.setData(l,d)}),this}},{key:"style",value:function(l){var d=this,x=l.passes,A=(0,la.Z)(l,["passes"]);return x&&Hi(x).forEach(function(O){var B=d.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(O[0]);B&&B.updateOptions(O[1])}),this.rawConfig=ja(ja({},this.rawConfig),A),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,d){return wi()(l)?this.scaleOptions=ja(ja({},this.scaleOptions),l):this.scaleOptions[l]=d,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(l){var d={};return d.enableHighlight=wi()(l)?!0:l,wi()(l)?(d.enableHighlight=!0,l.color&&(d.highlightColor=l.color)):d.enableHighlight=!!l,this.updateLayerConfig(d),this}},{key:"setActive",value:function(l,d){var x=this;if(wi()(l)){var A=l.x,O=A===void 0?0:A,B=l.y,te=B===void 0?0:B;this.updateLayerConfig({highlightColor:wi()(d)?d.color:this.getLayerConfig().highlightColor}),this.pick({x:O,y:te})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:wi()(d)?d.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,Je.Z6)(l)).then(function(){setTimeout(function(){x.reRender()},1)})}},{key:"select",value:function(l){var d={};return d.enableSelect=wi()(l)?!0:l,wi()(l)?(d.enableSelect=!0,l.color&&(d.selectColor=l.color)):d.enableSelect=!!l,this.updateLayerConfig(d),this}},{key:"setSelect",value:function(l,d){var x=this;if(wi()(l)){var A=l.x,O=A===void 0?0:A,B=l.y,te=B===void 0?0:B;this.updateLayerConfig({selectColor:wi()(d)?d.color:this.getLayerConfig().selectColor}),this.pick({x:O,y:te})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:wi()(d)?d.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,Je.Z6)(l)).then(function(){setTimeout(function(){x.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),d=this.getLayerConfig(),x=d.visible,A=d.minZoom,O=A===void 0?-Infinity:A,B=d.maxZoom,te=B===void 0?Infinity:B;return!!x&&l>=O&&l<=te}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),d=l.minZoom;return d}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),d=l.maxZoom;return d}},{key:"get",value:function(l){var d=this.getLayerConfig();return d[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var d=this.getSource(),x=d.extent,A=x.some(function(O){return Math.abs(O)===Infinity});return A?this:(this.mapService.fitBounds([[x[0],x[1]],[x[2],x[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var d=this.mapService.getZoom();this.layerSource.updateClusterData(d)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(l){var d=this.styleAttributeService.getLayerAttributeScale(l);if(d){if(d.ticks){var x=d.ticks().map(function(O){return(0,I.Z)({value:O},l,d(O))});return x}else if(d.invertExtent){var A=d.range().map(function(O){return(0,I.Z)({value:d.invertExtent(O)},l,O)});return A}}else return[]}},{key:"pick",value:function(l){var d=l.x,x=l.y;this.interactionService.triggerHover({x:d,y:x})}},{key:"boxSelect",value:function(l,d){this.pickingService.boxPickLayer(this,l,d)}},{key:"buildLayerModel",value:function(l){var d=l.moduleName,x=l.vertexShader,A=l.fragmentShader,O=l.triangulation,B=l.segmentNumber,te=(0,la.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"]);this.shaderModuleService.registerModule(d,{vs:x,fs:A});var $=this.shaderModuleService.getModule(d),me=$.vs,ze=$.fs,ht=$.uniforms,Ft=this.rendererService.createModel,mr=this.styleAttributeService.createAttributesAndIndices(this.encodedData,O,B),Er=mr.attributes,Zr=mr.elements;return Ft(ja({attributes:Er,uniforms:ht,fs:ze,vs:me,elements:Zr,blend:ga[E.BlendType.normal]},te))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var d=this.getLayerConfig(),x=d.enableHighlight,A=x===void 0?!0:x,O=d.enableSelect,B=O===void 0?!0:O,te=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&B&&(te=!0),l==="mousemove"&&(A||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(te=!0),this.isVisible()&&te}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:l.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(l,d,x,A){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:ja({field:d},this.splitValuesAndCallbackInAttribute(x,this.getLayerConfig()[d]))},A):this.pendingStyleAttributes.push({attributeName:l,attributeField:d,attributeValues:x,updateOptions:A})}},{key:"setEarthTime",value:function(l){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,d){return{values:po()(l)?void 0:l||d,callback:po()(l)?l:void 0}}}]),a}(Dt.EventEmitter),Ci=(0,ai.Z)(Qn.prototype,"configService",[Jt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Za=(0,ai.Z)(Qn.prototype,"shaderModuleService",[Yr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qn),oi=y(85061),ys=y(18446),rs=y.n(ys),Bs=y(2650),ns,Pa,uo,yl,_l;function Bu(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Vl(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(B){throw B},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){a=a.call(n)},n:function(){var B=a.next();return d=B.done,B},e:function(B){x=!0,A=B},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(x)throw A}}}}function Vl(n,c){if(!!n){if(typeof n=="string")return Eu(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Eu(n,c)}}function Eu(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var lo=(ns=(0,E.yT)(E.vK.IGlobalConfigService),Pa=(0,E.yT)(E.vK.IShaderModuleService),uo=function(){function n(c){(0,V.Z)(this,n),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"createTexture2D",void 0),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"dataTexture",void 0),(0,I.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,I.Z)(this,"rowCount",void 0),(0,I.Z)(this,"cacheStyleProperties",void 0),(0,I.Z)(this,"cellLength",void 0),(0,I.Z)(this,"cellProperties",void 0),(0,I.Z)(this,"cellTypeLayout",void 0),(0,I.Z)(this,"stylePropertyesExist",void 0),(0,I.Z)(this,"dataTextureTest",void 0),(0,Bi.Z)(this,"configService",yl,this),(0,Bi.Z)(this,"shaderModuleService",_l,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"styleAttributeService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"layerService",void 0),this.layer=c,this.rendererService=c.getContainer().get(E.vK.IRendererService),this.styleAttributeService=c.getContainer().get(E.vK.IStyleAttributeService),this.mapService=c.getContainer().get(E.vK.IMapService),this.iconService=c.getContainer().get(E.vK.IIconService),this.fontService=c.getContainer().get(E.vK.IFontService),this.cameraService=c.getContainer().get(E.vK.ICameraService),this.layerService=c.getContainer().get(E.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var a=this.rendererService.createTexture2D;this.createTexture2D=a,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:E.gl.NEAREST,min:E.gl.NEAREST,width:1,height:1}))}return(0,G.Z)(n,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(a){var s=!1;return rs()(a.opacity,this.cacheStyleProperties.opacity)||(s=!0,this.cacheStyleProperties.opacity=a.opacity),rs()(a.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(s=!0,this.cacheStyleProperties.strokeOpacity=a.strokeOpacity),rs()(a.strokeWidth,this.cacheStyleProperties.strokeWidth)||(s=!0,this.cacheStyleProperties.strokeWidth=a.strokeWidth),rs()(a.stroke,this.cacheStyleProperties.stroke)||(s=!0,this.cacheStyleProperties.stroke=a.stroke),rs()(a.offsets,this.cacheStyleProperties.offsets)||(s=!0,this.cacheStyleProperties.offsets=a.offsets),this.dataTexture===void 0&&(s=!0),s}},{key:"judgeStyleAttributes",value:function(a){this.clearLastCalRes(),a.opacity!==void 0&&!Fi()(a.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),a.strokeOpacity!==void 0&&!Fi()(a.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),a.strokeWidth!==void 0&&!Fi()(a.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),a.stroke!==void 0&&!this.isStaticColor(a.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),a.offsets!==void 0&&!this.isOffsetStatic(a.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(a){return Fa()(a)?!!(0,Bs.ZP)(a):!1}},{key:"getStrokeColor",value:function(a){if(this.isStaticColor(a)){var s=(0,Je.CI)(a);return s[0]=s[0]?s[0]:0,s[1]=s[1]?s[1]:0,s[2]=s[2]?s[2]:0,s[3]=s[3]?s[3]:0,s}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(a){return!!(ya()(a)&&a.length===2&&Fi()(a[0])&&Fi()(a[1]))}},{key:"patchMod",value:function(a,s){for(var l=0;l<s;l++)a.push(-1)}},{key:"patchData",value:function(a,s,l){var d=Bu(l),x;try{for(d.s();!(x=d.n()).done;){var A=x.value,O=A.attr,B=A.count,te=s[O];te?O==="stroke"?a.push.apply(a,(0,oi.Z)((0,Je.CI)(te))):O==="offsets"?this.isOffsetStatic(te)?a.push(-te[0],te[1]):a.push(0,0):a.push(Fi()(te)?te:1):this.patchMod(a,B)}}catch($){d.e($)}finally{d.f()}}},{key:"calDataFrame",value:function(a,s,l){for(var d=s.length,x=Math.ceil(d*a/this.DATA_TEXTURE_WIDTH),A=x*this.DATA_TEXTURE_WIDTH,O=[],B=0;B<d;B++){var te=s[B];this.patchData(O,te,l)}for(var $=O.length;$<A;$++)O.push(-1);return{data:O,width:this.DATA_TEXTURE_WIDTH,height:x}}},{key:"getBlend",value:function(){var a=this.layer.getLayerConfig(),s=a.blend,l=s===void 0?"normal":s;return ga[E.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.duration||4,a.interval||.2,a.trailLength||.1]}},{key:"startModelAnimate",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),n}(),yl=(0,ai.Z)(uo.prototype,"configService",[ns],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_l=(0,ai.Z)(uo.prototype,"shaderModuleService",[Pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uo),js=y(9187),ws=y.n(js),m=100,T=36;function H(n){return n/180*Math.acos(-1)}function R(n){var c=H(n[0])+Math.PI/2,a=H(n[1]),s=m+Math.random()*.4,l=s*Math.cos(a)*Math.cos(c),d=s*Math.cos(a)*Math.sin(c),x=s*Math.sin(a);return[d,x,l]}function ce(n,c){var a=mat4.create(),s=mat4.create(),l=vec3.fromValues(0,1,0),d=vec3.fromValues(0,0,0);c=c||{},n=typeof n!="undefined"?n:1;for(var x=typeof c.segments!="undefined"?c.segments:32,A=2+x,O=2*A,B=[],te=[],$=[],me=[],ze=[],ht=[],Ft=[],mr=0;mr<=A;mr++){for(var Er=mr/A,Zr=Er*Math.PI,vn=0;vn<=O;vn++){var hn=vn/O,On=hn*Math.PI*2;mat4.identity(s),mat4.rotateZ(s,s,-Zr),mat4.identity(a),mat4.rotateY(a,a,On),vec3.transformMat4(d,l,s),vec3.transformMat4(d,d,a),vec3.scale(d,d,-n),$.push(d.slice()),me.push.apply(me,_toConsumableArray(d.slice())),vec3.normalize(d,d),ze.push(d.slice()),ht.push.apply(ht,_toConsumableArray(d.slice())),Ft.push([hn,1-Er]),me.push(hn,1-Er)}if(mr>0)for(var ii=$.length,wn=ii-2*(O+1);wn+O+2<ii;wn++)B.push([wn,wn+1,wn+O+1]),te.push(wn,wn+1,wn+O+1),B.push([wn+O+1,wn+1,wn+O+2]),te.push(wn+O+1,wn+1,wn+O+2)}return{cells:B,positions:$,normals:ze,uvs:Ft,positionsArr:me,indicesArr:te,normalArr:ht}}var ye=y(31437),lt=ye.Ue(),Vt=ye.Ue(),Mt=ye.Ue(),Ir=ye.Ue(),Hr=ye.Ue();function qn(n,c,a,s,l){ye.IH(n,a,s),ye.Fv(n,n),c=ye.al(-n[1],n[0]);var d=ye.al(-a[1],a[0]);return[l/ye.AK(c,d),c]}function bi(n,c){return ye.t8(n,-c[1],c[0])}function di(n,c,a){return ye.lu(n,c,a),ye.Fv(n,n),n}function ca(n,c){return n[0]===c[0]&&n[1]===c[1]}function Wi(n){for(var c=new Map,a=0;a<n.length;a++){var s=n[0].toString()+"-"+n[1].toString();c.get(s)?(n.splice(a,1),a++):c.set(s,s)}return n}var ka=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,V.Z)(this,n),(0,I.Z)(this,"complex",void 0),(0,I.Z)(this,"join",void 0),(0,I.Z)(this,"cap",void 0),(0,I.Z)(this,"miterLimit",void 0),(0,I.Z)(this,"thickness",void 0),(0,I.Z)(this,"normal",void 0),(0,I.Z)(this,"lastFlip",-1),(0,I.Z)(this,"miter",ye.al(0,0)),(0,I.Z)(this,"started",!1),(0,I.Z)(this,"dash",!1),(0,I.Z)(this,"totalDistance",0),this.join=c.join||"miter",this.cap=c.cap||"butt",this.miterLimit=c.miterLimit||10,this.thickness=c.thickness||1,this.dash=c.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,G.Z)(n,[{key:"extrude_gaode2",value:function(a,s){var l=this.complex;if(a.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var d=a.length,x=l.startIndex,A=1;A<d;A++){var O=a[A-1],B=s[A-1],te=a[A],$=s[A],me=A<a.length-1?a[A+1]:null,ze=A<s.length-1?s[A+1]:null,ht=this.segment_gaode2(l,x,O,te,me,B,$,ze);x+=ht}if(this.dash)for(var Ft=0;Ft<l.positions.length/6;Ft++)l.positions[Ft*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(a){var s=this.complex;if(a.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=a.length,d=s.startIndex,x=1;x<l;x++){var A=a[x-1],O=a[x],B=x<a.length-1?a[x+1]:null,te=this.segment(s,d,A,O,B);d+=te}if(this.dash)for(var $=0;$<s.positions.length/6;$++)s.positions[$*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(a,s,l,d,x,A,O,B){var te=0,$=a.indices,me=a.positions,ze=a.normals,ht=this.cap==="square",Ft=this.join==="bevel",mr=(0,Je.Z)([O[0],O[1]]),Er=(0,Je.Z)([A[0],A[1]]);di(Mt,d,l);var Zr=0;if(this.dash&&(Zr=this.lineSegmentDistance(mr,Er),this.totalDistance+=Zr),this.normal||(this.normal=ye.Ue(),bi(this.normal,Mt)),!this.started)if(this.started=!0,ht){var vn=ye.Ue(),hn=ye.Ue();ye.IH(vn,this.normal,Mt),ye.IH(hn,this.normal,Mt),ze.push(hn[0],hn[1],0),ze.push(vn[0],vn[1],0),me.push(l[0],l[1],0,this.totalDistance-Zr,-this.thickness,0),me.push(l[0],l[1],0,this.totalDistance-Zr,this.thickness,0)}else this.extrusions(me,ze,l,this.normal,this.thickness,this.totalDistance-Zr);if($.push(s+0,s+1,s+2),x){ca(d,x)&&ye.IH(x,d,ye.Fv(x,ye.$X(x,d,l))),di(Ir,x,d);var wn=qn(Hr,ye.Ue(),Mt,Ir,this.thickness),xi=(0,Z.Z)(wn,2),Ji=xi[0],Sa=xi[1],gi=ye.AK(Hr,this.normal)<0?-1:1,Oa=Ft;if(!Oa&&this.join==="miter"){var eo=Ji;eo>this.miterLimit&&(Oa=!0)}Oa?(ze.push(this.normal[0],this.normal[1],0),ze.push(Sa[0],Sa[1],0),me.push(d[0],d[1],0,this.totalDistance,-this.thickness*gi,0),me.push(d[0],d[1],0,this.totalDistance,this.thickness*gi,0),$.push.apply($,(0,oi.Z)(this.lastFlip!==-gi?[s,s+2,s+3]:[s+2,s+1,s+3])),$.push(s+2,s+3,s+4),bi(lt,Ir),ye.JG(this.normal,lt),ze.push(this.normal[0],this.normal[1],0),me.push(d[0],d[1],0,this.totalDistance,-this.thickness*gi,0),te+=3):(this.extrusions(me,ze,d,Sa,Ji,this.totalDistance),$.push.apply($,(0,oi.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),gi=-1,ye.JG(this.normal,Sa),te+=2),this.lastFlip=gi}else{if(bi(this.normal,Mt),ht){var On=ye.Ue(),ii=ye.Ue();ye.lu(ii,Mt,this.normal),ye.IH(On,Mt,this.normal),ze.push(ii[0],ii[1],0),ze.push(On[0],On[1],0),me.push(d[0],d[1],0,this.totalDistance,this.thickness,0),me.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(me,ze,d,this.normal,this.thickness,this.totalDistance);$.push.apply($,(0,oi.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),te+=2}return te}},{key:"segment",value:function(a,s,l,d,x){var A=0,O=a.indices,B=a.positions,te=a.normals,$=this.cap==="square",me=this.join==="bevel",ze=(0,Je.Z)([d[0],d[1]]),ht=(0,Je.Z)([l[0],l[1]]);di(Mt,ze,ht);var Ft=0;if(this.dash&&(Ft=this.lineSegmentDistance(ze,ht),this.totalDistance+=Ft),this.normal||(this.normal=ye.Ue(),bi(this.normal,Mt)),!this.started)if(this.started=!0,$){var mr=ye.Ue(),Er=ye.Ue();ye.IH(mr,this.normal,Mt),ye.IH(Er,this.normal,Mt),te.push(Er[0],Er[1],0),te.push(mr[0],mr[1],0),B.push(l[0],l[1],0,this.totalDistance-Ft,-this.thickness,0),B.push(l[0],l[1],0,this.totalDistance-Ft,this.thickness,0)}else this.extrusions(B,te,l,this.normal,this.thickness,this.totalDistance-Ft);if(O.push(s+0,s+1,s+2),x){var hn=(0,Je.Z)([x[0],x[1]]);ca(ze,hn)&&ye.IH(hn,ze,ye.Fv(hn,ye.$X(hn,ze,ht))),di(Ir,hn,ze);var On=qn(Hr,ye.Ue(),Mt,Ir,this.thickness),ii=(0,Z.Z)(On,2),wn=ii[0],xi=ii[1],Ji=ye.AK(Hr,this.normal)<0?-1:1,Sa=me;if(!Sa&&this.join==="miter"){var gi=wn;gi>this.miterLimit&&(Sa=!0)}Sa?(te.push(this.normal[0],this.normal[1],0),te.push(xi[0],xi[1],0),B.push(d[0],d[1],0,this.totalDistance,-this.thickness*Ji,0),B.push(d[0],d[1],0,this.totalDistance,this.thickness*Ji,0),O.push.apply(O,(0,oi.Z)(this.lastFlip!==-Ji?[s,s+2,s+3]:[s+2,s+1,s+3])),O.push(s+2,s+3,s+4),bi(lt,Ir),ye.JG(this.normal,lt),te.push(this.normal[0],this.normal[1],0),B.push(d[0],d[1],0,this.totalDistance,-this.thickness*Ji,0),A+=3):(this.extrusions(B,te,d,xi,wn,this.totalDistance),O.push.apply(O,(0,oi.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),Ji=-1,ye.JG(this.normal,xi),A+=2),this.lastFlip=Ji}else{if(bi(this.normal,Mt),$){var Zr=ye.Ue(),vn=ye.Ue();ye.lu(vn,Mt,this.normal),ye.IH(Zr,Mt,this.normal),te.push(vn[0],vn[1],0),te.push(Zr[0],Zr[1],0),B.push(d[0],d[1],0,this.totalDistance,this.thickness,0),B.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(B,te,d,this.normal,this.thickness,this.totalDistance);O.push.apply(O,(0,oi.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),A+=2}return A}},{key:"extrusions",value:function(a,s,l,d,x,A){s.push(d[0],d[1],0),s.push(d[0],d[1],0),a.push(l[0],l[1],0,A,-x,0),a.push(l[0],l[1],0,A,x,0)}},{key:"lineSegmentDistance",value:function(a,s){var l=s[0]-a[0],d=s[1]-a[1];return Math.sqrt(l*l+d*d)}}]),n}();function Xi(n){if(Fi()(n[0]))return n;if(Fi()(n[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Fi()(n[0][0][0])){var c=n,a=0,s=0,l=0;return c.forEach(function(d){d.forEach(function(x){a+=x[0],s+=x[1],l++})}),[a/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var Yi=y(77160);function Js(n){var c=n[0][0],a=n[0][n[0].length-1];c[0]===a[0]&&c[1]===a[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var s=n[0].length,l=ws().flatten(n),d=l.vertices,x=l.dimensions,A=[],O=[],B=0;B<d.length/x;B++)x===2?A.push(d[B*2],d[B*2+1],1):A.push(d[B*3],d[B*3+1],1);var te=ws()(l.vertices,l.holes,l.dimensions);O.push.apply(O,(0,oi.Z)(te));for(var $=function(ht){var Ft=l.vertices.slice(ht*x,(ht+1)*x),mr=l.vertices.slice((ht+1)*x,(ht+2)*x);mr.length===0&&(mr=l.vertices.slice(0,x));var Er=A.length/3;A.push(Ft[0],Ft[1],1,mr[0],mr[1],1,Ft[0],Ft[1],0,mr[0],mr[1],0),O.push.apply(O,(0,oi.Z)([0,2,1,2,3,1].map(function(Zr){return Zr+Er})))},me=0;me<s;me++)$(me);return{positions:A,index:O}}function Cu(n){var c=ws().flatten(n),a=ws()(c.vertices,c.holes,c.dimensions);return{positions:c.vertices,index:a}}function xl(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=n[0][0],s=n[0][n[0].length-1];a[0]===s[0]&&a[1]===s[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var l=n[0].length,d=ws().flatten(n),x=d.vertices,A=d.dimensions,O=[],B=[],te=[],$=0;$<x.length/A;$++)A===2?O.push(x[$*2],x[$*2+1],1,-1,-1):O.push(x[$*3],x[$*3+1],1,-1,-1),te.push(0,0,1);var me=ws()(d.vertices,d.holes,d.dimensions);B.push.apply(B,(0,oi.Z)(me));for(var ze=function(mr){var Er=d.vertices.slice(mr*A,(mr+1)*A),Zr=d.vertices.slice((mr+1)*A,(mr+2)*A);Zr.length===0&&(Zr=d.vertices.slice(0,A));var vn=O.length/5;O.push(Er[0],Er[1],1,0,0,Zr[0],Zr[1],1,.1,0,Er[0],Er[1],0,0,.8,Zr[0],Zr[1],0,.1,.8);var hn=wu([Zr[0],Zr[1],1],[Er[0],Er[1],0],[Er[0],Er[1],1],c);te.push.apply(te,(0,oi.Z)(hn).concat((0,oi.Z)(hn),(0,oi.Z)(hn),(0,oi.Z)(hn))),B.push.apply(B,(0,oi.Z)([1,2,0,3,2,1].map(function(On){return On+vn})))},ht=0;ht<l;ht++)ze(ht);return{positions:O,index:B,normals:te}}function wu(n,c,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=Yi.create(),d=Yi.create(),x=Yi.create();s&&(n=(0,Je.vP)(n),c=(0,Je.vP)(c),a=(0,Je.vP)(a));var A=Yi.fromValues.apply(Yi,(0,oi.Z)(n)),O=Yi.fromValues.apply(Yi,(0,oi.Z)(c)),B=Yi.fromValues.apply(Yi,(0,oi.Z)(a));Yi.sub(l,B,O),Yi.sub(d,A,O),Yi.cross(x,l,d);var te=Yi.create();return Yi.normalize(te,x),te}var ds,vs;(function(n){n.CYLINDER="cylinder",n.SQUARECOLUMN="squareColumn",n.TRIANGLECOLUMN="triangleColumn",n.HEXAGONCOLUMN="hexagonColumn",n.PENTAGONCOLUMN="pentagonColumn"})(vs||(vs={}));var ms;(function(n){n.CIRCLE="circle",n.SQUARE="square",n.TRIANGLE="triangle",n.HEXAGON="hexagon",n.PENTAGON="pentagon"})(ms||(ms={}));function Ts(n){for(var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=Math.PI*2/n,s=[],l=0;l<n;l++)s.push(a*l+c*Math.PI/12);var d=s.map(function(x){var A=Math.sin(x+Math.PI/4),O=Math.cos(x+Math.PI/4);return[A,O,0]});return d}function co(){return Ts(30)}function Gl(){return Ts(4)}function Hl(){return Ts(3)}function is(){return Ts(6,1)}function Wl(){return Ts(5)}var As=(ds={},(0,I.Z)(ds,ms.CIRCLE,co),(0,I.Z)(ds,ms.HEXAGON,is),(0,I.Z)(ds,ms.TRIANGLE,Hl),(0,I.Z)(ds,ms.SQUARE,Gl),(0,I.Z)(ds,ms.PENTAGON,Wl),(0,I.Z)(ds,vs.CYLINDER,co),(0,I.Z)(ds,vs.HEXAGONCOLUMN,is),(0,I.Z)(ds,vs.TRIANGLECOLUMN,Hl),(0,I.Z)(ds,vs.SQUARECOLUMN,Gl),(0,I.Z)(ds,vs.PENTAGONCOLUMN,Wl),ds),_s={};function Xl(n){var c=Xi(n.coordinates);return{vertices:[].concat((0,oi.Z)(c),(0,oi.Z)(c),(0,oi.Z)(c),(0,oi.Z)(c)),indices:[0,1,2,2,3,0],size:c.length}}function Nu(n){var c=Xi(n.coordinates),a=R(c);return{vertices:[].concat((0,oi.Z)(a),(0,oi.Z)(a),(0,oi.Z)(a),(0,oi.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function Ia(n){var c=n.shape,a=il(c,!1),s=a.positions,l=a.index,d=a.normals;return{vertices:s,indices:l,normals:d,size:5}}function zu(n){var c=Xi(n.coordinates);return{vertices:(0,oi.Z)(c),indices:[0],size:c.length}}function Fc(n){var c=n.coordinates,a=n.originCoordinates,s=n.version,l=new ka({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var d=c;Array.isArray(d[0][0])||(d=[c]);var x=a;Array.isArray(x[0][0])||(x=[a]);for(var A=0;A<d.length;A++){var O=d[A],B=x[A];l.extrude_gaode2(O,B)}}else{var te=c;Array.isArray(te[0][0])||(te=[c]),te.forEach(function(me){l.extrude(me)})}var $=l.complex;return{vertices:$.positions,indices:$.indices,normals:$.normals,size:6}}function Tu(n){var c=n.coordinates,a=ws().flatten(c),s=a.vertices,l=a.dimensions,d=a.holes;return{indices:ws()(s,d,l),vertices:s,size:l}}function Yl(n){var c=n.coordinates,a=xl(c,!0),s=a.positions,l=a.index,d=a.normals;return{vertices:s,indices:l,normals:d,size:5}}function Bc(n){var c=n.shape,a=sl(c),s=a.positions,l=a.index;return{vertices:s,indices:l,size:3}}function rl(n){var c=n.coordinates,a=[].concat((0,oi.Z)(c[0]),[0,0,1,c[1][0],c[0][1],0,1,1],(0,oi.Z)(c[1]),[0,1,0],(0,oi.Z)(c[0]),[0,0,1],(0,oi.Z)(c[1]),[0,1,0,c[0][0],c[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:a,indices:s,size:5}}function nl(n,c){for(var a=c||30,s=n.coordinates,l=[],d=[],x=function(B){l.push(B,1,B,s[0][0],s[0][1],s[1][0],s[1][1],B,-1,B,s[0][0],s[0][1],s[1][0],s[1][1]),B!==a-1&&d.push.apply(d,(0,oi.Z)([0,1,2,1,3,2].map(function(te){return B*2+te})))},A=0;A<a;A++)x(A);return{vertices:l,indices:d,size:7}}function bl(n){var c=n.coordinates;c.length===2&&c.push(0);var a=n.size,s=iu(-1,1),l=iu(1,1),d=iu(-1,-1),x=iu(1,-1),A=[].concat((0,oi.Z)(c),(0,oi.Z)(s),(0,oi.Z)(c),(0,oi.Z)(d),(0,oi.Z)(c),(0,oi.Z)(x),(0,oi.Z)(c),(0,oi.Z)(l)),O=[0,1,2,3,0,2];return{vertices:A,indices:O,size:5}}function il(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(_s&&_s[n])return _s[n];var a=As[n]?As[n]():As.cylinder(),s=xl([a],c);return _s[n]=s,s}function Sl(n,c){for(var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(n.length/a*3),d,x,A,O=vec3.create(),B=vec3.create(),te=vec3.create(),$=0,me=c.length;$<me;$+=3){d=c[$+0]*3,x=c[$+1]*3,A=c[$+2]*3;var ze=[n[d],n[d+1]],ht=[n[x],n[x+1]],Ft=[n[A],n[A+1]];s&&(ze=lngLatToMeters(ze),ht=lngLatToMeters(ht),Ft=lngLatToMeters(Ft));var mr=ze,Er=_slicedToArray(mr,2),Zr=Er[0],vn=Er[1],hn=vec3.fromValues(Zr,vn,n[d+2]),On=ht,ii=_slicedToArray(On,2),wn=ii[0],xi=ii[1],Ji=vec3.fromValues(wn,xi,n[x+2]),Sa=Ft,gi=_slicedToArray(Sa,2),Oa=gi[0],eo=gi[1],Ks=vec3.fromValues(Oa,eo,n[A+2]);vec3.sub(O,Ks,Ji),vec3.sub(B,hn,Ji),vec3.cross(te,O,B),l[d]+=O[0],l[d+1]+=O[1],l[d+2]+=O[2],l[x]+=O[0],l[x+1]+=O[1],l[x+2]+=O[2],l[A]+=O[0],l[A+1]+=O[1],l[A+2]+=O[2]}return al(l),l}function al(n){for(var c=0,a=n.length;c<a;c+=3){var s=vec3.fromValues(n[c],n[c+1],n[c+2]),l=vec3.create();vec3.normalize(l,s),n.set(l,c)}}function ol(n){var c=n[0][0],a=n[0][n[0].length-1];return c[0]===a[0]&&c[1]===a[1]}function sl(n){var c=["cylinder","triangleColumn","hexagonColumn","squareColumn"],a=As[n]?As[n]():As.circle(),s=c.indexOf(n)===-1?Cu([a]):Js([a]);return s}function iu(n,c){var a=(n+1)/2,s=(c+1)/2;return[a,s]}function Qs(){var n=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),c=n.positionsArr,a=n.indicesArr,s=n.normalArr;return{vertices:c,indices:a,size:5,normals:s}}function gc(n){var c=yc();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function yc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Nc=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Uu=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,El=function(n){(0,_e.Z)(a,n);var c=gc(a);function a(){return(0,V.Z)(this,a),c.apply(this,arguments)}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.baseColor,O=A===void 0?"rgb(16,16,16)":A,B=l.brightColor,te=B===void 0?"rgb(255,176,38)":B,$=l.windowColor,me=$===void 0?"rgb(30,60,89)":$,ze=l.time,ht=ze===void 0?0:ze;return{u_opacity:x,u_baseColor:(0,Je.CI)(O),u_brightColor:(0,Je.CI)(te),u_windowColor:(0,Je.CI)(me),u_time:this.layer.getLayerAnimateTime()||ht}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Uu,fragmentShader:Nc,triangulation:Yl})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:E.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x,A,O,B){return B}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.size,te=B===void 0?10:B;return Array.isArray(te)?[te[0]]:[te]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(d,x,A,O){var B=d.size;return[A[3],A[4]]}}})}}]),a}(lo);function Kl(n){var c=_c();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function _c(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var $l=function(n){(0,_e.Z)(a,n);var c=Kl(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","PolygonLayer"),s}return(0,G.Z)(a,[{key:"buildModels",value:function(){this.layerModel=new El(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),a}(so);function Jl(n){var c=Au();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Au(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Pu=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Ql=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,ql=function(n){(0,_e.Z)(a,n);var c=Jl(a);function a(){return(0,V.Z)(this,a),c.apply(this,arguments)}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:x||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:Pu,fragmentShader:Ql,triangulation:Bc,depth:{enable:!1},primitive:E.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:E.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),a}(lo);function pu(n){var c=xc();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function xc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Cl=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,bc=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Zu=function(n){(0,_e.Z)(a,n);var c=pu(a);function a(){return(0,V.Z)(this,a),c.apply(this,arguments)}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:x||1,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:Cl,fragmentShader:bc,triangulation:Ia,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.size;return Array.isArray(B)?[B[0]]:[B]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:E.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x,A,O,B){return B}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:E.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),a}(lo),Va=y(85975);function ul(n,c){for(var a=[],s=[],l=[],d=n+1,x=c+1,A=n/2,O=c/2,B=0;B<x;B++)for(var te=B-O,$=0;$<d;$++){var me=$-A;s.push(me/A,-te/O,0),l.push($/n),l.push(1-B/c)}for(var ze=0;ze<c;ze++)for(var ht=0;ht<n;ht++){var Ft=ht+d*ze,mr=ht+d*(ze+1),Er=ht+1+d*(ze+1),Zr=ht+1+d*ze;a.push(Ft,mr,Zr),a.push(mr,Er,Zr)}return{vertices:s,indices:a,uvs:l}}var Xa,ju;function Mu(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function qs(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Mu(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Mu(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function aa(n){var c=Ba();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Ba(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ps=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,ec=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,du=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,tc=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,nf=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,af=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,ll=(Xa=(0,Ve.b2)(),Xa(ju=function(n){(0,_e.Z)(a,n);var c=aa(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"colorTexture",void 0),(0,I.Z)((0,L.Z)(s),"heatmapFramerBuffer",void 0),(0,I.Z)((0,L.Z)(s),"intensityModel",void 0),(0,I.Z)((0,L.Z)(s),"colorModel",void 0),(0,I.Z)((0,L.Z)(s),"shapeType",void 0),s}return(0,G.Z)(a,[{key:"render",value:function(){var l=this,d=this.rendererService,x=d.clear,A=d.useFramebuffer;A(this.heatmapFramerBuffer,function(){x({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,d=this.rendererService,x=d.createFramebuffer,A=d.clear,O=d.getViewportSize,B=d.createTexture2D,te=d.useFramebuffer,$=this.styleAttributeService.getLayerStyleAttribute("shape"),me=($==null||(l=$.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=me,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=me==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var ze=this.layer.getLayerConfig(),ht=ze.rampColors,Ft=(0,Je.Cl)(ht),mr=O(),Er=mr.width,Zr=mr.height;return this.heatmapFramerBuffer=x({color:B({width:Math.floor(Er/4),height:Math.floor(Zr/4),wrapS:E.gl.CLAMP_TO_EDGE,wrapT:E.gl.CLAMP_TO_EDGE,min:E.gl.LINEAR,mag:E.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:E.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(d,x,A,O){return[A[3],A[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.size,te=B===void 0?1:B;return[te]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:nf,fragmentShader:tc,triangulation:bl,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:E.gl.ONE,srcAlpha:1,dstRGB:E.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:af,fs:du});var l=this.shaderModuleService.getModule("heatmapColor"),d=l.vs,x=l.fs,A=l.uniforms,O=this.rendererService,B=O.createAttribute,te=O.createElements,$=O.createBuffer,me=O.createModel;return me({vs:d,fs:x,attributes:{a_Position:B({buffer:$({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:E.gl.FLOAT}),size:3}),a_Uv:B({buffer:$({data:[0,1,1,1,0,0,1,0],type:E.gl.FLOAT}),size:2})},uniforms:qs({},A),depth:{enable:!1},blend:this.getBlend(),count:6,elements:te({data:[0,2,1,2,3,1],type:E.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.intensity,A=x===void 0?10:x,O=l.radius,B=O===void 0?5:O;this.intensityModel.draw({uniforms:{u_opacity:d||1,u_radius:B,u_intensity:A}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=Va.create();Va.invert(x,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,oi.Z)(x)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,d=l(),x=d.width,A=d.height,O=ul(x/4,A/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:ec,fs:Ps});var B=this.shaderModuleService.getModule("heatmap3dColor"),te=B.vs,$=B.fs,me=B.uniforms,ze=this.rendererService,ht=ze.createAttribute,Ft=ze.createElements,mr=ze.createBuffer,Er=ze.createModel;return Er({vs:te,fs:$,attributes:{a_Position:ht({buffer:mr({data:O.vertices,type:E.gl.FLOAT}),size:3}),a_Uv:ht({buffer:mr({data:O.uvs,type:E.gl.FLOAT}),size:2})},primitive:E.gl.TRIANGLES,uniforms:qs({},me),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:E.gl.SRC_ALPHA,srcAlpha:1,dstRGB:E.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Ft({data:O.indices,type:E.gl.UNSIGNED_INT,count:O.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var d=this.layer.getLayerConfig(),x=d.rampColors,A=(0,Je.Cl)(x);this.colorTexture=l({data:new Uint8Array(A.data),width:A.width,height:A.height,wrapS:E.gl.CLAMP_TO_EDGE,wrapT:E.gl.CLAMP_TO_EDGE,min:E.gl.NEAREST,mag:E.gl.NEAREST,flipY:!1})}}]),a}(lo))||ju);function wl(n){var c=Iu();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Iu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ro=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Tl=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Vs=function(n){(0,_e.Z)(a,n);var c=wl(a);function a(){return(0,V.Z)(this,a),c.apply(this,arguments)}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:x||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:Tl,fragmentShader:Ro,triangulation:Bc,depth:{enable:!1},primitive:E.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:E.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),a}(lo),Eo={heatmap:ll,heatmap3d:ll,grid:ql,grid3d:Zu,hexagon:Vs},Nn=Eo;function fo(n){var c=vu();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function vu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var cl=function(n){(0,_e.Z)(a,n);var c=fo(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","HeatMapLayer"),s}return(0,G.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Nn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,d=this.getModelType();return d==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(x){return x.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),x=this.getLayerConfig(),A=x.shape3d,O=this.getSource(),B=O.data.type,te=(d==null||(l=d.scale)===null||l===void 0?void 0:l.field)||"heatmap";return te==="heatmap"||te==="heatmap3d"?"heatmap":B==="hexagon"?(A==null?void 0:A.indexOf(te))===-1?"hexagon":"grid3d":B==="grid"?(A==null?void 0:A.indexOf(te))===-1?"grid":"grid3d":"heatmap"}}]),a}(so);function eu(n){var c=Ms();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Ms(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Sc=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,gn=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,rc=function(n){(0,_e.Z)(a,n);var c=eu(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),s}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,d=this.layer.getSource(),x=this.rendererService.createTexture2D;return this.texture=x({height:0,width:0}),d.data.images.then(function(A){l.texture=x({data:A[0],width:A[0].width,height:A[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:gn,fragmentShader:Sc,triangulation:rl,primitive:E.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(d,x,A,O){return[A[3],A[4]]}}})}}]),a}(lo),nc={image:rc},Ou=nc;function Ua(n){var c=Is();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Is(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ic=function(n){(0,_e.Z)(a,n);var c=Ua(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","ImageLayer"),s}return(0,G.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Ou[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={image:{}};return d[l]}},{key:"getModelType",value:function(){return"image"}}]),a}(so);function mu(n){var c=Os();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Os(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var gu=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - \u7528\u4E8E\u5408\u5E76\u5355\u4E2A\u7684 varying \u53D8\u91CF

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = v_dataset.r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = v_dataset.b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float d_texCount = v_dataset.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = 1.0 - fract(arcRadio * d_texCount + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = v_dataset.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,zc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - \u7528\u4E8E\u5408\u5E76\u5355\u4E2A\u7684 varying \u53D8\u91CF

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_dataset.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_dataset.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_dataset.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_dataset.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Al={solid:0,dash:1},Ec=function(n){(0,_e.Z)(a,n);var c=mu(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:E.gl.NEAREST,min:E.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.sourceColor,A=l.targetColor,O=l.textureBlend,B=O===void 0?"normal":O,te=l.lineType,$=te===void 0?"solid":te,me=l.dashArray,ze=me===void 0?[10,5]:me,ht=l.forward,Ft=ht===void 0?!0:ht,mr=l.lineTexture,Er=mr===void 0?!1:mr,Zr=l.iconStep,vn=Zr===void 0?100:Zr,hn=l.segmentNumber,On=hn===void 0?30:hn,ii=l.thetaOffset,wn=ii===void 0?.314:ii;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var xi=this.layer.getEncodedData(),Ji=this.calDataFrame(this.cellLength,xi,this.cellProperties),Sa=Ji.data,gi=Ji.width,Oa=Ji.height;this.rowCount=Oa,this.dataTexture=this.cellLength>0&&Sa.length>0?this.createTexture2D({flipY:!0,data:Sa,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:gi,height:Oa}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}ze.length===2&&ze.push(0,0);var eo=0,Ks=[0,0,0,0],Ff=[0,0,0,0];return x&&A&&(Ks=(0,Je.CI)(x),Ff=(0,Je.CI)(A),eo=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:wn,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Fi()(d)?d:1,u_textureBlend:B==="normal"?0:1,segmentNumber:On,u_line_type:Al[$||"solid"],u_dash_array:ze,u_blur:.9,u_lineDir:Ft?1:-1,u_texture:this.texture,u_line_texture:Er?1:0,u_icon_step:vn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:eo,u_sourceColor:Ks,u_targetColor:Ff}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),d=l.segmentNumber,x=d===void 0?30:d;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:zc,fragmentShader:gu,triangulation:nl,depth:{enable:!1},blend:this.getBlend(),segmentNumber:x})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(x,A,O,B){var te=x.size,$=te===void 0?1:te;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:E.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(x,A,O,B){return[O[3],O[4],O[5],O[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(x,A,O,B){var te=l.iconService.getIconMap(),$=x.texture,me=te[$]||{x:0,y:0},ze=me.x,ht=me.y;return[ze,ht]}}})}}]),a}(lo);function Cc(n){var c=Gs();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Gs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ls=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec4 v_dataset; // \u6570\u636E\u96C6

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_dataset.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,ta=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

varying vec4 v_dataset; // \u6570\u636E\u96C6

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_dataset.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel(u_icon_step);
    v_dataset.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_dataset.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,yu={solid:0,dash:1},Hs=function(n){(0,_e.Z)(a,n);var c=Cc(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:E.gl.NEAREST,min:E.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.sourceColor,A=l.targetColor,O=l.textureBlend,B=O===void 0?"normal":O,te=l.lineType,$=te===void 0?"solid":te,me=l.dashArray,ze=me===void 0?[10,5]:me,ht=l.lineTexture,Ft=ht===void 0?!1:ht,mr=l.iconStep,Er=mr===void 0?100:mr,Zr=l.segmentNumber,vn=Zr===void 0?30:Zr;ze.length===2&&ze.push(0,0);var hn=0,On=[0,0,0,0],ii=[0,0,0,0];if(x&&A&&(On=(0,Je.CI)(x),ii=(0,Je.CI)(A),hn=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var wn=this.layer.getEncodedData(),xi=this.calDataFrame(this.cellLength,wn,this.cellProperties),Ji=xi.data,Sa=xi.width,gi=xi.height;this.rowCount=gi,this.dataTexture=this.cellLength>0&&Ji.length>0?this.createTexture2D({flipY:!0,data:Ji,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:Sa,height:gi}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Fi()(d)?d:1,u_textureBlend:B==="normal"?0:1,segmentNumber:vn,u_line_type:yu[$]||0,u_dash_array:ze,u_texture:this.texture,u_line_texture:Ft?1:0,u_icon_step:Er,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:hn,u_sourceColor:On,u_targetColor:ii}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:ta,fragmentShader:Ls,triangulation:nl,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(x,A,O,B){var te=x.size,$=te===void 0?1:te;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:E.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(x,A,O,B){return[O[3],O[4],O[5],O[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(x,A,O,B){var te=l.iconService.getIconMap(),$=x.texture,me=te[$]||{x:0,y:0},ze=me.x,ht=me.y;return[ze,ht]}}})}}]),a}(lo);function Uo(n){var c=Vu();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Vu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var au=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec4 v_dataset; // \u6570\u636E\u96C6

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = v_dataset.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_dataset.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_dataset.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,ou=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

varying vec4 v_dataset; // \u6570\u636E\u96C6

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_dataset.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_dataset.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_dataset.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,Co={solid:0,dash:1},Gu=function(n){(0,_e.Z)(a,n);var c=Uo(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:E.gl.NEAREST,min:E.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.sourceColor,A=l.targetColor,O=l.textureBlend,B=O===void 0?"normal":O,te=l.lineType,$=te===void 0?"solid":te,me=l.dashArray,ze=me===void 0?[10,5]:me,ht=l.lineTexture,Ft=ht===void 0?!1:ht,mr=l.iconStep,Er=mr===void 0?100:mr,Zr=l.segmentNumber,vn=Zr===void 0?30:Zr;ze.length===2&&ze.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var hn=0,On=[0,0,0,0],ii=[0,0,0,0];if(x&&A&&(On=(0,Je.CI)(x),ii=(0,Je.CI)(A),hn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var wn=this.layer.getEncodedData(),xi=this.calDataFrame(this.cellLength,wn,this.cellProperties),Ji=xi.data,Sa=xi.width,gi=xi.height;this.rowCount=gi,this.dataTexture=this.cellLength>0&&Ji.length>0?this.createTexture2D({flipY:!0,data:Ji,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:Sa,height:gi}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Fi()(d)?d:1,u_textureBlend:B==="normal"?0:1,segmentNumber:vn,u_line_type:Co[$]||0,u_dash_array:ze,u_texture:this.texture,u_line_texture:Ft?1:0,u_icon_step:Er,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:hn,u_sourceColor:On,u_targetColor:ii}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:ou,fragmentShader:au,triangulation:nl,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(x,A,O,B){var te=x.size,$=te===void 0?1:te;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:E.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(x,A,O,B){return[O[3],O[4],O[5],O[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(x,A,O,B){var te=l.iconService.getIconMap(),$=x.texture,me=te[$]||{x:0,y:0},ze=me.x,ht=me.y;return[ze,ht]}}})}}]),a}(lo);function ni(n){var c=$n();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function $n(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Pl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - distance_ratio/distance/pixelLen/texV

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,as=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - distance_ratio/distance/pixelLen/texV
// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset.r = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset.g = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset.b = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset.a = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Ws={solid:0,dash:1},Zo=function(n){(0,_e.Z)(a,n);var c=ni(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:E.gl.NEAREST,min:E.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.sourceColor,A=l.targetColor,O=l.textureBlend,B=O===void 0?"normal":O,te=l.lineType,$=te===void 0?"solid":te,me=l.dashArray,ze=me===void 0?[10,5,0,0]:me,ht=l.lineTexture,Ft=ht===void 0?!1:ht,mr=l.iconStep,Er=mr===void 0?100:mr;ze.length===2&&ze.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Zr=0,vn=[0,0,0,0],hn=[0,0,0,0];if(x&&A&&(vn=(0,Je.CI)(x),hn=(0,Je.CI)(A),Zr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var On=this.layer.getEncodedData(),ii=this.calDataFrame(this.cellLength,On,this.cellProperties),wn=ii.data,xi=ii.width,Ji=ii.height;this.rowCount=Ji,this.dataTexture=this.cellLength>0&&wn.length>0?this.createTexture2D({flipY:!0,data:wn,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:xi,height:Ji}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Fi()(d)?d:1,u_textureBlend:B==="normal"?0:1,u_line_type:Ws[$],u_dash_array:ze,u_texture:this.texture,u_line_texture:Ft?1:0,u_icon_step:Er,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:vn,u_targetColor:hn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:as,fragmentShader:Pl,triangulation:Fc,primitive:E.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.layer.getLayerConfig(),x=d.lineType,A=x===void 0?"solid":x;this.styleAttributeService.registerStyleAttribute({name:"distance",type:E.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(B,te,$,me){return[$[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:E.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(B,te,$,me){return[$[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(B,te,$,me){var ze=B.size,ht=ze===void 0?1:ze;return Array.isArray(ht)?[ht[0],ht[1]]:[ht,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:E.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(B,te,$,me,ze){return ze}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:E.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(B,te,$,me){return[$[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(B,te,$,me){var ze=l.iconService.getIconMap(),ht=B.texture,Ft=ze[ht]||{x:0,y:0},mr=Ft.x,Er=Ft.y;return[mr,Er]}}})}},{key:"loadImage",value:function(l){return new Promise(function(d,x){if(l instanceof HTMLImageElement){d(l);return}var A=new Image;A.crossOrigin="anonymous",A.onload=function(){d(A)},A.onerror=function(){x(new Error("Could not load image at "+l))},A.src=l instanceof File?URL.createObjectURL(l):l})}}]),a}(lo),su={arc:Ec,arc3d:Hs,greatcircle:Gu,line:Zo},wc=su;function ac(n){var c=oa();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function oa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Do=function(n){(0,_e.Z)(a,n);var c=ac(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","LineLayer"),s}return(0,G.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new wc[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return d[l]}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),x=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return x||"line"}}]),a}(so);function Uc(n){var c=xs();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function xs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ml=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Rs=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,os=function(n){(0,_e.Z)(a,n);var c=Uc(a);function a(){return(0,V.Z)(this,a),c.apply(this,arguments)}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x})){this.judgeStyleAttributes({opacity:x});var A=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,A,this.cellProperties),B=O.data,te=O.width,$=O.height;this.rowCount=$,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:te,height:$}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Fi()(x)?x:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:Rs,fragmentShader:Ml,triangulation:Ia,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(x,A,O,B){var te=x.size;if(te){var $=[];return Array.isArray(te)&&($=te.length===2?[te[0],te[0],te[1]]:te),Array.isArray(te)||($=[te,te,te]),$}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:E.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(x,A,O,B,te){return te}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:E.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(x,A){var O=Xi(x.coordinates);return l?R([O[0],O[1]]):[O[0],O[1],0]}}})}}]),a}(lo);function fl(n){var c=uu();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function uu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var oc=`#define Animate 0.0

uniform float u_globel;
uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiased_blur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  
 
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

  

}
`,Hu=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Wu=function(n){(0,_e.Z)(a,n);var c=fl(a);function a(){return(0,V.Z)(this,a),c.apply(this,arguments)}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.strokeOpacity,O=A===void 0?1:A,B=l.strokeWidth,te=B===void 0?0:B,$=l.stroke,me=$===void 0?"rgba(0,0,0,0)":$,ze=l.offsets,ht=ze===void 0?[0,0]:ze,Ft=l.isGlobel,mr=Ft===void 0?!1:Ft;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x,strokeOpacity:O,strokeWidth:te,stroke:me,offsets:ht})){this.judgeStyleAttributes({opacity:x,strokeOpacity:O,strokeWidth:te,stroke:me,offsets:ht});var Er=this.layer.getEncodedData(),Zr=this.calDataFrame(this.cellLength,Er,this.cellProperties),vn=Zr.data,hn=Zr.width,On=Zr.height;this.rowCount=On,this.dataTexture=this.cellLength>0&&vn.length>0?this.createTexture2D({flipY:!0,data:vn,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:hn,height:On}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Fi()(x)?x:1,u_stroke_opacity:Fi()(O)?O:1,u_stroke_width:Fi()(te)?te:0,u_stroke_color:this.getStrokeColor(me),u_offsets:this.isOffsetStatic(ht)?ht:[0,0]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Xl)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var l=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:Hu,fragmentShader:oc,triangulation:l?Nu:Xl,depth:{enable:l},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:E.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(A,O,B,te){var $;if(d){var me=(0,Z.Z)(B,3),ze=me[0],ht=me[1],Ft=me[2],mr=Yi.fromValues(0,0,1),Er=Yi.fromValues(ze,0,Ft),Zr=ze>=0?Yi.angle(mr,Er):Math.PI*2-Yi.angle(mr,Er),vn=Math.PI*2-Math.asin(ht/100),hn=Va.create();Va.rotateY(hn,hn,Zr),Va.rotateX(hn,hn,vn);var On=Yi.fromValues(1,1,0);Yi.transformMat4(On,On,hn),Yi.normalize(On,On);var ii=Yi.fromValues(-1,1,0);Yi.transformMat4(ii,ii,hn),Yi.normalize(ii,ii);var wn=Yi.fromValues(-1,-1,0);Yi.transformMat4(wn,wn,hn),Yi.normalize(wn,wn);var xi=Yi.fromValues(1,-1,0);Yi.transformMat4(xi,xi,hn),Yi.normalize(xi,xi),$=[].concat((0,oi.Z)(On),(0,oi.Z)(ii),(0,oi.Z)(wn),(0,oi.Z)(xi))}else $=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Ji=te%4*3;return[$[Ji],$[Ji+1],$[Ji+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(A,O,B,te){var $=A.size,me=$===void 0?5:$;return Array.isArray(me)?[me[0]]:[me]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:E.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(A,O,B,te){var $=A.shape,me=$===void 0?2:$,ze=l.layer.getLayerConfig().shape2d,ht=ze.indexOf(me);return[ht]}}})}}]),a}(lo);function Zc(n){var c=Il();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Il(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var hl=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,jc=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Xu=function(n){(0,_e.Z)(a,n);var c=Zc(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),s}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:jc,fragmentShader:hl,triangulation:zu,primitive:E.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(x,A,O,B){var te=x.size;return Array.isArray(te)?[te[0]]:[te]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(x,A,O,B){var te=l.fontService.mapping,$=x.shape,me=l.fontService.getGlyph($),ze=te[me],ht=ze.x,Ft=ze.y;return[ht,Ft]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.texture=l({data:d,mag:E.gl.LINEAR,min:E.gl.LINEAR,width:d.width,height:d.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),x=d.fontWeight,A=x===void 0?"normal":x,O=d.fontFamily,B=O===void 0?"sans-serif":O,te=this.layer.getEncodedData(),$=[];te.forEach(function(me){var ze=me.shape,ht=ze===void 0?"":ze;ht=ht.toString();var Ft=l.fontService.getGlyph(ht);$.indexOf(Ft)===-1&&$.push(Ft)}),this.fontService.setFontOptions({characterSet:$,fontWeight:A,fontFamily:B,fontSize:48})}}]),a}(lo);function Lu(n){var c=sc();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function sc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ru=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Xs=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Tc=function(n){(0,_e.Z)(a,n);var c=Lu(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.renderLayers();return}s.texture=A({data:s.iconService.getCanvas(),mag:E.gl.LINEAR,min:E.gl.LINEAR,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.offsets,A=x===void 0?[0,0]:x;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:A})){this.judgeStyleAttributes({opacity:d,offsets:A});var O=this.layer.getEncodedData(),B=this.calDataFrame(this.cellLength,O,this.cellProperties),te=B.data,$=B.width,me=B.height;this.rowCount=me,this.dataTexture=this.cellLength>0&&te.length>0?this.createTexture2D({flipY:!0,data:te,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:$,height:me}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Fi()(d)?d:1,u_offsets:this.isOffsetStatic(A)?A:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:Xs,fragmentShader:Ru,triangulation:zu,primitive:E.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(x,A,O,B){var te=x.size,$=te===void 0?5:te;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(x,A,O,B){var te=l.iconService.getIconMap(),$=x.shape,me=te[$]||{x:0,y:0},ze=me.x,ht=me.y;return[ze,ht]}}})}}]),a}(lo);function uc(n){var c=lc();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function lc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Yu=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,i=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function u(n){var c=n.coordinates;return{vertices:(0,oi.Z)(c),indices:[0],size:c.length}}var o=function(n){(0,_e.Z)(a,n);var c=uc(a);function a(){return(0,V.Z)(this,a),c.apply(this,arguments)}return(0,G.Z)(a,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.offsets,O=A===void 0?[0,0]:A;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x,offsets:O})){this.judgeStyleAttributes({opacity:x,offsets:O});var B=this.layer.getEncodedData(),te=this.calDataFrame(this.cellLength,B,this.cellProperties),$=te.data,me=te.width,ze=te.height;this.rowCount=ze,this.dataTexture=this.cellLength>0&&$.length>0?this.createTexture2D({flipY:!0,data:$,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:me,height:ze}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Fi()(x)?x:1,u_offsets:this.isOffsetStatic(O)?O:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:i,fragmentShader:Yu,triangulation:u,depth:{enable:!1},primitive:E.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.size,te=B===void 0?1:B;return Array.isArray(te)?[te[0]]:[te]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:E.BlendType.additive}}}]),a}(lo),h=y(98333);function _(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=C(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(B){throw B},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){a=a.call(n)},n:function(){var B=a.next();return d=B.done,B},e:function(B){x=!0,A=B},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(x)throw A}}}}function C(n,c){if(!!n){if(typeof n=="string")return P(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return P(n,c)}}function P(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var N=function(){function n(c,a,s){(0,V.Z)(this,n),(0,I.Z)(this,"boxCells",[]),(0,I.Z)(this,"xCellCount",void 0),(0,I.Z)(this,"yCellCount",void 0),(0,I.Z)(this,"boxKeys",void 0),(0,I.Z)(this,"bboxes",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"xScale",void 0),(0,I.Z)(this,"yScale",void 0),(0,I.Z)(this,"boxUid",void 0);var l=this.boxCells;this.xCellCount=Math.ceil(c/s),this.yCellCount=Math.ceil(a/s);for(var d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=c,this.height=a,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/a,this.boxUid=0}return(0,G.Z)(n,[{key:"insert",value:function(a,s,l,d,x){this.forEachCell(s,l,d,x,this.insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(x)}},{key:"query",value:function(a,s,l,d,x){return this.queryHitTest(a,s,l,d,!1,x)}},{key:"hitTest",value:function(a,s,l,d,x){return this.queryHitTest(a,s,l,d,!0,x)}},{key:"insertBoxCell",value:function(a,s,l,d,x,A){this.boxCells[x].push(A)}},{key:"queryHitTest",value:function(a,s,l,d,x,A){if(l<0||a>this.width||d<0||s>this.height)return x?!1:[];var O=[];if(a<=0&&s<=0&&this.width<=l&&this.height<=d){if(x)return!0;for(var B=0;B<this.boxKeys.length;B++)O.push({key:this.boxKeys[B],x1:this.bboxes[B*4],y1:this.bboxes[B*4+1],x2:this.bboxes[B*4+2],y2:this.bboxes[B*4+3]});return A?O.filter(A):O}var te={hitTest:x,seenUids:{box:{},circle:{}}};return this.forEachCell(a,s,l,d,this.queryCell,O,te,A),x?O.length>0:O}},{key:"queryCell",value:function(a,s,l,d,x,A,O,B){var te=O.seenUids,$=this.boxCells[x];if($!==null){var me=this.bboxes,ze=_($),ht;try{for(ze.s();!(ht=ze.n()).done;){var Ft=ht.value;if(!te.box[Ft]){te.box[Ft]=!0;var mr=Ft*4;if(a<=me[mr+2]&&s<=me[mr+3]&&l>=me[mr+0]&&d>=me[mr+1]&&(!B||B(this.boxKeys[Ft]))){if(O.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[Ft],x1:me[mr],y1:me[mr+1],x2:me[mr+2],y2:me[mr+3]})}}}}catch(Er){ze.e(Er)}finally{ze.f()}}return!1}},{key:"forEachCell",value:function(a,s,l,d,x,A,O,B){for(var te=this.convertToXCellCoord(a),$=this.convertToYCellCoord(s),me=this.convertToXCellCoord(l),ze=this.convertToYCellCoord(d),ht=te;ht<=me;ht++)for(var Ft=$;Ft<=ze;Ft++){var mr=this.xCellCount*Ft+ht;if(x.call(this,a,s,l,d,mr,A,O,B))return}}},{key:"convertToXCellCoord",value:function(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}},{key:"convertToYCellCoord",value:function(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}}]),n}(),K=N,se=function(){function n(c,a){(0,V.Z)(this,n),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"grid",void 0),(0,I.Z)(this,"viewportPadding",100),(0,I.Z)(this,"screenRightBoundary",void 0),(0,I.Z)(this,"screenBottomBoundary",void 0),(0,I.Z)(this,"gridRightBoundary",void 0),(0,I.Z)(this,"gridBottomBoundary",void 0),this.width=c,this.height=a,this.viewportPadding=Math.max(c,a),this.grid=new K(c+this.viewportPadding,a+this.viewportPadding,25),this.screenRightBoundary=c+this.viewportPadding,this.screenBottomBoundary=a+this.viewportPadding,this.gridRightBoundary=c+2*this.viewportPadding,this.gridBottomBoundary=a+2*this.viewportPadding}return(0,G.Z)(n,[{key:"placeCollisionBox",value:function(a){var s=a.x1+a.anchorPointX+this.viewportPadding,l=a.y1+a.anchorPointY+this.viewportPadding,d=a.x2+a.anchorPointX+this.viewportPadding,x=a.y2+a.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,d,x)||this.grid.hitTest(s,l,d,x)?{box:[]}:{box:[s,l,d,x]}}},{key:"insertCollisionBox",value:function(a,s){var l={featureIndex:s};this.grid.insert(l,a[0],a[1],a[2],a[3])}},{key:"project",value:function(a,s,l){var d=h.al(s,l,0,1),x=h.Ue(),A=Va.fromValues.apply(Va,(0,oi.Z)(a));return h.fF(x,d,A),{x:(x[0]/x[3]+1)/2*this.width+this.viewportPadding,y:(-x[1]/x[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(a,s,l,d){return l>=0&&a<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}}]),n}();function Ce(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Ae(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(B){throw B},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){a=a.call(n)},n:function(){var B=a.next();return d=B.done,B},e:function(B){x=!0,A=B},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(x)throw A}}}}function Ae(n,c){if(!!n){if(typeof n=="string")return Ie(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ie(n,c)}}function Ie(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Ke(n){var c=.5,a=.5;switch(n){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0;break;default:c=.5}switch(n){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0;break;default:a=.5}return{horizontalAlign:c,verticalAlign:a}}function We(n,c,a,s,l){if(!!l){var d=n[s],x=d.glyph;if(x)for(var A=c[x].advance*d.scale,O=(n[s].x+A)*l,B=a;B<=s;B++)n[B].x-=O}}function at(n,c,a,s,l,d,x){var A=(c-a)*l,O=(-s*x+.5)*d,B=Ce(n),te;try{for(B.s();!(te=B.n()).done;){var $=te.value;$.x+=A,$.y+=O}}catch(me){B.e(me)}finally{B.f()}}function Ze(n,c,a,s,l,d,x){var A=-8,O=0,B=A,te=0,$=n.positionedGlyphs,me=d==="right"?1:d==="left"?0:.5,ze=$.length;a.forEach(function(Zr){if(Zr.split("").forEach(function(hn){var On=c[hn],ii=0;On&&($.push({glyph:hn,x:O,y:B+ii,vertical:!1,scale:1,metrics:On}),O+=On.advance+x)}),$.length!==ze){var vn=O-x;te=Math.max(vn,te),We($,c,ze,$.length-1,me)}O=0,B+=s});var ht=Ke(l),Ft=ht.horizontalAlign,mr=ht.verticalAlign;at($,me,Ft,mr,te,s,a.length);var Er=B-A;n.top+=-mr*Er,n.bottom=n.top+Er,n.left+=-Ft*te,n.right=n.left+te}function st(n,c,a,s,l,d,x){var A=-8,O=0,B=A,te=0,$=n.positionedGlyphs,me=d==="right"?1:d==="left"?0:.5,ze=$.length;a.forEach(function(Zr){var vn=c[Zr],hn=0;if(vn&&($.push({glyph:Zr,x:O,y:B+hn,vertical:!1,scale:1,metrics:vn}),O+=vn.advance+x),$.length!==ze){var On=O-x;te=Math.max(On,te),We($,c,ze,$.length-1,me)}O=0,B+=s});var ht=Ke(l),Ft=ht.horizontalAlign,mr=ht.verticalAlign;at($,me,Ft,mr,te,s,a.length);var Er=B-A;n.top+=-mr*Er,n.bottom=n.top+Er,n.left+=-Ft*te,n.right=n.left+te}function St(n,c,a,s,l,d){var x=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],A=arguments.length>7?arguments[7]:void 0,O=n.split(`
`),B=[],te={positionedGlyphs:B,top:x[1],bottom:x[1],left:x[0],right:x[0],lineCount:O.length,text:n};return A?st(te,c,O,a,s,l,d):Ze(te,c,O,a,s,l,d),B.length?te:!1}function Wt(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],a=arguments.length>2?arguments[2]:void 0,s=n.positionedGlyphs,l=s===void 0?[]:s,d=[],x=Ce(l),A;try{for(x.s();!(A=x.n()).done;){var O=A.value,B=O.metrics,te=4,$=B.advance*O.scale/2,me=a?[O.x+$,O.y]:[0,0],ze=a?[0,0]:[O.x+$+c[0],O.y+c[1]],ht=(0-te)*O.scale-$+ze[0],Ft=(0-te)*O.scale+ze[1],mr=ht+B.width*O.scale,Er=Ft+B.height*O.scale,Zr={x:ht,y:Ft},vn={x:mr,y:Ft},hn={x:ht,y:Er},On={x:mr,y:Er};d.push({tl:Zr,tr:vn,bl:hn,br:On,tex:B,glyphOffset:me})}}catch(ii){x.e(ii)}finally{x.f()}return d}function xr(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=hr(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(B){throw B},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){a=a.call(n)},n:function(){var B=a.next();return d=B.done,B},e:function(B){x=!0,A=B},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(x)throw A}}}}function hr(n,c){if(!!n){if(typeof n=="string")return Sr(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Sr(n,c)}}function Sr(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Gr(n){var c=sn();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function sn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var qr=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Mn=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function ei(n){var c=this,a=n.id,s=[],l=[];if(!c.glyphInfoMap||!c.glyphInfoMap[a])return{vertices:[],indices:[],size:7};var d=c.glyphInfoMap[a].centroid,x=d.length===2?[d[0],d[1],0]:d;return c.glyphInfoMap[a].glyphQuads.forEach(function(A,O){s.push.apply(s,(0,oi.Z)(x).concat([A.tex.x,A.tex.y+A.tex.height,A.tl.x,A.tl.y],(0,oi.Z)(x),[A.tex.x+A.tex.width,A.tex.y+A.tex.height,A.tr.x,A.tr.y],(0,oi.Z)(x),[A.tex.x+A.tex.width,A.tex.y,A.br.x,A.br.y],(0,oi.Z)(x),[A.tex.x,A.tex.y,A.bl.x,A.bl.y])),l.push(0+O*4,1+O*4,2+O*4,2+O*4,3+O*4,0+O*4)}),{vertices:s,indices:l,size:7}}var fi=function(n){(0,_e.Z)(a,n);var c=Gr(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"glyphInfo",void 0),(0,I.Z)((0,L.Z)(s),"glyphInfoMap",{}),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"currentZoom",-1),(0,I.Z)((0,L.Z)(s),"extent",void 0),(0,I.Z)((0,L.Z)(s),"textureHeight",0),(0,I.Z)((0,L.Z)(s),"textCount",0),(0,I.Z)((0,L.Z)(s),"preTextStyle",{}),(0,I.Z)((0,L.Z)(s),"buildModels",function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),s.reBuildModel(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:Mn,fragmentShader:qr,triangulation:ei.bind((0,L.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]}),s}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.stroke,O=A===void 0?"#fff":A,B=l.strokeWidth,te=B===void 0?0:B,$=l.textAnchor,me=$===void 0?"center":$,ze=l.textAllowOverlap,ht=ze===void 0?!1:ze,Ft=l.halo,mr=Ft===void 0?.5:Ft,Er=l.gamma,Zr=Er===void 0?2:Er,vn=this.fontService,hn=vn.canvas,On=vn.mapping;if(Object.keys(On).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(On).length),this.preTextStyle={textAnchor:me,textAllowOverlap:ht},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x,strokeWidth:te,stroke:O})){this.judgeStyleAttributes({opacity:x,strokeWidth:te,stroke:O});var ii=this.layer.getEncodedData(),wn=this.calDataFrame(this.cellLength,ii,this.cellProperties),xi=wn.data,Ji=wn.width,Sa=wn.height;this.rowCount=Sa,this.dataTexture=this.cellLength>0&&xi.length>0?this.createTexture2D({flipY:!0,data:xi,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:Ji,height:Sa}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Fi()(x)?x:1,u_stroke_width:Fi()(te)?te:0,u_stroke_color:this.getStrokeColor(O),u_sdf_map:this.texture,u_halo_blur:mr,u_gamma_scale:Zr,u_sdf_map_size:[hn.width,hn.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),d=l.textAnchor,x=d===void 0?"center":d,A=l.textAllowOverlap,O=A===void 0?!0:A;return this.preTextStyle={textAnchor:x,textAllowOverlap:O},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),d=l.textAllowOverlap,x=d===void 0?!1:d,A=this.mapService.getZoom(),O=this.mapService.getBounds(),B=(0,Je.oO)(this.extent,O);return!x&&(Math.abs(this.currentZoom-A)>1||!B)||x!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:E.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.rotate,te=B===void 0?0:B;return Array.isArray(te)?[te[0]]:[te]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:E.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(d,x,A,O){return[A[5],A[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.size,te=B===void 0?12:B;return Array.isArray(te)?[te[0]]:[te]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:E.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(d,x,A,O){return[A[3],A[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,Je.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,x=d===void 0?"400":d,A=l.fontFamily,O=A===void 0?"sans-serif":A,B=this.layer.getEncodedData(),te=[];B.forEach(function($){var me=$.shape,ze=me===void 0?"":me;ze=ze.toString();var ht=xr(ze),Ft;try{for(ht.s();!(Ft=ht.n()).done;){var mr=Ft.value;te.indexOf(mr)===-1&&te.push(mr)}}catch(Er){ht.e(Er)}finally{ht.f()}}),this.fontService.setFontOptions({characterSet:te,fontWeight:x,fontFamily:O,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,x=d===void 0?"400":d,A=l.fontFamily,O=A===void 0?"sans-serif":A,B=this.layer.getEncodedData(),te=[];B.forEach(function($){var me=$.shape,ze=me===void 0?"":me;ze=ze.toString(),te.indexOf(ze)===-1&&te.push(ze)}),this.fontService.setFontOptions({characterSet:te,fontWeight:x,fontFamily:O,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var d=this,x=this.fontService.mapping,A=this.layer.getLayerConfig(),O=A.spacing,B=O===void 0?2:O,te=A.textAnchor,$=te===void 0?"center":te,me=this.layer.getEncodedData();this.glyphInfo=me.map(function(ze){var ht=ze.shape,Ft=ht===void 0?"":ht,mr=ze.id,Er=ze.size,Zr=Er===void 0?1:Er,vn=ze.textOffset,hn=vn===void 0?[0,0]:vn,On=St(Ft.toString(),x,Zr,$,"center",B,hn,l),ii=Wt(On,hn,!1);return ze.shaping=On,ze.glyphQuads=ii,ze.centroid=Xi(ze.coordinates),ze.originCentroid=ze.version==="GAODE2.x"?Xi(ze.originCoordinates):ze.originCentroid=ze.centroid,d.glyphInfoMap[mr]={shaping:On,glyphQuads:ii,centroid:Xi(ze.coordinates)},ze})}},{key:"filterGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),x=d.padding,A=x===void 0?[4,4]:x,O=d.textAllowOverlap,B=O===void 0?!1:O;if(!B){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var te=this.rendererService.getViewportSize(),$=te.width,me=te.height,ze=new se($,me),ht=this.glyphInfo.filter(function(Ft){var mr=Ft.shaping,Er=Ft.id,Zr=Er===void 0?0:Er,vn=Ft.version==="GAODE2.x"?Ft.originCentroid:Ft.centroid,hn=Ft.size,On=hn/24,ii=l.mapService.lngLatToContainer(vn),wn=ze.placeCollisionBox({x1:mr.left*On-A[0],x2:mr.right*On+A[0],y1:mr.top*On-A[1],y2:mr.bottom*On+A[1],anchorPointX:ii.x,anchorPointY:ii.y}),xi=wn.box;return xi&&xi.length?(ze.insertCollisionBox(xi,Zr),!0):!1});ht.forEach(function(Ft){l.glyphInfoMap[Ft.id]=Ft})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),d=l.iconfont,x=d===void 0?!1:d;x?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(x)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.textureHeight=d.height,this.texture&&this.texture.destroy(),this.texture=l({data:d,mag:E.gl.LINEAR,min:E.gl.LINEAR,width:d.width,height:d.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Mn,fragmentShader:qr,triangulation:ei.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),a}(lo),ri={fill:Wu,image:Tc,normal:o,extrude:os,text:fi,icon:Xu},sa=ri;function Vn(n){var c=Si();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Si(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ui=function(n){(0,_e.Z)(a,n);var c=Vn(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","PointLayer"),s}return(0,G.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new sa[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return d[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),x=d.shape2d,A=d.shape3d,O=this.iconService.getIconMap(),B=l.find(function($){return $.hasOwnProperty("shape")});if(B){var te=B.shape;return te==="dot"?"normal":(x==null?void 0:x.indexOf(te))!==-1?"fill":(A==null?void 0:A.indexOf(te))!==-1?"extrude":O.hasOwnProperty(te)?"image":this.fontService.getGlyph(te)!==""?"icon":"text"}else return"normal"}}]),a}(so);function ee(n){var c=ne();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function ne(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var k=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,F=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,ie=function(n){(0,_e.Z)(a,n);var c=ee(a);function a(){return(0,V.Z)(this,a),c.apply(this,arguments)}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x})){this.judgeStyleAttributes({opacity:x});var A=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,A,this.cellProperties),B=O.data,te=O.width,$=O.height;this.rowCount=$,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:te,height:$}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Fi()(x)?x:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:F,fragmentShader:k,triangulation:Yl})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:E.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x,A,O,B){return B}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.size,te=B===void 0?10:B;return Array.isArray(te)?[te[0]]:[te]}}})}}]),a}(lo);function Te(n){var c=ft();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function ft(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Gt=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Et=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Qt=function(n){(0,_e.Z)(a,n);var c=Te(a);function a(){return(0,V.Z)(this,a),c.apply(this,arguments)}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x})){this.judgeStyleAttributes({opacity:x});var A=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,A,this.cellProperties),B=O.data,te=O.width,$=O.height;this.rowCount=$,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:te,height:$}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Fi()(x)?x:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:Et,fragmentShader:Gt,triangulation:Tu,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),a}(lo),Fr={fill:Qt,line:Zo,extrude:ie,text:fi,point_fill:Wu,point_image:Tc,point_normal:o,point_extrude:os},Bn=Fr;function zn(n){var c=hi();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function hi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ui=function(n){(0,_e.Z)(a,n);var c=zn(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","PolygonLayer"),s}return(0,G.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Bn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),x=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return x==="fill"?"fill":x==="extrude"?"extrude":x==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),x=d.shape2d,A=d.shape3d,O=this.iconService.getIconMap(),B=l.find(function($){return $.hasOwnProperty("shape")});if(B){var te=B.shape;return te==="dot"?"point_normal":(x==null?void 0:x.indexOf(te))!==-1?"point_fill":(A==null?void 0:A.indexOf(te))!==-1?"point_extrude":O.hasOwnProperty(te)?"point_image":"text"}else return"fill"}}]),a}(so);function yi(n){var c=Ki();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Ki(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var _a=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,xa=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Ya=function(n){(0,_e.Z)(a,n);var c=yi(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"colorTexture",void 0),s}return(0,G.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.clampLow,O=A===void 0?!0:A,B=l.clampHigh,te=B===void 0?!0:B,$=l.noDataValue,me=$===void 0?-9999999:$,ze=l.domain,ht=ze===void 0?[0,1]:ze;return this.updateColorTexure(),{u_opacity:x||1,u_texture:this.texture,u_domain:ht,u_clampLow:O,u_clampHigh:typeof te!="undefined"?te:O,u_noDataValue:me,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),d=this.rendererService.createTexture2D,x=l.data.dataArray[0];this.texture=d({data:x.data,width:x.width,height:x.height,format:E.gl.LUMINANCE,type:E.gl.FLOAT});var A=this.layer.getLayerConfig(),O=A.rampColors,B=(0,Je.Cl)(O);return this.colorTexture=d({data:B.data,width:B.width,height:B.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:xa,fragmentShader:_a,triangulation:rl,primitive:E.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(d,x,A,O){return[A[3],A[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,d=this.layer.getLayerConfig(),x=d.rampColors,A=(0,Je.Cl)(x);this.colorTexture=l({data:A.data,width:A.width,height:A.height,flipY:!1})}}]),a}(lo),Na={raster:Ya,raster3d:Ya},wo=Na;function La(n){var c=Ea();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Ea(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var fa=function(n){(0,_e.Z)(a,n);var c=La(a);function a(){var s;(0,V.Z)(this,a);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","RasterLayer"),s}return(0,G.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new wo[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={raster:{},raster3d:{}};return d[l]}},{key:"getModelType",value:function(){return"raster"}}]),a}(so),ma=y(50361),Ga=y.n(ma),za,ko,Zi,$o,Po,To,Ac,Du,Ku;function $u(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ol(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?$u(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):$u(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Ju=(za=(0,Ve.b2)(),ko=(0,Ve.f3)(E.vK.IGlobalConfigService),Zi=(0,Ve.f3)(E.vK.IMapService),$o=(0,Ve.f3)(E.vK.IFontService),za(Po=(To=function(){function n(){(0,V.Z)(this,n),(0,Bi.Z)(this,"configService",Ac,this),(0,Bi.Z)(this,"mapService",Du,this),(0,Bi.Z)(this,"fontService",Ku,this)}return(0,G.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(a,{styleAttributeService:d})}),a.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return a.dataState.dataMappingNeedUpdate=!1,l.generateMaping(a,{styleAttributeService:d}),!0}),a.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!a.layerModelNeedUpdate){var x=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),O=a.getSource().data.dataArray,B=x.filter(function($){return $.needRemapping}),te=O;A!=null&&A.needRemapping&&A!==null&&A!==void 0&&A.scale&&(te=O.filter(function($){return l.applyAttributeMapping(A,$)[0]})),B.length&&(A!=null&&A.needRemapping?(a.setEncodedData(l.mapping(x,te)),A.needRemapping=!1):a.setEncodedData(l.mapping(B,te,a.getEncodedData())),a.emit("remapping",null))}})}},{key:"generateMaping",value:function(a,s){var l=this,d=s.styleAttributeService,x=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),O=a.getSource().data.dataArray,B=O;A!=null&&A.scale&&(B=O.filter(function(te){return l.applyAttributeMapping(A,te)[0]})),a.setEncodedData(this.mapping(x,B))}},{key:"mapping",value:function(a,s,l){var d=this,x=s.map(function(A,O){var B=l?l[O]:{},te=Ol({id:A._id,coordinates:A.coordinates},B);return a.filter(function($){return $.scale!==void 0}).forEach(function($){var me=d.applyAttributeMapping($,A);$.needRemapping=!1,$.name==="color"&&(me=me.map(function(ze){return(0,Je.CI)(ze)})),te[$.name]=Array.isArray(me)&&me.length===1?me[0]:me,$.name==="shape"&&(te.shape=d.fontService.getIconFontKey(te[$.name]))}),te});return x.length>0&&this.mapService.version==="GAODE2.x"&&(typeof x[0].coordinates[0]=="number"?x.filter(function(A){return!A.originCoordinates}).map(function(A){A.version="GAODE2.x",A.originCoordinates=Ga()(A.coordinates),A.coordinates=d.mapService.lngLatToCoord(A.coordinates)}):x.filter(function(A){return!A.originCoordinates}).map(function(A){A.version="GAODE2.x",A.originCoordinates=Ga()(A.coordinates),A.coordinates=d.mapService.lngLatToCoords(A.coordinates)})),x}},{key:"applyAttributeMapping",value:function(a,s){var l;if(!a.scale)return[];var d=(a==null||(l=a.scale)===null||l===void 0?void 0:l.scalers)||[],x=[];return d.forEach(function(A){var O,B=A.field;(s.hasOwnProperty(B)||((O=a.scale)===null||O===void 0?void 0:O.type)==="variable")&&x.push(s[B])}),a.mapping?a.mapping(x):[]}}]),n}(),Ac=(0,ai.Z)(To.prototype,"configService",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Du=(0,ai.Z)(To.prototype,"mapService",[Zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ku=(0,ai.Z)(To.prototype,"fontService",[$o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),To))||Po),pl={},Ll={},_u=function(c){return Ll[c]},Mo=function(c,a){Ll[c]=a},Bf=function(c){return pl[c]},Rl=function(c,a){pl[c]=a},of={},xf={},bf=34,Dl=10,kl=13;function Mh(n){return new Function("d","return {"+n.map(function(c,a){return JSON.stringify(c)+": d["+a+'] || ""'}).join(",")+"}")}function Nf(n,c){var a=Mh(n);return function(s,l){return c(a(s),l,n)}}function zf(n){var c=Object.create(null),a=[];return n.forEach(function(s){for(var l in s)l in c||a.push(c[l]=l)}),a}function ss(n,c){var a=n+"",s=a.length;return s<c?new Array(c-s+1).join(0)+a:a}function sf(n){return n<0?"-"+ss(-n,6):n>9999?"+"+ss(n,6):ss(n,4)}function sp(n){var c=n.getUTCHours(),a=n.getUTCMinutes(),s=n.getUTCSeconds(),l=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":sf(n.getUTCFullYear(),4)+"-"+ss(n.getUTCMonth()+1,2)+"-"+ss(n.getUTCDate(),2)+(l?"T"+ss(c,2)+":"+ss(a,2)+":"+ss(s,2)+"."+ss(l,3)+"Z":s?"T"+ss(c,2)+":"+ss(a,2)+":"+ss(s,2)+"Z":a||c?"T"+ss(c,2)+":"+ss(a,2)+"Z":"")}function uf(n){var c=new RegExp('["'+n+`
\r]`),a=n.charCodeAt(0);function s($,me){var ze,ht,Ft=l($,function(mr,Er){if(ze)return ze(mr,Er-1);ht=mr,ze=me?Nf(mr,me):Mh(mr)});return Ft.columns=ht||[],Ft}function l($,me){var ze=[],ht=$.length,Ft=0,mr=0,Er,Zr=ht<=0,vn=!1;$.charCodeAt(ht-1)===Dl&&--ht,$.charCodeAt(ht-1)===kl&&--ht;function hn(){if(Zr)return xf;if(vn)return vn=!1,of;var ii,wn=Ft,xi;if($.charCodeAt(wn)===bf){for(;Ft++<ht&&$.charCodeAt(Ft)!==bf||$.charCodeAt(++Ft)===bf;);return(ii=Ft)>=ht?Zr=!0:(xi=$.charCodeAt(Ft++))===Dl?vn=!0:xi===kl&&(vn=!0,$.charCodeAt(Ft)===Dl&&++Ft),$.slice(wn+1,ii-1).replace(/""/g,'"')}for(;Ft<ht;){if((xi=$.charCodeAt(ii=Ft++))===Dl)vn=!0;else if(xi===kl)vn=!0,$.charCodeAt(Ft)===Dl&&++Ft;else if(xi!==a)continue;return $.slice(wn,ii)}return Zr=!0,$.slice(wn,ht)}for(;(Er=hn())!==xf;){for(var On=[];Er!==of&&Er!==xf;)On.push(Er),Er=hn();me&&(On=me(On,mr++))==null||ze.push(On)}return ze}function d($,me){return $.map(function(ze){return me.map(function(ht){return te(ze[ht])}).join(n)})}function x($,me){return me==null&&(me=zf($)),[me.map(te).join(n)].concat(d($,me)).join(`
`)}function A($,me){return me==null&&(me=zf($)),d($,me).join(`
`)}function O($){return $.map(B).join(`
`)}function B($){return $.map(te).join(n)}function te($){return $==null?"":$ instanceof Date?sp($):c.test($+="")?'"'+$.replace(/"/g,'""')+'"':$}return{parse:s,parseRows:l,format:x,formatBody:A,formatRows:O,formatRow:B,formatValue:te}}var cc=uf(","),up=cc.parse,zp=cc.parseRows,lp=cc.format,Up=cc.formatBody,Ih=cc.formatRows,Zp=cc.formatRow,Sf=cc.formatValue,cp=y(6563),jo=y.n(cp);function Ef(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ch(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Ef(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Ef(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Cf(n,c){var a=c.x,s=c.y,l=c.x1,d=c.y1,x=c.coordinates,A=[];return n.forEach(function(O,B){var te=[];if(a&&s&&(te=[parseFloat(O[a]),parseFloat(O[s])]),a&&s&&l&&d){var $=[parseFloat(O[a]),parseFloat(O[s])],me=[parseFloat(O[l]),parseFloat(O[d])];te=[$,me]}if(x){var ze="Polygon";Array.isArray(x[0])||(ze="Point"),Array.isArray(x[0])&&!Array.isArray(x[0][0])&&(ze="LineString");var ht={type:ze,coordinates:(0,oi.Z)(O[x])};jo()(ht,!0),te=ht.coordinates}var Ft=ch(ch({},O),{},{_id:B,coordinates:te});A.push(Ft)}),{dataArray:A}}function Uf(n,c){var a=up(n);return Cf(a,c)}var Pc=y(40271);function Zf(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function wf(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Mc(n){if(n.length>1&&isNumber(n[0])&&isNumber(n[1]))return!0;if(Array.isArray(n[0])&&n[0].length)return Mc(n[0]);throw new Error("coordinates must only contain numbers")}function jf(n,c,a){if(!c||!a)throw new Error("type and name required");if(!n||n.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+n.type)}function Tf(n,c,a){if(!n)throw new Error("No feature passed");if(!a)throw new Error(".featureOf() requires a name");if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!n.geometry||n.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+n.geometry.type)}function fh(n,c,a){if(!n)throw new Error("No featureCollection passed");if(!a)throw new Error(".collectionOf() requires a name");if(!n||n.type!=="FeatureCollection")throw new Error("Invalid input to "+a+", FeatureCollection required");for(var s=0,l=n.features;s<l.length;s++){var d=l[s];if(!d||d.type!=="Feature"||!d.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!d.geometry||d.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+d.geometry.type)}}function Vc(n){return n.type==="Feature"?n.geometry:n}function Oh(n,c){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function fc(n,c,a){if(n!==null)for(var s,l,d,x,A,O,B,te=0,$=0,me,ze=n.type,ht=ze==="FeatureCollection",Ft=ze==="Feature",mr=ht?n.features.length:1,Er=0;Er<mr;Er++){B=ht?n.features[Er].geometry:Ft?n.geometry:n,me=B?B.type==="GeometryCollection":!1,A=me?B.geometries.length:1;for(var Zr=0;Zr<A;Zr++){var vn=0,hn=0;if(x=me?B.geometries[Zr]:B,x!==null){O=x.coordinates;var On=x.type;switch(te=a&&(On==="Polygon"||On==="MultiPolygon")?1:0,On){case null:break;case"Point":if(c(O,$,Er,vn,hn)===!1)return!1;$++,vn++;break;case"LineString":case"MultiPoint":for(s=0;s<O.length;s++){if(c(O[s],$,Er,vn,hn)===!1)return!1;$++,On==="MultiPoint"&&vn++}On==="LineString"&&vn++;break;case"Polygon":case"MultiLineString":for(s=0;s<O.length;s++){for(l=0;l<O[s].length-te;l++){if(c(O[s][l],$,Er,vn,hn)===!1)return!1;$++}On==="MultiLineString"&&vn++,On==="Polygon"&&hn++}On==="Polygon"&&vn++;break;case"MultiPolygon":for(s=0;s<O.length;s++){for(hn=0,l=0;l<O[s].length;l++){for(d=0;d<O[s][l].length-te;d++){if(c(O[s][l][d],$,Er,vn,hn)===!1)return!1;$++}hn++}vn++}break;case"GeometryCollection":for(s=0;s<x.geometries.length;s++)if(fc(x.geometries[s],c,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function hh(n,c,a,s){var l=a;return fc(n,function(d,x,A,O,B){x===0&&a===void 0?l=d:l=c(l,d,x,A,O,B)},s),l}function lf(n,c){var a;switch(n.type){case"FeatureCollection":for(a=0;a<n.features.length&&c(n.features[a].properties,a)!==!1;a++);break;case"Feature":c(n.properties,0);break}}function cf(n,c,a){var s=a;return lf(n,function(l,d){d===0&&a===void 0?s=l:s=c(s,l,d)}),s}function lu(n,c){if(n.type==="Feature")c(n,0);else if(n.type==="FeatureCollection")for(var a=0;a<n.features.length&&c(n.features[a],a)!==!1;a++);}function Vf(n,c,a){var s=a;return lu(n,function(l,d){d===0&&a===void 0?s=l:s=c(s,l,d)}),s}function Gf(n){var c=[];return fc(n,function(a){c.push(a)}),c}function ff(n,c){var a,s,l,d,x,A,O,B,te,$,me=0,ze=n.type==="FeatureCollection",ht=n.type==="Feature",Ft=ze?n.features.length:1;for(a=0;a<Ft;a++){for(A=ze?n.features[a].geometry:ht?n.geometry:n,B=ze?n.features[a].properties:ht?n.properties:{},te=ze?n.features[a].bbox:ht?n.bbox:void 0,$=ze?n.features[a].id:ht?n.id:void 0,O=A?A.type==="GeometryCollection":!1,x=O?A.geometries.length:1,l=0;l<x;l++){if(d=O?A.geometries[l]:A,d===null){if(c(null,me,B,te,$)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(c(d,me,B,te,$)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<d.geometries.length;s++)if(c(d.geometries[s],me,B,te,$)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}me++}}function Lh(n,c,a){var s=a;return ff(n,function(l,d,x,A,O){d===0&&a===void 0?s=l:s=c(s,l,d,x,A,O)}),s}function hc(n,c){ff(n,function(a,s,l,d,x){var A=a===null?null:a.type;switch(A){case null:case"Point":case"LineString":case"Polygon":return c((0,Pc.zL)(a,l,{bbox:d,id:x}),s,0)===!1?!1:void 0}var O;switch(A){case"MultiPoint":O="Point";break;case"MultiLineString":O="LineString";break;case"MultiPolygon":O="Polygon";break}for(var B=0;B<a.coordinates.length;B++){var te=a.coordinates[B],$={type:O,coordinates:te};if(c((0,Pc.zL)($,l),s,B)===!1)return!1}})}function dl(n,c,a){var s=a;return hc(n,function(l,d,x){d===0&&x===0&&a===void 0?s=l:s=c(s,l,d,x)}),s}function Rh(n,c){hc(n,function(a,s,l){var d=0;if(!!a.geometry){var x=a.geometry.type;if(!(x==="Point"||x==="MultiPoint")){var A,O=0,B=0,te=0;if(fc(a,function($,me,ze,ht,Ft){if(A===void 0||s>O||ht>B||Ft>te){A=$,O=s,B=ht,te=Ft,d=0;return}var mr=lineString([A,$],a.properties);if(c(mr,s,l,Ft,d)===!1)return!1;d++,A=$})===!1)return!1}}})}function Dh(n,c,a){var s=a,l=!1;return Rh(n,function(d,x,A,O,B){l===!1&&a===void 0?s=d:s=c(s,d,x,A,O,B),l=!0}),s}function kh(n,c){if(!n)throw new Error("geojson is required");hc(n,function(a,s,l){if(a.geometry!==null){var d=a.geometry.type,x=a.geometry.coordinates;switch(d){case"LineString":if(c(a,s,l,0,0)===!1)return!1;break;case"Polygon":for(var A=0;A<x.length;A++)if(c(lineString(x[A],a.properties),s,l,A)===!1)return!1;break}}})}function fp(n,c,a){var s=a;return kh(n,function(l,d,x,A){d===0&&a===void 0?s=l:s=c(s,l,d,x,A)}),s}function jp(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.segmentIndex||0,x=c.properties,A;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),x=x||n.features[a].properties,A=n.features[a].geometry;break;case"Feature":x=x||n.properties,A=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=n;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var O=A.coordinates;switch(A.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=O.length+d-1),lineString([O[d],O[d+1]],x,c);case"Polygon":return l<0&&(l=O.length+l),d<0&&(d=O[l].length+d-1),lineString([O[l][d],O[l][d+1]],x,c);case"MultiLineString":return s<0&&(s=O.length+s),d<0&&(d=O[s].length+d-1),lineString([O[s][d],O[s][d+1]],x,c);case"MultiPolygon":return s<0&&(s=O.length+s),l<0&&(l=O[s].length+l),d<0&&(d=O[s][l].length-d-1),lineString([O[s][l][d],O[s][l][d+1]],x,c)}throw new Error("geojson is invalid")}function Gc(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.coordIndex||0,x=c.properties,A;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),x=x||n.features[a].properties,A=n.features[a].geometry;break;case"Feature":x=x||n.properties,A=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=n;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var O=A.coordinates;switch(A.type){case"Point":return point(O,x,c);case"MultiPoint":return s<0&&(s=O.length+s),point(O[s],x,c);case"LineString":return d<0&&(d=O.length+d),point(O[d],x,c);case"Polygon":return l<0&&(l=O.length+l),d<0&&(d=O[l].length+d),point(O[l][d],x,c);case"MultiLineString":return s<0&&(s=O.length+s),d<0&&(d=O[s].length+d),point(O[s][d],x,c);case"MultiPolygon":return s<0&&(s=O.length+s),l<0&&(l=O[s].length+l),d<0&&(d=O[s][l].length-d),point(O[s][l][d],x,c)}throw new Error("geojson is invalid")}function Ic(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ph(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Ic(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Ic(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Hf(n,c){var a=[],s={};if(n.features=n.features.filter(function(d){var x=d.geometry;return d!=null&&x&&x.type&&x.coordinates&&x.coordinates.length>0}),jo()(n,!0),n.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return hc(n,function(d,x){var A=wf(d),O=x,B=ph(ph({},d.properties),{},{coordinates:A,_id:O});a.push(B)}),{dataArray:a,featureKeys:s}}function hf(n,c){var a=c.extent,s=new Promise(function(d){Qu(n,function(x){d(x)})}),l={images:s,_id:1,dataArray:[{_id:0,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return l}function Qu(n,c){var a=n,s=[];if(typeof a=="string")(0,Je.gJ)({url:a},function(x,A){s.push(A),c(s)});else{var l=a.length,d=0;a.forEach(function(x){(0,Je.gJ)({url:x},function(A,O){d++,s.push(O),d===l&&c(s)})})}return hf}function hp(n,c){var a=c.extent,s=c.width,l=c.height,d=c.min,x=c.max,A={_id:1,dataArray:[{_id:1,data:Array.from(n),width:s,height:l,min:d,max:x,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return A}var Fl=y(30236),Fh=y.n(Fl);function vl(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Bl(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?vl(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):vl(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function dh(n,c){var a=c.radius,s=a===void 0?40:a,l=c.maxZoom,d=l===void 0?18:l,x=c.minZoom,A=x===void 0?0:x,O=c.zoom,B=O===void 0?2:O;if(n.pointIndex){var te=n.pointIndex.getClusters(n.extent,Math.floor(B));return n.dataArray=vh(te),n}var $=new(Ni())({radius:s,minZoom:A,maxZoom:d}),me={type:"FeatureCollection",features:[]};return me.features=n.dataArray.map(function(ze){return{type:"Feature",geometry:{type:"Point",coordinates:ze.coordinates},properties:Bl({},ze)}}),$.load(me.features),$}function vh(n){return n.map(function(c,a){return Bl({coordinates:c.geometry.coordinates,_id:a+1},c.properties)})}function Wf(n){if(n.length===0)throw new Error("max requires at least one data point");for(var c=n[0],a=1;a<n.length;a++)n[a]>c&&(c=n[a]);return c}function Bh(n){if(n.length===0)throw new Error("min requires at least one data point");for(var c=n[0],a=1;a<n.length;a++)n[a]<c&&(c=n[a]);return c}function us(n){if(n.length===0)return 0;for(var c=n[0],a=0,s,l=1;l<n.length;l++)s=c+n[l]*1,Math.abs(c)>=Math.abs(n[l])?a+=c-s+n[l]:a+=n[l]-s+c,c=s;return c+a*1}function Vo(n){if(n.length===0)throw new Error("mean requires at least one data point");return us(n)/n.length}var ls={min:Bh,max:Wf,mean:Vo,sum:us};function cu(n,c){return n.map(function(a){return a[c]*1})}function Xf(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Nh(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Xf(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Xf(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function zh(n){var c=pp();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function pp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function dp(n,c){if(Array.isArray(c))return c}var Uh=function(n){(0,_e.Z)(a,n);var c=zh(a);function a(s,l){var d;return(0,V.Z)(this,a),d=c.call(this),(0,I.Z)((0,L.Z)(d),"data",void 0),(0,I.Z)((0,L.Z)(d),"extent",void 0),(0,I.Z)((0,L.Z)(d),"hooks",{init:new ia.ni}),(0,I.Z)((0,L.Z)(d),"parser",{type:"geojson"}),(0,I.Z)((0,L.Z)(d),"transforms",[]),(0,I.Z)((0,L.Z)(d),"cluster",!1),(0,I.Z)((0,L.Z)(d),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,I.Z)((0,L.Z)(d),"mapService",void 0),(0,I.Z)((0,L.Z)(d),"invalidExtent",!1),(0,I.Z)((0,L.Z)(d),"originData",void 0),(0,I.Z)((0,L.Z)(d),"rawData",void 0),(0,I.Z)((0,L.Z)(d),"cfg",{}),(0,I.Z)((0,L.Z)(d),"clusterIndex",void 0),d.originData=s,d.initCfg(l),d.hooks.init.tap("parser",function(){d.excuteParser()}),d.hooks.init.tap("cluster",function(){d.initCluster()}),d.hooks.init.tap("transform",function(){d.executeTrans()}),d.init(),d}return(0,G.Z)(a,[{key:"setData",value:function(l,d){this.rawData=l,this.originData=l,this.initCfg(d),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var d=this,x=this.clusterOptions,A=x.method,O=A===void 0?"sum":A,B=x.field,te=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,te.forEach(function($){$.id||($.properties.point_count=1)}),(B||po()(O))&&(te=te.map(function($){var me=$.id;if(me){var ze=d.clusterIndex.getLeaves(me,Infinity),ht=ze.map(function(Er){return Er.properties}),Ft;if(Fa()(O)&&B){var mr=cu(ht,B);Ft=ls[O](mr)}po()(O)&&(Ft=O(ht)),$.properties.stat=Ft}else $.properties.point_count=1;return $})),this.data=_u("geojson")({type:"FeatureCollection",features:te}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var d=this.parser.type,x=d===void 0?"geojson":d;if(x==="geojson"&&!this.cluster){var A=l<this.originData.features.length?this.originData.features[l]:"null",O=Ga()(A);if(this.transforms.length!==0){var B=this.data.dataArray.find(function(te){return te._id===l});O.properties=B}return O}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,d){var x=this.data.dataArray.find(function(A){return A[l]===name});return x==null?void 0:x._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var d=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(d=(0,Je.yA)((0,Je.ds)(this.extent),l)),d[0].concat(d[1])}},{key:"initCfg",value:function(l){this.cfg=Fh()(this.cfg,l,dp);var d=this.cfg;d&&(d.parser&&(this.parser=d.parser),d.transforms&&(this.transforms=d.transforms),this.cluster=d.cluster||!1,d.clusterOptions&&(this.cluster=!0,this.clusterOptions=Nh(Nh({},this.clusterOptions),d.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,d=l.type||"geojson",x=_u(d);this.data=x(this.originData,l),this.extent=(0,Je.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,d=this.transforms;d.forEach(function(x){var A=x.type,O=Bf(A)(l.data,x);Object.assign(l.data,O)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=dh(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),a}(Dt.EventEmitter);function Zh(n,c){var a=c.callback;return a&&(n.dataArray=n.dataArray.filter(a)),n}function jh(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=vp(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(B){throw B},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){a=a.call(n)},n:function(){var B=a.next();return d=B.done,B},e:function(B){x=!0,A=B},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(x)throw A}}}}function vp(n,c){if(!!n){if(typeof n=="string")return pf(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pf(n,c)}}function pf(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var Yf=6378e3;function mh(n,c){var a=n.dataArray,s=c.size,l=s===void 0?10:s,d=l/(2*Math.PI*Yf)*(256<<20)/2,x=Af(a,l),A=x.gridHash,O=x.gridOffset,B=Hc(A,O,c);return{yOffset:d,xOffset:d,radius:d,type:"grid",dataArray:B}}function Af(n,c){var a=Infinity,s=-Infinity,l,d=jh(n),x;try{for(d.s();!(x=d.n()).done;){var A=x.value;l=A.coordinates[1],Number.isFinite(l)&&(a=l<a?l:a,s=l>s?l:s)}}catch(vn){d.e(vn)}finally{d.f()}var O=(a+s)/2,B=Ka(c,O);if(B.xOffset<=0||B.yOffset<=0)return{gridHash:{},gridOffset:B};var te={},$=jh(n),me;try{for($.s();!(me=$.n()).done;){var ze=me.value,ht=ze.coordinates[1],Ft=ze.coordinates[0];if(Number.isFinite(ht)&&Number.isFinite(Ft)){var mr=Math.floor((ht+90)/B.yOffset),Er=Math.floor((Ft+180)/B.xOffset),Zr="".concat(mr,"-").concat(Er);te[Zr]=te[Zr]||{count:0,points:[]},te[Zr].count+=1,te[Zr].points.push(ze)}}}catch(vn){$.e(vn)}finally{$.f()}return{gridHash:te,gridOffset:B}}function Ka(n,c){var a=Vh(n),s=pc(c,n);return{yOffset:a,xOffset:s}}function Vh(n){return n/Yf*(180/Math.PI)}function pc(n,c){return c/Yf*(180/Math.PI)/Math.cos(n*Math.PI/180)}function Hc(n,c,a){return Object.keys(n).reduce(function(s,l,d){var x=l.split("-"),A=parseInt(x[0],10),O=parseInt(x[1],10),B={};if(a.field&&a.method){var te=Je.a5.getColumn(n[l].points,a.field);B[a.method]=Je.a5.statMap[a.method](te)}return Object.assign(B,{_id:d,coordinates:(0,Je.Z)([-180+c.xOffset*(O+.5),-90+c.yOffset*(A+.5)]),rawData:n[l].points,count:n[l].count}),s.push(B),s},[])}var Wc=Math.PI/3,W=[0,Wc,2*Wc,3*Wc,4*Wc,5*Wc];function Oe(n){return n[0]}function et(n){return n[1]}function ur(){var n=0,c=0,a=1,s=1,l=Oe,d=et,x,A,O;function B($){var me={},ze=[],ht,Ft=$.length;for(ht=0;ht<Ft;++ht)if(!(isNaN(Er=+l.call(null,mr=$[ht],ht,$))||isNaN(Zr=+d.call(null,mr,ht,$)))){var mr,Er,Zr,vn=Math.round(Zr=Zr/O),hn=Math.round(Er=Er/A-(vn&1)/2),On=Zr-vn;if(Math.abs(On)*3>1){var ii=Er-hn,wn=hn+(Er<hn?-1:1)/2,xi=vn+(Zr<vn?-1:1),Ji=Er-wn,Sa=Zr-xi;ii*ii+On*On>Ji*Ji+Sa*Sa&&(hn=wn+(vn&1?1:-1)/2,vn=xi)}var gi=hn+"-"+vn,Oa=me[gi];Oa?Oa.push(mr):(ze.push(Oa=me[gi]=[mr]),Oa.x=(hn+(vn&1)/2)*A,Oa.y=vn*O)}return ze}function te($){var me=0,ze=0;return W.map(function(ht){var Ft=Math.sin(ht)*$,mr=-Math.cos(ht)*$,Er=Ft-me,Zr=mr-ze;return me=Ft,ze=mr,[Er,Zr]})}return B.hexagon=function($){return"m"+te($==null?x:+$).join("l")+"z"},B.centers=function(){for(var $=[],me=Math.round(c/O),ze=Math.round(n/A),ht=me*O;ht<s+x;ht+=O,++me)for(var Ft=ze*A+(me&1)*A/2;Ft<a+A/2;Ft+=A)$.push([Ft,ht]);return $},B.mesh=function(){var $=te(x).slice(0,4).join("l");return B.centers().map(function(me){return"M"+me+"m"+$}).join("")},B.x=function($){return arguments.length?(l=$,B):l},B.y=function($){return arguments.length?(d=$,B):d},B.radius=function($){return arguments.length?(x=+$,A=x*2*Math.sin(Wc),O=x*1.5,B):x},B.size=function($){return arguments.length?(n=c=0,a=+$[0],s=+$[1],B):[a-n,s-c]},B.extent=function($){return arguments.length?(n=+$[0][0],c=+$[0][1],a=+$[1][0],s=+$[1][1],B):[[n,c],[a,s]]},B.radius(1)}function Dr(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ar(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Dr(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Dr(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Ar=6378e3;function jr(n,c){var a=n.dataArray,s=c.size,l=s===void 0?10:s,d=c.method,x=d===void 0?"sum":d,A=l/(2*Math.PI*Ar)*(256<<20)/2,O=a.map(function(me){var ze=(0,Je.Z)(me.coordinates),ht=(0,Z.Z)(ze,2),Ft=ht[0],mr=ht[1];return ar(ar({},me),{},{coordinates:[Ft,mr]})}),B=ur().radius(A).x(function(me){return me.coordinates[0]}).y(function(me){return me.coordinates[1]}),te=B(O),$={dataArray:te.map(function(me,ze){var ht;if(c.field&&x){var Ft=Je.a5.getColumn(me,c.field);me[x]=Je.a5.statMap[x](Ft)}return ht={},(0,I.Z)(ht,c.method,me[x]),(0,I.Z)(ht,"count",me.length),(0,I.Z)(ht,"rawData",me),(0,I.Z)(ht,"coordinates",[me.x,me.y]),(0,I.Z)(ht,"_id",ze),ht}),radius:A,xOffset:A,yOffset:A,type:"hexagon"};return $}function Wr(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Jr(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Wr(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Wr(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Qr(n,c){var a=c.sourceField,s=c.targetField,l=c.data,d={};return l.forEach(function(x){d[x[a]]=x}),n.dataArray=n.dataArray.map(function(x){var A=x[s];return Jr(Jr({},x),d[A])}),n}function rn(n,c){var a=c.callback;return a&&(n.dataArray=n.dataArray.map(a)),n}var yn=y(4771),Xr=Uh;Mo("geojson",Hf),Mo("image",hf),Mo("csv",Uf),Mo("json",Cf),Mo("raster",hp),Rl("cluster",dh),Rl("filter",Zh),Rl("join",Qr),Rl("map",rn),Rl("grid",mh),Rl("hexagon",jr);var en,Nt,_r=(en=(0,Ve.b2)(),en(Nt=function(){function n(){(0,V.Z)(this,n),(0,I.Z)(this,"mapService",void 0)}return(0,G.Z)(n,[{key:"apply",value:function(a){var s=this;this.mapService=a.getContainer().get(E.vK.IMapService),a.hooks.init.tap("DataSourcePlugin",function(){var l=a.getSource();if(!l){var d=a.sourceOption,x=d.data,A=d.options;a.setSource(new Xr(x,A))}s.updateClusterData(a)}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(a),d=a.dataState.dataSourceNeedUpdate;return a.dataState.dataSourceNeedUpdate=!1,l||d})}},{key:"updateClusterData",value:function(a){var s=a.getSource(),l=s.cluster,d=s.clusterOptions,x=d.zoom,A=x===void 0?0:x,O=d.maxZoom,B=O===void 0?16:O,te=this.mapService.getZoom()-1,$=a.dataState.dataSourceNeedUpdate;return l&&($||Math.abs(A-te)>1)&&B>A?(s.updateClusterData(Math.floor(te)),!0):!1}}]),n}())||Nt),Kr=y(44908),Ln=y.n(Kr),Or=y(14293),Sn=y.n(Or);function tn(n,c){return n<c?-1:n>c?1:n>=c?0:NaN}function li(n){return n.length===1&&(n=Lr(n)),{left:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;n(c[d],a)<0?s=d+1:l=d}return s},right:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;n(c[d],a)>0?l=d:s=d+1}return s}}}function Lr(n){return function(c,a){return tn(n(c),a)}}var Tr=li(tn),Xn=Tr.right,_n=Tr.left,$r=Xn;function An(n,c){var a=n.length,s=-1,l,d,x;if(c==null){for(;++s<a;)if((l=n[s])!=null&&l>=l)for(d=x=l;++s<a;)(l=n[s])!=null&&(d>l&&(d=l),x<l&&(x=l))}else for(;++s<a;)if((l=c(n[s],s,n))!=null&&l>=l)for(d=x=l;++s<a;)(l=c(n[s],s,n))!=null&&(d>l&&(d=l),x<l&&(x=l));return[d,x]}var En=Array.prototype,ji=En.slice,Ri=En.map,Pn=Math.sqrt(50),Cn=Math.sqrt(10),Ei=Math.sqrt(2);function Di(n,c,a){var s,l=-1,d,x,A;if(c=+c,n=+n,a=+a,n===c&&a>0)return[n];if((s=c<n)&&(d=n,n=c,c=d),(A=ra(n,c,a))===0||!isFinite(A))return[];if(A>0)for(n=Math.ceil(n/A),c=Math.floor(c/A),x=new Array(d=Math.ceil(c-n+1));++l<d;)x[l]=(n+l)*A;else for(n=Math.floor(n*A),c=Math.ceil(c*A),x=new Array(d=Math.ceil(n-c+1));++l<d;)x[l]=(n-l)/A;return s&&x.reverse(),x}function ra(n,c,a){var s=(c-n)/Math.max(0,a),l=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,l);return l>=0?(d>=Pn?10:d>=Cn?5:d>=Ei?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=Pn?10:d>=Cn?5:d>=Ei?2:1)}function yo(n,c,a){var s=Math.abs(c-n)/Math.max(0,a),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/l;return d>=Pn?l*=10:d>=Cn?l*=5:d>=Ei&&(l*=2),c<n?-l:l}function Fo(){var n=identity,c=extent,a=sturges;function s(l){var d,x=l.length,A,O=new Array(x);for(d=0;d<x;++d)O[d]=n(l[d],d,l);var B=c(O),te=B[0],$=B[1],me=a(O,te,$);Array.isArray(me)||(me=tickStep(te,$,me),me=range(Math.ceil(te/me)*me,$,me));for(var ze=me.length;me[0]<=te;)me.shift(),--ze;for(;me[ze-1]>$;)me.pop(),--ze;var ht=new Array(ze+1),Ft;for(d=0;d<=ze;++d)Ft=ht[d]=[],Ft.x0=d>0?me[d-1]:te,Ft.x1=d<ze?me[d]:$;for(d=0;d<x;++d)A=O[d],te<=A&&A<=$&&ht[bisect(me,A,0,ze)].push(l[d]);return ht}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(a=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):a},s}function da(n,c,a){return n=map.call(n,number).sort(ascending),Math.ceil((a-c)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function bs(n){return n===null?NaN:+n}function ho(n,c,a){if(a==null&&(a=bs),!!(s=n.length)){if((c=+c)<=0||s<2)return+a(n[0],0,n);if(c>=1)return+a(n[s-1],s-1,n);var s,l=(s-1)*c,d=Math.floor(l),x=+a(n[d],d,n),A=+a(n[d+1],d+1,n);return x+(A-x)*(l-d)}}var $a="$";function Io(){}Io.prototype=cs.prototype={constructor:Io,has:function(n){return $a+n in this},get:function(n){return this[$a+n]},set:function(n,c){return this[$a+n]=c,this},remove:function(n){var c=$a+n;return c in this&&delete this[c]},clear:function(){for(var n in this)n[0]===$a&&delete this[n]},keys:function(){var n=[];for(var c in this)c[0]===$a&&n.push(c.slice(1));return n},values:function(){var n=[];for(var c in this)c[0]===$a&&n.push(this[c]);return n},entries:function(){var n=[];for(var c in this)c[0]===$a&&n.push({key:c.slice(1),value:this[c]});return n},size:function(){var n=0;for(var c in this)c[0]===$a&&++n;return n},empty:function(){for(var n in this)if(n[0]===$a)return!1;return!0},each:function(n){for(var c in this)c[0]===$a&&n(this[c],c.slice(1),this)}};function cs(n,c){var a=new Io;if(n instanceof Io)n.each(function(A,O){a.set(O,A)});else if(Array.isArray(n)){var s=-1,l=n.length,d;if(c==null)for(;++s<l;)a.set(s,n[s]);else for(;++s<l;)a.set(c(d=n[s],s,n),d)}else if(n)for(var x in n)a.set(x,n[x]);return a}var fs=cs;function Ss(){var n=[],c=[],a,s,l;function d(A,O,B,te){if(O>=n.length)return a!=null&&A.sort(a),s!=null?s(A):A;for(var $=-1,me=A.length,ze=n[O++],ht,Ft,mr=map(),Er,Zr=B();++$<me;)(Er=mr.get(ht=ze(Ft=A[$])+""))?Er.push(Ft):mr.set(ht,[Ft]);return mr.each(function(vn,hn){te(Zr,hn,d(vn,O,B,te))}),Zr}function x(A,O){if(++O>n.length)return A;var B,te=c[O-1];return s!=null&&O>=n.length?B=A.entries():(B=[],A.each(function($,me){B.push({key:me,values:x($,O)})})),te!=null?B.sort(function($,me){return te($.key,me.key)}):B}return l={object:function(A){return d(A,0,Go,$i)},map:function(A){return d(A,0,Jo,Ma)},entries:function(A){return x(d(A,0,Jo,Ma),0)},key:function(A){return n.push(A),l},sortKeys:function(A){return c[n.length-1]=A,l},sortValues:function(A){return a=A,l},rollup:function(A){return s=A,l}}}function Go(){return{}}function $i(n,c,a){n[c]=a}function Jo(){return map()}function Ma(n,c,a){n.set(c,a)}function _o(){}var _i=fs.prototype;_o.prototype=pa.prototype={constructor:_o,has:_i.has,add:function(n){return n+="",this[$a+n]=n,this},remove:_i.remove,clear:_i.clear,values:_i.keys,size:_i.size,empty:_i.empty,each:_i.each};function pa(n,c){var a=new _o;if(n instanceof _o)n.each(function(d){a.add(d)});else if(n){var s=-1,l=n.length;if(c==null)for(;++s<l;)a.add(n[s]);else for(;++s<l;)a.add(c(n[s],s,n))}return a}var no=null,xo=Array.prototype,xu=xo.map,He=xo.slice;function nr(n,c){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(c).domain(n);break}return this}function er(n,c){switch(arguments.length){case 0:break;case 1:this.interpolator(n);break;default:this.interpolator(c).domain(n);break}return this}var Un={name:"implicit"};function ua(){var n=fs(),c=[],a=[],s=Un;function l(d){var x=d+"",A=n.get(x);if(!A){if(s!==Un)return s;n.set(x,A=c.push(d))}return a[(A-1)%a.length]}return l.domain=function(d){if(!arguments.length)return c.slice();c=[],n=fs();for(var x=-1,A=d.length,O,B;++x<A;)n.has(B=(O=d[x])+"")||n.set(B,c.push(O));return l},l.range=function(d){return arguments.length?(a=He.call(d),l):a.slice()},l.unknown=function(d){return arguments.length?(s=d,l):s},l.copy=function(){return ua(c,a).unknown(s)},nr.apply(l,arguments),l}function Be(){var n=ordinal().unknown(void 0),c=n.domain,a=n.range,s=[0,1],l,d,x=!1,A=0,O=0,B=.5;delete n.unknown;function te(){var $=c().length,me=s[1]<s[0],ze=s[me-0],ht=s[1-me];l=(ht-ze)/Math.max(1,$-A+O*2),x&&(l=Math.floor(l)),ze+=(ht-ze-l*($-A))*B,d=l*(1-A),x&&(ze=Math.round(ze),d=Math.round(d));var Ft=sequence($).map(function(mr){return ze+l*mr});return a(me?Ft.reverse():Ft)}return n.domain=function($){return arguments.length?(c($),te()):c()},n.range=function($){return arguments.length?(s=[+$[0],+$[1]],te()):s.slice()},n.rangeRound=function($){return s=[+$[0],+$[1]],x=!0,te()},n.bandwidth=function(){return d},n.step=function(){return l},n.round=function($){return arguments.length?(x=!!$,te()):x},n.padding=function($){return arguments.length?(A=Math.min(1,O=+$),te()):A},n.paddingInner=function($){return arguments.length?(A=Math.min(1,$),te()):A},n.paddingOuter=function($){return arguments.length?(O=+$,te()):O},n.align=function($){return arguments.length?(B=Math.max(0,Math.min(1,$)),te()):B},n.copy=function(){return Be(c(),s).round(x).paddingInner(A).paddingOuter(O).align(B)},initRange.apply(te(),arguments)}function we(n){var c=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return we(c())},n}function ut(){return we(Be.apply(null,arguments).paddingInner(1))}var zt=y(26257),lr=y(73626);function yt(n,c){return n=+n,c=+c,function(a){return Math.round(n*(1-a)+c*a)}}function dt(n){return function(){return n}}function it(n){return+n}var De=[0,1];function tt(n){return n}function Ne(n,c){return(c-=n=+n)?function(a){return(a-n)/c}:dt(isNaN(c)?NaN:.5)}function Zt(n){var c=n[0],a=n[n.length-1],s;return c>a&&(s=c,c=a,a=s),function(l){return Math.max(c,Math.min(a,l))}}function Kt(n,c,a){var s=n[0],l=n[1],d=c[0],x=c[1];return l<s?(s=Ne(l,s),d=a(x,d)):(s=Ne(s,l),d=a(d,x)),function(A){return d(s(A))}}function Vr(n,c,a){var s=Math.min(n.length,c.length)-1,l=new Array(s),d=new Array(s),x=-1;for(n[s]<n[0]&&(n=n.slice().reverse(),c=c.slice().reverse());++x<s;)l[x]=Ne(n[x],n[x+1]),d[x]=a(c[x],c[x+1]);return function(A){var O=$r(n,A,1,s)-1;return d[O](l[O](A))}}function cn(n,c){return c.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function dn(){var n=De,c=De,a=zt.Z,s,l,d,x=tt,A,O,B;function te(){return A=Math.min(n.length,c.length)>2?Vr:Kt,O=B=null,$}function $(me){return isNaN(me=+me)?d:(O||(O=A(n.map(s),c,a)))(s(x(me)))}return $.invert=function(me){return x(l((B||(B=A(c,n.map(s),lr.Z)))(me)))},$.domain=function(me){return arguments.length?(n=xu.call(me,it),x===tt||(x=Zt(n)),te()):n.slice()},$.range=function(me){return arguments.length?(c=He.call(me),te()):c.slice()},$.rangeRound=function(me){return c=He.call(me),a=yt,te()},$.clamp=function(me){return arguments.length?(x=me?Zt(n):tt,$):x!==tt},$.interpolate=function(me){return arguments.length?(a=me,te()):a},$.unknown=function(me){return arguments.length?(d=me,$):d},function(me,ze){return s=me,l=ze,te()}}function In(n,c){return dn()(n,c)}var fn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Wn(n){if(!(c=fn.exec(n)))throw new Error("invalid format: "+n);var c;return new Dn({fill:c[1],align:c[2],sign:c[3],symbol:c[4],zero:c[5],width:c[6],comma:c[7],precision:c[8]&&c[8].slice(1),trim:c[9],type:c[10]})}Wn.prototype=Dn.prototype;function Dn(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}Dn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Yn(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function Gn(n,c){if((a=(n=c?n.toExponential(c-1):n.toExponential()).indexOf("e"))<0)return null;var a,s=n.slice(0,a);return[s.length>1?s[0]+s.slice(2):s,+n.slice(a+1)]}function Zn(n){return n=Gn(Math.abs(n)),n?n[1]:NaN}function vi(n,c){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Zn(c)/3)))*3-Zn(Math.abs(n)))}function Ja(n,c){return function(a,s){for(var l=a.length,d=[],x=0,A=n[0],O=0;l>0&&A>0&&(O+A+1>s&&(A=Math.max(1,s-O)),d.push(a.substring(l-=A,l+A)),!((O+=A+1)>s));)A=n[x=(x+1)%n.length];return d.reverse().join(c)}}function Ho(n){return function(c){return c.replace(/[0-9]/g,function(a){return n[+a]})}}function Nl(n){e:for(var c=n.length,a=1,s=-1,l;a<c;++a)switch(n[a]){case".":s=l=a;break;case"0":s===0&&(s=a),l=a;break;default:if(!+n[a])break e;s>0&&(s=0);break}return s>0?n.slice(0,s)+n.slice(l+1):n}var Qa;function Ra(n,c){var a=Gn(n,c);if(!a)return n+"";var s=a[0],l=a[1],d=l-(Qa=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,x=s.length;return d===x?s:d>x?s+new Array(d-x+1).join("0"):d>0?s.slice(0,d)+"."+s.slice(d):"0."+new Array(1-d).join("0")+Gn(n,Math.max(0,c+d-1))[0]}function Ns(n,c){var a=Gn(n,c);if(!a)return n+"";var s=a[0],l=a[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var qu={"%":function(n,c){return(n*100).toFixed(c)},b:function(n){return Math.round(n).toString(2)},c:function(n){return n+""},d:Yn,e:function(n,c){return n.toExponential(c)},f:function(n,c){return n.toFixed(c)},g:function(n,c){return n.toPrecision(c)},o:function(n){return Math.round(n).toString(8)},p:function(n,c){return Ns(n*100,c)},r:Ns,s:Ra,X:function(n){return Math.round(n).toString(16).toUpperCase()},x:function(n){return Math.round(n).toString(16)}};function bu(n){return n}var Kf=Array.prototype.map,ku=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function $f(n){var c=n.grouping===void 0||n.thousands===void 0?bu:Ja(Kf.call(n.grouping,Number),n.thousands+""),a=n.currency===void 0?"":n.currency[0]+"",s=n.currency===void 0?"":n.currency[1]+"",l=n.decimal===void 0?".":n.decimal+"",d=n.numerals===void 0?bu:Ho(Kf.call(n.numerals,String)),x=n.percent===void 0?"%":n.percent+"",A=n.minus===void 0?"-":n.minus+"",O=n.nan===void 0?"NaN":n.nan+"";function B($){$=Wn($);var me=$.fill,ze=$.align,ht=$.sign,Ft=$.symbol,mr=$.zero,Er=$.width,Zr=$.comma,vn=$.precision,hn=$.trim,On=$.type;On==="n"?(Zr=!0,On="g"):qu[On]||(vn===void 0&&(vn=12),hn=!0,On="g"),(mr||me==="0"&&ze==="=")&&(mr=!0,me="0",ze="=");var ii=Ft==="$"?a:Ft==="#"&&/[boxX]/.test(On)?"0"+On.toLowerCase():"",wn=Ft==="$"?s:/[%p]/.test(On)?x:"",xi=qu[On],Ji=/[defgprs%]/.test(On);vn=vn===void 0?6:/[gprs]/.test(On)?Math.max(1,Math.min(21,vn)):Math.max(0,Math.min(20,vn));function Sa(gi){var Oa=ii,eo=wn,Ks,Ff,ip;if(On==="c")eo=xi(gi)+eo,gi="";else{gi=+gi;var ap=gi<0||1/gi<0;if(gi=isNaN(gi)?O:xi(Math.abs(gi),vn),hn&&(gi=Nl(gi)),ap&&+gi==0&&ht!=="+"&&(ap=!1),Oa=(ap?ht==="("?ht:A:ht==="-"||ht==="("?"":ht)+Oa,eo=(On==="s"?ku[8+Qa/3]:"")+eo+(ap&&ht==="("?")":""),Ji){for(Ks=-1,Ff=gi.length;++Ks<Ff;)if(ip=gi.charCodeAt(Ks),48>ip||ip>57){eo=(ip===46?l+gi.slice(Ks+1):gi.slice(Ks))+eo,gi=gi.slice(0,Ks);break}}}Zr&&!mr&&(gi=c(gi,Infinity));var op=Oa.length+gi.length+eo.length,rf=op<Er?new Array(Er-op+1).join(me):"";switch(Zr&&mr&&(gi=c(rf+gi,rf.length?Er-eo.length:Infinity),rf=""),ze){case"<":gi=Oa+gi+eo+rf;break;case"=":gi=Oa+rf+gi+eo;break;case"^":gi=rf.slice(0,op=rf.length>>1)+Oa+gi+eo+rf.slice(op);break;default:gi=rf+Oa+gi+eo;break}return d(gi)}return Sa.toString=function(){return $+""},Sa}function te($,me){var ze=B(($=Wn($),$.type="f",$)),ht=Math.max(-8,Math.min(8,Math.floor(Zn(me)/3)))*3,Ft=Math.pow(10,-ht),mr=ku[8+ht/3];return function(Er){return ze(Ft*Er)+mr}}return{format:B,formatPrefix:te}}var Oc,Xc,mp;gs({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function gs(n){return Oc=$f(n),Xc=Oc.format,mp=Oc.formatPrefix,Oc}function gh(n,c){return n=Math.abs(n),c=Math.abs(c)-n,Math.max(0,Zn(c)-Zn(n))+1}function Yc(n){return Math.max(0,-Zn(Math.abs(n)))}function Gh(n,c,a,s){var l=yo(n,c,a),d;switch(s=Wn(s==null?",f":s),s.type){case"s":{var x=Math.max(Math.abs(n),Math.abs(c));return s.precision==null&&!isNaN(d=vi(l,x))&&(s.precision=d),mp(s,x)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(d=gh(l,Math.max(Math.abs(n),Math.abs(c))))&&(s.precision=d-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(d=Yc(l))&&(s.precision=d-(s.type==="%")*2);break}}return Xc(s)}function Pf(n){var c=n.domain;return n.ticks=function(a){var s=c();return Di(s[0],s[s.length-1],a==null?10:a)},n.tickFormat=function(a,s){var l=c();return Gh(l[0],l[l.length-1],a==null?10:a,s)},n.nice=function(a){a==null&&(a=10);var s=c(),l=0,d=s.length-1,x=s[l],A=s[d],O;return A<x&&(O=x,x=A,A=O,O=l,l=d,d=O),O=ra(x,A,a),O>0?(x=Math.floor(x/O)*O,A=Math.ceil(A/O)*O,O=ra(x,A,a)):O<0&&(x=Math.ceil(x*O)/O,A=Math.floor(A*O)/O,O=ra(x,A,a)),O>0?(s[l]=Math.floor(x/O)*O,s[d]=Math.ceil(A/O)*O,c(s)):O<0&&(s[l]=Math.ceil(x*O)/O,s[d]=Math.floor(A*O)/O,c(s)),n},n}function Hh(){var n=In(tt,tt);return n.copy=function(){return cn(n,Hh())},nr.apply(n,arguments),Pf(n)}function Mf(n){var c;function a(s){return isNaN(s=+s)?c:s}return a.invert=a,a.domain=a.range=function(s){return arguments.length?(n=xu.call(s,it),a):n.slice()},a.unknown=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return Mf(n).unknown(c)},n=arguments.length?xu.call(n,it):[0,1],Pf(a)}function Lc(n,c){n=n.slice();var a=0,s=n.length-1,l=n[a],d=n[s],x;return d<l&&(x=a,a=s,s=x,x=l,l=d,d=x),n[a]=c.floor(l),n[s]=c.ceil(d),n}function gp(n){return Math.log(n)}function yp(n){return Math.exp(n)}function Ed(n){return-Math.log(-n)}function Ds(n){return-Math.exp(-n)}function df(n){return isFinite(n)?+("1e"+n):n<0?0:n}function Vp(n){return n===10?df:n===Math.E?Math.exp:function(c){return Math.pow(n,c)}}function e(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),function(c){return Math.log(c)/n})}function t(n){return function(c){return-n(-c)}}function r(n){var c=n(gp,yp),a=c.domain,s=10,l,d;function x(){return l=e(s),d=Vp(s),a()[0]<0?(l=t(l),d=t(d),n(Ed,Ds)):n(gp,yp),c}return c.base=function(A){return arguments.length?(s=+A,x()):s},c.domain=function(A){return arguments.length?(a(A),x()):a()},c.ticks=function(A){var O=a(),B=O[0],te=O[O.length-1],$;($=te<B)&&(me=B,B=te,te=me);var me=l(B),ze=l(te),ht,Ft,mr,Er=A==null?10:+A,Zr=[];if(!(s%1)&&ze-me<Er){if(me=Math.round(me)-1,ze=Math.round(ze)+1,B>0){for(;me<ze;++me)for(Ft=1,ht=d(me);Ft<s;++Ft)if(mr=ht*Ft,!(mr<B)){if(mr>te)break;Zr.push(mr)}}else for(;me<ze;++me)for(Ft=s-1,ht=d(me);Ft>=1;--Ft)if(mr=ht*Ft,!(mr<B)){if(mr>te)break;Zr.push(mr)}}else Zr=Di(me,ze,Math.min(ze-me,Er)).map(d);return $?Zr.reverse():Zr},c.tickFormat=function(A,O){if(O==null&&(O=s===10?".0e":","),typeof O!="function"&&(O=Xc(O)),A===Infinity)return O;A==null&&(A=10);var B=Math.max(1,s*A/c.ticks().length);return function(te){var $=te/d(Math.round(l(te)));return $*s<s-.5&&($*=s),$<=B?O(te):""}},c.nice=function(){return a(Lc(a(),{floor:function(A){return d(Math.floor(l(A)))},ceil:function(A){return d(Math.ceil(l(A)))}}))},c}function f(){var n=r(dn()).domain([1,10]);return n.copy=function(){return cn(n,f()).base(n.base())},nr.apply(n,arguments),n}function v(n){return function(c){return Math.sign(c)*Math.log1p(Math.abs(c/n))}}function g(n){return function(c){return Math.sign(c)*Math.expm1(Math.abs(c))*n}}function S(n){var c=1,a=n(v(c),g(c));return a.constant=function(s){return arguments.length?n(v(c=+s),g(c)):c},linearish(a)}function M(){var n=S(transformer());return n.copy=function(){return copy(n,M()).constant(n.constant())},initRange.apply(n,arguments)}function z(n){return function(c){return c<0?-Math.pow(-c,n):Math.pow(c,n)}}function Y(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function J(n){return n<0?-n*n:n*n}function oe(n){var c=n(tt,tt),a=1;function s(){return a===1?n(tt,tt):a===.5?n(Y,J):n(z(a),z(1/a))}return c.exponent=function(l){return arguments.length?(a=+l,s()):a},Pf(c)}function he(){var n=oe(dn());return n.copy=function(){return cn(n,he()).exponent(n.exponent())},nr.apply(n,arguments),n}function Se(){return he.apply(null,arguments).exponent(.5)}function Ye(){var n=[],c=[],a=[],s;function l(){var x=0,A=Math.max(1,c.length);for(a=new Array(A-1);++x<A;)a[x-1]=ho(n,x/A);return d}function d(x){return isNaN(x=+x)?s:c[$r(a,x)]}return d.invertExtent=function(x){var A=c.indexOf(x);return A<0?[NaN,NaN]:[A>0?a[A-1]:n[0],A<a.length?a[A]:n[n.length-1]]},d.domain=function(x){if(!arguments.length)return n.slice();n=[];for(var A=0,O=x.length,B;A<O;++A)B=x[A],B!=null&&!isNaN(B=+B)&&n.push(B);return n.sort(tn),l()},d.range=function(x){return arguments.length?(c=He.call(x),l()):c.slice()},d.unknown=function(x){return arguments.length?(s=x,d):s},d.quantiles=function(){return a.slice()},d.copy=function(){return Ye().domain(n).range(c).unknown(s)},nr.apply(d,arguments)}function $e(){var n=0,c=1,a=1,s=[.5],l=[0,1],d;function x(O){return O<=O?l[$r(s,O,0,a)]:d}function A(){var O=-1;for(s=new Array(a);++O<a;)s[O]=((O+1)*c-(O-a)*n)/(a+1);return x}return x.domain=function(O){return arguments.length?(n=+O[0],c=+O[1],A()):[n,c]},x.range=function(O){return arguments.length?(a=(l=He.call(O)).length-1,A()):l.slice()},x.invertExtent=function(O){var B=l.indexOf(O);return B<0?[NaN,NaN]:B<1?[n,s[0]]:B>=a?[s[a-1],c]:[s[B-1],s[B]]},x.unknown=function(O){return arguments.length&&(d=O),x},x.thresholds=function(){return s.slice()},x.copy=function(){return $e().domain([n,c]).range(l).unknown(d)},nr.apply(Pf(x),arguments)}function gt(){var n=[.5],c=[0,1],a,s=1;function l(d){return d<=d?c[$r(n,d,0,s)]:a}return l.domain=function(d){return arguments.length?(n=He.call(d),s=Math.min(n.length,c.length-1),l):n.slice()},l.range=function(d){return arguments.length?(c=He.call(d),s=Math.min(n.length,c.length-1),l):c.slice()},l.invertExtent=function(d){var x=c.indexOf(d);return[n[x-1],n[x]]},l.unknown=function(d){return arguments.length?(a=d,l):a},l.copy=function(){return gt().domain(n).range(c).unknown(a)},nr.apply(l,arguments)}var nt=new Date,Lt=new Date;function Ht(n,c,a,s){function l(d){return n(d=arguments.length===0?new Date:new Date(+d)),d}return l.floor=function(d){return n(d=new Date(+d)),d},l.ceil=function(d){return n(d=new Date(d-1)),c(d,1),n(d),d},l.round=function(d){var x=l(d),A=l.ceil(d);return d-x<A-d?x:A},l.offset=function(d,x){return c(d=new Date(+d),x==null?1:Math.floor(x)),d},l.range=function(d,x,A){var O=[],B;if(d=l.ceil(d),A=A==null?1:Math.floor(A),!(d<x)||!(A>0))return O;do O.push(B=new Date(+d)),c(d,A),n(d);while(B<d&&d<x);return O},l.filter=function(d){return Ht(function(x){if(x>=x)for(;n(x),!d(x);)x.setTime(x-1)},function(x,A){if(x>=x)if(A<0)for(;++A<=0;)for(;c(x,-1),!d(x););else for(;--A>=0;)for(;c(x,1),!d(x););})},a&&(l.count=function(d,x){return nt.setTime(+d),Lt.setTime(+x),n(nt),n(Lt),Math.floor(a(nt,Lt))},l.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?l.filter(s?function(x){return s(x)%d==0}:function(x){return l.count(0,x)%d==0}):l}),l}var pr=Ht(function(n){n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,c){n.setFullYear(n.getFullYear()+c)},function(n,c){return c.getFullYear()-n.getFullYear()},function(n){return n.getFullYear()});pr.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:Ht(function(c){c.setFullYear(Math.floor(c.getFullYear()/n)*n),c.setMonth(0,1),c.setHours(0,0,0,0)},function(c,a){c.setFullYear(c.getFullYear()+a*n)})};var vr=pr,Br=pr.range,nn=Ht(function(n){n.setDate(1),n.setHours(0,0,0,0)},function(n,c){n.setMonth(n.getMonth()+c)},function(n,c){return c.getMonth()-n.getMonth()+(c.getFullYear()-n.getFullYear())*12},function(n){return n.getMonth()}),xn=nn,pi=nn.range,kn=1e3,si=6e4,jn=36e5,na=864e5,Ti=6048e5;function Jn(n){return Ht(function(c){c.setDate(c.getDate()-(c.getDay()+7-n)%7),c.setHours(0,0,0,0)},function(c,a){c.setDate(c.getDate()+a*7)},function(c,a){return(a-c-(a.getTimezoneOffset()-c.getTimezoneOffset())*si)/Ti})}var ha=Jn(0),Vi=Jn(1),Ca=Jn(2),mi=Jn(3),ba=Jn(4),Ao=Jn(5),Wo=Jn(6),Xo=ha.range,Oo=Vi.range,Qo=Ca.range,ks=mi.range,Fs=ba.range,fu=Ao.range,zs=Wo.range,Ys=Ht(function(n){n.setHours(0,0,0,0)},function(n,c){n.setDate(n.getDate()+c)},function(n,c){return(c-n-(c.getTimezoneOffset()-n.getTimezoneOffset())*si)/na},function(n){return n.getDate()-1}),Bo=Ys,Us=Ys.range,va=Ht(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*kn-n.getMinutes()*si)},function(n,c){n.setTime(+n+c*jn)},function(n,c){return(c-n)/jn},function(n){return n.getHours()}),io=va,qa=va.range,wa=Ht(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*kn)},function(n,c){n.setTime(+n+c*si)},function(n,c){return(c-n)/si},function(n){return n.getMinutes()}),hu=wa,tu=wa.range,go=Ht(function(n){n.setTime(n-n.getMilliseconds())},function(n,c){n.setTime(+n+c*kn)},function(n,c){return(c-n)/kn},function(n){return n.getUTCSeconds()}),hs=go,ru=go.range,Ta=Ht(function(){},function(n,c){n.setTime(+n+c)},function(n,c){return c-n});Ta.every=function(n){return n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?Ht(function(c){c.setTime(Math.floor(c/n)*n)},function(c,a){c.setTime(+c+a*n)},function(c,a){return(a-c)/n}):Ta};var Rc=Ta,ml=Ta.range;function Su(n){return Ht(function(c){c.setUTCDate(c.getUTCDate()-(c.getUTCDay()+7-n)%7),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCDate(c.getUTCDate()+a*7)},function(c,a){return(a-c)/Ti})}var Yo=Su(0),gl=Su(1),zl=Su(2),Jf=Su(3),Ul=Su(4),Qf=Su(5),Kc=Su(6),yh=Yo.range,_p=gl.range,_h=zl.range,Wh=Jf.range,xp=Ul.range,bp=Qf.range,vf=Kc.range,qf=Ht(function(n){n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCDate(n.getUTCDate()+c)},function(n,c){return(c-n)/na},function(n){return n.getUTCDate()-1}),If=qf,Of=qf.range,mf=Ht(function(n){n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCFullYear(n.getUTCFullYear()+c)},function(n,c){return c.getUTCFullYear()-n.getUTCFullYear()},function(n){return n.getUTCFullYear()});mf.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:Ht(function(c){c.setUTCFullYear(Math.floor(c.getUTCFullYear()/n)*n),c.setUTCMonth(0,1),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCFullYear(c.getUTCFullYear()+a*n)})};var gf=mf,Sp=mf.range;function Lf(n){if(0<=n.y&&n.y<100){var c=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return c.setFullYear(n.y),c}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function Rf(n){if(0<=n.y&&n.y<100){var c=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return c.setUTCFullYear(n.y),c}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function yf(n,c,a){return{y:n,m:c,d:a,H:0,M:0,S:0,L:0}}function xh(n){var c=n.dateTime,a=n.date,s=n.time,l=n.periods,d=n.days,x=n.shortDays,A=n.months,O=n.shortMonths,B=$c(l),te=dc(l),$=$c(d),me=dc(d),ze=$c(x),ht=dc(x),Ft=$c(A),mr=dc(A),Er=$c(O),Zr=dc(O),vn={a:ap,A:op,b:rf,B:Zg,c:null,d:Ch,e:Ch,f:Xp,g:ih,G:oh,H:Ap,I:Wp,j:wh,L:Pp,m:Yp,M:Kp,p:jg,q:Vg,Q:sd,s:ud,S:$p,u:el,U:Qh,V:kc,w:Td,W:Jp,x:null,X:null,y:Df,Y:ah,Z:sh,"%":kp},hn={a:Gg,A:Hg,b:Wg,B:Xg,c:null,d:Ip,e:Ip,f:Op,g:Th,G:tp,H:Qp,I:qp,j:ed,L:qh,m:Qc,M:td,p:Yg,q:Kg,Q:sd,s:ud,S:Lp,u:Rp,U:rd,V:nd,w:id,W:Dp,x:null,X:null,y:ad,Y:od,Z:Ad,"%":kp},On={a:Sa,A:gi,b:Oa,B:eo,c:Ks,d:Zl,e:Zl,f:Dc,g:Yh,G:wp,H:Jc,I:Jc,j:wd,L:Kh,m:qo,M:Tp,p:Ji,q:Sh,Q:Eh,s:Jh,S:Hp,u:nh,U:Ep,V:Gp,w:bh,W:Cp,x:Ff,X:ip,y:Yh,Y:wp,Z:Cd,"%":$h};vn.x=ii(a,vn),vn.X=ii(s,vn),vn.c=ii(c,vn),hn.x=ii(a,hn),hn.X=ii(s,hn),hn.c=ii(c,hn);function ii(Oi,to){return function(bo){var Hn=[],jl=-1,ps=0,vc=Oi.length,mc,Ph,ym;for(bo instanceof Date||(bo=new Date(+bo));++jl<vc;)Oi.charCodeAt(jl)===37&&(Hn.push(Oi.slice(ps,jl)),(Ph=eh[mc=Oi.charAt(++jl)])!=null?mc=Oi.charAt(++jl):Ph=mc==="e"?" ":"0",(ym=to[mc])&&(mc=ym(bo,Ph)),Hn.push(mc),ps=jl+1);return Hn.push(Oi.slice(ps,jl)),Hn.join("")}}function wn(Oi,to){return function(bo){var Hn=yf(1900,void 0,1),jl=xi(Hn,Oi,bo+="",0),ps,vc;if(jl!=bo.length)return null;if("Q"in Hn)return new Date(Hn.Q);if("s"in Hn)return new Date(Hn.s*1e3+("L"in Hn?Hn.L:0));if(to&&!("Z"in Hn)&&(Hn.Z=0),"p"in Hn&&(Hn.H=Hn.H%12+Hn.p*12),Hn.m===void 0&&(Hn.m="q"in Hn?Hn.q:0),"V"in Hn){if(Hn.V<1||Hn.V>53)return null;"w"in Hn||(Hn.w=1),"Z"in Hn?(ps=Rf(yf(Hn.y,0,1)),vc=ps.getUTCDay(),ps=vc>4||vc===0?gl.ceil(ps):gl(ps),ps=If.offset(ps,(Hn.V-1)*7),Hn.y=ps.getUTCFullYear(),Hn.m=ps.getUTCMonth(),Hn.d=ps.getUTCDate()+(Hn.w+6)%7):(ps=Lf(yf(Hn.y,0,1)),vc=ps.getDay(),ps=vc>4||vc===0?Vi.ceil(ps):Vi(ps),ps=Bo.offset(ps,(Hn.V-1)*7),Hn.y=ps.getFullYear(),Hn.m=ps.getMonth(),Hn.d=ps.getDate()+(Hn.w+6)%7)}else("W"in Hn||"U"in Hn)&&("w"in Hn||(Hn.w="u"in Hn?Hn.u%7:"W"in Hn?1:0),vc="Z"in Hn?Rf(yf(Hn.y,0,1)).getUTCDay():Lf(yf(Hn.y,0,1)).getDay(),Hn.m=0,Hn.d="W"in Hn?(Hn.w+6)%7+Hn.W*7-(vc+5)%7:Hn.w+Hn.U*7-(vc+6)%7);return"Z"in Hn?(Hn.H+=Hn.Z/100|0,Hn.M+=Hn.Z%100,Rf(Hn)):Lf(Hn)}}function xi(Oi,to,bo,Hn){for(var jl=0,ps=to.length,vc=bo.length,mc,Ph;jl<ps;){if(Hn>=vc)return-1;if(mc=to.charCodeAt(jl++),mc===37){if(mc=to.charAt(jl++),Ph=On[mc in eh?to.charAt(jl++):mc],!Ph||(Hn=Ph(Oi,bo,Hn))<0)return-1}else if(mc!=bo.charCodeAt(Hn++))return-1}return Hn}function Ji(Oi,to,bo){var Hn=B.exec(to.slice(bo));return Hn?(Oi.p=te[Hn[0].toLowerCase()],bo+Hn[0].length):-1}function Sa(Oi,to,bo){var Hn=ze.exec(to.slice(bo));return Hn?(Oi.w=ht[Hn[0].toLowerCase()],bo+Hn[0].length):-1}function gi(Oi,to,bo){var Hn=$.exec(to.slice(bo));return Hn?(Oi.w=me[Hn[0].toLowerCase()],bo+Hn[0].length):-1}function Oa(Oi,to,bo){var Hn=Er.exec(to.slice(bo));return Hn?(Oi.m=Zr[Hn[0].toLowerCase()],bo+Hn[0].length):-1}function eo(Oi,to,bo){var Hn=Ft.exec(to.slice(bo));return Hn?(Oi.m=mr[Hn[0].toLowerCase()],bo+Hn[0].length):-1}function Ks(Oi,to,bo){return xi(Oi,c,to,bo)}function Ff(Oi,to,bo){return xi(Oi,a,to,bo)}function ip(Oi,to,bo){return xi(Oi,s,to,bo)}function ap(Oi){return x[Oi.getDay()]}function op(Oi){return d[Oi.getDay()]}function rf(Oi){return O[Oi.getMonth()]}function Zg(Oi){return A[Oi.getMonth()]}function jg(Oi){return l[+(Oi.getHours()>=12)]}function Vg(Oi){return 1+~~(Oi.getMonth()/3)}function Gg(Oi){return x[Oi.getUTCDay()]}function Hg(Oi){return d[Oi.getUTCDay()]}function Wg(Oi){return O[Oi.getUTCMonth()]}function Xg(Oi){return A[Oi.getUTCMonth()]}function Yg(Oi){return l[+(Oi.getUTCHours()>=12)]}function Kg(Oi){return 1+~~(Oi.getUTCMonth()/3)}return{format:function(Oi){var to=ii(Oi+="",vn);return to.toString=function(){return Oi},to},parse:function(Oi){var to=wn(Oi+="",!1);return to.toString=function(){return Oi},to},utcFormat:function(Oi){var to=ii(Oi+="",hn);return to.toString=function(){return Oi},to},utcParse:function(Oi){var to=wn(Oi+="",!0);return to.toString=function(){return Oi},to}}}var eh={"-":"",_:" ","0":"0"},Es=/^\s*\d+/,Xh=/^%/,th=/[\\^$*+?|[\]().{}]/g;function Ha(n,c,a){var s=n<0?"-":"",l=(s?-n:n)+"",d=l.length;return s+(d<a?new Array(a-d+1).join(c)+l:l)}function rh(n){return n.replace(th,"\\$&")}function $c(n){return new RegExp("^(?:"+n.map(rh).join("|")+")","i")}function dc(n){for(var c={},a=-1,s=n.length;++a<s;)c[n[a].toLowerCase()]=a;return c}function bh(n,c,a){var s=Es.exec(c.slice(a,a+1));return s?(n.w=+s[0],a+s[0].length):-1}function nh(n,c,a){var s=Es.exec(c.slice(a,a+1));return s?(n.u=+s[0],a+s[0].length):-1}function Ep(n,c,a){var s=Es.exec(c.slice(a,a+2));return s?(n.U=+s[0],a+s[0].length):-1}function Gp(n,c,a){var s=Es.exec(c.slice(a,a+2));return s?(n.V=+s[0],a+s[0].length):-1}function Cp(n,c,a){var s=Es.exec(c.slice(a,a+2));return s?(n.W=+s[0],a+s[0].length):-1}function wp(n,c,a){var s=Es.exec(c.slice(a,a+4));return s?(n.y=+s[0],a+s[0].length):-1}function Yh(n,c,a){var s=Es.exec(c.slice(a,a+2));return s?(n.y=+s[0]+(+s[0]>68?1900:2e3),a+s[0].length):-1}function Cd(n,c,a){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(c.slice(a,a+6));return s?(n.Z=s[1]?0:-(s[2]+(s[3]||"00")),a+s[0].length):-1}function Sh(n,c,a){var s=Es.exec(c.slice(a,a+1));return s?(n.q=s[0]*3-3,a+s[0].length):-1}function qo(n,c,a){var s=Es.exec(c.slice(a,a+2));return s?(n.m=s[0]-1,a+s[0].length):-1}function Zl(n,c,a){var s=Es.exec(c.slice(a,a+2));return s?(n.d=+s[0],a+s[0].length):-1}function wd(n,c,a){var s=Es.exec(c.slice(a,a+3));return s?(n.m=0,n.d=+s[0],a+s[0].length):-1}function Jc(n,c,a){var s=Es.exec(c.slice(a,a+2));return s?(n.H=+s[0],a+s[0].length):-1}function Tp(n,c,a){var s=Es.exec(c.slice(a,a+2));return s?(n.M=+s[0],a+s[0].length):-1}function Hp(n,c,a){var s=Es.exec(c.slice(a,a+2));return s?(n.S=+s[0],a+s[0].length):-1}function Kh(n,c,a){var s=Es.exec(c.slice(a,a+3));return s?(n.L=+s[0],a+s[0].length):-1}function Dc(n,c,a){var s=Es.exec(c.slice(a,a+6));return s?(n.L=Math.floor(s[0]/1e3),a+s[0].length):-1}function $h(n,c,a){var s=Xh.exec(c.slice(a,a+1));return s?a+s[0].length:-1}function Eh(n,c,a){var s=Es.exec(c.slice(a));return s?(n.Q=+s[0],a+s[0].length):-1}function Jh(n,c,a){var s=Es.exec(c.slice(a));return s?(n.s=+s[0],a+s[0].length):-1}function Ch(n,c){return Ha(n.getDate(),c,2)}function Ap(n,c){return Ha(n.getHours(),c,2)}function Wp(n,c){return Ha(n.getHours()%12||12,c,2)}function wh(n,c){return Ha(1+Bo.count(vr(n),n),c,3)}function Pp(n,c){return Ha(n.getMilliseconds(),c,3)}function Xp(n,c){return Pp(n,c)+"000"}function Yp(n,c){return Ha(n.getMonth()+1,c,2)}function Kp(n,c){return Ha(n.getMinutes(),c,2)}function $p(n,c){return Ha(n.getSeconds(),c,2)}function el(n){var c=n.getDay();return c===0?7:c}function Qh(n,c){return Ha(ha.count(vr(n)-1,n),c,2)}function Mp(n){var c=n.getDay();return c>=4||c===0?ba(n):ba.ceil(n)}function kc(n,c){return n=Mp(n),Ha(ba.count(vr(n),n)+(vr(n).getDay()===4),c,2)}function Td(n){return n.getDay()}function Jp(n,c){return Ha(Vi.count(vr(n)-1,n),c,2)}function Df(n,c){return Ha(n.getFullYear()%100,c,2)}function ih(n,c){return n=Mp(n),Ha(n.getFullYear()%100,c,2)}function ah(n,c){return Ha(n.getFullYear()%1e4,c,4)}function oh(n,c){var a=n.getDay();return n=a>=4||a===0?ba(n):ba.ceil(n),Ha(n.getFullYear()%1e4,c,4)}function sh(n){var c=n.getTimezoneOffset();return(c>0?"-":(c*=-1,"+"))+Ha(c/60|0,"0",2)+Ha(c%60,"0",2)}function Ip(n,c){return Ha(n.getUTCDate(),c,2)}function Qp(n,c){return Ha(n.getUTCHours(),c,2)}function qp(n,c){return Ha(n.getUTCHours()%12||12,c,2)}function ed(n,c){return Ha(1+If.count(gf(n),n),c,3)}function qh(n,c){return Ha(n.getUTCMilliseconds(),c,3)}function Op(n,c){return qh(n,c)+"000"}function Qc(n,c){return Ha(n.getUTCMonth()+1,c,2)}function td(n,c){return Ha(n.getUTCMinutes(),c,2)}function Lp(n,c){return Ha(n.getUTCSeconds(),c,2)}function Rp(n){var c=n.getUTCDay();return c===0?7:c}function rd(n,c){return Ha(Yo.count(gf(n)-1,n),c,2)}function ep(n){var c=n.getUTCDay();return c>=4||c===0?Ul(n):Ul.ceil(n)}function nd(n,c){return n=ep(n),Ha(Ul.count(gf(n),n)+(gf(n).getUTCDay()===4),c,2)}function id(n){return n.getUTCDay()}function Dp(n,c){return Ha(gl.count(gf(n)-1,n),c,2)}function ad(n,c){return Ha(n.getUTCFullYear()%100,c,2)}function Th(n,c){return n=ep(n),Ha(n.getUTCFullYear()%100,c,2)}function od(n,c){return Ha(n.getUTCFullYear()%1e4,c,4)}function tp(n,c){var a=n.getUTCDay();return n=a>=4||a===0?Ul(n):Ul.ceil(n),Ha(n.getUTCFullYear()%1e4,c,4)}function Ad(){return"+0000"}function kp(){return"%"}function sd(n){return+n}function ud(n){return Math.floor(+n/1e3)}var uh,ld,Pd,Md,Id;Od({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Od(n){return uh=xh(n),ld=uh.format,Pd=uh.parse,Md=uh.utcFormat,Id=uh.utcParse,uh}var tl=1e3,_f=tl*60,lh=_f*60,qc=lh*24,cd=qc*7,Zd=qc*30,Ld=qc*365;function _m(n){return new Date(n)}function xm(n){return n instanceof Date?+n:+new Date(+n)}function jd(n,c,a,s,l,d,x,A,O){var B=In(tt,tt),te=B.invert,$=B.domain,me=O(".%L"),ze=O(":%S"),ht=O("%I:%M"),Ft=O("%I %p"),mr=O("%a %d"),Er=O("%b %d"),Zr=O("%B"),vn=O("%Y"),hn=[[x,1,tl],[x,5,5*tl],[x,15,15*tl],[x,30,30*tl],[d,1,_f],[d,5,5*_f],[d,15,15*_f],[d,30,30*_f],[l,1,lh],[l,3,3*lh],[l,6,6*lh],[l,12,12*lh],[s,1,qc],[s,2,2*qc],[a,1,cd],[c,1,Zd],[c,3,3*Zd],[n,1,Ld]];function On(wn){return(x(wn)<wn?me:d(wn)<wn?ze:l(wn)<wn?ht:s(wn)<wn?Ft:c(wn)<wn?a(wn)<wn?mr:Er:n(wn)<wn?Zr:vn)(wn)}function ii(wn,xi,Ji,Sa){if(wn==null&&(wn=10),typeof wn=="number"){var gi=Math.abs(Ji-xi)/wn,Oa=li(function(eo){return eo[2]}).right(hn,gi);Oa===hn.length?(Sa=yo(xi/Ld,Ji/Ld,wn),wn=n):Oa?(Oa=hn[gi/hn[Oa-1][2]<hn[Oa][2]/gi?Oa-1:Oa],Sa=Oa[1],wn=Oa[0]):(Sa=Math.max(yo(xi,Ji,wn),1),wn=A)}return Sa==null?wn:wn.every(Sa)}return B.invert=function(wn){return new Date(te(wn))},B.domain=function(wn){return arguments.length?$(xu.call(wn,xm)):$().map(_m)},B.ticks=function(wn,xi){var Ji=$(),Sa=Ji[0],gi=Ji[Ji.length-1],Oa=gi<Sa,eo;return Oa&&(eo=Sa,Sa=gi,gi=eo),eo=ii(wn,Sa,gi,xi),eo=eo?eo.range(Sa,gi+1):[],Oa?eo.reverse():eo},B.tickFormat=function(wn,xi){return xi==null?On:O(xi)},B.nice=function(wn,xi){var Ji=$();return(wn=ii(wn,Ji[0],Ji[Ji.length-1],xi))?$(Lc(Ji,wn)):B},B.copy=function(){return cn(B,jd(n,c,a,s,l,d,x,A,O))},B}function bm(){return nr.apply(jd(vr,xn,ha,Bo,io,hu,hs,Rc,ld).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function $g(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function fd(){var n=0,c=1,a,s,l,d,x=identity,A=!1,O;function B(te){return isNaN(te=+te)?O:x(l===0?.5:(te=(d(te)-a)*l,A?Math.max(0,Math.min(1,te)):te))}return B.domain=function(te){return arguments.length?(a=d(n=+te[0]),s=d(c=+te[1]),l=a===s?0:1/(s-a),B):[n,c]},B.clamp=function(te){return arguments.length?(A=!!te,B):A},B.interpolator=function(te){return arguments.length?(x=te,B):x},B.unknown=function(te){return arguments.length?(O=te,B):O},function(te){return d=te,a=te(n),s=te(c),l=a===s?0:1/(s-a),B}}function hd(n,c){return c.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function Sm(){var n=linearish(fd()(identity));return n.copy=function(){return hd(n,Sm())},initInterpolator.apply(n,arguments)}function Em(){var n=loggish(fd()).domain([1,10]);return n.copy=function(){return hd(n,Em()).base(n.base())},initInterpolator.apply(n,arguments)}function Cm(){var n=symlogish(fd());return n.copy=function(){return hd(n,Cm()).constant(n.constant())},initInterpolator.apply(n,arguments)}function Vd(){var n=powish(fd());return n.copy=function(){return hd(n,Vd()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function Jg(){return Vd.apply(null,arguments).exponent(.5)}function wm(){var n=[],c=identity;function a(s){if(!isNaN(s=+s))return c((bisect(n,s)-1)/(n.length-1))}return a.domain=function(s){if(!arguments.length)return n.slice();n=[];for(var l=0,d=s.length,x;l<d;++l)x=s[l],x!=null&&!isNaN(x=+x)&&n.push(x);return n.sort(ascending),a},a.interpolator=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return wm(c).domain(n)},initInterpolator.apply(a,arguments)}function pd(){var n=0,c=.5,a=1,s,l,d,x,A,O=identity,B,te=!1,$;function me(ze){return isNaN(ze=+ze)?$:(ze=.5+((ze=+B(ze))-l)*(ze<l?x:A),O(te?Math.max(0,Math.min(1,ze)):ze))}return me.domain=function(ze){return arguments.length?(s=B(n=+ze[0]),l=B(c=+ze[1]),d=B(a=+ze[2]),x=s===l?0:.5/(l-s),A=l===d?0:.5/(d-l),me):[n,c,a]},me.clamp=function(ze){return arguments.length?(te=!!ze,me):te},me.interpolator=function(ze){return arguments.length?(O=ze,me):O},me.unknown=function(ze){return arguments.length?($=ze,me):$},function(ze){return B=ze,s=ze(n),l=ze(c),d=ze(a),x=s===l?0:.5/(l-s),A=l===d?0:.5/(d-l),me}}function Tm(){var n=linearish(pd()(identity));return n.copy=function(){return copy(n,Tm())},initInterpolator.apply(n,arguments)}function Am(){var n=loggish(pd()).domain([.1,1,10]);return n.copy=function(){return copy(n,Am()).base(n.base())},initInterpolator.apply(n,arguments)}function Pm(){var n=symlogish(pd());return n.copy=function(){return copy(n,Pm()).constant(n.constant())},initInterpolator.apply(n,arguments)}function Gd(){var n=powish(pd());return n.copy=function(){return copy(n,Gd()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function Qg(){return Gd.apply(null,arguments).exponent(.5)}var ef,Hd,Wd,Xd,Rd,Yd,Mm=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Im=(ef={},(0,I.Z)(ef,E.ScaleTypes.LINEAR,Hh),(0,I.Z)(ef,E.ScaleTypes.POWER,he),(0,I.Z)(ef,E.ScaleTypes.LOG,f),(0,I.Z)(ef,E.ScaleTypes.IDENTITY,Mf),(0,I.Z)(ef,E.ScaleTypes.TIME,bm),(0,I.Z)(ef,E.ScaleTypes.QUANTILE,Ye),(0,I.Z)(ef,E.ScaleTypes.QUANTIZE,$e),(0,I.Z)(ef,E.ScaleTypes.THRESHOLD,gt),(0,I.Z)(ef,E.ScaleTypes.CAT,ua),ef),Om=(Hd=(0,Ve.b2)(),Wd=(0,Ve.f3)(E.vK.IGlobalConfigService),Hd(Xd=(Rd=function(){function n(){(0,V.Z)(this,n),(0,Bi.Z)(this,"configService",Yd,this),(0,I.Z)(this,"scaleCache",{}),(0,I.Z)(this,"scaleOptions",{})}return(0,G.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var x=d.getLayerStyleAttributes(),A=a.getSource().data.dataArray;A.length!==0&&l.caculateScalesForAttributes(x||[],A)}),a.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var x=d.getLayerStyleAttributes(),A=a.getSource().data.dataArray;return l.caculateScalesForAttributes(x||[],A),a.layerModelNeedUpdate=!0,!0}),a.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!a.layerModelNeedUpdate){l.scaleOptions=a.getScaleOptions();var x=d.getLayerStyleAttributes();if(x){var A=a.getSource().data.dataArray;if(A.length===0)return;var O=x.filter(function(B){return B.needRescale});O.length&&l.caculateScalesForAttributes(O,A)}}})}},{key:"isNumber",value:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}},{key:"caculateScalesForAttributes",value:function(a,s){var l=this;this.scaleCache={},a.forEach(function(d){if(d.scale){var x=d.scale,A=d.name;x.names=l.parseFields(d.scale.field||[]);var O=[];x.names.forEach(function(B){O.push(l.getOrCreateScale(B,d,s))}),O.some(function(B){return B.type===E.StyleScaleType.VARIABLE})?(x.type=E.StyleScaleType.VARIABLE,O.forEach(function(B){if(!x.callback){var te;if(x.values&&x.values!=="text"){var $;if((($=B.option)===null||$===void 0?void 0:$.type)==="linear"&&x.values.length>2){var me=B.scale.ticks(x.values.length);A==="color"&&B.scale.domain(me)}B.scale.range(x.values)}else((te=B.option)===null||te===void 0?void 0:te.type)==="cat"&&B.scale.range(B.option.domain)}})):(x.type=E.StyleScaleType.CONSTANT,x.defaultValues=O.map(function(B,te){return B.scale(x.names[te])})),x.scalers=O.map(function(B){return{field:B.field,func:B.scale,option:B.option}}),d.needRescale=!1}})}},{key:"getOrCreateScale",value:function(a,s,l){var d,x=[a,s.name].join("_"),A=(d=s.scale)===null||d===void 0?void 0:d.values,O=this.createScale(a,s.name,A,l);return O}},{key:"parseFields",value:function(a){return Array.isArray(a)?a:Fa()(a)?a.split("*"):[a]}},{key:"createScale",value:function(a,s,l,d){var x,A,O=this.scaleOptions[s]&&((x=this.scaleOptions[s])===null||x===void 0?void 0:x.field)===a?this.scaleOptions[s]:this.scaleOptions[a],B={field:a,scale:void 0,type:E.StyleScaleType.VARIABLE,option:O};if(!d||!d.length)return O&&O.type?B.scale=this.createDefaultScale(O):(B.scale=ua([a]),B.type=E.StyleScaleType.CONSTANT),B;var te=(A=d.find(function(ze){return!Sn()(ze[a])}))===null||A===void 0?void 0:A[a];if(this.isNumber(a)||Sn()(te)&&!O)B.scale=ua([a]),B.type=E.StyleScaleType.CONSTANT;else{var $=O&&O.type||this.getDefaultType(te);l==="text"&&($=E.ScaleTypes.CAT);var me=this.createDefaultScaleConfig($,a,d);Object.assign(me,O),B.scale=this.createDefaultScale(me),B.option=me}return B}},{key:"getDefaultType",value:function(a){var s=E.ScaleTypes.LINEAR;return typeof a=="string"&&(s=Mm.test(a)?E.ScaleTypes.TIME:E.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(a,s,l){var d={type:a},x=(l==null?void 0:l.map(function(A){return A[s]}))||[];return a!==E.ScaleTypes.CAT&&a!==E.ScaleTypes.QUANTILE?d.domain=An(x):a===E.ScaleTypes.CAT?d.domain=Ln()(x):a===E.ScaleTypes.QUANTILE&&(d.domain=x),d}},{key:"createDefaultScale",value:function(a){var s=a.type,l=a.domain,d=Im[s]();return l&&d.domain(l),d}}]),n}(),Yd=(0,ai.Z)(Rd.prototype,"configService",[Wd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd))||Xd),Kd,$d,Jd,Qd,dd,qd,ev;function tv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Lm(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?tv(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):tv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Rm=(Kd=(0,Ve.b2)(),$d=(0,Ve.f3)(E.vK.ICameraService),Jd=(0,Ve.f3)(E.vK.IRendererService),Kd(Qd=(dd=function(){function n(){(0,V.Z)(this,n),(0,Bi.Z)(this,"cameraService",qd,this),(0,Bi.Z)(this,"rendererService",ev,this)}return(0,G.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){a.models.forEach(function(s){s.addUniforms(Lm({},a.layerModel.getAnimateUniforms()))})})}}]),n}(),qd=(0,ai.Z)(dd.prototype,"cameraService",[$d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ev=(0,ai.Z)(dd.prototype,"rendererService",[Jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dd))||Qd),rv,nv,Dm=(rv=(0,Ve.b2)(),rv(nv=function(){function n(){(0,V.Z)(this,n)}return(0,G.Z)(n,[{key:"apply",value:function(a){a.hooks.init.tap("LayerModelPlugin",function(){a.prepareBuildModel(),a.buildModels(),a.styleNeedUpdate=!1}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return a.prepareBuildModel(),a.clearModels(),a.buildModels(),a.layerModelNeedUpdate=!1,!1})}}]),n}())||nv),iv,av,km=(iv=(0,Ve.b2)(),iv(av=function(){function n(){(0,V.Z)(this,n)}return(0,G.Z)(n,[{key:"apply",value:function(a){a.hooks.afterInit.tap("LayerStylePlugin",function(){a.updateLayerConfig({});var s=a.getLayerConfig(),l=s.autoFit,d=s.fitBoundsOptions;l&&setTimeout(function(){a.fitBounds(d)},100)})}}]),n}())||av),ov,sv;function uv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Fp(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?uv(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):uv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var lv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Fm={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Bm={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Nm={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},qg=null;function zm(n){var c={u_DirectionalLights:new Array(3).fill(Fp({},Bm)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Fp({},Nm)),u_NumOfSpotLights:0};return(!n||!n.length)&&(n=[Fm]),n.forEach(function(a,s){var l=a.type,d=l===void 0?"directional":l,x=(0,la.Z)(a,["type"]),A=lv[d].lights,O=lv[d].num,B=c[O];c[A][B]=Fp(Fp({},c[A][B]),x),c[O]++}),c}var Um=(ov=(0,Ve.b2)(),ov(sv=function(){function n(){(0,V.Z)(this,n)}return(0,G.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LightingPlugin",function(){var s=a.getLayerConfig(),l=s.enableLighting;l&&a.models.forEach(function(d){return d.addUniforms(Fp({},zm()))})})}}]),n}())||sv),cv,fv,vd={NONE:0,ENCODE:1,HIGHLIGHT:2},Zm=(cv=(0,Ve.b2)(),cv(fv=function(){function n(){(0,V.Z)(this,n)}return(0,G.Z)(n,[{key:"apply",value:function(a,s){var l=s.rendererService,d=s.styleAttributeService;a.hooks.init.tap("PixelPickingPlugin",function(){var x=a.getLayerConfig(),A=x.enablePicking;d.registerStyleAttribute({name:"pickingColor",type:E.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:E.gl.FLOAT},size:3,update:function(B,te){var $=B.id;return A?(0,Je.Z6)($):[0,0,0]}}})}),a.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var x=a.getLayerConfig(),A=x.enablePicking;A&&a.isVisible()&&a.models.forEach(function(O){return O.addUniforms({u_PickingStage:vd.ENCODE})})}),a.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var x=a.getLayerConfig(),A=x.enablePicking;A&&a.isVisible()&&a.models.forEach(function(O){return O.addUniforms({u_PickingStage:vd.HIGHLIGHT})})}),a.hooks.beforeHighlight.tap("PixelPickingPlugin",function(x){var A=a.getLayerConfig(),O=A.highlightColor,B=typeof O=="string"?(0,Je.CI)(O):O||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,Je.W0)(new Uint8Array(x))}),a.models.forEach(function(te){return te.addUniforms({u_PickingStage:vd.HIGHLIGHT,u_PickingColor:x,u_HighlightColor:B.map(function($){return $*255})})})}),a.hooks.beforeSelect.tap("PixelPickingPlugin",function(x){var A=a.getLayerConfig(),O=A.selectColor,B=typeof O=="string"?(0,Je.CI)(O):O||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,Je.W0)(new Uint8Array(x))}),a.models.forEach(function(te){return te.addUniforms({u_PickingStage:vd.HIGHLIGHT,u_PickingColor:x,u_HighlightColor:B.map(function($){return $*255})})})})}}]),n}())||fv),hv,pv,jm=(hv=(0,Ve.b2)(),hv(pv=function(){function n(){(0,V.Z)(this,n)}return(0,G.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(d)})}},{key:"registerBuiltinAttributes",value:function(a){a.registerStyleAttribute({name:"position",type:E.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:E.gl.FLOAT},size:3,update:function(l,d,x){return x.length===2?[x[0],x[1],0]:[x[0],x[1],x[2]]}}}),a.registerStyleAttribute({name:"filter",type:E.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(l,d){var x=l.filter;return x?[1]:[0]}}}),a.registerStyleAttribute({name:"color",type:E.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(l,d){var x=l.color;return!x||!x.length?[1,1,1,1]:x}}}),a.registerStyleAttribute({name:"vertexId",type:E.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(l,d,x,A){return[d]}}})}}]),n}())||pv),dv,vv,mv,gv,yv,_v,rp,xv,bv,Sv,Ev,Vm=(dv=(0,Ve.b2)(),vv=(0,Ve.f3)(E.vK.ICameraService),mv=(0,Ve.f3)(E.vK.ICoordinateSystemService),gv=(0,Ve.f3)(E.vK.IRendererService),yv=(0,Ve.f3)(E.vK.IMapService),dv(_v=(rp=function(){function n(){(0,V.Z)(this,n),(0,Bi.Z)(this,"cameraService",xv,this),(0,Bi.Z)(this,"coordinateSystemService",bv,this),(0,Bi.Z)(this,"rendererService",Sv,this),(0,Bi.Z)(this,"mapService",Ev,this)}return(0,G.Z)(n,[{key:"apply",value:function(a){var s=this,l=this.mapService.version,d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],x=[0,0];a.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(d=s.mapService.map.customCoords.getMVPMatrix(),x=s.mapService.getCustomCoordCenter());var A=s.rendererService.getViewportSize(),O=A.width,B=A.height;a.models.forEach(function(te){var $;te.addUniforms(($={},(0,I.Z)($,E.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,I.Z)($,E.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,I.Z)($,E.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,I.Z)($,E.CameraUniform.Zoom,s.cameraService.getZoom()),(0,I.Z)($,E.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,I.Z)($,E.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,I.Z)($,E.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,I.Z)($,E.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,I.Z)($,E.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,I.Z)($,E.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,I.Z)($,E.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,I.Z)($,E.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,I.Z)($,E.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,I.Z)($,E.CoordinateUniform.Mvp,d),(0,I.Z)($,"u_SceneCenterMKT",x),(0,I.Z)($,"u_ViewportSize",[O,B]),(0,I.Z)($,"u_DevicePixelRatio",window.devicePixelRatio),(0,I.Z)($,"u_ModelMatrix",s.cameraService.getModelMatrix()),(0,I.Z)($,"u_PickingBuffer",a.getLayerConfig().pickingBuffer||0),$))})})}}]),n}(),xv=(0,ai.Z)(rp.prototype,"cameraService",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bv=(0,ai.Z)(rp.prototype,"coordinateSystemService",[mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sv=(0,ai.Z)(rp.prototype,"rendererService",[gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ev=(0,ai.Z)(rp.prototype,"mapService",[yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rp))||_v),Cv,wv,Gm=(Cv=(0,Ve.b2)(),Cv(wv=function(){function n(){(0,V.Z)(this,n)}return(0,G.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("UpdateModelPlugin",function(){a.layerModel&&a.layerModel.needUpdate()})}}]),n}())||wv),Tv,Av,Hm=(Tv=(0,Ve.b2)(),Tv(Av=function(){function n(){(0,V.Z)(this,n)}return(0,G.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(a,{styleAttributeService:d})}),a.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){a.layerModelNeedUpdate||l.updateStyleAtrribute(a,{styleAttributeService:d})})}},{key:"updateStyleAtrribute",value:function(a,s){var l=s.styleAttributeService,d=l.getLayerStyleAttributes()||[],x=l.getLayerStyleAttribute("filter"),A=l.getLayerStyleAttribute("shape");if(x&&x.needRegenerateVertices||A&&A.needRegenerateVertices){a.layerModelNeedUpdate=!0,d.forEach(function(O){return O.needRegenerateVertices=!1});return}d.filter(function(O){return O.needRegenerateVertices}).forEach(function(O){l.updateAttributeByFeatureRange(O.name,a.getEncodedData(),O.featureRange.startIndex,O.featureRange.endIndex),O.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(a,s){var l=s.styleAttributeService,d=l.getLayerStyleAttributes()||[];d.filter(function(x){return x.needRegenerateVertices}).forEach(function(x){l.updateAttributeByFeatureRange(x.name,a.getEncodedData(),x.featureRange.startIndex,x.featureRange.endIndex),x.needRegenerateVertices=!1})}}]),n}())||Av);E.nC.bind(E.vK.ILayerPlugin).to(_r).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(jm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Om).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Ju).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(km).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Hm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Gm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Wa).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Vm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Rm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Um).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Zm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Dm).inRequestScope();var ey="2.5.30";function Pv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ty(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Pv(Object(a),!0).forEach(function(s){Wm(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Pv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Wm(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function ry(n,c){return $m(n)||Km(n,c)||Ym(n,c)||Xm()}function Xm(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ym(n,c){if(!!n){if(typeof n=="string")return Mv(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Mv(n,c)}}function Mv(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Km(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function $m(n){if(Array.isArray(n))return n}var ny=null,iy=null,Iv,Dd,Ov;function Lv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Rv(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Lv(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Lv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Jm=(Iv=(0,E.yT)(E.vK.IGlobalConfigService),Dd=function(){function n(c){(0,V.Z)(this,n),(0,Bi.Z)(this,"configService",Ov,this),(0,I.Z)(this,"config",void 0),this.config=c}return(0,G.Z)(n,[{key:"setContainer",value:function(a,s){a.bind(E.vK.MapConfig).toConstantValue(Rv(Rv({},this.config),{},{id:s})),a.bind(E.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),n}(),Ov=(0,ai.Z)(Dd.prototype,"configService",[Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dd),Qm=y(6158),qm=y.n(Qm),kd;(function(n){n["GAODE1.x"]="GAODE1.x",n["GAODE2.x"]="GAODE2.x",n.MAPBOX="MAPBOX",n.L7MAP="L7MAP",n.GLOBEL="GLOBEL"})(kd||(kd={}));function Bp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function md(n,c){var a=h.fF([],c,n);return h.bA(a,a,1/a[3]),a}function ay(n,c){var a=n%c;return a<0?c+a:a}function oy(n,c,a){return a*c+(1-a)*n}function Ah(n,c){if(!n)throw new Error(c||"viewport-mercator-project: assertion failed.")}var tf=Math.PI,Dv=tf/4,kf=tf/180,kv=180/tf,Fd=512,Bd=4003e4,e0=1.5;function Fv(n){return Math.pow(2,n)}function t0(n){return Math.log2(n)}function gd(n,c){var a=(0,Z.Z)(n,2),s=a[0],l=a[1];Ah(Number.isFinite(s)&&Number.isFinite(c)),Ah(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),c*=Fd;var d=s*kf,x=l*kf,A=c*(d+tf)/(2*tf),O=c*(tf-Math.log(Math.tan(Dv+x*.5)))/(2*tf);return[A,O]}function Nd(n,c){var a=(0,Z.Z)(n,2),s=a[0],l=a[1];c*=Fd;var d=s/c*(2*tf)-tf,x=2*(Math.atan(Math.exp(tf-l/c*(2*tf)))-Dv);return[d*kv,x*kv]}function sy(n){var c=n.latitude;assert(Number.isFinite(c));var a=Math.cos(c*kf);return t0(Bd*a)-9}function Bv(n){var c=n.latitude,a=n.longitude,s=n.zoom,l=n.scale,d=n.highPrecision,x=d===void 0?!1:d;l=l!==void 0?l:Fv(s),Ah(Number.isFinite(c)&&Number.isFinite(a)&&Number.isFinite(l));var A={},O=Fd*l,B=Math.cos(c*kf),te=O/360,$=te/B,me=O/Bd/B;if(A.pixelsPerMeter=[me,-me,me],A.metersPerPixel=[1/me,-1/me,1/me],A.pixelsPerDegree=[te,-$,me],A.degreesPerPixel=[1/te,-1/$,1/me],x){var ze=kf*Math.tan(c*kf)/B,ht=te*ze/2,Ft=O/Bd*ze,mr=Ft/$*me;A.pixelsPerDegree2=[0,-ht,Ft],A.pixelsPerMeter2=[mr,0,mr]}return A}function uy(n,c){var a=_slicedToArray(n,3),s=a[0],l=a[1],d=a[2],x=_slicedToArray(c,3),A=x[0],O=x[1],B=x[2],te=1,$=Bv({longitude:s,latitude:l,scale:te,highPrecision:!0}),me=$.pixelsPerMeter,ze=$.pixelsPerMeter2,ht=gd(n,te);ht[0]+=A*(me[0]+ze[0]*O),ht[1]+=O*(me[1]+ze[1]*O);var Ft=Nd(ht,te),mr=(d||0)+(B||0);return Number.isFinite(d)||Number.isFinite(B)?[Ft[0],Ft[1],mr]:Ft}function r0(n){var c=n.height,a=n.pitch,s=n.bearing,l=n.altitude,d=n.center,x=d===void 0?null:d,A=n.flipY,O=A===void 0?!1:A,B=Bp();return Va.translate(B,B,[0,0,-l]),Va.scale(B,B,[1,1,1/c]),Va.rotateX(B,B,-a*kf),Va.rotateZ(B,B,s*kf),O&&Va.scale(B,B,[1,-1,1]),x&&Va.translate(B,B,Yi.negate([],x)),B}function n0(n){var c=n.width,a=n.height,s=n.altitude,l=s===void 0?e0:s,d=n.pitch,x=d===void 0?0:d,A=n.nearZMultiplier,O=A===void 0?1:A,B=n.farZMultiplier,te=B===void 0?1:B,$=x*kf,me=Math.atan(.5/l),ze=Math.sin(me)*l/Math.sin(Math.PI/2-$-me),ht=Math.cos(Math.PI/2-$)*ze+l;return{fov:2*Math.atan(a/2/l),aspect:c/a,focalDistance:l,near:O,far:ht*te}}function i0(n){var c=n.width,a=n.height,s=n.pitch,l=n.altitude,d=n.nearZMultiplier,x=n.farZMultiplier,A=n0({width:c,height:a,altitude:l,pitch:s,nearZMultiplier:d,farZMultiplier:x}),O=A.fov,B=A.aspect,te=A.near,$=A.far,me=Va.perspective([],O,B,te,$);return me}function a0(n,c){var a=(0,Z.Z)(n,3),s=a[0],l=a[1],d=a[2],x=d===void 0?0:d;return Ah(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(x)),md(c,[s,l,x,1])}function Nv(n,c){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,Z.Z)(n,3),l=s[0],d=s[1],x=s[2];if(Ah(Number.isFinite(l)&&Number.isFinite(d),"invalid pixel coordinate"),Number.isFinite(x)){var A=md(c,[l,d,x,1]);return A}var O=md(c,[l,d,0,1]),B=md(c,[l,d,1,1]),te=O[2],$=B[2],me=te===$?0:((a||0)-te)/($-te);return ye.t7([],O,B,me)}var zv=Bp(),o0=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=c.width,s=c.height,l=c.viewMatrix,d=l===void 0?zv:l,x=c.projectionMatrix,A=x===void 0?zv:x;(0,V.Z)(this,n),this.width=a||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=d,this.projectionMatrix=A;var O=Bp();Va.multiply(O,O,this.projectionMatrix),Va.multiply(O,O,this.viewMatrix),this.viewProjectionMatrix=O;var B=Bp();Va.scale(B,B,[this.width/2,-this.height/2,1]),Va.translate(B,B,[1,-1,0]),Va.multiply(B,B,this.viewProjectionMatrix);var te=Va.invert(Bp(),B);if(!te)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=B,this.pixelUnprojectionMatrix=te,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,G.Z)(n,[{key:"equals",value:function(a){return a instanceof n?a.width===this.width&&a.height===this.height&&Va.equals(a.projectionMatrix,this.projectionMatrix)&&Va.equals(a.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,x=this.projectPosition(a),A=a0(x,this.pixelProjectionMatrix),O=(0,Z.Z)(A,2),B=O[0],te=O[1],$=d?te:this.height-te;return a.length===2?[B,$]:[B,$,A[2]]}},{key:"unproject",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,x=s.targetZ,A=(0,Z.Z)(a,3),O=A[0],B=A[1],te=A[2],$=d?B:this.height-B,me=x&&x*this.pixelsPerMeter,ze=Nv([O,$,te],this.pixelUnprojectionMatrix,me),ht=this.unprojectPosition(ze),Ft=(0,Z.Z)(ht,3),mr=Ft[0],Er=Ft[1],Zr=Ft[2];return Number.isFinite(te)?[mr,Er,Zr]:Number.isFinite(x)?[mr,Er,x]:[mr,Er]}},{key:"projectPosition",value:function(a){var s=this.projectFlat(a),l=(0,Z.Z)(s,2),d=l[0],x=l[1],A=(a[2]||0)*this.pixelsPerMeter;return[d,x,A]}},{key:"unprojectPosition",value:function(a){var s=this.unprojectFlat(a),l=(0,Z.Z)(s,2),d=l[0],x=l[1],A=(a[2]||0)/this.pixelsPerMeter;return[d,x,A]}},{key:"projectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}},{key:"unprojectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}}]),n}();function s0(n){var c=n.width,a=n.height,s=n.bounds,l=n.minExtent,d=l===void 0?0:l,x=n.maxZoom,A=x===void 0?24:x,O=n.padding,B=O===void 0?0:O,te=n.offset,$=te===void 0?[0,0]:te,me=(0,Z.Z)(s,2),ze=(0,Z.Z)(me[0],2),ht=ze[0],Ft=ze[1],mr=(0,Z.Z)(me[1],2),Er=mr[0],Zr=mr[1];if(Number.isFinite(B)){var vn=B;B={top:vn,bottom:vn,left:vn,right:vn}}else Ah(Number.isFinite(B.top)&&Number.isFinite(B.bottom)&&Number.isFinite(B.left)&&Number.isFinite(B.right));var hn=new Uv({width:c,height:a,longitude:0,latitude:0,zoom:0}),On=hn.project([ht,Zr]),ii=hn.project([Er,Ft]),wn=[Math.max(Math.abs(ii[0]-On[0]),d),Math.max(Math.abs(ii[1]-On[1]),d)],xi=[c-B.left-B.right-Math.abs($[0])*2,a-B.top-B.bottom-Math.abs($[1])*2];Ah(xi[0]>0&&xi[1]>0);var Ji=xi[0]/wn[0],Sa=xi[1]/wn[1],gi=(B.right-B.left)/2/Ji,Oa=(B.bottom-B.top)/2/Sa,eo=[(ii[0]+On[0])/2+gi,(ii[1]+On[1])/2+Oa],Ks=hn.unproject(eo),Ff=hn.zoom+Math.log2(Math.abs(Math.min(Ji,Sa)));return{longitude:Ks[0],latitude:Ks[1],zoom:Math.min(Ff,A)}}var Uv=function(n){(0,_e.Z)(c,n);function c(){var a,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,d=s.height,x=s.latitude,A=x===void 0?0:x,O=s.longitude,B=O===void 0?0:O,te=s.zoom,$=te===void 0?0:te,me=s.pitch,ze=me===void 0?0:me,ht=s.bearing,Ft=ht===void 0?0:ht,mr=s.altitude,Er=mr===void 0?1.5:mr,Zr=s.nearZMultiplier,vn=s.farZMultiplier;(0,V.Z)(this,c),l=l||1,d=d||1;var hn=Fv($);Er=Math.max(.75,Er);var On=gd([B,A],hn);On[2]=0;var ii=i0({width:l,height:d,pitch:ze,bearing:Ft,altitude:Er,nearZMultiplier:Zr||1/d,farZMultiplier:vn||1.01}),wn=r0({height:d,center:On,pitch:ze,bearing:Ft,altitude:Er,flipY:!0});return a=(0,be.Z)(this,(0,Le.Z)(c).call(this,{width:l,height:d,viewMatrix:wn,projectionMatrix:ii})),a.latitude=A,a.longitude=B,a.zoom=$,a.pitch=ze,a.bearing=Ft,a.altitude=Er,a.scale=hn,a.center=On,a.pixelsPerMeter=Bv((0,L.Z)((0,L.Z)(a))).pixelsPerMeter[2],Object.freeze((0,L.Z)((0,L.Z)(a))),a}return(0,G.Z)(c,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return gd(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Nd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,d=s.pos,x=Nv(d,this.pixelUnprojectionMatrix),A=gd(l,this.scale),O=ye.IH([],A,ye.tk([],x)),B=ye.IH([],this.center,O);return Nd(B,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,d=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:d})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=this.width,x=this.height,A=s0(Object.assign({width:d,height:x,bounds:s},l)),O=A.longitude,B=A.latitude,te=A.zoom;return new c({width:d,height:x,longitude:O,latitude:B,zoom:te})}}]),c}(o0),u0=function(){function n(){(0,V.Z)(this,n),(0,I.Z)(this,"viewport",void 0)}return(0,G.Z)(n,[{key:"syncWithMapCamera",value:function(a){var s=a.center,l=a.zoom,d=a.pitch,x=a.bearing,A=a.viewportHeight,O=a.viewportWidth;this.viewport=new Uv({width:O,height:A,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:d,bearing:x})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(a,s){return this.viewport.projectFlat(a,s)}}]),n}(),Zv={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},jv,Vv,Gv,Hv,Wv,Xv,np,Yv,Kv,$v,Jv;function Qv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function l0(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Qv(Object(a),!0).forEach(function(s){(0,I.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Qv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function c0(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}c0(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=qm();var qv={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},f0=0,h0=12,em="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",p0=(jv=(0,Ve.b2)(),Vv=(0,Ve.f3)(E.vK.MapConfig),Gv=(0,Ve.f3)(E.vK.IGlobalConfigService),Hv=(0,Ve.f3)(E.vK.ICoordinateSystemService),Wv=(0,Ve.f3)(E.vK.IEventEmitter),jv(Xv=(np=function(){function n(){var c=this;(0,V.Z)(this,n),(0,I.Z)(this,"version",kd.MAPBOX),(0,I.Z)(this,"map",void 0),(0,Bi.Z)(this,"config",Yv,this),(0,Bi.Z)(this,"configService",Kv,this),(0,Bi.Z)(this,"coordinateSystemService",$v,this),(0,Bi.Z)(this,"eventEmitter",Jv,this),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"markerContainer",void 0),(0,I.Z)(this,"cameraChangedCallback",void 0),(0,I.Z)(this,"$mapContainer",void 0),(0,I.Z)(this,"handleCameraChanged",function(){var a=c.map.getCenter().wrap(),s=a.lat,l=a.lng;c.viewport.syncWithMapCamera({bearing:c.map.getBearing(),center:[l,s],viewportHeight:c.map.transform.height,pitch:c.map.getPitch(),viewportWidth:c.map.transform.width,zoom:c.map.getZoom(),cameraHeight:0});var d=c.config.offsetZoom,x=d===void 0?h0:d;c.viewport.getZoom()>x?c.coordinateSystemService.setCoordinateSystem(E.CoordinateSystem.LNGLAT_OFFSET):c.coordinateSystemService.setCoordinateSystem(E.CoordinateSystem.LNGLAT),c.cameraChangedCallback(c.viewport)})}return(0,G.Z)(n,[{key:"addMarkerContainer",value:function(){var a=this.map.getCanvasContainer();this.markerContainer=Je.SO.create("div","l7-marker-container",a),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(a,s){E.MapServiceEvent.indexOf(a)!==-1?this.eventEmitter.on(a,s):this.map.on(qv[a]||a,s)}},{key:"off",value:function(a,s){this.map.off(qv[a]||a,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var a=this.map.transform;return[a.width,a.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(a){return this.map.setZoom(a)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(a){this.map.setCenter(a)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(a){this.map.setBearing(a)}},{key:"zoomIn",value:function(a,s){this.map.zoomIn(a,s)}},{key:"zoomOut",value:function(a,s){this.map.zoomOut(a,s)}},{key:"setPitch",value:function(a){return this.map.setPitch(a)}},{key:"panTo",value:function(a){this.map.panTo(a)}},{key:"panBy",value:function(a,s){this.panTo([a,s])}},{key:"fitBounds",value:function(a,s){this.map.fitBounds(a,s)}},{key:"setMaxZoom",value:function(a){this.map.setMaxZoom(a)}},{key:"setMinZoom",value:function(a){this.map.setMinZoom(a)}},{key:"setMapStatus",value:function(a){a.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),a.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),a.dragEnable===!1&&this.map.dragPan.disable(),a.dragEnable===!0&&this.map.dragPan.enable(),a.rotateEnable===!1&&this.map.dragRotate.disable(),a.rotateEnable===!0&&this.map.dragRotate.enable(),a.keyboardEnable===!1&&this.map.keyboard.disable(),a.keyboardEnable===!0&&this.map.keyboard.enable(),a.zoomEnable===!1&&this.map.scrollZoom.disable(),a.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(a,s){this.map.flyTo({zoom:a,center:s})}},{key:"setMapStyle",value:function(a){this.map.setStyle(this.getMapStyle(a))}},{key:"pixelToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToPixel",value:function(a){return this.map.project(a)}},{key:"containerToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToContainer",value:function(a){return this.map.project(a)}},{key:"lngLatToCoord",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},l=this.lngLatToMercator(a,0),d=l.x,x=l.y;return[d-s.x,x-s.y]}},{key:"lngLatToMercator",value:function(a,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),d=l.x,x=d===void 0?0:d,A=l.y,O=A===void 0?0:A,B=l.z,te=B===void 0?0:B;return{x,y:O,z:te}}},{key:"getModelMatrix",value:function(a,s,l){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},A=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),O=A.meterInMercatorCoordinateUnits(),B=Va.create();return Va.translate(B,B,Yi.fromValues(A.x-x.x,A.y-x.y,A.z||0-x.z)),Va.scale(B,B,Yi.fromValues(O*d[0],-O*d[1],O*d[2])),Va.rotateX(B,B,l[0]),Va.rotateY(B,B,l[1]),Va.rotateZ(B,B,l[2]),B}},{key:"init",value:function(){var c=(0,w.Z)(Ue().mark(function s(){var l,d,x,A,O,B,te,$,me,ze,ht,Ft,mr;return Ue().wrap(function(Zr){for(;;)switch(Zr.prev=Zr.next){case 0:l=this.config,d=l.id,x=d===void 0?"map":d,A=l.attributionControl,O=A===void 0?!1:A,B=l.style,te=B===void 0?"light":B,$=l.token,me=$===void 0?em:$,ze=l.rotation,ht=ze===void 0?0:ze,Ft=l.mapInstance,mr=(0,la.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new u0,!Ft&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),me===em&&te!=="blank"&&!window.mapboxgl.accessToken&&!Ft&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Ft&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=me),Ft?(this.map=Ft,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(x),this.map=new window.mapboxgl.Map(l0({container:this.$mapContainer,style:this.getMapStyle(te),attributionControl:O,bearing:ht},mr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Zr.stop()}},s,this)}));function a(){return c.apply(this,arguments)}return a}()},{key:"destroy",value:function(){var a,s;(a=this.$mapContainer)===null||a===void 0||(s=a.parentNode)===null||s===void 0||s.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(a){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),x=1;x<l;x++)d[x-1]=arguments[x];(s=this.eventEmitter).emit.apply(s,[a].concat(d))}},{key:"once",value:function(a){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),x=1;x<l;x++)d[x-1]=arguments[x];(s=this.eventEmitter).once.apply(s,[a].concat(d))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(a){var s=this.map.getCanvas(),l=a==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(a){this.cameraChangedCallback=a}},{key:"creatAmapContainer",value:function(a){var s=a;typeof a=="string"&&(s=document.getElementById(a));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+f0++,s.appendChild(l),l}},{key:"getMapStyle",value:function(a){return typeof a!="string"?a:Zv[a]?Zv[a]:a}}]),n}(),Yv=(0,ai.Z)(np.prototype,"config",[Vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kv=(0,ai.Z)(np.prototype,"configService",[Gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$v=(0,ai.Z)(np.prototype,"coordinateSystemService",[Hv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jv=(0,ai.Z)(np.prototype,"eventEmitter",[Wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),np))||Xv);function d0(n){var c=v0();return function(){var s=(0,Le.Z)(n),l;if(c){var d=(0,Le.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function v0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function m0(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}m0(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var g0=function(n){(0,_e.Z)(a,n);var c=d0(a);function a(){return(0,V.Z)(this,a),c.apply(this,arguments)}return(0,G.Z)(a,[{key:"getServiceConstructor",value:function(){return p0}}]),a}(Jm);function tm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function rm(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?tm(Object(a),!0).forEach(function(s){y0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):tm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function y0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function _0(n,c){return E0(n)||S0(n,c)||b0(n,c)||x0()}function x0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function b0(n,c){if(!!n){if(typeof n=="string")return nm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return nm(n,c)}}function nm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function S0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function E0(n){if(Array.isArray(n))return n}var C0=j.memo(function(n){var c=n.style,a=n.className,s=n.map,l=n.option,d=n.onSceneLoaded,x=(0,j.createRef)(),A=(0,j.useState)(),O=_0(A,2),B=O[0],te=O[1];return(0,j.useEffect)(function(){var $=new Mi(rm(rm({id:x.current},l),{},{map:new g0(s)}));return $.on("loaded",function(){te($),d&&d($)}),function(){$.destroy()}},[]),(0,j.useEffect)(function(){B&&s.style&&B.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,j.useEffect)(function(){B&&s.zoom&&B.setZoom(s.zoom)},[s.zoom]),(0,j.useEffect)(function(){B&&s.center&&B.setCenter(s.center)},[JSON.stringify(s.center)]),(0,j.useEffect)(function(){B&&s.pitch!==void 0&&B.setPitch(s.pitch||0)},[s.pitch]),(0,j.useEffect)(function(){B&&s.rotation&&B.setRotation(s.rotation)},[s.rotation]),j.createElement(b.Provider,{value:B},(0,j.createElement)("div",{ref:x,style:c,className:a},B&&n.children))}),w0=C0;function im(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ly(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?im(Object(a),!0).forEach(function(s){T0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):im(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function T0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function cy(n,c){return I0(n)||M0(n,c)||P0(n,c)||A0()}function A0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P0(n,c){if(!!n){if(typeof n=="string")return am(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return am(n,c)}}function am(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function M0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function I0(n){if(Array.isArray(n))return n}var fy=null,hy=null;function om(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function py(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?om(Object(a),!0).forEach(function(s){O0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):om(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function O0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function dy(n,c){return k0(n)||D0(n,c)||R0(n,c)||L0()}function L0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function R0(n,c){if(!!n){if(typeof n=="string")return sm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return sm(n,c)}}function sm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function D0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function k0(n){if(Array.isArray(n))return n}var vy=null,gy=null;function yy(n,c){return z0(n)||N0(n,c)||B0(n,c)||F0()}function F0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function B0(n,c){if(!!n){if(typeof n=="string")return um(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return um(n,c)}}function um(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function N0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function z0(n){if(Array.isArray(n))return n}var _y=null,xy=null;function lm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function by(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?lm(Object(a),!0).forEach(function(s){U0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):lm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function U0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Sy(n,c){if(n==null)return{};var a=Z0(n,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function Z0(n,c){if(n==null)return{};var a={},s=Object.keys(n),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(a[l]=n[l]);return a}var Ey=null,cm=y(73935);function j0(n,c){return W0(n)||H0(n,c)||G0(n,c)||V0()}function V0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function G0(n,c){if(!!n){if(typeof n=="string")return fm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fm(n,c)}}function fm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function H0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function W0(n){if(Array.isArray(n))return n}var X0=j.useEffect,Y0=j.useState;function Cy(n){var c=n.className,a=n.style,s=n.children,l=n.position,d=useSceneValue(),x=Y0(function(){return document.createElement("div")}),A=j0(x,1),O=A[0];return X0(function(){var B=new Control({position:l});return B.onAdd=function(){if(c&&(O.className=c),a){var te=Object.keys(a).map(function($){return"".concat($,":").concat(a[$])}).join(";");O.style.cssText=te}return O},d.addControl(B),function(){d.removeControl(B)}},[]),createPortal(s,O)}var hm=(0,j.createContext)({});function wy(){return useContext(hm)}var K0=j.useEffect,$0=j.memo(function(c){var a=c.layer,s=c.active;return K0(function(){a.active(s.option)},[JSON.stringify(s)]),null}),J0=j.useEffect,Q0=j.memo(function(c){var a=c.layer,s=c.animate;return J0(function(){a.animate(s)},[JSON.stringify(s)]),null}),q0=j.useEffect,eg=j.memo(function(c){var a=c.layer,s=c.color;return q0(function(){s.field?a.color(s.field,s.values):a.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),tg=j.useEffect,rg=j.memo(function(c){var a=c.layer,s=c.filter;return tg(function(){s.field&&a.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),ng=j.useEffect,ig=j.memo(function(c){var a=c.layer,s=c.scale;return ng(function(){a.scale(s.values)},[s.values]),null}),ag=j.useEffect,og=j.memo(function(c){var a=c.layer,s=c.select;return ag(function(){a.select(s.option)},[JSON.stringify(s)]),null}),sg=j.useEffect,ug=j.memo(function(c){var a=c.layer,s=c.shape;return sg(function(){s.field?a.shape(s.field,s.values):a.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),lg=j.useEffect,cg=j.memo(function(c){var a=c.layer,s=c.size;return lg(function(){s.field?a.size(s.field,s.values):a.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),fg=["data"];function hg(n,c){if(n==null)return{};var a=pg(n,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function pg(n,c){if(n==null)return{};var a={},s=Object.keys(n),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(a[l]=n[l]);return a}var dg=j.useEffect,vg=j.memo(function(c){var a=c.layer,s=c.source,l=s.data,d=hg(s,fg);return dg(function(){a.inited?a.setData(l,d):a.source(l,d),d.autoFit&&a.fitBounds(d&&d.fitBoundsOptions)},[l,JSON.stringify(d)]),null}),mg=j.useEffect,gg=j.memo(function(c){var a=c.layer,s=c.style;return mg(function(){a.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function yg(n,c){return Sg(n)||bg(n,c)||xg(n,c)||_g()}function _g(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xg(n,c){if(!!n){if(typeof n=="string")return pm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pm(n,c)}}function pm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function bg(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,x,A;try{for(a=a.call(n);!(l=(x=a.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function Sg(n){if(Array.isArray(n))return n}var Np=j.useEffect,Eg=j.useState;function dm(n,c){var a=c.source,s=c.color,l=c.shape,d=c.style,x=c.size,A=c.scale,O=c.active,B=c.select,te=c.filter,$=c.animate,me=c.options,ze=c.onLayerLoaded,ht=p(),Ft=Eg(function(){var Zr;switch(n){case"polygonLayer":Zr=new ui(me);break;case"lineLayer":Zr=new Do(me);break;case"pointLayer":Zr=new Ui(me);break;case"heatmapLayer":Zr=new cl(me);break;case"rasterLayer":Zr=new fa(me);break;case"imageLayer":Zr=new ic(me);break;case"citybuildingLayer":Zr=new $l(me);break;default:Zr=new ui(me)}return Zr.on("inited",function(){ze&&ze(Zr,ht)}),Zr}),mr=yg(Ft,1),Er=mr[0];return Np(function(){return ht.addLayer(Er),function(){ht.removeLayer(Er)}},[]),Np(function(){Er.inited&&me&&Er.updateLayerConfig(me)},[me==null?void 0:me.minZoom,me==null?void 0:me.maxZoom,me==null?void 0:me.visible]),Np(function(){Er.inited&&(me==null?void 0:me.zIndex)&&Er.setIndex(me.zIndex)},[me==null?void 0:me.zIndex]),Np(function(){Er.inited&&(me==null?void 0:me.blend)&&Er.setBlend(me.blend)},[me==null?void 0:me.blend]),Np(function(){ht.render()}),j.createElement(hm.Provider,{value:Er},j.createElement(vg,{layer:Er,source:a}),A&&j.createElement(ig,{layer:Er,scale:A}),s&&j.createElement(eg,{layer:Er,color:s}),x&&j.createElement(cg,{layer:Er,size:x}),l&&j.createElement(ug,{layer:Er,shape:l}),d&&j.createElement(gg,{layer:Er,style:d}),O&&j.createElement($0,{layer:Er,active:O}),B&&j.createElement(og,{layer:Er,select:B}),te&&j.createElement(rg,{layer:Er,filter:te}),$&&j.createElement(Q0,{layer:Er,animate:$}),c.children)}var Ty=null,Ay=null,Cg=j.memo(function(c){return dm("pointLayer",c)}),wg=j.memo(function(c){return dm("heatmapLayer",c)}),Py=null,My=null,Iy=null,Oy=j.useEffect,Ly=null,Ry=null;function yd(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?yd=function(a){return typeof a}:yd=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},yd(n)}function vm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function _d(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?vm(Object(a),!0).forEach(function(s){Tg(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):vm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Tg(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Ag(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function mm(n,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function Pg(n,c,a){return c&&mm(n.prototype,c),a&&mm(n,a),n}function Mg(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&zd(n,c)}function zd(n,c){return zd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},zd(n,c)}function Ig(n){var c=Rg();return function(){var s=xd(n),l;if(c){var d=xd(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Og(this,l)}}function Og(n,c){if(c&&(yd(c)==="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Lg(n)}function Lg(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Rg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function xd(n){return xd=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},xd(n)}var Dy=function(n){Mg(a,n);var c=Ig(a);function a(s){var l;return Ag(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return Pg(a,[{key:"componentDidMount",value:function(){var l,d=this.props,x=d.lnglat,A=d.children,O=d.option,B=d.lngLat,te=new sr(_d(_d({},O),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));x&&te.setLnglat(x),B&&te.setLnglat(B),A&&te.setDOMContent(this.el),this.popup=te,this.scene.addPopup(te)}},{key:"componentDidUpdate",value:function(l){var d,x,A,O,B,te,$=Array.isArray(l.lnglat)?l.lnglat:[l==null||(d=l.lnglat)===null||d===void 0?void 0:d.lng,l==null||(x=l.lnglat)===null||x===void 0?void 0:x.lat],me=Array.isArray(this.props.lnglat)?this.props.lnglat:[(A=this.props)===null||A===void 0||(O=A.lnglat)===null||O===void 0?void 0:O.lng,(B=this.props)===null||B===void 0||(te=B.lnglat)===null||te===void 0?void 0:te.lat],ze=$.toString()!==me.toString();if(ze){var ht;this.popup.remove(),this.popup=new sr(_d(_d({},this.props.option),{},{stopPropagation:(ht=this.props.option)===null||ht===void 0?void 0:ht.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return j.createElement(b.Consumer,{},function(d){return d&&(l.scene=d),(0,cm.createPortal)(l.props.children,l.el)})}}]),a}(j.PureComponent);function bd(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?bd=function(a){return typeof a}:bd=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},bd(n)}function Dg(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function gm(n,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function kg(n,c,a){return c&&gm(n.prototype,c),a&&gm(n,a),n}function Fg(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Ud(n,c)}function Ud(n,c){return Ud=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Ud(n,c)}function Bg(n){var c=Ug();return function(){var s=Sd(n),l;if(c){var d=Sd(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Ng(this,l)}}function Ng(n,c){if(c&&(bd(c)==="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zg(n)}function zg(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Ug(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Sd(n){return Sd=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},Sd(n)}var ky=function(n){Fg(a,n);var c=Bg(a);function a(s){var l;return Dg(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return kg(a,[{key:"componentDidMount",value:function(){var l=this.props,d=l.lnglat,x=l.children,A=l.option,O=l.onMarkerLoaded,B=new Bt(A);d&&B.setLnglat(d),x&&B.setElement(this.el),this.marker=B,O&&O(B),this.scene.addMarker(B)}},{key:"componentDidUpdate",value:function(l){var d,x=(l==null?void 0:l.lnglat.toString())!==((d=this.props)===null||d===void 0?void 0:d.lnglat.toString());x&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return j.createElement(b.Consumer,{},function(d){return d&&(l.scene=d),(0,cm.createPortal)(l.props.children,l.el)})}}]),a}(j.PureComponent),Fy=j.useEffect,By=null,Ny=null,zy=j.useEffect,Uy=null},4771:function(){},6563:function(qe,D,y){var j=y(31795);qe.exports=b;function b(I,L){switch(I&&I.type||null){case"FeatureCollection":return I.features=I.features.map(p(b,L)),I;case"GeometryCollection":return I.geometries=I.geometries.map(p(b,L)),I;case"Feature":return I.geometry=b(I.geometry,L),I;case"Polygon":case"MultiPolygon":return E(I,L);default:return I}}function p(I,L){return function(_e){return I(_e,L)}}function E(I,L){return I.type==="Polygon"?I.coordinates=Z(I.coordinates,L):I.type==="MultiPolygon"&&(I.coordinates=I.coordinates.map(p(Z,L))),I}function Z(I,L){L=!!L,I[0]=V(I[0],L);for(var _e=1;_e<I.length;_e++)I[_e]=V(I[_e],!L);return I}function V(I,L){return G(I)===L?I:I.reverse()}function G(I){return j.ring(I)>=0}},6901:function(qe,D,y){"use strict";y.d(D,{SO:function(){return j},z6:function(){return rt},a5:function(){return b},Z:function(){return ot},rQ:function(){return un},bV:function(){return Mr},zi:function(){return an},ds:function(){return Xe},Ev:function(){return wt},oO:function(){return Cr},W0:function(){return br},Z6:function(){return Xt},We:function(){return rr},Cl:function(){return kr},gJ:function(){return Ge},vP:function(){return Rr},yM:function(){return Q},yA:function(){return dr},CI:function(){return gr}});var j={};y.r(j),y.d(j,{DPR:function(){return Qe},addClass:function(){return Je},create:function(){return be},empty:function(){return bt},getClass:function(){return xt},getContainer:function(){return G},getViewPortScale:function(){return Ct},hasClass:function(){return It},printCanvas:function(){return cr},remove:function(){return Le},removeClass:function(){return Dt},setClass:function(){return Ut},setTransform:function(){return ir},splitWords:function(){return L},triggerResize:function(){return re},trim:function(){return I}});var b={};y.r(b),y.d(b,{getColumn:function(){return le},getSatByColumn:function(){return pe},max:function(){return Kn},mean:function(){return Ai},min:function(){return ti},mode:function(){return Pi},statMap:function(){return q},sum:function(){return Qi}});function p(U){var ae=131,de=137,Pe=0;U+="x";for(var ue=Math.floor(9007199254740991/de),Ee=0;Ee<U.length;Ee++)Pe>ue&&(Pe=Math.floor(Pe/de)),Pe=Pe*ae+U.charCodeAt(Ee);return Pe}function E(U){U=U.toString();for(var ae=5381,de=U.length;de;)ae=ae*33^U.charCodeAt(--de);return ae>>>0}var Z=y(28481),V=window.document.documentElement.style;function G(U){var ae=U;return typeof U=="string"&&(ae=document.getElementById(U)),ae}function I(U){return U.trim?U.trim():U.replace(/^\s+|\s+$/g,"")}function L(U){return I(U).split(/\s+/)}function _e(U){if(!V)return U[0];for(var ae in U)if(U[ae]&&U[ae]in V)return U[ae];return U[0]}function be(U,ae,de){var Pe=document.createElement(U);return Pe.className=ae||"",de&&de.appendChild(Pe),Pe}function Le(U){var ae=U.parentNode;ae&&ae.removeChild(U)}function Je(U,ae){if(U.classList!==void 0)for(var de=L(ae),Pe=0,ue=de.length;Pe<ue;Pe++)U.classList.add(de[Pe]);else if(!It(U,ae)){var Ee=xt(U);Ut(U,(Ee?Ee+" ":"")+ae)}}function Dt(U,ae){U.classList!==void 0?U.classList.remove(ae):Ut(U,I((" "+xt(U)+" ").replace(" "+ae+" "," ")))}function It(U,ae){if(U.classList!==void 0)return U.classList.contains(ae);var de=xt(U);return de.length>0&&new RegExp("(^|\\s)"+ae+"(\\s|$)").test(de)}function Ut(U,ae){U instanceof HTMLElement?U.className=ae:U.className.baseVal=ae}function xt(U){return U instanceof SVGElement&&(U=U.correspondingElement),U.className.baseVal===void 0?U.className:U.className.baseVal}function bt(U){for(;U&&U.firstChild;)U.removeChild(U.firstChild)}var ct=_e(["transform","WebkitTransform"]);function ir(U,ae){U.style[ct]=ae}function re(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var U=window.document.createEvent("UIEvents");U.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(U)}}function cr(U){var ae=["padding: "+(U.height/2-8)+"px "+U.width/2+"px;","line-height: "+U.height+"px;","background-image: url("+U.toDataURL()+");"];console.log(`%c
`,ae.join(""))}function Ct(){var U,ae=document.querySelector('meta[name="viewport"]');if(!ae)return 1;var de=(U=ae.content)===null||U===void 0?void 0:U.split(","),Pe=de.find(function(ue){var Ee=ue.split("="),mt=(0,Z.Z)(Ee,2),wr=mt[0],Yt=mt[1];return wr==="initial-scale"});return Pe?Pe.split("=")[1]*1:1}var Qe=Ct()<1?1:window.devicePixelRatio,Tt=y(6610),je=y(5991),Pt=y(63349),fr=y(10379),$t=y(46070),zr=y(77608),fe=y(14665);function ke(U){return Function.toString.call(U).indexOf("[native code]")!==-1}var ge=y(51814);function _t(U,ae,de){return(0,ge.Z)()?_t=Reflect.construct:_t=function(ue,Ee,mt){var wr=[null];wr.push.apply(wr,Ee);var Yt=Function.bind.apply(ue,wr),tr=new Yt;return mt&&(0,fe.Z)(tr,mt.prototype),tr},_t.apply(null,arguments)}function vt(U){var ae=typeof Map=="function"?new Map:void 0;return vt=function(Pe){if(Pe===null||!ke(Pe))return Pe;if(typeof Pe!="function")throw new TypeError("Super expression must either be null or a function");if(typeof ae!="undefined"){if(ae.has(Pe))return ae.get(Pe);ae.set(Pe,ue)}function ue(){return _t(Pe,arguments,(0,zr.Z)(this).constructor)}return ue.prototype=Object.create(Pe.prototype,{constructor:{value:ue,enumerable:!1,writable:!0,configurable:!0}}),(0,fe.Z)(ue,Pe)},vt(U)}var jt=y(96156);function Bt(U){var ae=Nr();return function(){var Pe=(0,zr.Z)(U),ue;if(ae){var Ee=(0,zr.Z)(this).constructor;ue=Reflect.construct(Pe,arguments,Ee)}else ue=Pe.apply(this,arguments);return(0,$t.Z)(this,ue)}}function Nr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(U){return!1}}var pn=function(U){(0,fr.Z)(de,U);var ae=Bt(de);function de(Pe,ue,Ee){var mt;return(0,Tt.Z)(this,de),mt=ae.call(this,Pe),(0,jt.Z)((0,Pt.Z)(mt),"status",void 0),(0,jt.Z)((0,Pt.Z)(mt),"url",void 0),mt.status=ue,mt.url=Ee,mt.name=mt.constructor.name,mt.message=Pe,mt}return(0,je.Z)(de,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),de}(vt(Error));function mn(U){var ae=new XMLHttpRequest;ae.open("GET",U.url,!0);for(var de in U.headers)U.headers.hasOwnProperty(de)&&ae.setRequestHeader(de,U.headers[de]);return ae.withCredentials=U.credentials==="include",ae}var Ni=function(ae,de){var Pe=mn(ae);return Pe.setRequestHeader("Accept","application/json"),Pe.onerror=function(){de(new Error(Pe.statusText))},Pe.onload=function(){if(Pe.status>=200&&Pe.status<300&&Pe.response){var ue;try{ue=JSON.parse(Pe.response)}catch(Ee){return de(Ee)}de(null,ue)}else Pe.status===401?de(new pn("".concat(Pe.statusText),Pe.status,ae.url)):de(new pn(Pe.statusText,Pe.status,ae.url))},Pe.send(),Pe},or=function(ae,de){var Pe=mn(ae);return Pe.responseType="arraybuffer",Pe.onerror=function(){de(new Error(Pe.statusText))},Pe.onload=function(){var ue=Pe.response;if(ue.byteLength===0&&Pe.status===200)return de(new Error("http status 200 returned without content."));Pe.status>=200&&Pe.status<300&&Pe.response?de(null,{data:ue,cacheControl:Pe.getResponseHeader("Cache-Control"),expires:Pe.getResponseHeader("Expires")}):de(new pn(Pe.statusText,Pe.status,ae.url))},Pe.send(),Pe};function ve(U){var ae=window.document.createElement("a");return ae.href=U,ae.protocol===window.document.location.protocol&&ae.host===window.document.location.host}var Me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ge=function(ae,de){return or(ae,function(Pe,ue){if(Pe)de(Pe);else if(ue){var Ee=new window.Image;Ee.crossOrigin="anonymous";var mt=window.URL||window.webkitURL;Ee.onload=function(){de(null,Ee),mt.revokeObjectURL(Ee.src)};var wr=new window.Blob([new Uint8Array(ue.data)],{type:"image/png"});Ee.src=ue.data.byteLength?mt.createObjectURL(wr):Me}})},Re=y(40271),kt=2*Math.PI*6378137/2;function rr(U){var ae=[Infinity,Infinity,-Infinity,-Infinity];return U.forEach(function(de){var Pe=de.coordinates;yr(ae,Pe)}),ae}function yr(U,ae){return Array.isArray(ae[0])?ae.forEach(function(de){yr(U,de)}):(U[0]>ae[0]&&(U[0]=ae[0]),U[1]>ae[1]&&(U[1]=ae[1]),U[2]<ae[0]&&(U[2]=ae[0]),U[3]<ae[1]&&(U[3]=ae[1])),U}function Pr(U,ae){return sr(U,ae)}function sr(U,ae){return Array.isArray(U[0])?U.map(function(de){return sr(de,ae)}):ae(U)}function Rr(U){var ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};U=Ve(U,ae);var Pe=U[0],ue=U[1],Ee=Pe*kt/180,mt=Math.log(Math.tan((90+ue)*Math.PI/360))/(Math.PI/180);return mt=mt*kt/180,de.enable&&(Ee=Number(Ee.toFixed(de.decimal)),mt=Number(mt.toFixed(de.decimal))),U.length===3?[Ee,mt,U[2]]:[Ee,mt]}function w(U){var ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,de=U[0],Pe=U[1],ue=de/kt*180,Ee=Pe/kt*180;return Ee=180/Math.PI*(2*Math.atan(Math.exp(Ee*Math.PI/180))-Math.PI/2),ae!=null&&(ue=Number(ue.toFixed(ae)),Ee=Number(Ee.toFixed(ae))),U.length===3?[ue,Ee,U[2]]:[ue,Ee]}function X(U){if(U==null)throw new Error("lng is required");return(U>180||U<-180)&&(U=U%360,U>180&&(U=-360+U),U<-180&&(U=360+U),U===0&&(U=0)),U}function Ue(U){if(U==null)throw new Error("lat is required");return(U>90||U<-90)&&(U=U%180,U>90&&(U=-180+U),U<-90&&(U=180+U),U===0&&(U=0)),U}function Ve(U,ae){if(ae===!1)return U;var de=X(U[0]),Pe=Ue(U[1]);return Pe>85&&(Pe=85),Pe<-85&&(Pe=-85),U.length===3?[de,Pe,U[2]]:[de,Pe]}function ot(U){var ae=85.0511287798,de=Math.max(Math.min(ae,U[1]),-ae),Pe=256<<20,ue=Math.PI/180,Ee=U[0]*ue,mt=de*ue;mt=Math.log(Math.tan(Math.PI/4+mt/2));var wr=.5/Math.PI,Yt=.5,tr=-.5/Math.PI;return ue=.5,Ee=Pe*(wr*Ee+Yt),mt=Pe*(tr*mt+ue),[Math.floor(Ee),Math.floor(mt)]}function At(U){var ae=.5/Math.PI,de=.5,Pe=-.5/Math.PI,ue=.5,Ee=256<<20,mt=_slicedToArray(U,2),wr=mt[0],Yt=mt[1];wr=(wr/Ee-de)/ae,Yt=(Yt/Ee-ue)/Pe,Yt=(Math.atan(Math.pow(Math.E,Yt))-Math.PI/4)*2,ue=Math.PI/180;var tr=Yt/ue,Ur=wr/ue;return[Ur,tr]}function Q(U,ae,de){var Pe=(0,Re.Ht)(ae[1]-U[1]),ue=(0,Re.Ht)(ae[0]-U[0]),Ee=(0,Re.Ht)(U[1]),mt=(0,Re.Ht)(ae[1]),wr=Math.pow(Math.sin(Pe/2),2)+Math.pow(Math.sin(ue/2),2)*Math.cos(Ee)*Math.cos(mt);return(0,Re.DL)(2*Math.atan2(Math.sqrt(wr),Math.sqrt(1-wr)),de="meters")}function Rt(U){var ae=Math.PI/180,de=85.0511287798,Pe=6378137,ue=Math.max(Math.min(de,U[1]),-de),Ee=Math.sin(ue*ae),mt=Pe*U[0]*ae,wr=Pe*Math.log((1+Ee)/(1-Ee))/2;return[mt,wr]}function dr(U,ae){var de=Math.abs(U[1][1]-U[0][1])*ae,Pe=Math.abs(U[1][0]-U[0][0])*ae;return[[U[0][0]-Pe,U[0][1]-de],[U[1][0]+Pe,U[1][1]+de]]}function Cr(U,ae){return U[0][0]<=ae[0][0]&&U[0][1]<=ae[0][1]&&U[1][0]>=ae[1][0]&&U[1][1]>=ae[1][1]}function Xe(U){return[[U[0],U[1]],[U[2],U[3]]]}var rt=function(){function U(){var ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,de=arguments.length>1?arguments[1]:void 0;(0,Tt.Z)(this,U),(0,jt.Z)(this,"limit",void 0),(0,jt.Z)(this,"cache",void 0),(0,jt.Z)(this,"destroy",void 0),(0,jt.Z)(this,"order",void 0),this.limit=ae,this.destroy=de||this.defaultDestroy,this.order=[],this.clear()}return(0,je.Z)(U,[{key:"clear",value:function(){var de=this;this.order.forEach(function(Pe){de.delete(Pe)}),this.cache={},this.order=[]}},{key:"get",value:function(de){var Pe=this.cache[de];return Pe&&(this.deleteOrder(de),this.appendOrder(de)),Pe}},{key:"set",value:function(de,Pe){this.cache[de]?(this.delete(de),this.cache[de]=Pe,this.appendOrder(de)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[de]=Pe,this.appendOrder(de))}},{key:"delete",value:function(de){var Pe=this.cache[de];Pe&&(this.deleteCache(de),this.deleteOrder(de),this.destroy(Pe,de))}},{key:"deleteCache",value:function(de){delete this.cache[de]}},{key:"deleteOrder",value:function(de){var Pe=this.order.findIndex(function(ue){return ue===de});Pe>=0&&this.order.splice(Pe,1)}},{key:"appendOrder",value:function(de){this.order.push(de)}},{key:"defaultDestroy",value:function(de,Pe){return null}}]),U}();function wt(U,ae){U.forEach(function(de){!ae[de]||(ae[de]=ae[de].bind(ae))})}var Ot=y(2650);function gr(U){var ae=Ot.ZP(U),de=[0,0,0,0];return ae!=null&&(de[0]=ae.r/255,de[1]=ae.g/255,de[2]=ae.b/255,de[3]=ae.opacity),de}function br(U){var ae=U&&U[0],de=U&&U[1],Pe=U&&U[2],ue=ae+de*256+Pe*65536-1;return ue}function Xt(U){return[U+1&255,U+1>>8&255,U+1>>8>>8&255]}function kr(U){var ae=document.createElement("canvas"),de=ae.getContext("2d");ae.width=256,ae.height=1;for(var Pe=de.createLinearGradient(0,0,256,1),ue=null,Ee=U.positions[0],mt=U.positions[U.positions.length-1],wr=0;wr<U.colors.length;++wr){var Yt=(U.positions[wr]-Ee)/(mt-Ee);Pe.addColorStop(Yt,U.colors[wr])}return de.fillStyle=Pe,de.fillRect(0,0,256,1),ue=new Uint8ClampedArray(de.getImageData(0,0,256,1).data),new ImageData(ue,256,1)}var Mr;(function(U){U.CENTER="center",U.TOP="top",U["TOP-LEFT"]="top-left",U["TOP-RIGHT"]="top-right",U.BOTTOM="bottom",U["BOTTOM-LEFT"]="bottom-left",U.LEFT="left",U.RIGHT="right"})(Mr||(Mr={}));var un={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function an(U,ae,de){var Pe=U.classList;for(var ue in un)un.hasOwnProperty(ue)&&Pe.remove("l7-".concat(de,"-anchor-").concat(ue));Pe.add("l7-".concat(de,"-anchor-").concat(ae))}function Kn(U){if(U.length===0)throw new Error("max requires at least one data point");for(var ae=U[0],de=1;de<U.length;de++)U[de]>ae&&(ae=U[de]);return ae*1}function ti(U){if(U.length===0)throw new Error("min requires at least one data point");for(var ae=U[0],de=1;de<U.length;de++)U[de]<ae&&(ae=U[de]);return ae*1}function Qi(U){if(U.length===0)return 0;for(var ae=U[0]*1,de=1;de<U.length;de++)ae+=U[de]*1;return ae}function Ai(U){if(U.length===0)throw new Error("mean requires at least one data point");return Qi(U)/U.length}function Pi(U){if(U.length===0)throw new Error("mean requires at least one data point");if(U.length<3)return U[0];U.sort();for(var ae=U[0],de=NaN,Pe=0,ue=1,Ee=1;Ee<U.length+1;Ee++)U[Ee]!==ae?(ue>Pe&&(Pe=ue,de=ae),ue=1,ae=U[Ee]):ue++;return de*1}var q={min:ti,max:Kn,mean:Ai,sum:Qi,mode:Pi};function le(U,ae){return U.map(function(de){return de[ae]})}function pe(U,ae){return q[U](ae)}},3473:function(qe,D,y){"use strict";y.d(D,{Z:function(){return j}});function j(b,p,E,Z,V){var G={};return Object.keys(Z).forEach(function(I){G[I]=Z[I]}),G.enumerable=!!G.enumerable,G.configurable=!!G.configurable,("value"in G||G.initializer)&&(G.writable=!0),G=E.slice().reverse().reduce(function(I,L){return L(b,p,I)||I},G),V&&G.initializer!==void 0&&(G.value=G.initializer?G.initializer.call(V):void 0,G.initializer=void 0),G.initializer===void 0&&(Object.defineProperty(b,p,G),G=null),G}},66213:function(qe,D,y){"use strict";y.d(D,{Z:function(){return p}});var j=y(77608);function b(E,Z){for(;!Object.prototype.hasOwnProperty.call(E,Z)&&(E=(0,j.Z)(E),E!==null););return E}function p(E,Z,V){return typeof Reflect!="undefined"&&Reflect.get?p=Reflect.get:p=function(I,L,_e){var be=b(I,L);if(!!be){var Le=Object.getOwnPropertyDescriptor(be,L);return Le.get?Le.get.call(_e):Le.value}},p(E,Z,V||E)}},55770:function(qe,D,y){"use strict";y.d(D,{Z:function(){return j}});function j(b,p,E,Z){!E||Object.defineProperty(b,p,{enumerable:E.enumerable,configurable:E.configurable,writable:E.writable,value:E.initializer?E.initializer.call(Z):void 0})}},31795:function(qe,D,y){var j=y(75752);qe.exports.geometry=b,qe.exports.ring=E;function b(V){var G=0,I;switch(V.type){case"Polygon":return p(V.coordinates);case"MultiPolygon":for(I=0;I<V.coordinates.length;I++)G+=p(V.coordinates[I]);return G;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(I=0;I<V.geometries.length;I++)G+=b(V.geometries[I]);return G}}function p(V){var G=0;if(V&&V.length>0){G+=Math.abs(E(V[0]));for(var I=1;I<V.length;I++)G-=Math.abs(E(V[I]))}return G}function E(V){var G,I,L,_e,be,Le,Je,Dt=0,It=V.length;if(It>2){for(Je=0;Je<It;Je++)Je===It-2?(_e=It-2,be=It-1,Le=0):Je===It-1?(_e=It-1,be=0,Le=1):(_e=Je,be=Je+1,Le=Je+2),G=V[_e],I=V[be],L=V[Le],Dt+=(Z(L[0])-Z(G[0]))*Math.sin(Z(I[1]));Dt=Dt*j.RADIUS*j.RADIUS/2}return Dt}function Z(V){return V*Math.PI/180}},49296:function(qe){"use strict";qe.exports=y,qe.exports.default=y;var D=1e20;function y(Z,V,G,I,L,_e){this.fontSize=Z||24,this.buffer=V===void 0?3:V,this.cutoff=I||.25,this.fontFamily=L||"sans-serif",this.fontWeight=_e||"normal",this.radius=G||8;var be=this.size=this.fontSize+this.buffer*2,Le=be+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=be,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Le*Le),this.gridInner=new Float64Array(Le*Le),this.f=new Float64Array(Le),this.z=new Float64Array(Le+1),this.v=new Uint16Array(Le),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(be/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function j(Z,V,G,I,L,_e,be){_e.fill(D,0,V*G),be.fill(0,0,V*G);for(var Le=(V-I)/2,Je=0;Je<L;Je++)for(var Dt=0;Dt<I;Dt++){var It=(Je+Le)*V+Dt+Le,Ut=Z.data[4*(Je*I+Dt)+3]/255;if(Ut===1)_e[It]=0,be[It]=D;else if(Ut===0)_e[It]=D,be[It]=0;else{var xt=Math.max(0,.5-Ut),bt=Math.max(0,Ut-.5);_e[It]=xt*xt,be[It]=bt*bt}}}function b(Z,V,G,I,L,_e,be){for(var Le=0;Le<V*G;Le++){var Je=Math.sqrt(I[Le])-Math.sqrt(L[Le]);Z[Le]=Math.round(255-255*(Je/_e+be))}}y.prototype._draw=function(Z,V){var G=this.ctx.measureText(Z),I=G.width,L=2*this.buffer,_e,be,Le,Je,Dt,It,Ut,xt;V&&this.useMetrics?(Dt=Math.floor(G.actualBoundingBoxAscent),xt=this.buffer+Math.ceil(G.actualBoundingBoxAscent),It=this.buffer,Ut=this.buffer,be=Math.min(this.size,Math.ceil(G.actualBoundingBoxRight-G.actualBoundingBoxLeft)),Je=Math.min(this.size-It,Math.ceil(G.actualBoundingBoxAscent+G.actualBoundingBoxDescent)),_e=be+L,Le=Je+L,this.ctx.textBaseline="alphabetic"):(_e=be=this.size,Le=Je=this.size,Dt=19*this.fontSize/24,It=Ut=0,xt=this.middle,this.ctx.textBaseline="middle");var bt;be&&Je&&(this.ctx.clearRect(Ut,It,be,Je),this.ctx.fillText(Z,this.buffer,xt),bt=this.ctx.getImageData(Ut,It,be,Je));var ct=new Uint8ClampedArray(_e*Le);return j(bt,_e,Le,be,Je,this.gridOuter,this.gridInner),p(this.gridOuter,_e,Le,this.f,this.v,this.z),p(this.gridInner,_e,Le,this.f,this.v,this.z),b(ct,_e,Le,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:ct,metrics:{width:be,height:Je,sdfWidth:_e,sdfHeight:Le,top:Dt,left:0,advance:I}}},y.prototype.draw=function(Z){return this._draw(Z,!1).data},y.prototype.drawWithMetrics=function(Z){return this._draw(Z,!0)};function p(Z,V,G,I,L,_e){for(var be=0;be<V;be++)E(Z,be,V,G,I,L,_e);for(var Le=0;Le<G;Le++)E(Z,Le*V,1,V,I,L,_e)}function E(Z,V,G,I,L,_e,be){var Le,Je,Dt,It;for(_e[0]=0,be[0]=-D,be[1]=D,Le=0;Le<I;Le++)L[Le]=Z[V+Le*G];for(Le=1,Je=0,Dt=0;Le<I;Le++){do It=_e[Je],Dt=(L[Le]-L[It]+Le*Le-It*It)/(Le-It)/2;while(Dt<=be[Je]&&--Je>-1);Je++,_e[Je]=Le,be[Je]=Dt,be[Je+1]=D}for(Le=0,Je=0;Le<I;Le++){for(;be[Je+1]<Le;)Je++;It=_e[Je],Z[V+Le*G]=L[It]+(Le-It)*(Le-It)}}},40271:function(qe,D,y){"use strict";y.d(D,{zL:function(){return Z},DL:function(){return ct},Ht:function(){return Qe}});var j=63710088e-1,b={centimeters:j*100,centimetres:j*100,degrees:j/111325,feet:j*3.28084,inches:j*39.37,kilometers:j/1e3,kilometres:j/1e3,meters:j,metres:j,miles:j/1609.344,millimeters:j*1e3,millimetres:j*1e3,nauticalmiles:j/1852,radians:1,yards:j*1.0936},p={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/j,yards:1.0936133},E={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Z(fe,ke,ge){ge===void 0&&(ge={});var _t={type:"Feature"};return(ge.id===0||ge.id)&&(_t.id=ge.id),ge.bbox&&(_t.bbox=ge.bbox),_t.properties=ke||{},_t.geometry=fe,_t}function V(fe,ke,ge){switch(ge===void 0&&(ge={}),fe){case"Point":return G(ke).geometry;case"LineString":return be(ke).geometry;case"Polygon":return L(ke).geometry;case"MultiPoint":return It(ke).geometry;case"MultiLineString":return Dt(ke).geometry;case"MultiPolygon":return Ut(ke).geometry;default:throw new Error(fe+" is invalid")}}function G(fe,ke,ge){if(ge===void 0&&(ge={}),!fe)throw new Error("coordinates is required");if(!Array.isArray(fe))throw new Error("coordinates must be an Array");if(fe.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pt(fe[0])||!Pt(fe[1]))throw new Error("coordinates must contain numbers");var _t={type:"Point",coordinates:fe};return Z(_t,ke,ge)}function I(fe,ke,ge){return ge===void 0&&(ge={}),Je(fe.map(function(_t){return G(_t,ke)}),ge)}function L(fe,ke,ge){ge===void 0&&(ge={});for(var _t=0,vt=fe;_t<vt.length;_t++){var jt=vt[_t];if(jt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Bt=0;Bt<jt[jt.length-1].length;Bt++)if(jt[jt.length-1][Bt]!==jt[0][Bt])throw new Error("First and last Position are not equivalent.")}var Nr={type:"Polygon",coordinates:fe};return Z(Nr,ke,ge)}function _e(fe,ke,ge){return ge===void 0&&(ge={}),Je(fe.map(function(_t){return L(_t,ke)}),ge)}function be(fe,ke,ge){if(ge===void 0&&(ge={}),fe.length<2)throw new Error("coordinates must be an array of two or more positions");var _t={type:"LineString",coordinates:fe};return Z(_t,ke,ge)}function Le(fe,ke,ge){return ge===void 0&&(ge={}),Je(fe.map(function(_t){return be(_t,ke)}),ge)}function Je(fe,ke){ke===void 0&&(ke={});var ge={type:"FeatureCollection"};return ke.id&&(ge.id=ke.id),ke.bbox&&(ge.bbox=ke.bbox),ge.features=fe,ge}function Dt(fe,ke,ge){ge===void 0&&(ge={});var _t={type:"MultiLineString",coordinates:fe};return Z(_t,ke,ge)}function It(fe,ke,ge){ge===void 0&&(ge={});var _t={type:"MultiPoint",coordinates:fe};return Z(_t,ke,ge)}function Ut(fe,ke,ge){ge===void 0&&(ge={});var _t={type:"MultiPolygon",coordinates:fe};return Z(_t,ke,ge)}function xt(fe,ke,ge){ge===void 0&&(ge={});var _t={type:"GeometryCollection",geometries:fe};return Z(_t,ke,ge)}function bt(fe,ke){if(ke===void 0&&(ke=0),ke&&!(ke>=0))throw new Error("precision must be a positive number");var ge=Math.pow(10,ke||0);return Math.round(fe*ge)/ge}function ct(fe,ke){ke===void 0&&(ke="kilometers");var ge=b[ke];if(!ge)throw new Error(ke+" units is invalid");return fe*ge}function ir(fe,ke){ke===void 0&&(ke="kilometers");var ge=b[ke];if(!ge)throw new Error(ke+" units is invalid");return fe/ge}function re(fe,ke){return Ct(ir(fe,ke))}function cr(fe){var ke=fe%360;return ke<0&&(ke+=360),ke}function Ct(fe){var ke=fe%(2*Math.PI);return ke*180/Math.PI}function Qe(fe){var ke=fe%360;return ke*Math.PI/180}function Tt(fe,ke,ge){if(ke===void 0&&(ke="kilometers"),ge===void 0&&(ge="kilometers"),!(fe>=0))throw new Error("length must be a positive number");return ct(ir(fe,ke),ge)}function je(fe,ke,ge){if(ke===void 0&&(ke="meters"),ge===void 0&&(ge="kilometers"),!(fe>=0))throw new Error("area must be a positive number");var _t=E[ke];if(!_t)throw new Error("invalid original units");var vt=E[ge];if(!vt)throw new Error("invalid final units");return fe/_t*vt}function Pt(fe){return!isNaN(fe)&&fe!==null&&!Array.isArray(fe)}function fr(fe){return!!fe&&fe.constructor===Object}function $t(fe){if(!fe)throw new Error("bbox is required");if(!Array.isArray(fe))throw new Error("bbox must be an Array");if(fe.length!==4&&fe.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");fe.forEach(function(ke){if(!Pt(ke))throw new Error("bbox must only contain numbers")})}function zr(fe){if(!fe)throw new Error("id is required");if(["string","number"].indexOf(typeof fe)===-1)throw new Error("id must be a number or a string")}},53645:function(qe){qe.exports={"ant-pro-grid-content":"ant-pro-grid-content",wide:"wide"}},9187:function(qe){"use strict";qe.exports=D,qe.exports.default=D;function D(fe,ke,ge){ge=ge||2;var _t=ke&&ke.length,vt=_t?ke[0]*ge:fe.length,jt=y(fe,0,vt,ge,!0),Bt=[];if(!jt||jt.next===jt.prev)return Bt;var Nr,pn,mn,Ni,or,ve,Me;if(_t&&(jt=G(fe,ke,jt,ge)),fe.length>80*ge){Nr=mn=fe[0],pn=Ni=fe[1];for(var Ge=ge;Ge<vt;Ge+=ge)or=fe[Ge],ve=fe[Ge+1],or<Nr&&(Nr=or),ve<pn&&(pn=ve),or>mn&&(mn=or),ve>Ni&&(Ni=ve);Me=Math.max(mn-Nr,Ni-pn),Me=Me!==0?1/Me:0}return b(jt,Bt,ge,Nr,pn,Me),Bt}function y(fe,ke,ge,_t,vt){var jt,Bt;if(vt===zr(fe,ke,ge,_t)>0)for(jt=ke;jt<ge;jt+=_t)Bt=Pt(jt,fe[jt],fe[jt+1],Bt);else for(jt=ge-_t;jt>=ke;jt-=_t)Bt=Pt(jt,fe[jt],fe[jt+1],Bt);return Bt&&ct(Bt,Bt.next)&&(fr(Bt),Bt=Bt.next),Bt}function j(fe,ke){if(!fe)return fe;ke||(ke=fe);var ge=fe,_t;do if(_t=!1,!ge.steiner&&(ct(ge,ge.next)||bt(ge.prev,ge,ge.next)===0)){if(fr(ge),ge=ke=ge.prev,ge===ge.next)break;_t=!0}else ge=ge.next;while(_t||ge!==ke);return ke}function b(fe,ke,ge,_t,vt,jt,Bt){if(!!fe){!Bt&&jt&&Le(fe,_t,vt,jt);for(var Nr=fe,pn,mn;fe.prev!==fe.next;){if(pn=fe.prev,mn=fe.next,jt?E(fe,_t,vt,jt):p(fe)){ke.push(pn.i/ge),ke.push(fe.i/ge),ke.push(mn.i/ge),fr(fe),fe=mn.next,Nr=mn.next;continue}if(fe=mn,fe===Nr){Bt?Bt===1?(fe=Z(j(fe),ke,ge),b(fe,ke,ge,_t,vt,jt,2)):Bt===2&&V(fe,ke,ge,_t,vt,jt):b(j(fe),ke,ge,_t,vt,jt,1);break}}}}function p(fe){var ke=fe.prev,ge=fe,_t=fe.next;if(bt(ke,ge,_t)>=0)return!1;for(var vt=fe.next.next;vt!==fe.prev;){if(Ut(ke.x,ke.y,ge.x,ge.y,_t.x,_t.y,vt.x,vt.y)&&bt(vt.prev,vt,vt.next)>=0)return!1;vt=vt.next}return!0}function E(fe,ke,ge,_t){var vt=fe.prev,jt=fe,Bt=fe.next;if(bt(vt,jt,Bt)>=0)return!1;for(var Nr=vt.x<jt.x?vt.x<Bt.x?vt.x:Bt.x:jt.x<Bt.x?jt.x:Bt.x,pn=vt.y<jt.y?vt.y<Bt.y?vt.y:Bt.y:jt.y<Bt.y?jt.y:Bt.y,mn=vt.x>jt.x?vt.x>Bt.x?vt.x:Bt.x:jt.x>Bt.x?jt.x:Bt.x,Ni=vt.y>jt.y?vt.y>Bt.y?vt.y:Bt.y:jt.y>Bt.y?jt.y:Bt.y,or=Dt(Nr,pn,ke,ge,_t),ve=Dt(mn,Ni,ke,ge,_t),Me=fe.prevZ,Ge=fe.nextZ;Me&&Me.z>=or&&Ge&&Ge.z<=ve;){if(Me!==fe.prev&&Me!==fe.next&&Ut(vt.x,vt.y,jt.x,jt.y,Bt.x,Bt.y,Me.x,Me.y)&&bt(Me.prev,Me,Me.next)>=0||(Me=Me.prevZ,Ge!==fe.prev&&Ge!==fe.next&&Ut(vt.x,vt.y,jt.x,jt.y,Bt.x,Bt.y,Ge.x,Ge.y)&&bt(Ge.prev,Ge,Ge.next)>=0))return!1;Ge=Ge.nextZ}for(;Me&&Me.z>=or;){if(Me!==fe.prev&&Me!==fe.next&&Ut(vt.x,vt.y,jt.x,jt.y,Bt.x,Bt.y,Me.x,Me.y)&&bt(Me.prev,Me,Me.next)>=0)return!1;Me=Me.prevZ}for(;Ge&&Ge.z<=ve;){if(Ge!==fe.prev&&Ge!==fe.next&&Ut(vt.x,vt.y,jt.x,jt.y,Bt.x,Bt.y,Ge.x,Ge.y)&&bt(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.nextZ}return!0}function Z(fe,ke,ge){var _t=fe;do{var vt=_t.prev,jt=_t.next.next;!ct(vt,jt)&&ir(vt,_t,_t.next,jt)&&Qe(vt,jt)&&Qe(jt,vt)&&(ke.push(vt.i/ge),ke.push(_t.i/ge),ke.push(jt.i/ge),fr(_t),fr(_t.next),_t=fe=jt),_t=_t.next}while(_t!==fe);return j(_t)}function V(fe,ke,ge,_t,vt,jt){var Bt=fe;do{for(var Nr=Bt.next.next;Nr!==Bt.prev;){if(Bt.i!==Nr.i&&xt(Bt,Nr)){var pn=je(Bt,Nr);Bt=j(Bt,Bt.next),pn=j(pn,pn.next),b(Bt,ke,ge,_t,vt,jt),b(pn,ke,ge,_t,vt,jt);return}Nr=Nr.next}Bt=Bt.next}while(Bt!==fe)}function G(fe,ke,ge,_t){var vt=[],jt,Bt,Nr,pn,mn;for(jt=0,Bt=ke.length;jt<Bt;jt++)Nr=ke[jt]*_t,pn=jt<Bt-1?ke[jt+1]*_t:fe.length,mn=y(fe,Nr,pn,_t,!1),mn===mn.next&&(mn.steiner=!0),vt.push(It(mn));for(vt.sort(I),jt=0;jt<vt.length;jt++)ge=L(vt[jt],ge),ge=j(ge,ge.next);return ge}function I(fe,ke){return fe.x-ke.x}function L(fe,ke){var ge=_e(fe,ke);if(!ge)return ke;var _t=je(ge,fe),vt=j(ge,ge.next);return j(_t,_t.next),ke===ge?vt:ke}function _e(fe,ke){var ge=ke,_t=fe.x,vt=fe.y,jt=-Infinity,Bt;do{if(vt<=ge.y&&vt>=ge.next.y&&ge.next.y!==ge.y){var Nr=ge.x+(vt-ge.y)*(ge.next.x-ge.x)/(ge.next.y-ge.y);if(Nr<=_t&&Nr>jt){if(jt=Nr,Nr===_t){if(vt===ge.y)return ge;if(vt===ge.next.y)return ge.next}Bt=ge.x<ge.next.x?ge:ge.next}}ge=ge.next}while(ge!==ke);if(!Bt)return null;if(_t===jt)return Bt;var pn=Bt,mn=Bt.x,Ni=Bt.y,or=Infinity,ve;ge=Bt;do _t>=ge.x&&ge.x>=mn&&_t!==ge.x&&Ut(vt<Ni?_t:jt,vt,mn,Ni,vt<Ni?jt:_t,vt,ge.x,ge.y)&&(ve=Math.abs(vt-ge.y)/(_t-ge.x),Qe(ge,fe)&&(ve<or||ve===or&&(ge.x>Bt.x||ge.x===Bt.x&&be(Bt,ge)))&&(Bt=ge,or=ve)),ge=ge.next;while(ge!==pn);return Bt}function be(fe,ke){return bt(fe.prev,fe,ke.prev)<0&&bt(ke.next,fe,fe.next)<0}function Le(fe,ke,ge,_t){var vt=fe;do vt.z===null&&(vt.z=Dt(vt.x,vt.y,ke,ge,_t)),vt.prevZ=vt.prev,vt.nextZ=vt.next,vt=vt.next;while(vt!==fe);vt.prevZ.nextZ=null,vt.prevZ=null,Je(vt)}function Je(fe){var ke,ge,_t,vt,jt,Bt,Nr,pn,mn=1;do{for(ge=fe,fe=null,jt=null,Bt=0;ge;){for(Bt++,_t=ge,Nr=0,ke=0;ke<mn&&(Nr++,_t=_t.nextZ,!!_t);ke++);for(pn=mn;Nr>0||pn>0&&_t;)Nr!==0&&(pn===0||!_t||ge.z<=_t.z)?(vt=ge,ge=ge.nextZ,Nr--):(vt=_t,_t=_t.nextZ,pn--),jt?jt.nextZ=vt:fe=vt,vt.prevZ=jt,jt=vt;ge=_t}jt.nextZ=null,mn*=2}while(Bt>1);return fe}function Dt(fe,ke,ge,_t,vt){return fe=32767*(fe-ge)*vt,ke=32767*(ke-_t)*vt,fe=(fe|fe<<8)&16711935,fe=(fe|fe<<4)&252645135,fe=(fe|fe<<2)&858993459,fe=(fe|fe<<1)&1431655765,ke=(ke|ke<<8)&16711935,ke=(ke|ke<<4)&252645135,ke=(ke|ke<<2)&858993459,ke=(ke|ke<<1)&1431655765,fe|ke<<1}function It(fe){var ke=fe,ge=fe;do(ke.x<ge.x||ke.x===ge.x&&ke.y<ge.y)&&(ge=ke),ke=ke.next;while(ke!==fe);return ge}function Ut(fe,ke,ge,_t,vt,jt,Bt,Nr){return(vt-Bt)*(ke-Nr)-(fe-Bt)*(jt-Nr)>=0&&(fe-Bt)*(_t-Nr)-(ge-Bt)*(ke-Nr)>=0&&(ge-Bt)*(jt-Nr)-(vt-Bt)*(_t-Nr)>=0}function xt(fe,ke){return fe.next.i!==ke.i&&fe.prev.i!==ke.i&&!Ct(fe,ke)&&(Qe(fe,ke)&&Qe(ke,fe)&&Tt(fe,ke)&&(bt(fe.prev,fe,ke.prev)||bt(fe,ke.prev,ke))||ct(fe,ke)&&bt(fe.prev,fe,fe.next)>0&&bt(ke.prev,ke,ke.next)>0)}function bt(fe,ke,ge){return(ke.y-fe.y)*(ge.x-ke.x)-(ke.x-fe.x)*(ge.y-ke.y)}function ct(fe,ke){return fe.x===ke.x&&fe.y===ke.y}function ir(fe,ke,ge,_t){var vt=cr(bt(fe,ke,ge)),jt=cr(bt(fe,ke,_t)),Bt=cr(bt(ge,_t,fe)),Nr=cr(bt(ge,_t,ke));return!!(vt!==jt&&Bt!==Nr||vt===0&&re(fe,ge,ke)||jt===0&&re(fe,_t,ke)||Bt===0&&re(ge,fe,_t)||Nr===0&&re(ge,ke,_t))}function re(fe,ke,ge){return ke.x<=Math.max(fe.x,ge.x)&&ke.x>=Math.min(fe.x,ge.x)&&ke.y<=Math.max(fe.y,ge.y)&&ke.y>=Math.min(fe.y,ge.y)}function cr(fe){return fe>0?1:fe<0?-1:0}function Ct(fe,ke){var ge=fe;do{if(ge.i!==fe.i&&ge.next.i!==fe.i&&ge.i!==ke.i&&ge.next.i!==ke.i&&ir(ge,ge.next,fe,ke))return!0;ge=ge.next}while(ge!==fe);return!1}function Qe(fe,ke){return bt(fe.prev,fe,fe.next)<0?bt(fe,ke,fe.next)>=0&&bt(fe,fe.prev,ke)>=0:bt(fe,ke,fe.prev)<0||bt(fe,fe.next,ke)<0}function Tt(fe,ke){var ge=fe,_t=!1,vt=(fe.x+ke.x)/2,jt=(fe.y+ke.y)/2;do ge.y>jt!=ge.next.y>jt&&ge.next.y!==ge.y&&vt<(ge.next.x-ge.x)*(jt-ge.y)/(ge.next.y-ge.y)+ge.x&&(_t=!_t),ge=ge.next;while(ge!==fe);return _t}function je(fe,ke){var ge=new $t(fe.i,fe.x,fe.y),_t=new $t(ke.i,ke.x,ke.y),vt=fe.next,jt=ke.prev;return fe.next=ke,ke.prev=fe,ge.next=vt,vt.prev=ge,_t.next=ge,ge.prev=_t,jt.next=_t,_t.prev=jt,_t}function Pt(fe,ke,ge,_t){var vt=new $t(fe,ke,ge);return _t?(vt.next=_t.next,vt.prev=_t,_t.next.prev=vt,_t.next=vt):(vt.prev=vt,vt.next=vt),vt}function fr(fe){fe.next.prev=fe.prev,fe.prev.next=fe.next,fe.prevZ&&(fe.prevZ.nextZ=fe.nextZ),fe.nextZ&&(fe.nextZ.prevZ=fe.prevZ)}function $t(fe,ke,ge){this.i=fe,this.x=ke,this.y=ge,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}D.deviation=function(fe,ke,ge,_t){var vt=ke&&ke.length,jt=vt?ke[0]*ge:fe.length,Bt=Math.abs(zr(fe,0,jt,ge));if(vt)for(var Nr=0,pn=ke.length;Nr<pn;Nr++){var mn=ke[Nr]*ge,Ni=Nr<pn-1?ke[Nr+1]*ge:fe.length;Bt-=Math.abs(zr(fe,mn,Ni,ge))}var or=0;for(Nr=0;Nr<_t.length;Nr+=3){var ve=_t[Nr]*ge,Me=_t[Nr+1]*ge,Ge=_t[Nr+2]*ge;or+=Math.abs((fe[ve]-fe[Ge])*(fe[Me+1]-fe[ve+1])-(fe[ve]-fe[Me])*(fe[Ge+1]-fe[ve+1]))}return Bt===0&&or===0?0:Math.abs((or-Bt)/Bt)};function zr(fe,ke,ge,_t){for(var vt=0,jt=ke,Bt=ge-_t;jt<ge;jt+=_t)vt+=(fe[Bt]-fe[jt])*(fe[jt+1]+fe[Bt+1]),Bt=jt;return vt}D.flatten=function(fe){for(var ke=fe[0][0].length,ge={vertices:[],holes:[],dimensions:ke},_t=0,vt=0;vt<fe.length;vt++){for(var jt=0;jt<fe[vt].length;jt++)for(var Bt=0;Bt<ke;Bt++)ge.vertices.push(fe[vt][jt][Bt]);vt>0&&(_t+=fe[vt-1].length,ge.holes.push(_t))}return ge}},67709:function(qe){function D(j){var b=j.target||j.srcElement;b.__resizeRAF__&&cancelAnimationFrame(b.__resizeRAF__),b.__resizeRAF__=requestAnimationFrame(function(){var p=b.__resizeTrigger__,E=p&&p.__resizeListeners__;E&&E.forEach(function(Z){Z.call(p,j)})})}var y=function(b,p){var E=this,Z=E.document,V,G=Z.attachEvent;typeof navigator!="undefined"&&(V=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function I(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",D)}if(!b.__resizeListeners__)if(b.__resizeListeners__=[],G)b.__resizeTrigger__=b,b.attachEvent("onresize",D);else{getComputedStyle(b).position==="static"&&(b.style.position="relative");var L=b.__resizeTrigger__=Z.createElement("object");L.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),L.setAttribute("class","resize-sensor"),L.setAttribute("tabindex","-1"),L.setAttribute("title",""),L.__resizeElement__=b,L.onload=I,L.type="text/html",V&&b.appendChild(L),L.data="about:blank",V||b.appendChild(L)}b.__resizeListeners__.push(p)};qe.exports=typeof window=="undefined"?y:y.bind(window),qe.exports.unbind=function(j,b){var p=document.attachEvent,E=j.__resizeListeners__||[];if(b){var Z=E.indexOf(b);Z!==-1&&E.splice(Z,1)}else E=j.__resizeListeners__=[];if(!E.length){if(p)j.detachEvent("onresize",D);else if(j.__resizeTrigger__){var V=j.__resizeTrigger__.contentDocument,G=V&&V.defaultView;G&&(G.removeEventListener("resize",D),delete G.__resizeTrigger__),j.__resizeTrigger__=!j.removeChild(j.__resizeTrigger__)}delete j.__resizeListeners__}}},26729:function(qe){"use strict";var D=Object.prototype.hasOwnProperty,y="~";function j(){}Object.create&&(j.prototype=Object.create(null),new j().__proto__||(y=!1));function b(V,G,I){this.fn=V,this.context=G,this.once=I||!1}function p(V,G,I,L,_e){if(typeof I!="function")throw new TypeError("The listener must be a function");var be=new b(I,L||V,_e),Le=y?y+G:G;return V._events[Le]?V._events[Le].fn?V._events[Le]=[V._events[Le],be]:V._events[Le].push(be):(V._events[Le]=be,V._eventsCount++),V}function E(V,G){--V._eventsCount==0?V._events=new j:delete V._events[G]}function Z(){this._events=new j,this._eventsCount=0}Z.prototype.eventNames=function(){var G=[],I,L;if(this._eventsCount===0)return G;for(L in I=this._events)D.call(I,L)&&G.push(y?L.slice(1):L);return Object.getOwnPropertySymbols?G.concat(Object.getOwnPropertySymbols(I)):G},Z.prototype.listeners=function(G){var I=y?y+G:G,L=this._events[I];if(!L)return[];if(L.fn)return[L.fn];for(var _e=0,be=L.length,Le=new Array(be);_e<be;_e++)Le[_e]=L[_e].fn;return Le},Z.prototype.listenerCount=function(G){var I=y?y+G:G,L=this._events[I];return L?L.fn?1:L.length:0},Z.prototype.emit=function(G,I,L,_e,be,Le){var Je=y?y+G:G;if(!this._events[Je])return!1;var Dt=this._events[Je],It=arguments.length,Ut,xt;if(Dt.fn){switch(Dt.once&&this.removeListener(G,Dt.fn,void 0,!0),It){case 1:return Dt.fn.call(Dt.context),!0;case 2:return Dt.fn.call(Dt.context,I),!0;case 3:return Dt.fn.call(Dt.context,I,L),!0;case 4:return Dt.fn.call(Dt.context,I,L,_e),!0;case 5:return Dt.fn.call(Dt.context,I,L,_e,be),!0;case 6:return Dt.fn.call(Dt.context,I,L,_e,be,Le),!0}for(xt=1,Ut=new Array(It-1);xt<It;xt++)Ut[xt-1]=arguments[xt];Dt.fn.apply(Dt.context,Ut)}else{var bt=Dt.length,ct;for(xt=0;xt<bt;xt++)switch(Dt[xt].once&&this.removeListener(G,Dt[xt].fn,void 0,!0),It){case 1:Dt[xt].fn.call(Dt[xt].context);break;case 2:Dt[xt].fn.call(Dt[xt].context,I);break;case 3:Dt[xt].fn.call(Dt[xt].context,I,L);break;case 4:Dt[xt].fn.call(Dt[xt].context,I,L,_e);break;default:if(!Ut)for(ct=1,Ut=new Array(It-1);ct<It;ct++)Ut[ct-1]=arguments[ct];Dt[xt].fn.apply(Dt[xt].context,Ut)}}return!0},Z.prototype.on=function(G,I,L){return p(this,G,I,L,!1)},Z.prototype.once=function(G,I,L){return p(this,G,I,L,!0)},Z.prototype.removeListener=function(G,I,L,_e){var be=y?y+G:G;if(!this._events[be])return this;if(!I)return E(this,be),this;var Le=this._events[be];if(Le.fn)Le.fn===I&&(!_e||Le.once)&&(!L||Le.context===L)&&E(this,be);else{for(var Je=0,Dt=[],It=Le.length;Je<It;Je++)(Le[Je].fn!==I||_e&&!Le[Je].once||L&&Le[Je].context!==L)&&Dt.push(Le[Je]);Dt.length?this._events[be]=Dt.length===1?Dt[0]:Dt:E(this,be)}return this},Z.prototype.removeAllListeners=function(G){var I;return G?(I=y?y+G:G,this._events[I]&&E(this,I)):(this._events=new j,this._eventsCount=0),this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.addListener=Z.prototype.on,Z.prefixed=y,Z.EventEmitter=Z,qe.exports=Z},85975:function(qe,D,y){"use strict";y.r(D),y.d(D,{create:function(){return b},clone:function(){return p},copy:function(){return E},fromValues:function(){return Z},set:function(){return V},identity:function(){return G},transpose:function(){return I},invert:function(){return L},adjoint:function(){return _e},determinant:function(){return be},multiply:function(){return Le},translate:function(){return Je},scale:function(){return Dt},rotate:function(){return It},rotateX:function(){return Ut},rotateY:function(){return xt},rotateZ:function(){return bt},fromTranslation:function(){return ct},fromScaling:function(){return ir},fromRotation:function(){return re},fromXRotation:function(){return cr},fromYRotation:function(){return Ct},fromZRotation:function(){return Qe},fromRotationTranslation:function(){return Tt},fromQuat2:function(){return je},getTranslation:function(){return Pt},getScaling:function(){return fr},getRotation:function(){return $t},fromRotationTranslationScale:function(){return zr},fromRotationTranslationScaleOrigin:function(){return fe},fromQuat:function(){return ke},frustum:function(){return ge},perspectiveNO:function(){return _t},perspective:function(){return vt},perspectiveZO:function(){return jt},perspectiveFromFieldOfView:function(){return Bt},orthoNO:function(){return Nr},ortho:function(){return pn},orthoZO:function(){return mn},lookAt:function(){return Ni},targetTo:function(){return or},str:function(){return ve},frob:function(){return Me},add:function(){return Ge},subtract:function(){return Re},multiplyScalar:function(){return kt},multiplyScalarAndAdd:function(){return rr},exactEquals:function(){return yr},equals:function(){return Pr},mul:function(){return sr},sub:function(){return Rr}});var j=y(49685);function b(){var w=new j.WT(16);return j.WT!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=0,w[12]=0,w[13]=0,w[14]=0),w[0]=1,w[5]=1,w[10]=1,w[15]=1,w}function p(w){var X=new j.WT(16);return X[0]=w[0],X[1]=w[1],X[2]=w[2],X[3]=w[3],X[4]=w[4],X[5]=w[5],X[6]=w[6],X[7]=w[7],X[8]=w[8],X[9]=w[9],X[10]=w[10],X[11]=w[11],X[12]=w[12],X[13]=w[13],X[14]=w[14],X[15]=w[15],X}function E(w,X){return w[0]=X[0],w[1]=X[1],w[2]=X[2],w[3]=X[3],w[4]=X[4],w[5]=X[5],w[6]=X[6],w[7]=X[7],w[8]=X[8],w[9]=X[9],w[10]=X[10],w[11]=X[11],w[12]=X[12],w[13]=X[13],w[14]=X[14],w[15]=X[15],w}function Z(w,X,Ue,Ve,ot,At,Q,Rt,dr,Cr,Xe,rt,wt,Ot,gr,br){var Xt=new j.WT(16);return Xt[0]=w,Xt[1]=X,Xt[2]=Ue,Xt[3]=Ve,Xt[4]=ot,Xt[5]=At,Xt[6]=Q,Xt[7]=Rt,Xt[8]=dr,Xt[9]=Cr,Xt[10]=Xe,Xt[11]=rt,Xt[12]=wt,Xt[13]=Ot,Xt[14]=gr,Xt[15]=br,Xt}function V(w,X,Ue,Ve,ot,At,Q,Rt,dr,Cr,Xe,rt,wt,Ot,gr,br,Xt){return w[0]=X,w[1]=Ue,w[2]=Ve,w[3]=ot,w[4]=At,w[5]=Q,w[6]=Rt,w[7]=dr,w[8]=Cr,w[9]=Xe,w[10]=rt,w[11]=wt,w[12]=Ot,w[13]=gr,w[14]=br,w[15]=Xt,w}function G(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function I(w,X){if(w===X){var Ue=X[1],Ve=X[2],ot=X[3],At=X[6],Q=X[7],Rt=X[11];w[1]=X[4],w[2]=X[8],w[3]=X[12],w[4]=Ue,w[6]=X[9],w[7]=X[13],w[8]=Ve,w[9]=At,w[11]=X[14],w[12]=ot,w[13]=Q,w[14]=Rt}else w[0]=X[0],w[1]=X[4],w[2]=X[8],w[3]=X[12],w[4]=X[1],w[5]=X[5],w[6]=X[9],w[7]=X[13],w[8]=X[2],w[9]=X[6],w[10]=X[10],w[11]=X[14],w[12]=X[3],w[13]=X[7],w[14]=X[11],w[15]=X[15];return w}function L(w,X){var Ue=X[0],Ve=X[1],ot=X[2],At=X[3],Q=X[4],Rt=X[5],dr=X[6],Cr=X[7],Xe=X[8],rt=X[9],wt=X[10],Ot=X[11],gr=X[12],br=X[13],Xt=X[14],kr=X[15],Mr=Ue*Rt-Ve*Q,un=Ue*dr-ot*Q,an=Ue*Cr-At*Q,Kn=Ve*dr-ot*Rt,ti=Ve*Cr-At*Rt,Qi=ot*Cr-At*dr,Ai=Xe*br-rt*gr,Pi=Xe*Xt-wt*gr,q=Xe*kr-Ot*gr,le=rt*Xt-wt*br,pe=rt*kr-Ot*br,U=wt*kr-Ot*Xt,ae=Mr*U-un*pe+an*le+Kn*q-ti*Pi+Qi*Ai;return ae?(ae=1/ae,w[0]=(Rt*U-dr*pe+Cr*le)*ae,w[1]=(ot*pe-Ve*U-At*le)*ae,w[2]=(br*Qi-Xt*ti+kr*Kn)*ae,w[3]=(wt*ti-rt*Qi-Ot*Kn)*ae,w[4]=(dr*q-Q*U-Cr*Pi)*ae,w[5]=(Ue*U-ot*q+At*Pi)*ae,w[6]=(Xt*an-gr*Qi-kr*un)*ae,w[7]=(Xe*Qi-wt*an+Ot*un)*ae,w[8]=(Q*pe-Rt*q+Cr*Ai)*ae,w[9]=(Ve*q-Ue*pe-At*Ai)*ae,w[10]=(gr*ti-br*an+kr*Mr)*ae,w[11]=(rt*an-Xe*ti-Ot*Mr)*ae,w[12]=(Rt*Pi-Q*le-dr*Ai)*ae,w[13]=(Ue*le-Ve*Pi+ot*Ai)*ae,w[14]=(br*un-gr*Kn-Xt*Mr)*ae,w[15]=(Xe*Kn-rt*un+wt*Mr)*ae,w):null}function _e(w,X){var Ue=X[0],Ve=X[1],ot=X[2],At=X[3],Q=X[4],Rt=X[5],dr=X[6],Cr=X[7],Xe=X[8],rt=X[9],wt=X[10],Ot=X[11],gr=X[12],br=X[13],Xt=X[14],kr=X[15];return w[0]=Rt*(wt*kr-Ot*Xt)-rt*(dr*kr-Cr*Xt)+br*(dr*Ot-Cr*wt),w[1]=-(Ve*(wt*kr-Ot*Xt)-rt*(ot*kr-At*Xt)+br*(ot*Ot-At*wt)),w[2]=Ve*(dr*kr-Cr*Xt)-Rt*(ot*kr-At*Xt)+br*(ot*Cr-At*dr),w[3]=-(Ve*(dr*Ot-Cr*wt)-Rt*(ot*Ot-At*wt)+rt*(ot*Cr-At*dr)),w[4]=-(Q*(wt*kr-Ot*Xt)-Xe*(dr*kr-Cr*Xt)+gr*(dr*Ot-Cr*wt)),w[5]=Ue*(wt*kr-Ot*Xt)-Xe*(ot*kr-At*Xt)+gr*(ot*Ot-At*wt),w[6]=-(Ue*(dr*kr-Cr*Xt)-Q*(ot*kr-At*Xt)+gr*(ot*Cr-At*dr)),w[7]=Ue*(dr*Ot-Cr*wt)-Q*(ot*Ot-At*wt)+Xe*(ot*Cr-At*dr),w[8]=Q*(rt*kr-Ot*br)-Xe*(Rt*kr-Cr*br)+gr*(Rt*Ot-Cr*rt),w[9]=-(Ue*(rt*kr-Ot*br)-Xe*(Ve*kr-At*br)+gr*(Ve*Ot-At*rt)),w[10]=Ue*(Rt*kr-Cr*br)-Q*(Ve*kr-At*br)+gr*(Ve*Cr-At*Rt),w[11]=-(Ue*(Rt*Ot-Cr*rt)-Q*(Ve*Ot-At*rt)+Xe*(Ve*Cr-At*Rt)),w[12]=-(Q*(rt*Xt-wt*br)-Xe*(Rt*Xt-dr*br)+gr*(Rt*wt-dr*rt)),w[13]=Ue*(rt*Xt-wt*br)-Xe*(Ve*Xt-ot*br)+gr*(Ve*wt-ot*rt),w[14]=-(Ue*(Rt*Xt-dr*br)-Q*(Ve*Xt-ot*br)+gr*(Ve*dr-ot*Rt)),w[15]=Ue*(Rt*wt-dr*rt)-Q*(Ve*wt-ot*rt)+Xe*(Ve*dr-ot*Rt),w}function be(w){var X=w[0],Ue=w[1],Ve=w[2],ot=w[3],At=w[4],Q=w[5],Rt=w[6],dr=w[7],Cr=w[8],Xe=w[9],rt=w[10],wt=w[11],Ot=w[12],gr=w[13],br=w[14],Xt=w[15],kr=X*Q-Ue*At,Mr=X*Rt-Ve*At,un=X*dr-ot*At,an=Ue*Rt-Ve*Q,Kn=Ue*dr-ot*Q,ti=Ve*dr-ot*Rt,Qi=Cr*gr-Xe*Ot,Ai=Cr*br-rt*Ot,Pi=Cr*Xt-wt*Ot,q=Xe*br-rt*gr,le=Xe*Xt-wt*gr,pe=rt*Xt-wt*br;return kr*pe-Mr*le+un*q+an*Pi-Kn*Ai+ti*Qi}function Le(w,X,Ue){var Ve=X[0],ot=X[1],At=X[2],Q=X[3],Rt=X[4],dr=X[5],Cr=X[6],Xe=X[7],rt=X[8],wt=X[9],Ot=X[10],gr=X[11],br=X[12],Xt=X[13],kr=X[14],Mr=X[15],un=Ue[0],an=Ue[1],Kn=Ue[2],ti=Ue[3];return w[0]=un*Ve+an*Rt+Kn*rt+ti*br,w[1]=un*ot+an*dr+Kn*wt+ti*Xt,w[2]=un*At+an*Cr+Kn*Ot+ti*kr,w[3]=un*Q+an*Xe+Kn*gr+ti*Mr,un=Ue[4],an=Ue[5],Kn=Ue[6],ti=Ue[7],w[4]=un*Ve+an*Rt+Kn*rt+ti*br,w[5]=un*ot+an*dr+Kn*wt+ti*Xt,w[6]=un*At+an*Cr+Kn*Ot+ti*kr,w[7]=un*Q+an*Xe+Kn*gr+ti*Mr,un=Ue[8],an=Ue[9],Kn=Ue[10],ti=Ue[11],w[8]=un*Ve+an*Rt+Kn*rt+ti*br,w[9]=un*ot+an*dr+Kn*wt+ti*Xt,w[10]=un*At+an*Cr+Kn*Ot+ti*kr,w[11]=un*Q+an*Xe+Kn*gr+ti*Mr,un=Ue[12],an=Ue[13],Kn=Ue[14],ti=Ue[15],w[12]=un*Ve+an*Rt+Kn*rt+ti*br,w[13]=un*ot+an*dr+Kn*wt+ti*Xt,w[14]=un*At+an*Cr+Kn*Ot+ti*kr,w[15]=un*Q+an*Xe+Kn*gr+ti*Mr,w}function Je(w,X,Ue){var Ve=Ue[0],ot=Ue[1],At=Ue[2],Q,Rt,dr,Cr,Xe,rt,wt,Ot,gr,br,Xt,kr;return X===w?(w[12]=X[0]*Ve+X[4]*ot+X[8]*At+X[12],w[13]=X[1]*Ve+X[5]*ot+X[9]*At+X[13],w[14]=X[2]*Ve+X[6]*ot+X[10]*At+X[14],w[15]=X[3]*Ve+X[7]*ot+X[11]*At+X[15]):(Q=X[0],Rt=X[1],dr=X[2],Cr=X[3],Xe=X[4],rt=X[5],wt=X[6],Ot=X[7],gr=X[8],br=X[9],Xt=X[10],kr=X[11],w[0]=Q,w[1]=Rt,w[2]=dr,w[3]=Cr,w[4]=Xe,w[5]=rt,w[6]=wt,w[7]=Ot,w[8]=gr,w[9]=br,w[10]=Xt,w[11]=kr,w[12]=Q*Ve+Xe*ot+gr*At+X[12],w[13]=Rt*Ve+rt*ot+br*At+X[13],w[14]=dr*Ve+wt*ot+Xt*At+X[14],w[15]=Cr*Ve+Ot*ot+kr*At+X[15]),w}function Dt(w,X,Ue){var Ve=Ue[0],ot=Ue[1],At=Ue[2];return w[0]=X[0]*Ve,w[1]=X[1]*Ve,w[2]=X[2]*Ve,w[3]=X[3]*Ve,w[4]=X[4]*ot,w[5]=X[5]*ot,w[6]=X[6]*ot,w[7]=X[7]*ot,w[8]=X[8]*At,w[9]=X[9]*At,w[10]=X[10]*At,w[11]=X[11]*At,w[12]=X[12],w[13]=X[13],w[14]=X[14],w[15]=X[15],w}function It(w,X,Ue,Ve){var ot=Ve[0],At=Ve[1],Q=Ve[2],Rt=Math.hypot(ot,At,Q),dr,Cr,Xe,rt,wt,Ot,gr,br,Xt,kr,Mr,un,an,Kn,ti,Qi,Ai,Pi,q,le,pe,U,ae,de;return Rt<j.Ib?null:(Rt=1/Rt,ot*=Rt,At*=Rt,Q*=Rt,dr=Math.sin(Ue),Cr=Math.cos(Ue),Xe=1-Cr,rt=X[0],wt=X[1],Ot=X[2],gr=X[3],br=X[4],Xt=X[5],kr=X[6],Mr=X[7],un=X[8],an=X[9],Kn=X[10],ti=X[11],Qi=ot*ot*Xe+Cr,Ai=At*ot*Xe+Q*dr,Pi=Q*ot*Xe-At*dr,q=ot*At*Xe-Q*dr,le=At*At*Xe+Cr,pe=Q*At*Xe+ot*dr,U=ot*Q*Xe+At*dr,ae=At*Q*Xe-ot*dr,de=Q*Q*Xe+Cr,w[0]=rt*Qi+br*Ai+un*Pi,w[1]=wt*Qi+Xt*Ai+an*Pi,w[2]=Ot*Qi+kr*Ai+Kn*Pi,w[3]=gr*Qi+Mr*Ai+ti*Pi,w[4]=rt*q+br*le+un*pe,w[5]=wt*q+Xt*le+an*pe,w[6]=Ot*q+kr*le+Kn*pe,w[7]=gr*q+Mr*le+ti*pe,w[8]=rt*U+br*ae+un*de,w[9]=wt*U+Xt*ae+an*de,w[10]=Ot*U+kr*ae+Kn*de,w[11]=gr*U+Mr*ae+ti*de,X!==w&&(w[12]=X[12],w[13]=X[13],w[14]=X[14],w[15]=X[15]),w)}function Ut(w,X,Ue){var Ve=Math.sin(Ue),ot=Math.cos(Ue),At=X[4],Q=X[5],Rt=X[6],dr=X[7],Cr=X[8],Xe=X[9],rt=X[10],wt=X[11];return X!==w&&(w[0]=X[0],w[1]=X[1],w[2]=X[2],w[3]=X[3],w[12]=X[12],w[13]=X[13],w[14]=X[14],w[15]=X[15]),w[4]=At*ot+Cr*Ve,w[5]=Q*ot+Xe*Ve,w[6]=Rt*ot+rt*Ve,w[7]=dr*ot+wt*Ve,w[8]=Cr*ot-At*Ve,w[9]=Xe*ot-Q*Ve,w[10]=rt*ot-Rt*Ve,w[11]=wt*ot-dr*Ve,w}function xt(w,X,Ue){var Ve=Math.sin(Ue),ot=Math.cos(Ue),At=X[0],Q=X[1],Rt=X[2],dr=X[3],Cr=X[8],Xe=X[9],rt=X[10],wt=X[11];return X!==w&&(w[4]=X[4],w[5]=X[5],w[6]=X[6],w[7]=X[7],w[12]=X[12],w[13]=X[13],w[14]=X[14],w[15]=X[15]),w[0]=At*ot-Cr*Ve,w[1]=Q*ot-Xe*Ve,w[2]=Rt*ot-rt*Ve,w[3]=dr*ot-wt*Ve,w[8]=At*Ve+Cr*ot,w[9]=Q*Ve+Xe*ot,w[10]=Rt*Ve+rt*ot,w[11]=dr*Ve+wt*ot,w}function bt(w,X,Ue){var Ve=Math.sin(Ue),ot=Math.cos(Ue),At=X[0],Q=X[1],Rt=X[2],dr=X[3],Cr=X[4],Xe=X[5],rt=X[6],wt=X[7];return X!==w&&(w[8]=X[8],w[9]=X[9],w[10]=X[10],w[11]=X[11],w[12]=X[12],w[13]=X[13],w[14]=X[14],w[15]=X[15]),w[0]=At*ot+Cr*Ve,w[1]=Q*ot+Xe*Ve,w[2]=Rt*ot+rt*Ve,w[3]=dr*ot+wt*Ve,w[4]=Cr*ot-At*Ve,w[5]=Xe*ot-Q*Ve,w[6]=rt*ot-Rt*Ve,w[7]=wt*ot-dr*Ve,w}function ct(w,X){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=X[0],w[13]=X[1],w[14]=X[2],w[15]=1,w}function ir(w,X){return w[0]=X[0],w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=X[1],w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=X[2],w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function re(w,X,Ue){var Ve=Ue[0],ot=Ue[1],At=Ue[2],Q=Math.hypot(Ve,ot,At),Rt,dr,Cr;return Q<j.Ib?null:(Q=1/Q,Ve*=Q,ot*=Q,At*=Q,Rt=Math.sin(X),dr=Math.cos(X),Cr=1-dr,w[0]=Ve*Ve*Cr+dr,w[1]=ot*Ve*Cr+At*Rt,w[2]=At*Ve*Cr-ot*Rt,w[3]=0,w[4]=Ve*ot*Cr-At*Rt,w[5]=ot*ot*Cr+dr,w[6]=At*ot*Cr+Ve*Rt,w[7]=0,w[8]=Ve*At*Cr+ot*Rt,w[9]=ot*At*Cr-Ve*Rt,w[10]=At*At*Cr+dr,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w)}function cr(w,X){var Ue=Math.sin(X),Ve=Math.cos(X);return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Ve,w[6]=Ue,w[7]=0,w[8]=0,w[9]=-Ue,w[10]=Ve,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Ct(w,X){var Ue=Math.sin(X),Ve=Math.cos(X);return w[0]=Ve,w[1]=0,w[2]=-Ue,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=Ue,w[9]=0,w[10]=Ve,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Qe(w,X){var Ue=Math.sin(X),Ve=Math.cos(X);return w[0]=Ve,w[1]=Ue,w[2]=0,w[3]=0,w[4]=-Ue,w[5]=Ve,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Tt(w,X,Ue){var Ve=X[0],ot=X[1],At=X[2],Q=X[3],Rt=Ve+Ve,dr=ot+ot,Cr=At+At,Xe=Ve*Rt,rt=Ve*dr,wt=Ve*Cr,Ot=ot*dr,gr=ot*Cr,br=At*Cr,Xt=Q*Rt,kr=Q*dr,Mr=Q*Cr;return w[0]=1-(Ot+br),w[1]=rt+Mr,w[2]=wt-kr,w[3]=0,w[4]=rt-Mr,w[5]=1-(Xe+br),w[6]=gr+Xt,w[7]=0,w[8]=wt+kr,w[9]=gr-Xt,w[10]=1-(Xe+Ot),w[11]=0,w[12]=Ue[0],w[13]=Ue[1],w[14]=Ue[2],w[15]=1,w}function je(w,X){var Ue=new j.WT(3),Ve=-X[0],ot=-X[1],At=-X[2],Q=X[3],Rt=X[4],dr=X[5],Cr=X[6],Xe=X[7],rt=Ve*Ve+ot*ot+At*At+Q*Q;return rt>0?(Ue[0]=(Rt*Q+Xe*Ve+dr*At-Cr*ot)*2/rt,Ue[1]=(dr*Q+Xe*ot+Cr*Ve-Rt*At)*2/rt,Ue[2]=(Cr*Q+Xe*At+Rt*ot-dr*Ve)*2/rt):(Ue[0]=(Rt*Q+Xe*Ve+dr*At-Cr*ot)*2,Ue[1]=(dr*Q+Xe*ot+Cr*Ve-Rt*At)*2,Ue[2]=(Cr*Q+Xe*At+Rt*ot-dr*Ve)*2),Tt(w,X,Ue),w}function Pt(w,X){return w[0]=X[12],w[1]=X[13],w[2]=X[14],w}function fr(w,X){var Ue=X[0],Ve=X[1],ot=X[2],At=X[4],Q=X[5],Rt=X[6],dr=X[8],Cr=X[9],Xe=X[10];return w[0]=Math.hypot(Ue,Ve,ot),w[1]=Math.hypot(At,Q,Rt),w[2]=Math.hypot(dr,Cr,Xe),w}function $t(w,X){var Ue=new j.WT(3);fr(Ue,X);var Ve=1/Ue[0],ot=1/Ue[1],At=1/Ue[2],Q=X[0]*Ve,Rt=X[1]*ot,dr=X[2]*At,Cr=X[4]*Ve,Xe=X[5]*ot,rt=X[6]*At,wt=X[8]*Ve,Ot=X[9]*ot,gr=X[10]*At,br=Q+Xe+gr,Xt=0;return br>0?(Xt=Math.sqrt(br+1)*2,w[3]=.25*Xt,w[0]=(rt-Ot)/Xt,w[1]=(wt-dr)/Xt,w[2]=(Rt-Cr)/Xt):Q>Xe&&Q>gr?(Xt=Math.sqrt(1+Q-Xe-gr)*2,w[3]=(rt-Ot)/Xt,w[0]=.25*Xt,w[1]=(Rt+Cr)/Xt,w[2]=(wt+dr)/Xt):Xe>gr?(Xt=Math.sqrt(1+Xe-Q-gr)*2,w[3]=(wt-dr)/Xt,w[0]=(Rt+Cr)/Xt,w[1]=.25*Xt,w[2]=(rt+Ot)/Xt):(Xt=Math.sqrt(1+gr-Q-Xe)*2,w[3]=(Rt-Cr)/Xt,w[0]=(wt+dr)/Xt,w[1]=(rt+Ot)/Xt,w[2]=.25*Xt),w}function zr(w,X,Ue,Ve){var ot=X[0],At=X[1],Q=X[2],Rt=X[3],dr=ot+ot,Cr=At+At,Xe=Q+Q,rt=ot*dr,wt=ot*Cr,Ot=ot*Xe,gr=At*Cr,br=At*Xe,Xt=Q*Xe,kr=Rt*dr,Mr=Rt*Cr,un=Rt*Xe,an=Ve[0],Kn=Ve[1],ti=Ve[2];return w[0]=(1-(gr+Xt))*an,w[1]=(wt+un)*an,w[2]=(Ot-Mr)*an,w[3]=0,w[4]=(wt-un)*Kn,w[5]=(1-(rt+Xt))*Kn,w[6]=(br+kr)*Kn,w[7]=0,w[8]=(Ot+Mr)*ti,w[9]=(br-kr)*ti,w[10]=(1-(rt+gr))*ti,w[11]=0,w[12]=Ue[0],w[13]=Ue[1],w[14]=Ue[2],w[15]=1,w}function fe(w,X,Ue,Ve,ot){var At=X[0],Q=X[1],Rt=X[2],dr=X[3],Cr=At+At,Xe=Q+Q,rt=Rt+Rt,wt=At*Cr,Ot=At*Xe,gr=At*rt,br=Q*Xe,Xt=Q*rt,kr=Rt*rt,Mr=dr*Cr,un=dr*Xe,an=dr*rt,Kn=Ve[0],ti=Ve[1],Qi=Ve[2],Ai=ot[0],Pi=ot[1],q=ot[2],le=(1-(br+kr))*Kn,pe=(Ot+an)*Kn,U=(gr-un)*Kn,ae=(Ot-an)*ti,de=(1-(wt+kr))*ti,Pe=(Xt+Mr)*ti,ue=(gr+un)*Qi,Ee=(Xt-Mr)*Qi,mt=(1-(wt+br))*Qi;return w[0]=le,w[1]=pe,w[2]=U,w[3]=0,w[4]=ae,w[5]=de,w[6]=Pe,w[7]=0,w[8]=ue,w[9]=Ee,w[10]=mt,w[11]=0,w[12]=Ue[0]+Ai-(le*Ai+ae*Pi+ue*q),w[13]=Ue[1]+Pi-(pe*Ai+de*Pi+Ee*q),w[14]=Ue[2]+q-(U*Ai+Pe*Pi+mt*q),w[15]=1,w}function ke(w,X){var Ue=X[0],Ve=X[1],ot=X[2],At=X[3],Q=Ue+Ue,Rt=Ve+Ve,dr=ot+ot,Cr=Ue*Q,Xe=Ve*Q,rt=Ve*Rt,wt=ot*Q,Ot=ot*Rt,gr=ot*dr,br=At*Q,Xt=At*Rt,kr=At*dr;return w[0]=1-rt-gr,w[1]=Xe+kr,w[2]=wt-Xt,w[3]=0,w[4]=Xe-kr,w[5]=1-Cr-gr,w[6]=Ot+br,w[7]=0,w[8]=wt+Xt,w[9]=Ot-br,w[10]=1-Cr-rt,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function ge(w,X,Ue,Ve,ot,At,Q){var Rt=1/(Ue-X),dr=1/(ot-Ve),Cr=1/(At-Q);return w[0]=At*2*Rt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=At*2*dr,w[6]=0,w[7]=0,w[8]=(Ue+X)*Rt,w[9]=(ot+Ve)*dr,w[10]=(Q+At)*Cr,w[11]=-1,w[12]=0,w[13]=0,w[14]=Q*At*2*Cr,w[15]=0,w}function _t(w,X,Ue,Ve,ot){var At=1/Math.tan(X/2),Q;return w[0]=At/Ue,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=At,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,ot!=null&&ot!==Infinity?(Q=1/(Ve-ot),w[10]=(ot+Ve)*Q,w[14]=2*ot*Ve*Q):(w[10]=-1,w[14]=-2*Ve),w}var vt=_t;function jt(w,X,Ue,Ve,ot){var At=1/Math.tan(X/2),Q;return w[0]=At/Ue,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=At,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,ot!=null&&ot!==Infinity?(Q=1/(Ve-ot),w[10]=ot*Q,w[14]=ot*Ve*Q):(w[10]=-1,w[14]=-Ve),w}function Bt(w,X,Ue,Ve){var ot=Math.tan(X.upDegrees*Math.PI/180),At=Math.tan(X.downDegrees*Math.PI/180),Q=Math.tan(X.leftDegrees*Math.PI/180),Rt=Math.tan(X.rightDegrees*Math.PI/180),dr=2/(Q+Rt),Cr=2/(ot+At);return w[0]=dr,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Cr,w[6]=0,w[7]=0,w[8]=-((Q-Rt)*dr*.5),w[9]=(ot-At)*Cr*.5,w[10]=Ve/(Ue-Ve),w[11]=-1,w[12]=0,w[13]=0,w[14]=Ve*Ue/(Ue-Ve),w[15]=0,w}function Nr(w,X,Ue,Ve,ot,At,Q){var Rt=1/(X-Ue),dr=1/(Ve-ot),Cr=1/(At-Q);return w[0]=-2*Rt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*dr,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=2*Cr,w[11]=0,w[12]=(X+Ue)*Rt,w[13]=(ot+Ve)*dr,w[14]=(Q+At)*Cr,w[15]=1,w}var pn=Nr;function mn(w,X,Ue,Ve,ot,At,Q){var Rt=1/(X-Ue),dr=1/(Ve-ot),Cr=1/(At-Q);return w[0]=-2*Rt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*dr,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=Cr,w[11]=0,w[12]=(X+Ue)*Rt,w[13]=(ot+Ve)*dr,w[14]=At*Cr,w[15]=1,w}function Ni(w,X,Ue,Ve){var ot,At,Q,Rt,dr,Cr,Xe,rt,wt,Ot,gr=X[0],br=X[1],Xt=X[2],kr=Ve[0],Mr=Ve[1],un=Ve[2],an=Ue[0],Kn=Ue[1],ti=Ue[2];return Math.abs(gr-an)<j.Ib&&Math.abs(br-Kn)<j.Ib&&Math.abs(Xt-ti)<j.Ib?G(w):(Xe=gr-an,rt=br-Kn,wt=Xt-ti,Ot=1/Math.hypot(Xe,rt,wt),Xe*=Ot,rt*=Ot,wt*=Ot,ot=Mr*wt-un*rt,At=un*Xe-kr*wt,Q=kr*rt-Mr*Xe,Ot=Math.hypot(ot,At,Q),Ot?(Ot=1/Ot,ot*=Ot,At*=Ot,Q*=Ot):(ot=0,At=0,Q=0),Rt=rt*Q-wt*At,dr=wt*ot-Xe*Q,Cr=Xe*At-rt*ot,Ot=Math.hypot(Rt,dr,Cr),Ot?(Ot=1/Ot,Rt*=Ot,dr*=Ot,Cr*=Ot):(Rt=0,dr=0,Cr=0),w[0]=ot,w[1]=Rt,w[2]=Xe,w[3]=0,w[4]=At,w[5]=dr,w[6]=rt,w[7]=0,w[8]=Q,w[9]=Cr,w[10]=wt,w[11]=0,w[12]=-(ot*gr+At*br+Q*Xt),w[13]=-(Rt*gr+dr*br+Cr*Xt),w[14]=-(Xe*gr+rt*br+wt*Xt),w[15]=1,w)}function or(w,X,Ue,Ve){var ot=X[0],At=X[1],Q=X[2],Rt=Ve[0],dr=Ve[1],Cr=Ve[2],Xe=ot-Ue[0],rt=At-Ue[1],wt=Q-Ue[2],Ot=Xe*Xe+rt*rt+wt*wt;Ot>0&&(Ot=1/Math.sqrt(Ot),Xe*=Ot,rt*=Ot,wt*=Ot);var gr=dr*wt-Cr*rt,br=Cr*Xe-Rt*wt,Xt=Rt*rt-dr*Xe;return Ot=gr*gr+br*br+Xt*Xt,Ot>0&&(Ot=1/Math.sqrt(Ot),gr*=Ot,br*=Ot,Xt*=Ot),w[0]=gr,w[1]=br,w[2]=Xt,w[3]=0,w[4]=rt*Xt-wt*br,w[5]=wt*gr-Xe*Xt,w[6]=Xe*br-rt*gr,w[7]=0,w[8]=Xe,w[9]=rt,w[10]=wt,w[11]=0,w[12]=ot,w[13]=At,w[14]=Q,w[15]=1,w}function ve(w){return"mat4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+", "+w[4]+", "+w[5]+", "+w[6]+", "+w[7]+", "+w[8]+", "+w[9]+", "+w[10]+", "+w[11]+", "+w[12]+", "+w[13]+", "+w[14]+", "+w[15]+")"}function Me(w){return Math.hypot(w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15])}function Ge(w,X,Ue){return w[0]=X[0]+Ue[0],w[1]=X[1]+Ue[1],w[2]=X[2]+Ue[2],w[3]=X[3]+Ue[3],w[4]=X[4]+Ue[4],w[5]=X[5]+Ue[5],w[6]=X[6]+Ue[6],w[7]=X[7]+Ue[7],w[8]=X[8]+Ue[8],w[9]=X[9]+Ue[9],w[10]=X[10]+Ue[10],w[11]=X[11]+Ue[11],w[12]=X[12]+Ue[12],w[13]=X[13]+Ue[13],w[14]=X[14]+Ue[14],w[15]=X[15]+Ue[15],w}function Re(w,X,Ue){return w[0]=X[0]-Ue[0],w[1]=X[1]-Ue[1],w[2]=X[2]-Ue[2],w[3]=X[3]-Ue[3],w[4]=X[4]-Ue[4],w[5]=X[5]-Ue[5],w[6]=X[6]-Ue[6],w[7]=X[7]-Ue[7],w[8]=X[8]-Ue[8],w[9]=X[9]-Ue[9],w[10]=X[10]-Ue[10],w[11]=X[11]-Ue[11],w[12]=X[12]-Ue[12],w[13]=X[13]-Ue[13],w[14]=X[14]-Ue[14],w[15]=X[15]-Ue[15],w}function kt(w,X,Ue){return w[0]=X[0]*Ue,w[1]=X[1]*Ue,w[2]=X[2]*Ue,w[3]=X[3]*Ue,w[4]=X[4]*Ue,w[5]=X[5]*Ue,w[6]=X[6]*Ue,w[7]=X[7]*Ue,w[8]=X[8]*Ue,w[9]=X[9]*Ue,w[10]=X[10]*Ue,w[11]=X[11]*Ue,w[12]=X[12]*Ue,w[13]=X[13]*Ue,w[14]=X[14]*Ue,w[15]=X[15]*Ue,w}function rr(w,X,Ue,Ve){return w[0]=X[0]+Ue[0]*Ve,w[1]=X[1]+Ue[1]*Ve,w[2]=X[2]+Ue[2]*Ve,w[3]=X[3]+Ue[3]*Ve,w[4]=X[4]+Ue[4]*Ve,w[5]=X[5]+Ue[5]*Ve,w[6]=X[6]+Ue[6]*Ve,w[7]=X[7]+Ue[7]*Ve,w[8]=X[8]+Ue[8]*Ve,w[9]=X[9]+Ue[9]*Ve,w[10]=X[10]+Ue[10]*Ve,w[11]=X[11]+Ue[11]*Ve,w[12]=X[12]+Ue[12]*Ve,w[13]=X[13]+Ue[13]*Ve,w[14]=X[14]+Ue[14]*Ve,w[15]=X[15]+Ue[15]*Ve,w}function yr(w,X){return w[0]===X[0]&&w[1]===X[1]&&w[2]===X[2]&&w[3]===X[3]&&w[4]===X[4]&&w[5]===X[5]&&w[6]===X[6]&&w[7]===X[7]&&w[8]===X[8]&&w[9]===X[9]&&w[10]===X[10]&&w[11]===X[11]&&w[12]===X[12]&&w[13]===X[13]&&w[14]===X[14]&&w[15]===X[15]}function Pr(w,X){var Ue=w[0],Ve=w[1],ot=w[2],At=w[3],Q=w[4],Rt=w[5],dr=w[6],Cr=w[7],Xe=w[8],rt=w[9],wt=w[10],Ot=w[11],gr=w[12],br=w[13],Xt=w[14],kr=w[15],Mr=X[0],un=X[1],an=X[2],Kn=X[3],ti=X[4],Qi=X[5],Ai=X[6],Pi=X[7],q=X[8],le=X[9],pe=X[10],U=X[11],ae=X[12],de=X[13],Pe=X[14],ue=X[15];return Math.abs(Ue-Mr)<=j.Ib*Math.max(1,Math.abs(Ue),Math.abs(Mr))&&Math.abs(Ve-un)<=j.Ib*Math.max(1,Math.abs(Ve),Math.abs(un))&&Math.abs(ot-an)<=j.Ib*Math.max(1,Math.abs(ot),Math.abs(an))&&Math.abs(At-Kn)<=j.Ib*Math.max(1,Math.abs(At),Math.abs(Kn))&&Math.abs(Q-ti)<=j.Ib*Math.max(1,Math.abs(Q),Math.abs(ti))&&Math.abs(Rt-Qi)<=j.Ib*Math.max(1,Math.abs(Rt),Math.abs(Qi))&&Math.abs(dr-Ai)<=j.Ib*Math.max(1,Math.abs(dr),Math.abs(Ai))&&Math.abs(Cr-Pi)<=j.Ib*Math.max(1,Math.abs(Cr),Math.abs(Pi))&&Math.abs(Xe-q)<=j.Ib*Math.max(1,Math.abs(Xe),Math.abs(q))&&Math.abs(rt-le)<=j.Ib*Math.max(1,Math.abs(rt),Math.abs(le))&&Math.abs(wt-pe)<=j.Ib*Math.max(1,Math.abs(wt),Math.abs(pe))&&Math.abs(Ot-U)<=j.Ib*Math.max(1,Math.abs(Ot),Math.abs(U))&&Math.abs(gr-ae)<=j.Ib*Math.max(1,Math.abs(gr),Math.abs(ae))&&Math.abs(br-de)<=j.Ib*Math.max(1,Math.abs(br),Math.abs(de))&&Math.abs(Xt-Pe)<=j.Ib*Math.max(1,Math.abs(Xt),Math.abs(Pe))&&Math.abs(kr-ue)<=j.Ib*Math.max(1,Math.abs(kr),Math.abs(ue))}var sr=Le,Rr=Re},98333:function(qe,D,y){"use strict";y.d(D,{Ue:function(){return b},al:function(){return E},bA:function(){return Ut},fF:function(){return $t}});var j=y(49685);function b(){var ve=new j.WT(4);return j.WT!=Float32Array&&(ve[0]=0,ve[1]=0,ve[2]=0,ve[3]=0),ve}function p(ve){var Me=new glMatrix.ARRAY_TYPE(4);return Me[0]=ve[0],Me[1]=ve[1],Me[2]=ve[2],Me[3]=ve[3],Me}function E(ve,Me,Ge,Re){var kt=new j.WT(4);return kt[0]=ve,kt[1]=Me,kt[2]=Ge,kt[3]=Re,kt}function Z(ve,Me){return ve[0]=Me[0],ve[1]=Me[1],ve[2]=Me[2],ve[3]=Me[3],ve}function V(ve,Me,Ge,Re,kt){return ve[0]=Me,ve[1]=Ge,ve[2]=Re,ve[3]=kt,ve}function G(ve,Me,Ge){return ve[0]=Me[0]+Ge[0],ve[1]=Me[1]+Ge[1],ve[2]=Me[2]+Ge[2],ve[3]=Me[3]+Ge[3],ve}function I(ve,Me,Ge){return ve[0]=Me[0]-Ge[0],ve[1]=Me[1]-Ge[1],ve[2]=Me[2]-Ge[2],ve[3]=Me[3]-Ge[3],ve}function L(ve,Me,Ge){return ve[0]=Me[0]*Ge[0],ve[1]=Me[1]*Ge[1],ve[2]=Me[2]*Ge[2],ve[3]=Me[3]*Ge[3],ve}function _e(ve,Me,Ge){return ve[0]=Me[0]/Ge[0],ve[1]=Me[1]/Ge[1],ve[2]=Me[2]/Ge[2],ve[3]=Me[3]/Ge[3],ve}function be(ve,Me){return ve[0]=Math.ceil(Me[0]),ve[1]=Math.ceil(Me[1]),ve[2]=Math.ceil(Me[2]),ve[3]=Math.ceil(Me[3]),ve}function Le(ve,Me){return ve[0]=Math.floor(Me[0]),ve[1]=Math.floor(Me[1]),ve[2]=Math.floor(Me[2]),ve[3]=Math.floor(Me[3]),ve}function Je(ve,Me,Ge){return ve[0]=Math.min(Me[0],Ge[0]),ve[1]=Math.min(Me[1],Ge[1]),ve[2]=Math.min(Me[2],Ge[2]),ve[3]=Math.min(Me[3],Ge[3]),ve}function Dt(ve,Me,Ge){return ve[0]=Math.max(Me[0],Ge[0]),ve[1]=Math.max(Me[1],Ge[1]),ve[2]=Math.max(Me[2],Ge[2]),ve[3]=Math.max(Me[3],Ge[3]),ve}function It(ve,Me){return ve[0]=Math.round(Me[0]),ve[1]=Math.round(Me[1]),ve[2]=Math.round(Me[2]),ve[3]=Math.round(Me[3]),ve}function Ut(ve,Me,Ge){return ve[0]=Me[0]*Ge,ve[1]=Me[1]*Ge,ve[2]=Me[2]*Ge,ve[3]=Me[3]*Ge,ve}function xt(ve,Me,Ge,Re){return ve[0]=Me[0]+Ge[0]*Re,ve[1]=Me[1]+Ge[1]*Re,ve[2]=Me[2]+Ge[2]*Re,ve[3]=Me[3]+Ge[3]*Re,ve}function bt(ve,Me){var Ge=Me[0]-ve[0],Re=Me[1]-ve[1],kt=Me[2]-ve[2],rr=Me[3]-ve[3];return Math.hypot(Ge,Re,kt,rr)}function ct(ve,Me){var Ge=Me[0]-ve[0],Re=Me[1]-ve[1],kt=Me[2]-ve[2],rr=Me[3]-ve[3];return Ge*Ge+Re*Re+kt*kt+rr*rr}function ir(ve){var Me=ve[0],Ge=ve[1],Re=ve[2],kt=ve[3];return Math.hypot(Me,Ge,Re,kt)}function re(ve){var Me=ve[0],Ge=ve[1],Re=ve[2],kt=ve[3];return Me*Me+Ge*Ge+Re*Re+kt*kt}function cr(ve,Me){return ve[0]=-Me[0],ve[1]=-Me[1],ve[2]=-Me[2],ve[3]=-Me[3],ve}function Ct(ve,Me){return ve[0]=1/Me[0],ve[1]=1/Me[1],ve[2]=1/Me[2],ve[3]=1/Me[3],ve}function Qe(ve,Me){var Ge=Me[0],Re=Me[1],kt=Me[2],rr=Me[3],yr=Ge*Ge+Re*Re+kt*kt+rr*rr;return yr>0&&(yr=1/Math.sqrt(yr)),ve[0]=Ge*yr,ve[1]=Re*yr,ve[2]=kt*yr,ve[3]=rr*yr,ve}function Tt(ve,Me){return ve[0]*Me[0]+ve[1]*Me[1]+ve[2]*Me[2]+ve[3]*Me[3]}function je(ve,Me,Ge,Re){var kt=Ge[0]*Re[1]-Ge[1]*Re[0],rr=Ge[0]*Re[2]-Ge[2]*Re[0],yr=Ge[0]*Re[3]-Ge[3]*Re[0],Pr=Ge[1]*Re[2]-Ge[2]*Re[1],sr=Ge[1]*Re[3]-Ge[3]*Re[1],Rr=Ge[2]*Re[3]-Ge[3]*Re[2],w=Me[0],X=Me[1],Ue=Me[2],Ve=Me[3];return ve[0]=X*Rr-Ue*sr+Ve*Pr,ve[1]=-(w*Rr)+Ue*yr-Ve*rr,ve[2]=w*sr-X*yr+Ve*kt,ve[3]=-(w*Pr)+X*rr-Ue*kt,ve}function Pt(ve,Me,Ge,Re){var kt=Me[0],rr=Me[1],yr=Me[2],Pr=Me[3];return ve[0]=kt+Re*(Ge[0]-kt),ve[1]=rr+Re*(Ge[1]-rr),ve[2]=yr+Re*(Ge[2]-yr),ve[3]=Pr+Re*(Ge[3]-Pr),ve}function fr(ve,Me){Me=Me||1;var Ge,Re,kt,rr,yr,Pr;do Ge=glMatrix.RANDOM()*2-1,Re=glMatrix.RANDOM()*2-1,yr=Ge*Ge+Re*Re;while(yr>=1);do kt=glMatrix.RANDOM()*2-1,rr=glMatrix.RANDOM()*2-1,Pr=kt*kt+rr*rr;while(Pr>=1);var sr=Math.sqrt((1-yr)/Pr);return ve[0]=Me*Ge,ve[1]=Me*Re,ve[2]=Me*kt*sr,ve[3]=Me*rr*sr,ve}function $t(ve,Me,Ge){var Re=Me[0],kt=Me[1],rr=Me[2],yr=Me[3];return ve[0]=Ge[0]*Re+Ge[4]*kt+Ge[8]*rr+Ge[12]*yr,ve[1]=Ge[1]*Re+Ge[5]*kt+Ge[9]*rr+Ge[13]*yr,ve[2]=Ge[2]*Re+Ge[6]*kt+Ge[10]*rr+Ge[14]*yr,ve[3]=Ge[3]*Re+Ge[7]*kt+Ge[11]*rr+Ge[15]*yr,ve}function zr(ve,Me,Ge){var Re=Me[0],kt=Me[1],rr=Me[2],yr=Ge[0],Pr=Ge[1],sr=Ge[2],Rr=Ge[3],w=Rr*Re+Pr*rr-sr*kt,X=Rr*kt+sr*Re-yr*rr,Ue=Rr*rr+yr*kt-Pr*Re,Ve=-yr*Re-Pr*kt-sr*rr;return ve[0]=w*Rr+Ve*-yr+X*-sr-Ue*-Pr,ve[1]=X*Rr+Ve*-Pr+Ue*-yr-w*-sr,ve[2]=Ue*Rr+Ve*-sr+w*-Pr-X*-yr,ve[3]=Me[3],ve}function fe(ve){return ve[0]=0,ve[1]=0,ve[2]=0,ve[3]=0,ve}function ke(ve){return"vec4("+ve[0]+", "+ve[1]+", "+ve[2]+", "+ve[3]+")"}function ge(ve,Me){return ve[0]===Me[0]&&ve[1]===Me[1]&&ve[2]===Me[2]&&ve[3]===Me[3]}function _t(ve,Me){var Ge=ve[0],Re=ve[1],kt=ve[2],rr=ve[3],yr=Me[0],Pr=Me[1],sr=Me[2],Rr=Me[3];return Math.abs(Ge-yr)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ge),Math.abs(yr))&&Math.abs(Re-Pr)<=glMatrix.EPSILON*Math.max(1,Math.abs(Re),Math.abs(Pr))&&Math.abs(kt-sr)<=glMatrix.EPSILON*Math.max(1,Math.abs(kt),Math.abs(sr))&&Math.abs(rr-Rr)<=glMatrix.EPSILON*Math.max(1,Math.abs(rr),Math.abs(Rr))}var vt=null,jt=null,Bt=null,Nr=null,pn=null,mn=null,Ni=null,or=function(){var ve=b();return function(Me,Ge,Re,kt,rr,yr){var Pr,sr;for(Ge||(Ge=4),Re||(Re=0),kt?sr=Math.min(kt*Ge+Re,Me.length):sr=Me.length,Pr=Re;Pr<sr;Pr+=Ge)ve[0]=Me[Pr],ve[1]=Me[Pr+1],ve[2]=Me[Pr+2],ve[3]=Me[Pr+3],rr(ve,ve,yr),Me[Pr]=ve[0],Me[Pr+1]=ve[1],Me[Pr+2]=ve[2],Me[Pr+3]=ve[3];return Me}}()},50840:function(qe,D,y){var j;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(b,p,E,Z){"use strict";var V=["","webkit","Moz","MS","ms","o"],G=p.createElement("div"),I="function",L=Math.round,_e=Math.abs,be=Date.now;function Le(xe,Fe,pt){return setTimeout(ir(xe,pt),Fe)}function Je(xe,Fe,pt){return Array.isArray(xe)?(Dt(xe,pt[Fe],pt),!0):!1}function Dt(xe,Fe,pt){var Jt;if(!!xe)if(xe.forEach)xe.forEach(Fe,pt);else if(xe.length!==Z)for(Jt=0;Jt<xe.length;)Fe.call(pt,xe[Jt],Jt,xe),Jt++;else for(Jt in xe)xe.hasOwnProperty(Jt)&&Fe.call(pt,xe[Jt],Jt,xe)}function It(xe,Fe,pt){var Jt="DEPRECATED METHOD: "+Fe+`
`+pt+` AT 
`;return function(){var Yr=new Error("get-stack-trace"),Qn=Yr&&Yr.stack?Yr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ci=b.console&&(b.console.warn||b.console.log);return Ci&&Ci.call(b.console,Jt,Qn),xe.apply(this,arguments)}}var Ut;typeof Object.assign!="function"?Ut=function(Fe){if(Fe===Z||Fe===null)throw new TypeError("Cannot convert undefined or null to object");for(var pt=Object(Fe),Jt=1;Jt<arguments.length;Jt++){var Yr=arguments[Jt];if(Yr!==Z&&Yr!==null)for(var Qn in Yr)Yr.hasOwnProperty(Qn)&&(pt[Qn]=Yr[Qn])}return pt}:Ut=Object.assign;var xt=It(function(Fe,pt,Jt){for(var Yr=Object.keys(pt),Qn=0;Qn<Yr.length;)(!Jt||Jt&&Fe[Yr[Qn]]===Z)&&(Fe[Yr[Qn]]=pt[Yr[Qn]]),Qn++;return Fe},"extend","Use `assign`."),bt=It(function(Fe,pt){return xt(Fe,pt,!0)},"merge","Use `assign`.");function ct(xe,Fe,pt){var Jt=Fe.prototype,Yr;Yr=xe.prototype=Object.create(Jt),Yr.constructor=xe,Yr._super=Jt,pt&&Ut(Yr,pt)}function ir(xe,Fe){return function(){return xe.apply(Fe,arguments)}}function re(xe,Fe){return typeof xe==I?xe.apply(Fe&&Fe[0]||Z,Fe):xe}function cr(xe,Fe){return xe===Z?Fe:xe}function Ct(xe,Fe,pt){Dt(Pt(Fe),function(Jt){xe.addEventListener(Jt,pt,!1)})}function Qe(xe,Fe,pt){Dt(Pt(Fe),function(Jt){xe.removeEventListener(Jt,pt,!1)})}function Tt(xe,Fe){for(;xe;){if(xe==Fe)return!0;xe=xe.parentNode}return!1}function je(xe,Fe){return xe.indexOf(Fe)>-1}function Pt(xe){return xe.trim().split(/\s+/g)}function fr(xe,Fe,pt){if(xe.indexOf&&!pt)return xe.indexOf(Fe);for(var Jt=0;Jt<xe.length;){if(pt&&xe[Jt][pt]==Fe||!pt&&xe[Jt]===Fe)return Jt;Jt++}return-1}function $t(xe){return Array.prototype.slice.call(xe,0)}function zr(xe,Fe,pt){for(var Jt=[],Yr=[],Qn=0;Qn<xe.length;){var Ci=Fe?xe[Qn][Fe]:xe[Qn];fr(Yr,Ci)<0&&Jt.push(xe[Qn]),Yr[Qn]=Ci,Qn++}return pt&&(Fe?Jt=Jt.sort(function(mo,oo){return mo[Fe]>oo[Fe]}):Jt=Jt.sort()),Jt}function fe(xe,Fe){for(var pt,Jt,Yr=Fe[0].toUpperCase()+Fe.slice(1),Qn=0;Qn<V.length;){if(pt=V[Qn],Jt=pt?pt+Yr:Fe,Jt in xe)return Jt;Qn++}return Z}var ke=1;function ge(){return ke++}function _t(xe){var Fe=xe.ownerDocument||xe;return Fe.defaultView||Fe.parentWindow||b}var vt=/mobile|tablet|ip(ad|hone|od)|android/i,jt="ontouchstart"in b,Bt=fe(b,"PointerEvent")!==Z,Nr=jt&&vt.test(navigator.userAgent),pn="touch",mn="pen",Ni="mouse",or="kinect",ve=25,Me=1,Ge=2,Re=4,kt=8,rr=1,yr=2,Pr=4,sr=8,Rr=16,w=yr|Pr,X=sr|Rr,Ue=w|X,Ve=["x","y"],ot=["clientX","clientY"];function At(xe,Fe){var pt=this;this.manager=xe,this.callback=Fe,this.element=xe.element,this.target=xe.options.inputTarget,this.domHandler=function(Jt){re(xe.options.enable,[xe])&&pt.handler(Jt)},this.init()}At.prototype={handler:function(){},init:function(){this.evEl&&Ct(this.element,this.evEl,this.domHandler),this.evTarget&&Ct(this.target,this.evTarget,this.domHandler),this.evWin&&Ct(_t(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Qe(this.element,this.evEl,this.domHandler),this.evTarget&&Qe(this.target,this.evTarget,this.domHandler),this.evWin&&Qe(_t(this.element),this.evWin,this.domHandler)}};function Q(xe){var Fe,pt=xe.options.inputClass;return pt?Fe=pt:Bt?Fe=le:Nr?Fe=mt:jt?Fe=Ur:Fe=ti,new Fe(xe,Rt)}function Rt(xe,Fe,pt){var Jt=pt.pointers.length,Yr=pt.changedPointers.length,Qn=Fe&Me&&Jt-Yr==0,Ci=Fe&(Re|kt)&&Jt-Yr==0;pt.isFirst=!!Qn,pt.isFinal=!!Ci,Qn&&(xe.session={}),pt.eventType=Fe,dr(xe,pt),xe.emit("hammer.input",pt),xe.recognize(pt),xe.session.prevInput=pt}function dr(xe,Fe){var pt=xe.session,Jt=Fe.pointers,Yr=Jt.length;pt.firstInput||(pt.firstInput=rt(Fe)),Yr>1&&!pt.firstMultiple?pt.firstMultiple=rt(Fe):Yr===1&&(pt.firstMultiple=!1);var Qn=pt.firstInput,Ci=pt.firstMultiple,Za=Ci?Ci.center:Qn.center,mo=Fe.center=wt(Jt);Fe.timeStamp=be(),Fe.deltaTime=Fe.timeStamp-Qn.timeStamp,Fe.angle=Xt(Za,mo),Fe.distance=br(Za,mo),Cr(pt,Fe),Fe.offsetDirection=gr(Fe.deltaX,Fe.deltaY);var oo=Ot(Fe.deltaTime,Fe.deltaX,Fe.deltaY);Fe.overallVelocityX=oo.x,Fe.overallVelocityY=oo.y,Fe.overallVelocity=_e(oo.x)>_e(oo.y)?oo.x:oo.y,Fe.scale=Ci?Mr(Ci.pointers,Jt):1,Fe.rotation=Ci?kr(Ci.pointers,Jt):0,Fe.maxPointers=pt.prevInput?Fe.pointers.length>pt.prevInput.maxPointers?Fe.pointers.length:pt.prevInput.maxPointers:Fe.pointers.length,Xe(pt,Fe);var es=xe.element;Tt(Fe.srcEvent.target,es)&&(es=Fe.srcEvent.target),Fe.target=es}function Cr(xe,Fe){var pt=Fe.center,Jt=xe.offsetDelta||{},Yr=xe.prevDelta||{},Qn=xe.prevInput||{};(Fe.eventType===Me||Qn.eventType===Re)&&(Yr=xe.prevDelta={x:Qn.deltaX||0,y:Qn.deltaY||0},Jt=xe.offsetDelta={x:pt.x,y:pt.y}),Fe.deltaX=Yr.x+(pt.x-Jt.x),Fe.deltaY=Yr.y+(pt.y-Jt.y)}function Xe(xe,Fe){var pt=xe.lastInterval||Fe,Jt=Fe.timeStamp-pt.timeStamp,Yr,Qn,Ci,Za;if(Fe.eventType!=kt&&(Jt>ve||pt.velocity===Z)){var mo=Fe.deltaX-pt.deltaX,oo=Fe.deltaY-pt.deltaY,es=Ot(Jt,mo,oo);Qn=es.x,Ci=es.y,Yr=_e(es.x)>_e(es.y)?es.x:es.y,Za=gr(mo,oo),xe.lastInterval=Fe}else Yr=pt.velocity,Qn=pt.velocityX,Ci=pt.velocityY,Za=pt.direction;Fe.velocity=Yr,Fe.velocityX=Qn,Fe.velocityY=Ci,Fe.direction=Za}function rt(xe){for(var Fe=[],pt=0;pt<xe.pointers.length;)Fe[pt]={clientX:L(xe.pointers[pt].clientX),clientY:L(xe.pointers[pt].clientY)},pt++;return{timeStamp:be(),pointers:Fe,center:wt(Fe),deltaX:xe.deltaX,deltaY:xe.deltaY}}function wt(xe){var Fe=xe.length;if(Fe===1)return{x:L(xe[0].clientX),y:L(xe[0].clientY)};for(var pt=0,Jt=0,Yr=0;Yr<Fe;)pt+=xe[Yr].clientX,Jt+=xe[Yr].clientY,Yr++;return{x:L(pt/Fe),y:L(Jt/Fe)}}function Ot(xe,Fe,pt){return{x:Fe/xe||0,y:pt/xe||0}}function gr(xe,Fe){return xe===Fe?rr:_e(xe)>=_e(Fe)?xe<0?yr:Pr:Fe<0?sr:Rr}function br(xe,Fe,pt){pt||(pt=Ve);var Jt=Fe[pt[0]]-xe[pt[0]],Yr=Fe[pt[1]]-xe[pt[1]];return Math.sqrt(Jt*Jt+Yr*Yr)}function Xt(xe,Fe,pt){pt||(pt=Ve);var Jt=Fe[pt[0]]-xe[pt[0]],Yr=Fe[pt[1]]-xe[pt[1]];return Math.atan2(Yr,Jt)*180/Math.PI}function kr(xe,Fe){return Xt(Fe[1],Fe[0],ot)+Xt(xe[1],xe[0],ot)}function Mr(xe,Fe){return br(Fe[0],Fe[1],ot)/br(xe[0],xe[1],ot)}var un={mousedown:Me,mousemove:Ge,mouseup:Re},an="mousedown",Kn="mousemove mouseup";function ti(){this.evEl=an,this.evWin=Kn,this.pressed=!1,At.apply(this,arguments)}ct(ti,At,{handler:function(Fe){var pt=un[Fe.type];pt&Me&&Fe.button===0&&(this.pressed=!0),pt&Ge&&Fe.which!==1&&(pt=Re),!!this.pressed&&(pt&Re&&(this.pressed=!1),this.callback(this.manager,pt,{pointers:[Fe],changedPointers:[Fe],pointerType:Ni,srcEvent:Fe}))}});var Qi={pointerdown:Me,pointermove:Ge,pointerup:Re,pointercancel:kt,pointerout:kt},Ai={2:pn,3:mn,4:Ni,5:or},Pi="pointerdown",q="pointermove pointerup pointercancel";b.MSPointerEvent&&!b.PointerEvent&&(Pi="MSPointerDown",q="MSPointerMove MSPointerUp MSPointerCancel");function le(){this.evEl=Pi,this.evWin=q,At.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}ct(le,At,{handler:function(Fe){var pt=this.store,Jt=!1,Yr=Fe.type.toLowerCase().replace("ms",""),Qn=Qi[Yr],Ci=Ai[Fe.pointerType]||Fe.pointerType,Za=Ci==pn,mo=fr(pt,Fe.pointerId,"pointerId");Qn&Me&&(Fe.button===0||Za)?mo<0&&(pt.push(Fe),mo=pt.length-1):Qn&(Re|kt)&&(Jt=!0),!(mo<0)&&(pt[mo]=Fe,this.callback(this.manager,Qn,{pointers:pt,changedPointers:[Fe],pointerType:Ci,srcEvent:Fe}),Jt&&pt.splice(mo,1))}});var pe={touchstart:Me,touchmove:Ge,touchend:Re,touchcancel:kt},U="touchstart",ae="touchstart touchmove touchend touchcancel";function de(){this.evTarget=U,this.evWin=ae,this.started=!1,At.apply(this,arguments)}ct(de,At,{handler:function(Fe){var pt=pe[Fe.type];if(pt===Me&&(this.started=!0),!!this.started){var Jt=Pe.call(this,Fe,pt);pt&(Re|kt)&&Jt[0].length-Jt[1].length==0&&(this.started=!1),this.callback(this.manager,pt,{pointers:Jt[0],changedPointers:Jt[1],pointerType:pn,srcEvent:Fe})}}});function Pe(xe,Fe){var pt=$t(xe.touches),Jt=$t(xe.changedTouches);return Fe&(Re|kt)&&(pt=zr(pt.concat(Jt),"identifier",!0)),[pt,Jt]}var ue={touchstart:Me,touchmove:Ge,touchend:Re,touchcancel:kt},Ee="touchstart touchmove touchend touchcancel";function mt(){this.evTarget=Ee,this.targetIds={},At.apply(this,arguments)}ct(mt,At,{handler:function(Fe){var pt=ue[Fe.type],Jt=wr.call(this,Fe,pt);!Jt||this.callback(this.manager,pt,{pointers:Jt[0],changedPointers:Jt[1],pointerType:pn,srcEvent:Fe})}});function wr(xe,Fe){var pt=$t(xe.touches),Jt=this.targetIds;if(Fe&(Me|Ge)&&pt.length===1)return Jt[pt[0].identifier]=!0,[pt,pt];var Yr,Qn,Ci=$t(xe.changedTouches),Za=[],mo=this.target;if(Qn=pt.filter(function(oo){return Tt(oo.target,mo)}),Fe===Me)for(Yr=0;Yr<Qn.length;)Jt[Qn[Yr].identifier]=!0,Yr++;for(Yr=0;Yr<Ci.length;)Jt[Ci[Yr].identifier]&&Za.push(Ci[Yr]),Fe&(Re|kt)&&delete Jt[Ci[Yr].identifier],Yr++;if(!!Za.length)return[zr(Qn.concat(Za),"identifier",!0),Za]}var Yt=2500,tr=25;function Ur(){At.apply(this,arguments);var xe=ir(this.handler,this);this.touch=new mt(this.manager,xe),this.mouse=new ti(this.manager,xe),this.primaryTouch=null,this.lastTouches=[]}ct(Ur,At,{handler:function(Fe,pt,Jt){var Yr=Jt.pointerType==pn,Qn=Jt.pointerType==Ni;if(!(Qn&&Jt.sourceCapabilities&&Jt.sourceCapabilities.firesTouchEvents)){if(Yr)Fn.call(this,pt,Jt);else if(Qn&&qt.call(this,Jt))return;this.callback(Fe,pt,Jt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Fn(xe,Fe){xe&Me?(this.primaryTouch=Fe.changedPointers[0].identifier,Rn.call(this,Fe)):xe&(Re|kt)&&Rn.call(this,Fe)}function Rn(xe){var Fe=xe.changedPointers[0];if(Fe.identifier===this.primaryTouch){var pt={x:Fe.clientX,y:Fe.clientY};this.lastTouches.push(pt);var Jt=this.lastTouches,Yr=function(){var Qn=Jt.indexOf(pt);Qn>-1&&Jt.splice(Qn,1)};setTimeout(Yr,Yt)}}function qt(xe){for(var Fe=xe.srcEvent.clientX,pt=xe.srcEvent.clientY,Jt=0;Jt<this.lastTouches.length;Jt++){var Yr=this.lastTouches[Jt],Qn=Math.abs(Fe-Yr.x),Ci=Math.abs(pt-Yr.y);if(Qn<=tr&&Ci<=tr)return!0}return!1}var Tn=fe(G.style,"touchAction"),ln=Tn!==Z,on="compute",Li="auto",bn="manipulation",Ii="none",ea="pan-x",ci="pan-y",qi=la();function zi(xe,Fe){this.manager=xe,this.set(Fe)}zi.prototype={set:function(xe){xe==on&&(xe=this.compute()),ln&&this.manager.element.style&&qi[xe]&&(this.manager.element.style[Tn]=xe),this.actions=xe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var xe=[];return Dt(this.manager.recognizers,function(Fe){re(Fe.options.enable,[Fe])&&(xe=xe.concat(Fe.getTouchAction()))}),Mi(xe.join(" "))},preventDefaults:function(xe){var Fe=xe.srcEvent,pt=xe.offsetDirection;if(this.manager.session.prevented){Fe.preventDefault();return}var Jt=this.actions,Yr=je(Jt,Ii)&&!qi[Ii],Qn=je(Jt,ci)&&!qi[ci],Ci=je(Jt,ea)&&!qi[ea];if(Yr){var Za=xe.pointers.length===1,mo=xe.distance<2,oo=xe.deltaTime<250;if(Za&&mo&&oo)return}if(!(Ci&&Qn)&&(Yr||Qn&&pt&w||Ci&&pt&X))return this.preventSrc(Fe)},preventSrc:function(xe){this.manager.session.prevented=!0,xe.preventDefault()}};function Mi(xe){if(je(xe,Ii))return Ii;var Fe=je(xe,ea),pt=je(xe,ci);return Fe&&pt?Ii:Fe||pt?Fe?ea:ci:je(xe,bn)?bn:Li}function la(){if(!ln)return!1;var xe={},Fe=b.CSS&&b.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(pt){xe[pt]=Fe?b.CSS.supports("touch-action",pt):!0}),xe}var Bi=1,ai=2,ki=4,wi=8,ro=wi,po=16,ia=32;function Gi(xe){this.options=Ut({},this.defaults,xe||{}),this.id=ge(),this.manager=null,this.options.enable=cr(this.options.enable,!0),this.state=Bi,this.simultaneous={},this.requireFail=[]}Gi.prototype={defaults:{},set:function(xe){return Ut(this.options,xe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(xe){if(Je(xe,"recognizeWith",this))return this;var Fe=this.simultaneous;return xe=Aa(xe,this),Fe[xe.id]||(Fe[xe.id]=xe,xe.recognizeWith(this)),this},dropRecognizeWith:function(xe){return Je(xe,"dropRecognizeWith",this)?this:(xe=Aa(xe,this),delete this.simultaneous[xe.id],this)},requireFailure:function(xe){if(Je(xe,"requireFailure",this))return this;var Fe=this.requireFail;return xe=Aa(xe,this),fr(Fe,xe)===-1&&(Fe.push(xe),xe.requireFailure(this)),this},dropRequireFailure:function(xe){if(Je(xe,"dropRequireFailure",this))return this;xe=Aa(xe,this);var Fe=fr(this.requireFail,xe);return Fe>-1&&this.requireFail.splice(Fe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(xe){return!!this.simultaneous[xe.id]},emit:function(xe){var Fe=this,pt=this.state;function Jt(Yr){Fe.manager.emit(Yr,xe)}pt<wi&&Jt(Fe.options.event+Zs(pt)),Jt(Fe.options.event),xe.additionalEvent&&Jt(xe.additionalEvent),pt>=wi&&Jt(Fe.options.event+Zs(pt))},tryEmit:function(xe){if(this.canEmit())return this.emit(xe);this.state=ia},canEmit:function(){for(var xe=0;xe<this.requireFail.length;){if(!(this.requireFail[xe].state&(ia|Bi)))return!1;xe++}return!0},recognize:function(xe){var Fe=Ut({},xe);if(!re(this.options.enable,[this,Fe])){this.reset(),this.state=ia;return}this.state&(ro|po|ia)&&(this.state=Bi),this.state=this.process(Fe),this.state&(ai|ki|wi|po)&&this.tryEmit(Fe)},process:function(xe){},getTouchAction:function(){},reset:function(){}};function Zs(xe){return xe&po?"cancel":xe&wi?"end":xe&ki?"move":xe&ai?"start":""}function nu(xe){return xe==Rr?"down":xe==sr?"up":xe==yr?"left":xe==Pr?"right":""}function Aa(xe,Fe){var pt=Fe.manager;return pt?pt.get(xe):xe}function No(){Gi.apply(this,arguments)}ct(No,Gi,{defaults:{pointers:1},attrTest:function(xe){var Fe=this.options.pointers;return Fe===0||xe.pointers.length===Fe},process:function(xe){var Fe=this.state,pt=xe.eventType,Jt=Fe&(ai|ki),Yr=this.attrTest(xe);return Jt&&(pt&kt||!Yr)?Fe|po:Jt||Yr?pt&Re?Fe|wi:Fe&ai?Fe|ki:ai:ia}});function Hi(){No.apply(this,arguments),this.pX=null,this.pY=null}ct(Hi,No,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ue},getTouchAction:function(){var xe=this.options.direction,Fe=[];return xe&w&&Fe.push(ci),xe&X&&Fe.push(ea),Fe},directionTest:function(xe){var Fe=this.options,pt=!0,Jt=xe.distance,Yr=xe.direction,Qn=xe.deltaX,Ci=xe.deltaY;return Yr&Fe.direction||(Fe.direction&w?(Yr=Qn===0?rr:Qn<0?yr:Pr,pt=Qn!=this.pX,Jt=Math.abs(xe.deltaX)):(Yr=Ci===0?rr:Ci<0?sr:Rr,pt=Ci!=this.pY,Jt=Math.abs(xe.deltaY))),xe.direction=Yr,pt&&Jt>Fe.threshold&&Yr&Fe.direction},attrTest:function(xe){return No.prototype.attrTest.call(this,xe)&&(this.state&ai||!(this.state&ai)&&this.directionTest(xe))},emit:function(xe){this.pX=xe.deltaX,this.pY=xe.deltaY;var Fe=nu(xe.direction);Fe&&(xe.additionalEvent=this.options.event+Fe),this._super.emit.call(this,xe)}});function Wa(){No.apply(this,arguments)}ct(Wa,No,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ii]},attrTest:function(xe){return this._super.attrTest.call(this,xe)&&(Math.abs(xe.scale-1)>this.options.threshold||this.state&ai)},emit:function(xe){if(xe.scale!==1){var Fe=xe.scale<1?"in":"out";xe.additionalEvent=this.options.event+Fe}this._super.emit.call(this,xe)}});function ao(){Gi.apply(this,arguments),this._timer=null,this._input=null}ct(ao,Gi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Li]},process:function(xe){var Fe=this.options,pt=xe.pointers.length===Fe.pointers,Jt=xe.distance<Fe.threshold,Yr=xe.deltaTime>Fe.time;if(this._input=xe,!Jt||!pt||xe.eventType&(Re|kt)&&!Yr)this.reset();else if(xe.eventType&Me)this.reset(),this._timer=Le(function(){this.state=ro,this.tryEmit()},Fe.time,this);else if(xe.eventType&Re)return ro;return ia},reset:function(){clearTimeout(this._timer)},emit:function(xe){this.state===ro&&(xe&&xe.eventType&Re?this.manager.emit(this.options.event+"up",xe):(this._input.timeStamp=be(),this.manager.emit(this.options.event,this._input)))}});function ga(){No.apply(this,arguments)}ct(ga,No,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ii]},attrTest:function(xe){return this._super.attrTest.call(this,xe)&&(Math.abs(xe.rotation)>this.options.threshold||this.state&ai)}});function Lo(){No.apply(this,arguments)}ct(Lo,No,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:w|X,pointers:1},getTouchAction:function(){return Hi.prototype.getTouchAction.call(this)},attrTest:function(xe){var Fe=this.options.direction,pt;return Fe&(w|X)?pt=xe.overallVelocity:Fe&w?pt=xe.overallVelocityX:Fe&X&&(pt=xe.overallVelocityY),this._super.attrTest.call(this,xe)&&Fe&xe.offsetDirection&&xe.distance>this.options.threshold&&xe.maxPointers==this.options.pointers&&_e(pt)>this.options.velocity&&xe.eventType&Re},emit:function(xe){var Fe=nu(xe.offsetDirection);Fe&&this.manager.emit(this.options.event+Fe,xe),this.manager.emit(this.options.event,xe)}});function Fa(){Gi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}ct(Fa,Gi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[bn]},process:function(xe){var Fe=this.options,pt=xe.pointers.length===Fe.pointers,Jt=xe.distance<Fe.threshold,Yr=xe.deltaTime<Fe.time;if(this.reset(),xe.eventType&Me&&this.count===0)return this.failTimeout();if(Jt&&Yr&&pt){if(xe.eventType!=Re)return this.failTimeout();var Qn=this.pTime?xe.timeStamp-this.pTime<Fe.interval:!0,Ci=!this.pCenter||br(this.pCenter,xe.center)<Fe.posThreshold;this.pTime=xe.timeStamp,this.pCenter=xe.center,!Ci||!Qn?this.count=1:this.count+=1,this._input=xe;var Za=this.count%Fe.taps;if(Za===0)return this.hasRequireFailures()?(this._timer=Le(function(){this.state=ro,this.tryEmit()},Fe.interval,this),ai):ro}return ia},failTimeout:function(){return this._timer=Le(function(){this.state=ia},this.options.interval,this),ia},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ro&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Cs(xe,Fe){return Fe=Fe||{},Fe.recognizers=cr(Fe.recognizers,Cs.defaults.preset),new ya(xe,Fe)}Cs.VERSION="2.0.7",Cs.defaults={domEvents:!1,touchAction:on,enable:!0,inputTarget:null,inputClass:null,preset:[[ga,{enable:!1}],[Wa,{enable:!1},["rotate"]],[Lo,{direction:w}],[Hi,{direction:w},["swipe"]],[Fa],[Fa,{event:"doubletap",taps:2},["tap"]],[ao]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Fi=1,Ko=2;function ya(xe,Fe){this.options=Ut({},Cs.defaults,Fe||{}),this.options.inputTarget=this.options.inputTarget||xe,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=xe,this.input=Q(this),this.touchAction=new zi(this,this.options.touchAction),vo(this,!0),Dt(this.options.recognizers,function(pt){var Jt=this.add(new pt[0](pt[1]));pt[2]&&Jt.recognizeWith(pt[2]),pt[3]&&Jt.requireFailure(pt[3])},this)}ya.prototype={set:function(xe){return Ut(this.options,xe),xe.touchAction&&this.touchAction.update(),xe.inputTarget&&(this.input.destroy(),this.input.target=xe.inputTarget,this.input.init()),this},stop:function(xe){this.session.stopped=xe?Ko:Fi},recognize:function(xe){var Fe=this.session;if(!Fe.stopped){this.touchAction.preventDefaults(xe);var pt,Jt=this.recognizers,Yr=Fe.curRecognizer;(!Yr||Yr&&Yr.state&ro)&&(Yr=Fe.curRecognizer=null);for(var Qn=0;Qn<Jt.length;)pt=Jt[Qn],Fe.stopped!==Ko&&(!Yr||pt==Yr||pt.canRecognizeWith(Yr))?pt.recognize(xe):pt.reset(),!Yr&&pt.state&(ai|ki|wi)&&(Yr=Fe.curRecognizer=pt),Qn++}},get:function(xe){if(xe instanceof Gi)return xe;for(var Fe=this.recognizers,pt=0;pt<Fe.length;pt++)if(Fe[pt].options.event==xe)return Fe[pt];return null},add:function(xe){if(Je(xe,"add",this))return this;var Fe=this.get(xe.options.event);return Fe&&this.remove(Fe),this.recognizers.push(xe),xe.manager=this,this.touchAction.update(),xe},remove:function(xe){if(Je(xe,"remove",this))return this;if(xe=this.get(xe),xe){var Fe=this.recognizers,pt=fr(Fe,xe);pt!==-1&&(Fe.splice(pt,1),this.touchAction.update())}return this},on:function(xe,Fe){if(xe!==Z&&Fe!==Z){var pt=this.handlers;return Dt(Pt(xe),function(Jt){pt[Jt]=pt[Jt]||[],pt[Jt].push(Fe)}),this}},off:function(xe,Fe){if(xe!==Z){var pt=this.handlers;return Dt(Pt(xe),function(Jt){Fe?pt[Jt]&&pt[Jt].splice(fr(pt[Jt],Fe),1):delete pt[Jt]}),this}},emit:function(xe,Fe){this.options.domEvents&&Da(xe,Fe);var pt=this.handlers[xe]&&this.handlers[xe].slice();if(!(!pt||!pt.length)){Fe.type=xe,Fe.preventDefault=function(){Fe.srcEvent.preventDefault()};for(var Jt=0;Jt<pt.length;)pt[Jt](Fe),Jt++}},destroy:function(){this.element&&vo(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function vo(xe,Fe){var pt=xe.element;if(!!pt.style){var Jt;Dt(xe.options.cssProps,function(Yr,Qn){Jt=fe(pt.style,Qn),Fe?(xe.oldCssProps[Jt]=pt.style[Jt],pt.style[Jt]=Yr):pt.style[Jt]=xe.oldCssProps[Jt]||""}),Fe||(xe.oldCssProps={})}}function Da(xe,Fe){var pt=p.createEvent("Event");pt.initEvent(xe,!0,!0),pt.gesture=Fe,Fe.target.dispatchEvent(pt)}Ut(Cs,{INPUT_START:Me,INPUT_MOVE:Ge,INPUT_END:Re,INPUT_CANCEL:kt,STATE_POSSIBLE:Bi,STATE_BEGAN:ai,STATE_CHANGED:ki,STATE_ENDED:wi,STATE_RECOGNIZED:ro,STATE_CANCELLED:po,STATE_FAILED:ia,DIRECTION_NONE:rr,DIRECTION_LEFT:yr,DIRECTION_RIGHT:Pr,DIRECTION_UP:sr,DIRECTION_DOWN:Rr,DIRECTION_HORIZONTAL:w,DIRECTION_VERTICAL:X,DIRECTION_ALL:Ue,Manager:ya,Input:At,TouchAction:zi,TouchInput:mt,MouseInput:ti,PointerEventInput:le,TouchMouseInput:Ur,SingleTouchInput:de,Recognizer:Gi,AttrRecognizer:No,Tap:Fa,Pan:Hi,Swipe:Lo,Pinch:Wa,Rotate:ga,Press:ao,on:Ct,off:Qe,each:Dt,merge:bt,extend:xt,assign:Ut,inherit:ct,bindFn:ir,prefixed:fe});var So=typeof b!="undefined"?b:typeof self!="undefined"?self:{};So.Hammer=Cs,j=function(){return Cs}.call(D,y,D,qe),j!==Z&&(qe.exports=j)})(window,document,"Hammer")},7375:function(qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0});var y=Symbol.for("INJECTION");function j(V,G,I,L){function _e(){return L&&!Reflect.hasMetadata(y,this,G)&&Reflect.defineMetadata(y,I(),this,G),Reflect.hasMetadata(y,this,G)?Reflect.getMetadata(y,this,G):I()}function be(Le){Reflect.defineMetadata(y,Le,this,G)}Object.defineProperty(V,G,{configurable:!0,enumerable:!0,get:_e,set:be})}function b(V,G){return function(I){return function(L,_e){var be=function(){return V.get(I)};j(L,_e,be,G)}}}D.makePropertyInjectDecorator=b;function p(V,G){return function(I,L){return function(_e,be){var Le=function(){return V.getNamed(I,L)};j(_e,be,Le,G)}}}D.makePropertyInjectNamedDecorator=p;function E(V,G){return function(I,L,_e){return function(be,Le){var Je=function(){return V.getTagged(I,L,_e)};j(be,Le,Je,G)}}}D.makePropertyInjectTaggedDecorator=E;function Z(V,G){return function(I){return function(L,_e){var be=function(){return V.getAll(I)};j(L,_e,be,G)}}}D.makePropertyMultiInjectDecorator=Z},84879:function(qe,D,y){"use strict";var j;j={value:!0};var b=y(7375);function p(E,Z){Z===void 0&&(Z=!0);var V=b.makePropertyInjectDecorator(E,Z),G=b.makePropertyInjectNamedDecorator(E,Z),I=b.makePropertyInjectTaggedDecorator(E,Z),L=b.makePropertyMultiInjectDecorator(E,Z);return{lazyInject:V,lazyInjectNamed:G,lazyInjectTagged:I,lazyMultiInject:L}}D.Z=p},99934:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.tagProperty=D.tagParameter=D.decorate=void 0;var j=y(16674),b=y(6867);function p(L,_e,be,Le){var Je=b.TAGGED;Z(Je,L,_e,Le,be)}D.tagParameter=p;function E(L,_e,be){var Le=b.TAGGED_PROP;Z(Le,L.constructor,_e,be)}D.tagProperty=E;function Z(L,_e,be,Le,Je){var Dt={},It=typeof Je=="number",Ut=Je!==void 0&&It?Je.toString():be;if(It&&be!==void 0)throw new Error(j.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(L,_e)&&(Dt=Reflect.getMetadata(L,_e));var xt=Dt[Ut];if(!Array.isArray(xt))xt=[];else for(var bt=0,ct=xt;bt<ct.length;bt++){var ir=ct[bt];if(ir.key===Le.key)throw new Error(j.DUPLICATED_METADATA+" "+ir.key.toString())}xt.push(Le),Dt[Ut]=xt,Reflect.defineMetadata(L,Dt,_e)}function V(L,_e){Reflect.decorate(L,_e)}function G(L,_e){return function(be,Le){_e(be,Le,L)}}function I(L,_e,be){typeof be=="number"?V([G(be,L)],_e):typeof be=="string"?Reflect.decorate([L],_e,be):V([L],_e)}D.decorate=I},5744:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.inject=D.LazyServiceIdentifer=void 0;var j=y(16674),b=y(6867),p=y(47738),E=y(99934),Z=function(){function G(I){this._cb=I}return G.prototype.unwrap=function(){return this._cb()},G}();D.LazyServiceIdentifer=Z;function V(G){return function(I,L,_e){if(G===void 0)throw new Error(j.UNDEFINED_INJECT_ANNOTATION(I.name));var be=new p.Metadata(b.INJECT_TAG,G);typeof _e=="number"?E.tagParameter(I,L,_e,be):E.tagProperty(I,L,be)}}D.inject=V},64315:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.injectable=void 0;var j=y(16674),b=y(6867);function p(){return function(E){if(Reflect.hasOwnMetadata(b.PARAM_TYPES,E))throw new Error(j.DUPLICATED_INJECTABLE_DECORATOR);var Z=Reflect.getMetadata(b.DESIGN_PARAM_TYPES,E)||[];return Reflect.defineMetadata(b.PARAM_TYPES,Z,E),E}}D.injectable=p},71693:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.multiInject=void 0;var j=y(6867),b=y(47738),p=y(99934);function E(Z){return function(V,G,I){var L=new b.Metadata(j.MULTI_INJECT_TAG,Z);typeof I=="number"?p.tagParameter(V,G,I,L):p.tagProperty(V,G,L)}}D.multiInject=E},38085:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.named=void 0;var j=y(6867),b=y(47738),p=y(99934);function E(Z){return function(V,G,I){var L=new b.Metadata(j.NAMED_TAG,Z);typeof I=="number"?p.tagParameter(V,G,I,L):p.tagProperty(V,G,L)}}D.named=E},6515:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.optional=void 0;var j=y(6867),b=y(47738),p=y(99934);function E(){return function(Z,V,G){var I=new b.Metadata(j.OPTIONAL_TAG,!0);typeof G=="number"?p.tagParameter(Z,V,G,I):p.tagProperty(Z,V,I)}}D.optional=E},7014:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.postConstruct=void 0;var j=y(16674),b=y(6867),p=y(47738);function E(){return function(Z,V,G){var I=new p.Metadata(b.POST_CONSTRUCT,V);if(Reflect.hasOwnMetadata(b.POST_CONSTRUCT,Z.constructor))throw new Error(j.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(b.POST_CONSTRUCT,I,Z.constructor)}}D.postConstruct=E},32052:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.tagged=void 0;var j=y(47738),b=y(99934);function p(E,Z){return function(V,G,I){var L=new j.Metadata(E,Z);typeof I=="number"?b.tagParameter(V,G,I,L):b.tagProperty(V,G,L)}}D.tagged=p},55638:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.targetName=void 0;var j=y(6867),b=y(47738),p=y(99934);function E(Z){return function(V,G,I){var L=new b.Metadata(j.NAME_TAG,Z);p.tagParameter(V,G,I,L)}}D.targetName=E},86757:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.unmanaged=void 0;var j=y(6867),b=y(47738),p=y(99934);function E(){return function(Z,V,G){var I=new b.Metadata(j.UNMANAGED_TAG,!0);p.tagParameter(Z,V,G,I)}}D.unmanaged=E},44290:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Binding=void 0;var j=y(28421),b=y(37791),p=function(){function E(Z,V){this.id=b.id(),this.activated=!1,this.serviceIdentifier=Z,this.scope=V,this.type=j.BindingTypeEnum.Invalid,this.constraint=function(G){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return E.prototype.clone=function(){var Z=new E(this.serviceIdentifier,this.scope);return Z.activated=Z.scope===j.BindingScopeEnum.Singleton?this.activated:!1,Z.implementationType=this.implementationType,Z.dynamicValue=this.dynamicValue,Z.scope=this.scope,Z.type=this.type,Z.factory=this.factory,Z.provider=this.provider,Z.constraint=this.constraint,Z.onActivation=this.onActivation,Z.cache=this.cache,Z},E}();D.Binding=p},23184:function(qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingCount=void 0;var y={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};D.BindingCount=y},16674:function(qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.STACK_OVERFLOW=D.CIRCULAR_DEPENDENCY_IN_FACTORY=D.POST_CONSTRUCT_ERROR=D.MULTIPLE_POST_CONSTRUCT_METHODS=D.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=D.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=D.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=D.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=D.ARGUMENTS_LENGTH_MISMATCH=D.INVALID_DECORATOR_OPERATION=D.INVALID_TO_SELF_VALUE=D.INVALID_FUNCTION_BINDING=D.INVALID_MIDDLEWARE_RETURN=D.NO_MORE_SNAPSHOTS_AVAILABLE=D.INVALID_BINDING_TYPE=D.NOT_IMPLEMENTED=D.CIRCULAR_DEPENDENCY=D.UNDEFINED_INJECT_ANNOTATION=D.MISSING_INJECT_ANNOTATION=D.MISSING_INJECTABLE_ANNOTATION=D.NOT_REGISTERED=D.CANNOT_UNBIND=D.AMBIGUOUS_MATCH=D.KEY_NOT_FOUND=D.NULL_ARGUMENT=D.DUPLICATED_METADATA=D.DUPLICATED_INJECTABLE_DECORATOR=void 0,D.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",D.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",D.NULL_ARGUMENT="NULL argument",D.KEY_NOT_FOUND="Key Not Found",D.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",D.CANNOT_UNBIND="Could not unbind serviceIdentifier:",D.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",D.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",D.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var y=function(E){return"@inject called with undefined this could mean that the class "+E+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};D.UNDEFINED_INJECT_ANNOTATION=y,D.CIRCULAR_DEPENDENCY="Circular dependency found:",D.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",D.INVALID_BINDING_TYPE="Invalid binding type:",D.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",D.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",D.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",D.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",D.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var j=function(){for(var E=[],Z=0;Z<arguments.length;Z++)E[Z]=arguments[Z];return"The number of constructor arguments in the derived class "+(E[0]+" must be >= than the number of constructor arguments of its base class.")};D.ARGUMENTS_LENGTH_MISMATCH=j,D.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",D.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",D.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",D.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",D.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var b=function(){for(var E=[],Z=0;Z<arguments.length;Z++)E[Z]=arguments[Z];return"@postConstruct error in class "+E[0]+": "+E[1]};D.POST_CONSTRUCT_ERROR=b;var p=function(){for(var E=[],Z=0;Z<arguments.length;Z++)E[Z]=arguments[Z];return"It looks like there is a circular dependency "+("in one of the '"+E[0]+"' bindings. Please investigate bindings with")+("service identifier '"+E[1]+"'.")};D.CIRCULAR_DEPENDENCY_IN_FACTORY=p,D.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.TargetTypeEnum=D.BindingTypeEnum=D.BindingScopeEnum=void 0;var y={Request:"Request",Singleton:"Singleton",Transient:"Transient"};D.BindingScopeEnum=y;var j={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};D.BindingTypeEnum=j;var b={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};D.TargetTypeEnum=b},6867:function(qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.NON_CUSTOM_TAG_KEYS=D.POST_CONSTRUCT=D.DESIGN_PARAM_TYPES=D.PARAM_TYPES=D.TAGGED_PROP=D.TAGGED=D.MULTI_INJECT_TAG=D.INJECT_TAG=D.OPTIONAL_TAG=D.UNMANAGED_TAG=D.NAME_TAG=D.NAMED_TAG=void 0,D.NAMED_TAG="named",D.NAME_TAG="name",D.UNMANAGED_TAG="unmanaged",D.OPTIONAL_TAG="optional",D.INJECT_TAG="inject",D.MULTI_INJECT_TAG="multi_inject",D.TAGGED="inversify:tagged",D.TAGGED_PROP="inversify:tagged_props",D.PARAM_TYPES="inversify:paramtypes",D.DESIGN_PARAM_TYPES="design:paramtypes",D.POST_CONSTRUCT="post_construct";function y(){return[D.INJECT_TAG,D.MULTI_INJECT_TAG,D.NAME_TAG,D.UNMANAGED_TAG,D.NAMED_TAG,D.OPTIONAL_TAG]}D.NON_CUSTOM_TAG_KEYS=y()},51389:function(qe,D,y){"use strict";var j=this&&this.__awaiter||function(xt,bt,ct,ir){function re(cr){return cr instanceof ct?cr:new ct(function(Ct){Ct(cr)})}return new(ct||(ct=Promise))(function(cr,Ct){function Qe(Pt){try{je(ir.next(Pt))}catch(fr){Ct(fr)}}function Tt(Pt){try{je(ir.throw(Pt))}catch(fr){Ct(fr)}}function je(Pt){Pt.done?cr(Pt.value):re(Pt.value).then(Qe,Tt)}je((ir=ir.apply(xt,bt||[])).next())})},b=this&&this.__generator||function(xt,bt){var ct={label:0,sent:function(){if(cr[0]&1)throw cr[1];return cr[1]},trys:[],ops:[]},ir,re,cr,Ct;return Ct={next:Qe(0),throw:Qe(1),return:Qe(2)},typeof Symbol=="function"&&(Ct[Symbol.iterator]=function(){return this}),Ct;function Qe(je){return function(Pt){return Tt([je,Pt])}}function Tt(je){if(ir)throw new TypeError("Generator is already executing.");for(;ct;)try{if(ir=1,re&&(cr=je[0]&2?re.return:je[0]?re.throw||((cr=re.return)&&cr.call(re),0):re.next)&&!(cr=cr.call(re,je[1])).done)return cr;switch(re=0,cr&&(je=[je[0]&2,cr.value]),je[0]){case 0:case 1:cr=je;break;case 4:return ct.label++,{value:je[1],done:!1};case 5:ct.label++,re=je[1],je=[0];continue;case 7:je=ct.ops.pop(),ct.trys.pop();continue;default:if(cr=ct.trys,!(cr=cr.length>0&&cr[cr.length-1])&&(je[0]===6||je[0]===2)){ct=0;continue}if(je[0]===3&&(!cr||je[1]>cr[0]&&je[1]<cr[3])){ct.label=je[1];break}if(je[0]===6&&ct.label<cr[1]){ct.label=cr[1],cr=je;break}if(cr&&ct.label<cr[2]){ct.label=cr[2],ct.ops.push(je);break}cr[2]&&ct.ops.pop(),ct.trys.pop();continue}je=bt.call(xt,ct)}catch(Pt){je=[6,Pt],re=0}finally{ir=cr=0}if(je[0]&5)throw je[1];return{value:je[0]?je[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(xt,bt){for(var ct=0,ir=bt.length,re=xt.length;ct<ir;ct++,re++)xt[re]=bt[ct];return xt};Object.defineProperty(D,"__esModule",{value:!0}),D.Container=void 0;var E=y(44290),Z=y(16674),V=y(28421),G=y(6867),I=y(51377),L=y(86311),_e=y(31927),be=y(15451),Le=y(37791),Je=y(55800),Dt=y(85700),It=y(80175),Ut=function(){function xt(bt){this._appliedMiddleware=[];var ct=bt||{};if(typeof ct!="object")throw new Error(""+Z.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(ct.defaultScope===void 0)ct.defaultScope=V.BindingScopeEnum.Transient;else if(ct.defaultScope!==V.BindingScopeEnum.Singleton&&ct.defaultScope!==V.BindingScopeEnum.Transient&&ct.defaultScope!==V.BindingScopeEnum.Request)throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(ct.autoBindInjectable===void 0)ct.autoBindInjectable=!1;else if(typeof ct.autoBindInjectable!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(ct.skipBaseClassChecks===void 0)ct.skipBaseClassChecks=!1;else if(typeof ct.skipBaseClassChecks!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:ct.autoBindInjectable,defaultScope:ct.defaultScope,skipBaseClassChecks:ct.skipBaseClassChecks},this.id=Le.id(),this._bindingDictionary=new It.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new I.MetadataReader}return xt.merge=function(bt,ct){for(var ir=[],re=2;re<arguments.length;re++)ir[re-2]=arguments[re];var cr=new xt,Ct=p([bt,ct],ir).map(function(je){return L.getBindingDictionary(je)}),Qe=L.getBindingDictionary(cr);function Tt(je,Pt){je.traverse(function(fr,$t){$t.forEach(function(zr){Pt.add(zr.serviceIdentifier,zr.clone())})})}return Ct.forEach(function(je){Tt(je,Qe)}),cr},xt.prototype.load=function(){for(var bt=[],ct=0;ct<arguments.length;ct++)bt[ct]=arguments[ct];for(var ir=this._getContainerModuleHelpersFactory(),re=0,cr=bt;re<cr.length;re++){var Ct=cr[re],Qe=ir(Ct.id);Ct.registry(Qe.bindFunction,Qe.unbindFunction,Qe.isboundFunction,Qe.rebindFunction)}},xt.prototype.loadAsync=function(){for(var bt=[],ct=0;ct<arguments.length;ct++)bt[ct]=arguments[ct];return j(this,void 0,void 0,function(){var ir,re,cr,Ct,Qe;return b(this,function(Tt){switch(Tt.label){case 0:ir=this._getContainerModuleHelpersFactory(),re=0,cr=bt,Tt.label=1;case 1:return re<cr.length?(Ct=cr[re],Qe=ir(Ct.id),[4,Ct.registry(Qe.bindFunction,Qe.unbindFunction,Qe.isboundFunction,Qe.rebindFunction)]):[3,4];case 2:Tt.sent(),Tt.label=3;case 3:return re++,[3,1];case 4:return[2]}})})},xt.prototype.unload=function(){for(var bt=this,ct=[],ir=0;ir<arguments.length;ir++)ct[ir]=arguments[ir];var re=function(cr){return function(Ct){return Ct.moduleId===cr}};ct.forEach(function(cr){var Ct=re(cr.id);bt._bindingDictionary.removeByCondition(Ct)})},xt.prototype.bind=function(bt){var ct=this.options.defaultScope||V.BindingScopeEnum.Transient,ir=new E.Binding(bt,ct);return this._bindingDictionary.add(bt,ir),new be.BindingToSyntax(ir)},xt.prototype.rebind=function(bt){return this.unbind(bt),this.bind(bt)},xt.prototype.unbind=function(bt){try{this._bindingDictionary.remove(bt)}catch(ct){throw new Error(Z.CANNOT_UNBIND+" "+Je.getServiceIdentifierAsString(bt))}},xt.prototype.unbindAll=function(){this._bindingDictionary=new It.Lookup},xt.prototype.isBound=function(bt){var ct=this._bindingDictionary.hasKey(bt);return!ct&&this.parent&&(ct=this.parent.isBound(bt)),ct},xt.prototype.isBoundNamed=function(bt,ct){return this.isBoundTagged(bt,G.NAMED_TAG,ct)},xt.prototype.isBoundTagged=function(bt,ct,ir){var re=!1;if(this._bindingDictionary.hasKey(bt)){var cr=this._bindingDictionary.get(bt),Ct=L.createMockRequest(this,bt,ct,ir);re=cr.some(function(Qe){return Qe.constraint(Ct)})}return!re&&this.parent&&(re=this.parent.isBoundTagged(bt,ct,ir)),re},xt.prototype.snapshot=function(){this._snapshots.push(Dt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},xt.prototype.restore=function(){var bt=this._snapshots.pop();if(bt===void 0)throw new Error(Z.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=bt.bindings,this._middleware=bt.middleware},xt.prototype.createChild=function(bt){var ct=new xt(bt||this.options);return ct.parent=this,ct},xt.prototype.applyMiddleware=function(){for(var bt=[],ct=0;ct<arguments.length;ct++)bt[ct]=arguments[ct];this._appliedMiddleware=this._appliedMiddleware.concat(bt);var ir=this._middleware?this._middleware:this._planAndResolve();this._middleware=bt.reduce(function(re,cr){return cr(re)},ir)},xt.prototype.applyCustomMetadataReader=function(bt){this._metadataReader=bt},xt.prototype.get=function(bt){return this._get(!1,!1,V.TargetTypeEnum.Variable,bt)},xt.prototype.getTagged=function(bt,ct,ir){return this._get(!1,!1,V.TargetTypeEnum.Variable,bt,ct,ir)},xt.prototype.getNamed=function(bt,ct){return this.getTagged(bt,G.NAMED_TAG,ct)},xt.prototype.getAll=function(bt){return this._get(!0,!0,V.TargetTypeEnum.Variable,bt)},xt.prototype.getAllTagged=function(bt,ct,ir){return this._get(!1,!0,V.TargetTypeEnum.Variable,bt,ct,ir)},xt.prototype.getAllNamed=function(bt,ct){return this.getAllTagged(bt,G.NAMED_TAG,ct)},xt.prototype.resolve=function(bt){var ct=this.createChild();return ct.bind(bt).toSelf(),this._appliedMiddleware.forEach(function(ir){ct.applyMiddleware(ir)}),ct.get(bt)},xt.prototype._getContainerModuleHelpersFactory=function(){var bt=this,ct=function(Qe,Tt){Qe._binding.moduleId=Tt},ir=function(Qe){return function(Tt){var je=bt.bind.bind(bt),Pt=je(Tt);return ct(Pt,Qe),Pt}},re=function(Qe){return function(Tt){var je=bt.unbind.bind(bt);je(Tt)}},cr=function(Qe){return function(Tt){var je=bt.isBound.bind(bt);return je(Tt)}},Ct=function(Qe){return function(Tt){var je=bt.rebind.bind(bt),Pt=je(Tt);return ct(Pt,Qe),Pt}};return function(Qe){return{bindFunction:ir(Qe),isboundFunction:cr(Qe),rebindFunction:Ct(Qe),unbindFunction:re(Qe)}}},xt.prototype._get=function(bt,ct,ir,re,cr,Ct){var Qe=null,Tt={avoidConstraints:bt,contextInterceptor:function(je){return je},isMultiInject:ct,key:cr,serviceIdentifier:re,targetType:ir,value:Ct};if(this._middleware){if(Qe=this._middleware(Tt),Qe==null)throw new Error(Z.INVALID_MIDDLEWARE_RETURN)}else Qe=this._planAndResolve()(Tt);return Qe},xt.prototype._planAndResolve=function(){var bt=this;return function(ct){var ir=L.plan(bt._metadataReader,bt,ct.isMultiInject,ct.targetType,ct.serviceIdentifier,ct.key,ct.value,ct.avoidConstraints);ir=ct.contextInterceptor(ir);var re=_e.resolve(ir);return re}},xt}();D.Container=Ut},33244:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.AsyncContainerModule=D.ContainerModule=void 0;var j=y(37791),b=function(){function E(Z){this.id=j.id(),this.registry=Z}return E}();D.ContainerModule=b;var p=function(){function E(Z){this.id=j.id(),this.registry=Z}return E}();D.AsyncContainerModule=p},85700:function(qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.ContainerSnapshot=void 0;var y=function(){function j(){}return j.of=function(b,p){var E=new j;return E.bindings=b,E.middleware=p,E},j}();D.ContainerSnapshot=y},80175:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Lookup=void 0;var j=y(16674),b=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(E,Z){if(E==null)throw new Error(j.NULL_ARGUMENT);if(Z==null)throw new Error(j.NULL_ARGUMENT);var V=this._map.get(E);V!==void 0?(V.push(Z),this._map.set(E,V)):this._map.set(E,[Z])},p.prototype.get=function(E){if(E==null)throw new Error(j.NULL_ARGUMENT);var Z=this._map.get(E);if(Z!==void 0)return Z;throw new Error(j.KEY_NOT_FOUND)},p.prototype.remove=function(E){if(E==null)throw new Error(j.NULL_ARGUMENT);if(!this._map.delete(E))throw new Error(j.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(E){var Z=this;this._map.forEach(function(V,G){var I=V.filter(function(L){return!E(L)});I.length>0?Z._map.set(G,I):Z._map.delete(G)})},p.prototype.hasKey=function(E){if(E==null)throw new Error(j.NULL_ARGUMENT);return this._map.has(E)},p.prototype.clone=function(){var E=new p;return this._map.forEach(function(Z,V){Z.forEach(function(G){return E.add(V,G.clone())})}),E},p.prototype.traverse=function(E){this._map.forEach(function(Z,V){E(V,Z)})},p}();D.Lookup=b},86700:function(qe,D,y){"use strict";var j;j={value:!0},j=j=j=j=j=j=D.GW=j=j=D.zY=j=j=j=j=j=D.f3=j=j=D.b2=j=j=j=j=j=D.W2=j=void 0;var b=y(6867);j=b;var p=y(51389);Object.defineProperty(D,"W2",{enumerable:!0,get:function(){return p.Container}});var E=y(28421);j={enumerable:!0,get:function(){return E.BindingScopeEnum}},j={enumerable:!0,get:function(){return E.BindingTypeEnum}},j={enumerable:!0,get:function(){return E.TargetTypeEnum}};var Z=y(33244);j={enumerable:!0,get:function(){return Z.AsyncContainerModule}},j={enumerable:!0,get:function(){return Z.ContainerModule}};var V=y(64315);Object.defineProperty(D,"b2",{enumerable:!0,get:function(){return V.injectable}});var G=y(32052);j={enumerable:!0,get:function(){return G.tagged}};var I=y(38085);j={enumerable:!0,get:function(){return I.named}};var L=y(5744);Object.defineProperty(D,"f3",{enumerable:!0,get:function(){return L.inject}}),j={enumerable:!0,get:function(){return L.LazyServiceIdentifer}};var _e=y(6515);j={enumerable:!0,get:function(){return _e.optional}};var be=y(86757);j={enumerable:!0,get:function(){return be.unmanaged}};var Le=y(71693);j={enumerable:!0,get:function(){return Le.multiInject}};var Je=y(55638);j={enumerable:!0,get:function(){return Je.targetName}};var Dt=y(7014);Object.defineProperty(D,"zY",{enumerable:!0,get:function(){return Dt.postConstruct}});var It=y(51377);j={enumerable:!0,get:function(){return It.MetadataReader}};var Ut=y(37791);j={enumerable:!0,get:function(){return Ut.id}};var xt=y(99934);Object.defineProperty(D,"GW",{enumerable:!0,get:function(){return xt.decorate}});var bt=y(80758);j={enumerable:!0,get:function(){return bt.traverseAncerstors}},j={enumerable:!0,get:function(){return bt.taggedConstraint}},j={enumerable:!0,get:function(){return bt.namedConstraint}},j={enumerable:!0,get:function(){return bt.typeConstraint}};var ct=y(55800);j={enumerable:!0,get:function(){return ct.getServiceIdentifierAsString}};var ir=y(70600);j={enumerable:!0,get:function(){return ir.multiBindToService}}},95228:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Context=void 0;var j=y(37791),b=function(){function p(E){this.id=j.id(),this.container=E}return p.prototype.addPlan=function(E){this.plan=E},p.prototype.setCurrentRequest=function(E){this.currentRequest=E},p}();D.Context=b},47738:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Metadata=void 0;var j=y(6867),b=function(){function p(E,Z){this.key=E,this.value=Z}return p.prototype.toString=function(){return this.key===j.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();D.Metadata=b},51377:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.MetadataReader=void 0;var j=y(6867),b=function(){function p(){}return p.prototype.getConstructorMetadata=function(E){var Z=Reflect.getMetadata(j.PARAM_TYPES,E),V=Reflect.getMetadata(j.TAGGED,E);return{compilerGeneratedMetadata:Z,userGeneratedMetadata:V||{}}},p.prototype.getPropertiesMetadata=function(E){var Z=Reflect.getMetadata(j.TAGGED_PROP,E)||[];return Z},p}();D.MetadataReader=b},55314:function(qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Plan=void 0;var y=function(){function j(b,p){this.parentContext=b,this.rootRequest=p}return j}();D.Plan=y},86311:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.getBindingDictionary=D.createMockRequest=D.plan=void 0;var j=y(23184),b=y(16674),p=y(28421),E=y(6867),Z=y(85265),V=y(55800),G=y(95228),I=y(47738),L=y(55314),_e=y(6e3),be=y(6748),Le=y(18924);function Je(re){return re._bindingDictionary}D.getBindingDictionary=Je;function Dt(re,cr,Ct,Qe,Tt,je){var Pt=re?E.MULTI_INJECT_TAG:E.INJECT_TAG,fr=new I.Metadata(Pt,Ct),$t=new Le.Target(cr,Qe,Ct,fr);if(Tt!==void 0){var zr=new I.Metadata(Tt,je);$t.metadata.push(zr)}return $t}function It(re,cr,Ct,Qe,Tt){var je=bt(Ct.container,Tt.serviceIdentifier),Pt=[];return je.length===j.BindingCount.NoBindingsAvailable&&Ct.container.options.autoBindInjectable&&typeof Tt.serviceIdentifier=="function"&&re.getConstructorMetadata(Tt.serviceIdentifier).compilerGeneratedMetadata&&(Ct.container.bind(Tt.serviceIdentifier).toSelf(),je=bt(Ct.container,Tt.serviceIdentifier)),cr?Pt=je:Pt=je.filter(function(fr){var $t=new be.Request(fr.serviceIdentifier,Ct,Qe,fr,Tt);return fr.constraint($t)}),Ut(Tt.serviceIdentifier,Pt,Tt,Ct.container),Pt}function Ut(re,cr,Ct,Qe){switch(cr.length){case j.BindingCount.NoBindingsAvailable:if(Ct.isOptional())return cr;var Tt=V.getServiceIdentifierAsString(re),je=b.NOT_REGISTERED;throw je+=V.listMetadataForTarget(Tt,Ct),je+=V.listRegisteredBindingsForServiceIdentifier(Qe,Tt,bt),new Error(je);case j.BindingCount.OnlyOneBindingAvailable:if(!Ct.isArray())return cr;case j.BindingCount.MultipleBindingsAvailable:default:if(Ct.isArray())return cr;var Tt=V.getServiceIdentifierAsString(re),je=b.AMBIGUOUS_MATCH+" "+Tt;throw je+=V.listRegisteredBindingsForServiceIdentifier(Qe,Tt,bt),new Error(je)}}function xt(re,cr,Ct,Qe,Tt,je){var Pt,fr;if(Tt===null){Pt=It(re,cr,Qe,null,je),fr=new be.Request(Ct,Qe,null,Pt,je);var $t=new L.Plan(Qe,fr);Qe.addPlan($t)}else Pt=It(re,cr,Qe,Tt,je),fr=Tt.addChildRequest(je.serviceIdentifier,Pt,je);Pt.forEach(function(zr){var fe=null;if(je.isArray())fe=fr.addChildRequest(zr.serviceIdentifier,zr,je);else{if(zr.cache)return;fe=fr}if(zr.type===p.BindingTypeEnum.Instance&&zr.implementationType!==null){var ke=_e.getDependencies(re,zr.implementationType);if(!Qe.container.options.skipBaseClassChecks){var ge=_e.getBaseClassDependencyCount(re,zr.implementationType);if(ke.length<ge){var _t=b.ARGUMENTS_LENGTH_MISMATCH(_e.getFunctionName(zr.implementationType));throw new Error(_t)}}ke.forEach(function(vt){xt(re,!1,vt.serviceIdentifier,Qe,fe,vt)})}})}function bt(re,cr){var Ct=[],Qe=Je(re);return Qe.hasKey(cr)?Ct=Qe.get(cr):re.parent!==null&&(Ct=bt(re.parent,cr)),Ct}function ct(re,cr,Ct,Qe,Tt,je,Pt,fr){fr===void 0&&(fr=!1);var $t=new G.Context(cr),zr=Dt(Ct,Qe,Tt,"",je,Pt);try{return xt(re,fr,Tt,$t,null,zr),$t}catch(fe){throw Z.isStackOverflowExeption(fe)&&$t.plan&&V.circularDependencyToException($t.plan.rootRequest),fe}}D.plan=ct;function ir(re,cr,Ct,Qe){var Tt=new Le.Target(p.TargetTypeEnum.Variable,"",cr,new I.Metadata(Ct,Qe)),je=new G.Context(re),Pt=new be.Request(cr,je,null,[],Tt);return Pt}D.createMockRequest=ir},88460:function(qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.QueryableString=void 0;var y=function(){function j(b){this.str=b}return j.prototype.startsWith=function(b){return this.str.indexOf(b)===0},j.prototype.endsWith=function(b){var p="",E=b.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},E)},j.prototype.contains=function(b){return this.str.indexOf(b)!==-1},j.prototype.equals=function(b){return this.str===b},j.prototype.value=function(){return this.str},j}();D.QueryableString=y},6e3:function(qe,D,y){"use strict";var j=this&&this.__spreadArray||function(It,Ut){for(var xt=0,bt=Ut.length,ct=It.length;xt<bt;xt++,ct++)It[ct]=Ut[xt];return It};Object.defineProperty(D,"__esModule",{value:!0}),D.getFunctionName=D.getBaseClassDependencyCount=D.getDependencies=void 0;var b=y(5744),p=y(16674),E=y(28421),Z=y(6867),V=y(55800);Object.defineProperty(D,"getFunctionName",{enumerable:!0,get:function(){return V.getFunctionName}});var G=y(18924);function I(It,Ut){var xt=V.getFunctionName(Ut),bt=L(It,xt,Ut,!1);return bt}D.getDependencies=I;function L(It,Ut,xt,bt){var ct=It.getConstructorMetadata(xt),ir=ct.compilerGeneratedMetadata;if(ir===void 0){var re=p.MISSING_INJECTABLE_ANNOTATION+" "+Ut+".";throw new Error(re)}var cr=ct.userGeneratedMetadata,Ct=Object.keys(cr),Qe=xt.length===0&&Ct.length>0,Tt=Ct.length>xt.length,je=Qe||Tt?Ct.length:xt.length,Pt=be(bt,Ut,ir,cr,je),fr=Le(It,xt),$t=j(j([],Pt),fr);return $t}function _e(It,Ut,xt,bt,ct){var ir=ct[It.toString()]||[],re=Dt(ir),cr=re.unmanaged!==!0,Ct=bt[It],Qe=re.inject||re.multiInject;if(Ct=Qe||Ct,Ct instanceof b.LazyServiceIdentifer&&(Ct=Ct.unwrap()),cr){var Tt=Ct===Object,je=Ct===Function,Pt=Ct===void 0,fr=Tt||je||Pt;if(!Ut&&fr){var $t=p.MISSING_INJECT_ANNOTATION+" argument "+It+" in class "+xt+".";throw new Error($t)}var zr=new G.Target(E.TargetTypeEnum.ConstructorArgument,re.targetName,Ct);return zr.metadata=ir,zr}return null}function be(It,Ut,xt,bt,ct){for(var ir=[],re=0;re<ct;re++){var cr=re,Ct=_e(cr,It,Ut,xt,bt);Ct!==null&&ir.push(Ct)}return ir}function Le(It,Ut){for(var xt=It.getPropertiesMetadata(Ut),bt=[],ct=Object.keys(xt),ir=0,re=ct;ir<re.length;ir++){var cr=re[ir],Ct=xt[cr],Qe=Dt(xt[cr]),Tt=Qe.targetName||cr,je=Qe.inject||Qe.multiInject,Pt=new G.Target(E.TargetTypeEnum.ClassProperty,Tt,je);Pt.metadata=Ct,bt.push(Pt)}var fr=Object.getPrototypeOf(Ut.prototype).constructor;if(fr!==Object){var $t=Le(It,fr);bt=j(j([],bt),$t)}return bt}function Je(It,Ut){var xt=Object.getPrototypeOf(Ut.prototype).constructor;if(xt!==Object){var bt=V.getFunctionName(xt),ct=L(It,bt,xt,!0),ir=ct.map(function(Ct){return Ct.metadata.filter(function(Qe){return Qe.key===Z.UNMANAGED_TAG})}),re=[].concat.apply([],ir).length,cr=ct.length-re;return cr>0?cr:Je(It,xt)}else return 0}D.getBaseClassDependencyCount=Je;function Dt(It){var Ut={};return It.forEach(function(xt){Ut[xt.key.toString()]=xt.value}),{inject:Ut[Z.INJECT_TAG],multiInject:Ut[Z.MULTI_INJECT_TAG],targetName:Ut[Z.NAME_TAG],unmanaged:Ut[Z.UNMANAGED_TAG]}}},6748:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Request=void 0;var j=y(37791),b=function(){function p(E,Z,V,G,I){this.id=j.id(),this.serviceIdentifier=E,this.parentContext=Z,this.parentRequest=V,this.target=I,this.childRequests=[],this.bindings=Array.isArray(G)?G:[G],this.requestScope=V===null?new Map:null}return p.prototype.addChildRequest=function(E,Z,V){var G=new p(E,this.parentContext,this,Z,V);return this.childRequests.push(G),G},p}();D.Request=b},18924:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Target=void 0;var j=y(6867),b=y(37791),p=y(47738),E=y(88460),Z=function(){function V(G,I,L,_e){this.id=b.id(),this.type=G,this.serviceIdentifier=L,this.name=new E.QueryableString(I||""),this.metadata=new Array;var be=null;typeof _e=="string"?be=new p.Metadata(j.NAMED_TAG,_e):_e instanceof p.Metadata&&(be=_e),be!==null&&this.metadata.push(be)}return V.prototype.hasTag=function(G){for(var I=0,L=this.metadata;I<L.length;I++){var _e=L[I];if(_e.key===G)return!0}return!1},V.prototype.isArray=function(){return this.hasTag(j.MULTI_INJECT_TAG)},V.prototype.matchesArray=function(G){return this.matchesTag(j.MULTI_INJECT_TAG)(G)},V.prototype.isNamed=function(){return this.hasTag(j.NAMED_TAG)},V.prototype.isTagged=function(){return this.metadata.some(function(G){return j.NON_CUSTOM_TAG_KEYS.every(function(I){return G.key!==I})})},V.prototype.isOptional=function(){return this.matchesTag(j.OPTIONAL_TAG)(!0)},V.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(G){return G.key===j.NAMED_TAG})[0]:null},V.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(G){return j.NON_CUSTOM_TAG_KEYS.every(function(I){return G.key!==I})}):null},V.prototype.matchesNamedTag=function(G){return this.matchesTag(j.NAMED_TAG)(G)},V.prototype.matchesTag=function(G){var I=this;return function(L){for(var _e=0,be=I.metadata;_e<be.length;_e++){var Le=be[_e];if(Le.key===G&&Le.value===L)return!0}return!1}},V}();D.Target=Z},52279:function(qe,D,y){"use strict";var j=this&&this.__spreadArray||function(L,_e){for(var be=0,Le=_e.length,Je=L.length;be<Le;be++,Je++)L[Je]=_e[be];return L};Object.defineProperty(D,"__esModule",{value:!0}),D.resolveInstance=void 0;var b=y(16674),p=y(28421),E=y(6867);function Z(L,_e,be){var Le=_e.filter(function(Dt){return Dt.target!==null&&Dt.target.type===p.TargetTypeEnum.ClassProperty}),Je=Le.map(be);return Le.forEach(function(Dt,It){var Ut="";Ut=Dt.target.name.value();var xt=Je[It];L[Ut]=xt}),L}function V(L,_e){return new(L.bind.apply(L,j([void 0],_e)))}function G(L,_e){if(Reflect.hasMetadata(E.POST_CONSTRUCT,L)){var be=Reflect.getMetadata(E.POST_CONSTRUCT,L);try{_e[be.value]()}catch(Le){throw new Error(b.POST_CONSTRUCT_ERROR(L.name,Le.message))}}}function I(L,_e,be){var Le=null;if(_e.length>0){var Je=_e.filter(function(It){return It.target!==null&&It.target.type===p.TargetTypeEnum.ConstructorArgument}),Dt=Je.map(be);Le=V(L,Dt),Le=Z(Le,_e,be)}else Le=new L;return G(L,Le),Le}D.resolveInstance=I},31927:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.resolve=void 0;var j=y(16674),b=y(28421),p=y(85265),E=y(55800),Z=y(52279),V=function(L,_e,be){try{return be()}catch(Le){throw p.isStackOverflowExeption(Le)?new Error(j.CIRCULAR_DEPENDENCY_IN_FACTORY(L,_e.toString())):Le}},G=function(L){return function(_e){_e.parentContext.setCurrentRequest(_e);var be=_e.bindings,Le=_e.childRequests,Je=_e.target&&_e.target.isArray(),Dt=!_e.parentRequest||!_e.parentRequest.target||!_e.target||!_e.parentRequest.target.matchesArray(_e.target.serviceIdentifier);if(Je&&Dt)return Le.map(function(ir){var re=G(L);return re(ir)});var It=null;if(_e.target.isOptional()&&be.length===0)return;var Ut=be[0],xt=Ut.scope===b.BindingScopeEnum.Singleton,bt=Ut.scope===b.BindingScopeEnum.Request;if(xt&&Ut.activated)return Ut.cache;if(bt&&L!==null&&L.has(Ut.id))return L.get(Ut.id);if(Ut.type===b.BindingTypeEnum.ConstantValue)It=Ut.cache,Ut.activated=!0;else if(Ut.type===b.BindingTypeEnum.Function)It=Ut.cache,Ut.activated=!0;else if(Ut.type===b.BindingTypeEnum.Constructor)It=Ut.implementationType;else if(Ut.type===b.BindingTypeEnum.DynamicValue&&Ut.dynamicValue!==null)It=V("toDynamicValue",Ut.serviceIdentifier,function(){return Ut.dynamicValue(_e.parentContext)});else if(Ut.type===b.BindingTypeEnum.Factory&&Ut.factory!==null)It=V("toFactory",Ut.serviceIdentifier,function(){return Ut.factory(_e.parentContext)});else if(Ut.type===b.BindingTypeEnum.Provider&&Ut.provider!==null)It=V("toProvider",Ut.serviceIdentifier,function(){return Ut.provider(_e.parentContext)});else if(Ut.type===b.BindingTypeEnum.Instance&&Ut.implementationType!==null)It=Z.resolveInstance(Ut.implementationType,Le,G(L));else{var ct=E.getServiceIdentifierAsString(_e.serviceIdentifier);throw new Error(j.INVALID_BINDING_TYPE+" "+ct)}return typeof Ut.onActivation=="function"&&(It=Ut.onActivation(_e.parentContext,It)),xt&&(Ut.cache=It,Ut.activated=!0),bt&&L!==null&&!L.has(Ut.id)&&L.set(Ut.id,It),It}};function I(L){var _e=G(L.plan.rootRequest.requestScope);return _e(L.plan.rootRequest)}D.resolve=I},83366:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingInSyntax=void 0;var j=y(28421),b=y(71325),p=function(){function E(Z){this._binding=Z}return E.prototype.inRequestScope=function(){return this._binding.scope=j.BindingScopeEnum.Request,new b.BindingWhenOnSyntax(this._binding)},E.prototype.inSingletonScope=function(){return this._binding.scope=j.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},E.prototype.inTransientScope=function(){return this._binding.scope=j.BindingScopeEnum.Transient,new b.BindingWhenOnSyntax(this._binding)},E}();D.BindingInSyntax=p},74889:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingInWhenOnSyntax=void 0;var j=y(83366),b=y(51811),p=y(98370),E=function(){function Z(V){this._binding=V,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new b.BindingOnSyntax(this._binding),this._bindingInSyntax=new j.BindingInSyntax(V)}return Z.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},Z.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},Z.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},Z.prototype.when=function(V){return this._bindingWhenSyntax.when(V)},Z.prototype.whenTargetNamed=function(V){return this._bindingWhenSyntax.whenTargetNamed(V)},Z.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Z.prototype.whenTargetTagged=function(V,G){return this._bindingWhenSyntax.whenTargetTagged(V,G)},Z.prototype.whenInjectedInto=function(V){return this._bindingWhenSyntax.whenInjectedInto(V)},Z.prototype.whenParentNamed=function(V){return this._bindingWhenSyntax.whenParentNamed(V)},Z.prototype.whenParentTagged=function(V,G){return this._bindingWhenSyntax.whenParentTagged(V,G)},Z.prototype.whenAnyAncestorIs=function(V){return this._bindingWhenSyntax.whenAnyAncestorIs(V)},Z.prototype.whenNoAncestorIs=function(V){return this._bindingWhenSyntax.whenNoAncestorIs(V)},Z.prototype.whenAnyAncestorNamed=function(V){return this._bindingWhenSyntax.whenAnyAncestorNamed(V)},Z.prototype.whenAnyAncestorTagged=function(V,G){return this._bindingWhenSyntax.whenAnyAncestorTagged(V,G)},Z.prototype.whenNoAncestorNamed=function(V){return this._bindingWhenSyntax.whenNoAncestorNamed(V)},Z.prototype.whenNoAncestorTagged=function(V,G){return this._bindingWhenSyntax.whenNoAncestorTagged(V,G)},Z.prototype.whenAnyAncestorMatches=function(V){return this._bindingWhenSyntax.whenAnyAncestorMatches(V)},Z.prototype.whenNoAncestorMatches=function(V){return this._bindingWhenSyntax.whenNoAncestorMatches(V)},Z.prototype.onActivation=function(V){return this._bindingOnSyntax.onActivation(V)},Z}();D.BindingInWhenOnSyntax=E},51811:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingOnSyntax=void 0;var j=y(98370),b=function(){function p(E){this._binding=E}return p.prototype.onActivation=function(E){return this._binding.onActivation=E,new j.BindingWhenSyntax(this._binding)},p}();D.BindingOnSyntax=b},15451:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingToSyntax=void 0;var j=y(16674),b=y(28421),p=y(74889),E=y(71325),Z=function(){function V(G){this._binding=G}return V.prototype.to=function(G){return this._binding.type=b.BindingTypeEnum.Instance,this._binding.implementationType=G,new p.BindingInWhenOnSyntax(this._binding)},V.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+j.INVALID_TO_SELF_VALUE);var G=this._binding.serviceIdentifier;return this.to(G)},V.prototype.toConstantValue=function(G){return this._binding.type=b.BindingTypeEnum.ConstantValue,this._binding.cache=G,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=b.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},V.prototype.toDynamicValue=function(G){return this._binding.type=b.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=G,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},V.prototype.toConstructor=function(G){return this._binding.type=b.BindingTypeEnum.Constructor,this._binding.implementationType=G,this._binding.scope=b.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},V.prototype.toFactory=function(G){return this._binding.type=b.BindingTypeEnum.Factory,this._binding.factory=G,this._binding.scope=b.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},V.prototype.toFunction=function(G){if(typeof G!="function")throw new Error(j.INVALID_FUNCTION_BINDING);var I=this.toConstantValue(G);return this._binding.type=b.BindingTypeEnum.Function,this._binding.scope=b.BindingScopeEnum.Singleton,I},V.prototype.toAutoFactory=function(G){return this._binding.type=b.BindingTypeEnum.Factory,this._binding.factory=function(I){var L=function(){return I.container.get(G)};return L},this._binding.scope=b.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},V.prototype.toProvider=function(G){return this._binding.type=b.BindingTypeEnum.Provider,this._binding.provider=G,this._binding.scope=b.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},V.prototype.toService=function(G){this.toDynamicValue(function(I){return I.container.get(G)})},V}();D.BindingToSyntax=Z},71325:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingWhenOnSyntax=void 0;var j=y(51811),b=y(98370),p=function(){function E(Z){this._binding=Z,this._bindingWhenSyntax=new b.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new j.BindingOnSyntax(this._binding)}return E.prototype.when=function(Z){return this._bindingWhenSyntax.when(Z)},E.prototype.whenTargetNamed=function(Z){return this._bindingWhenSyntax.whenTargetNamed(Z)},E.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},E.prototype.whenTargetTagged=function(Z,V){return this._bindingWhenSyntax.whenTargetTagged(Z,V)},E.prototype.whenInjectedInto=function(Z){return this._bindingWhenSyntax.whenInjectedInto(Z)},E.prototype.whenParentNamed=function(Z){return this._bindingWhenSyntax.whenParentNamed(Z)},E.prototype.whenParentTagged=function(Z,V){return this._bindingWhenSyntax.whenParentTagged(Z,V)},E.prototype.whenAnyAncestorIs=function(Z){return this._bindingWhenSyntax.whenAnyAncestorIs(Z)},E.prototype.whenNoAncestorIs=function(Z){return this._bindingWhenSyntax.whenNoAncestorIs(Z)},E.prototype.whenAnyAncestorNamed=function(Z){return this._bindingWhenSyntax.whenAnyAncestorNamed(Z)},E.prototype.whenAnyAncestorTagged=function(Z,V){return this._bindingWhenSyntax.whenAnyAncestorTagged(Z,V)},E.prototype.whenNoAncestorNamed=function(Z){return this._bindingWhenSyntax.whenNoAncestorNamed(Z)},E.prototype.whenNoAncestorTagged=function(Z,V){return this._bindingWhenSyntax.whenNoAncestorTagged(Z,V)},E.prototype.whenAnyAncestorMatches=function(Z){return this._bindingWhenSyntax.whenAnyAncestorMatches(Z)},E.prototype.whenNoAncestorMatches=function(Z){return this._bindingWhenSyntax.whenNoAncestorMatches(Z)},E.prototype.onActivation=function(Z){return this._bindingOnSyntax.onActivation(Z)},E}();D.BindingWhenOnSyntax=p},98370:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingWhenSyntax=void 0;var j=y(51811),b=y(80758),p=function(){function E(Z){this._binding=Z}return E.prototype.when=function(Z){return this._binding.constraint=Z,new j.BindingOnSyntax(this._binding)},E.prototype.whenTargetNamed=function(Z){return this._binding.constraint=b.namedConstraint(Z),new j.BindingOnSyntax(this._binding)},E.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(Z){var V=Z.target!==null&&!Z.target.isNamed()&&!Z.target.isTagged();return V},new j.BindingOnSyntax(this._binding)},E.prototype.whenTargetTagged=function(Z,V){return this._binding.constraint=b.taggedConstraint(Z)(V),new j.BindingOnSyntax(this._binding)},E.prototype.whenInjectedInto=function(Z){return this._binding.constraint=function(V){return b.typeConstraint(Z)(V.parentRequest)},new j.BindingOnSyntax(this._binding)},E.prototype.whenParentNamed=function(Z){return this._binding.constraint=function(V){return b.namedConstraint(Z)(V.parentRequest)},new j.BindingOnSyntax(this._binding)},E.prototype.whenParentTagged=function(Z,V){return this._binding.constraint=function(G){return b.taggedConstraint(Z)(V)(G.parentRequest)},new j.BindingOnSyntax(this._binding)},E.prototype.whenAnyAncestorIs=function(Z){return this._binding.constraint=function(V){return b.traverseAncerstors(V,b.typeConstraint(Z))},new j.BindingOnSyntax(this._binding)},E.prototype.whenNoAncestorIs=function(Z){return this._binding.constraint=function(V){return!b.traverseAncerstors(V,b.typeConstraint(Z))},new j.BindingOnSyntax(this._binding)},E.prototype.whenAnyAncestorNamed=function(Z){return this._binding.constraint=function(V){return b.traverseAncerstors(V,b.namedConstraint(Z))},new j.BindingOnSyntax(this._binding)},E.prototype.whenNoAncestorNamed=function(Z){return this._binding.constraint=function(V){return!b.traverseAncerstors(V,b.namedConstraint(Z))},new j.BindingOnSyntax(this._binding)},E.prototype.whenAnyAncestorTagged=function(Z,V){return this._binding.constraint=function(G){return b.traverseAncerstors(G,b.taggedConstraint(Z)(V))},new j.BindingOnSyntax(this._binding)},E.prototype.whenNoAncestorTagged=function(Z,V){return this._binding.constraint=function(G){return!b.traverseAncerstors(G,b.taggedConstraint(Z)(V))},new j.BindingOnSyntax(this._binding)},E.prototype.whenAnyAncestorMatches=function(Z){return this._binding.constraint=function(V){return b.traverseAncerstors(V,Z)},new j.BindingOnSyntax(this._binding)},E.prototype.whenNoAncestorMatches=function(Z){return this._binding.constraint=function(V){return!b.traverseAncerstors(V,Z)},new j.BindingOnSyntax(this._binding)},E}();D.BindingWhenSyntax=p},80758:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.typeConstraint=D.namedConstraint=D.taggedConstraint=D.traverseAncerstors=void 0;var j=y(6867),b=y(47738),p=function(G,I){var L=G.parentRequest;return L!==null?I(L)?!0:p(L,I):!1};D.traverseAncerstors=p;var E=function(G){return function(I){var L=function(_e){return _e!==null&&_e.target!==null&&_e.target.matchesTag(G)(I)};return L.metaData=new b.Metadata(G,I),L}};D.taggedConstraint=E;var Z=E(j.NAMED_TAG);D.namedConstraint=Z;var V=function(G){return function(I){var L=null;if(I!==null)if(L=I.bindings[0],typeof G=="string"){var _e=L.serviceIdentifier;return _e===G}else{var be=I.bindings[0].implementationType;return G===be}return!1}};D.typeConstraint=V},70600:function(qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.multiBindToService=void 0;var y=function(j){return function(b){return function(){for(var p=[],E=0;E<arguments.length;E++)p[E]=arguments[E];return p.forEach(function(Z){return j.bind(Z).toService(b)})}}};D.multiBindToService=y},85265:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.isStackOverflowExeption=void 0;var j=y(16674);function b(p){return p instanceof RangeError||p.message===j.STACK_OVERFLOW}D.isStackOverflowExeption=b},37791:function(qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.id=void 0;var y=0;function j(){return y++}D.id=j},55800:function(qe,D,y){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.circularDependencyToException=D.listMetadataForTarget=D.listRegisteredBindingsForServiceIdentifier=D.getServiceIdentifierAsString=D.getFunctionName=void 0;var j=y(16674);function b(L){if(typeof L=="function"){var _e=L;return _e.name}else{if(typeof L=="symbol")return L.toString();var _e=L;return _e}}D.getServiceIdentifierAsString=b;function p(L,_e,be){var Le="",Je=be(L,_e);return Je.length!==0&&(Le=`
Registered bindings:`,Je.forEach(function(Dt){var It="Object";Dt.implementationType!==null&&(It=I(Dt.implementationType)),Le=Le+`
 `+It,Dt.constraint.metaData&&(Le=Le+" - "+Dt.constraint.metaData)})),Le}D.listRegisteredBindingsForServiceIdentifier=p;function E(L,_e){return L.parentRequest===null?!1:L.parentRequest.serviceIdentifier===_e?!0:E(L.parentRequest,_e)}function Z(L){function _e(Le,Je){Je===void 0&&(Je=[]);var Dt=b(Le.serviceIdentifier);return Je.push(Dt),Le.parentRequest!==null?_e(Le.parentRequest,Je):Je}var be=_e(L);return be.reverse().join(" --> ")}function V(L){L.childRequests.forEach(function(_e){if(E(_e,_e.serviceIdentifier)){var be=Z(_e);throw new Error(j.CIRCULAR_DEPENDENCY+" "+be)}else V(_e)})}D.circularDependencyToException=V;function G(L,_e){if(_e.isTagged()||_e.isNamed()){var be="",Le=_e.getNamedTag(),Je=_e.getCustomTags();return Le!==null&&(be+=Le.toString()+`
`),Je!==null&&Je.forEach(function(Dt){be+=Dt.toString()+`
`})," "+L+`
 `+L+" - "+be}else return" "+L}D.listMetadataForTarget=G;function I(L){if(L.name)return L.name;var _e=L.toString(),be=_e.match(/^function\s*([^\s(]+)/);return be?be[1]:"Anonymous function: "+_e}D.getFunctionName=I},18857:function(qe,D,y){"use strict";y.r(D),y.d(D,{Function:function(){return js},Interpreter:function(){return uo},default:function(){return ws},evaluate:function(){return lo},vm:function(){return j}});var j={};y.r(j),y.d(j,{Script:function(){return Eu},compileFunction:function(){return _l},createContext:function(){return yl},runInContext:function(){return Bu},runInNewContext:function(){return Vl}});var b={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},p="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",E={5:p,"5module":p+" export import",6:p+" const class extends export import super"},Z=/^in(stanceof)?$/,V="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",G="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",I=new RegExp("["+V+"]"),L=new RegExp("["+V+G+"]");V=G=null;var _e=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],be=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Le(m,T){for(var H=65536,R=0;R<T.length;R+=2){if(H+=T[R],H>m)return!1;if(H+=T[R+1],H>=m)return!0}}function Je(m,T){return m<65?m===36:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&I.test(String.fromCharCode(m)):T===!1?!1:Le(m,_e)}function Dt(m,T){return m<48?m===36:m<58?!0:m<65?!1:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&L.test(String.fromCharCode(m)):T===!1?!1:Le(m,_e)||Le(m,be)}var It=function(T,H){H===void 0&&(H={}),this.label=T,this.keyword=H.keyword,this.beforeExpr=!!H.beforeExpr,this.startsExpr=!!H.startsExpr,this.isLoop=!!H.isLoop,this.isAssign=!!H.isAssign,this.prefix=!!H.prefix,this.postfix=!!H.postfix,this.binop=H.binop||null,this.updateContext=null};function Ut(m,T){return new It(m,{beforeExpr:!0,binop:T})}var xt={beforeExpr:!0},bt={startsExpr:!0},ct={};function ir(m,T){return T===void 0&&(T={}),T.keyword=m,ct[m]=new It(m,T)}var re={num:new It("num",bt),regexp:new It("regexp",bt),string:new It("string",bt),name:new It("name",bt),eof:new It("eof"),bracketL:new It("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new It("]"),braceL:new It("{",{beforeExpr:!0,startsExpr:!0}),braceR:new It("}"),parenL:new It("(",{beforeExpr:!0,startsExpr:!0}),parenR:new It(")"),comma:new It(",",xt),semi:new It(";",xt),colon:new It(":",xt),dot:new It("."),question:new It("?",xt),questionDot:new It("?."),arrow:new It("=>",xt),template:new It("template"),invalidTemplate:new It("invalidTemplate"),ellipsis:new It("...",xt),backQuote:new It("`",bt),dollarBraceL:new It("${",{beforeExpr:!0,startsExpr:!0}),eq:new It("=",{beforeExpr:!0,isAssign:!0}),assign:new It("_=",{beforeExpr:!0,isAssign:!0}),incDec:new It("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new It("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Ut("||",1),logicalAND:Ut("&&",2),bitwiseOR:Ut("|",3),bitwiseXOR:Ut("^",4),bitwiseAND:Ut("&",5),equality:Ut("==/!=/===/!==",6),relational:Ut("</>/<=/>=",7),bitShift:Ut("<</>>/>>>",8),plusMin:new It("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Ut("%",10),star:Ut("*",10),slash:Ut("/",10),starstar:new It("**",{beforeExpr:!0}),coalesce:Ut("??",1),_break:ir("break"),_case:ir("case",xt),_catch:ir("catch"),_continue:ir("continue"),_debugger:ir("debugger"),_default:ir("default",xt),_do:ir("do",{isLoop:!0,beforeExpr:!0}),_else:ir("else",xt),_finally:ir("finally"),_for:ir("for",{isLoop:!0}),_function:ir("function",bt),_if:ir("if"),_return:ir("return",xt),_switch:ir("switch"),_throw:ir("throw",xt),_try:ir("try"),_var:ir("var"),_const:ir("const"),_while:ir("while",{isLoop:!0}),_with:ir("with"),_new:ir("new",{beforeExpr:!0,startsExpr:!0}),_this:ir("this",bt),_super:ir("super",bt),_class:ir("class",bt),_extends:ir("extends",xt),_export:ir("export"),_import:ir("import",bt),_null:ir("null",bt),_true:ir("true",bt),_false:ir("false",bt),_in:ir("in",{beforeExpr:!0,binop:7}),_instanceof:ir("instanceof",{beforeExpr:!0,binop:7}),_typeof:ir("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ir("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ir("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},cr=/\r\n?|\n|\u2028|\u2029/,Ct=new RegExp(cr.source,"g");function Qe(m,T){return m===10||m===13||!T&&(m===8232||m===8233)}var Tt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,je=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Pt=Object.prototype,fr=Pt.hasOwnProperty,$t=Pt.toString;function zr(m,T){return fr.call(m,T)}var fe=Array.isArray||function(m){return $t.call(m)==="[object Array]"};function ke(m){return new RegExp("^(?:"+m.replace(/ /g,"|")+")$")}var ge=function(T,H){this.line=T,this.column=H};ge.prototype.offset=function(T){return new ge(this.line,this.column+T)};var _t=function(T,H,R){this.start=H,this.end=R,T.sourceFile!==null&&(this.source=T.sourceFile)};function vt(m,T){for(var H=1,R=0;;){Ct.lastIndex=R;var ce=Ct.exec(m);if(ce&&ce.index<T)++H,R=ce.index+ce[0].length;else return new ge(H,T-R)}}var jt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Bt(m){var T={};for(var H in jt)T[H]=m&&zr(m,H)?m[H]:jt[H];if(T.ecmaVersion>=2015&&(T.ecmaVersion-=2009),T.allowReserved==null&&(T.allowReserved=T.ecmaVersion<5),fe(T.onToken)){var R=T.onToken;T.onToken=function(ce){return R.push(ce)}}return fe(T.onComment)&&(T.onComment=Nr(T,T.onComment)),T}function Nr(m,T){return function(H,R,ce,ye,lt,Vt){var Mt={type:H?"Block":"Line",value:R,start:ce,end:ye};m.locations&&(Mt.loc=new _t(this,lt,Vt)),m.ranges&&(Mt.range=[ce,ye]),T.push(Mt)}}var pn=1,mn=2,Ni=pn|mn,or=4,ve=8,Me=16,Ge=32,Re=64,kt=128;function rr(m,T){return mn|(m?or:0)|(T?ve:0)}var yr=0,Pr=1,sr=2,Rr=3,w=4,X=5,Ue=function(T,H,R){this.options=T=Bt(T),this.sourceFile=T.sourceFile,this.keywords=ke(E[T.ecmaVersion>=6?6:T.sourceType==="module"?"5module":5]);var ce="";if(T.allowReserved!==!0){for(var ye=T.ecmaVersion;!(ce=b[ye]);ye--);T.sourceType==="module"&&(ce+=" await")}this.reservedWords=ke(ce);var lt=(ce?ce+" ":"")+b.strict;this.reservedWordsStrict=ke(lt),this.reservedWordsStrictBind=ke(lt+" "+b.strictBind),this.input=String(H),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(cr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=re.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=T.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&T.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(pn),this.regexpState=null},Ve={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ue.prototype.parse=function(){var T=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(T)},Ve.inFunction.get=function(){return(this.currentVarScope().flags&mn)>0},Ve.inGenerator.get=function(){return(this.currentVarScope().flags&ve)>0},Ve.inAsync.get=function(){return(this.currentVarScope().flags&or)>0},Ve.allowSuper.get=function(){return(this.currentThisScope().flags&Re)>0},Ve.allowDirectSuper.get=function(){return(this.currentThisScope().flags&kt)>0},Ve.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ue.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&mn)>0},Ue.extend=function(){for(var T=[],H=arguments.length;H--;)T[H]=arguments[H];for(var R=this,ce=0;ce<T.length;ce++)R=T[ce](R);return R},Ue.parse=function(T,H){return new this(H,T).parse()},Ue.parseExpressionAt=function(T,H,R){var ce=new this(R,T,H);return ce.nextToken(),ce.parseExpression()},Ue.tokenizer=function(T,H){return new this(H,T)},Object.defineProperties(Ue.prototype,Ve);var ot=Ue.prototype,At=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;ot.strictDirective=function(m){for(;;){je.lastIndex=m,m+=je.exec(this.input)[0].length;var T=At.exec(this.input.slice(m));if(!T)return!1;if((T[1]||T[2])==="use strict"){je.lastIndex=m+T[0].length;var H=je.exec(this.input),R=H.index+H[0].length,ce=this.input.charAt(R);return ce===";"||ce==="}"||cr.test(H[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(ce)||ce==="!"&&this.input.charAt(R+1)==="=")}m+=T[0].length,je.lastIndex=m,m+=je.exec(this.input)[0].length,this.input[m]===";"&&m++}},ot.eat=function(m){return this.type===m?(this.next(),!0):!1},ot.isContextual=function(m){return this.type===re.name&&this.value===m&&!this.containsEsc},ot.eatContextual=function(m){return this.isContextual(m)?(this.next(),!0):!1},ot.expectContextual=function(m){this.eatContextual(m)||this.unexpected()},ot.canInsertSemicolon=function(){return this.type===re.eof||this.type===re.braceR||cr.test(this.input.slice(this.lastTokEnd,this.start))},ot.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ot.semicolon=function(){!this.eat(re.semi)&&!this.insertSemicolon()&&this.unexpected()},ot.afterTrailingComma=function(m,T){if(this.type===m)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),T||this.next(),!0},ot.expect=function(m){this.eat(m)||this.unexpected()},ot.unexpected=function(m){this.raise(m!=null?m:this.start,"Unexpected token")};function Q(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}ot.checkPatternErrors=function(m,T){if(!!m){m.trailingComma>-1&&this.raiseRecoverable(m.trailingComma,"Comma is not permitted after the rest element");var H=T?m.parenthesizedAssign:m.parenthesizedBind;H>-1&&this.raiseRecoverable(H,"Parenthesized pattern")}},ot.checkExpressionErrors=function(m,T){if(!m)return!1;var H=m.shorthandAssign,R=m.doubleProto;if(!T)return H>=0||R>=0;H>=0&&this.raise(H,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},ot.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ot.isSimpleAssignTarget=function(m){return m.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(m.expression):m.type==="Identifier"||m.type==="MemberExpression"};var Rt=Ue.prototype;Rt.parseTopLevel=function(m){var T={};for(m.body||(m.body=[]);this.type!==re.eof;){var H=this.parseStatement(null,!0,T);m.body.push(H)}if(this.inModule)for(var R=0,ce=Object.keys(this.undefinedExports);R<ce.length;R+=1){var ye=ce[R];this.raiseRecoverable(this.undefinedExports[ye].start,"Export '"+ye+"' is not defined")}return this.adaptDirectivePrologue(m.body),this.next(),m.sourceType=this.options.sourceType,this.finishNode(m,"Program")};var dr={kind:"loop"},Cr={kind:"switch"};Rt.isLet=function(m){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;je.lastIndex=this.pos;var T=je.exec(this.input),H=this.pos+T[0].length,R=this.input.charCodeAt(H);if(R===91)return!0;if(m)return!1;if(R===123)return!0;if(Je(R,!0)){for(var ce=H+1;Dt(this.input.charCodeAt(ce),!0);)++ce;var ye=this.input.slice(H,ce);if(!Z.test(ye))return!0}return!1},Rt.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;je.lastIndex=this.pos;var m=je.exec(this.input),T=this.pos+m[0].length;return!cr.test(this.input.slice(this.pos,T))&&this.input.slice(T,T+8)==="function"&&(T+8===this.input.length||!Dt(this.input.charAt(T+8)))},Rt.parseStatement=function(m,T,H){var R=this.type,ce=this.startNode(),ye;switch(this.isLet(m)&&(R=re._var,ye="let"),R){case re._break:case re._continue:return this.parseBreakContinueStatement(ce,R.keyword);case re._debugger:return this.parseDebuggerStatement(ce);case re._do:return this.parseDoStatement(ce);case re._for:return this.parseForStatement(ce);case re._function:return m&&(this.strict||m!=="if"&&m!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(ce,!1,!m);case re._class:return m&&this.unexpected(),this.parseClass(ce,!0);case re._if:return this.parseIfStatement(ce);case re._return:return this.parseReturnStatement(ce);case re._switch:return this.parseSwitchStatement(ce);case re._throw:return this.parseThrowStatement(ce);case re._try:return this.parseTryStatement(ce);case re._const:case re._var:return ye=ye||this.value,m&&ye!=="var"&&this.unexpected(),this.parseVarStatement(ce,ye);case re._while:return this.parseWhileStatement(ce);case re._with:return this.parseWithStatement(ce);case re.braceL:return this.parseBlock(!0,ce);case re.semi:return this.parseEmptyStatement(ce);case re._export:case re._import:if(this.options.ecmaVersion>10&&R===re._import){je.lastIndex=this.pos;var lt=je.exec(this.input),Vt=this.pos+lt[0].length,Mt=this.input.charCodeAt(Vt);if(Mt===40||Mt===46)return this.parseExpressionStatement(ce,this.parseExpression())}return this.options.allowImportExportEverywhere||(T||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===re._import?this.parseImport(ce):this.parseExport(ce,H);default:if(this.isAsyncFunction())return m&&this.unexpected(),this.next(),this.parseFunctionStatement(ce,!0,!m);var Ir=this.value,Hr=this.parseExpression();return R===re.name&&Hr.type==="Identifier"&&this.eat(re.colon)?this.parseLabeledStatement(ce,Ir,Hr,m):this.parseExpressionStatement(ce,Hr)}},Rt.parseBreakContinueStatement=function(m,T){var H=T==="break";this.next(),this.eat(re.semi)||this.insertSemicolon()?m.label=null:this.type!==re.name?this.unexpected():(m.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var ce=this.labels[R];if((m.label==null||ce.name===m.label.name)&&(ce.kind!=null&&(H||ce.kind==="loop")||m.label&&H))break}return R===this.labels.length&&this.raise(m.start,"Unsyntactic "+T),this.finishNode(m,H?"BreakStatement":"ContinueStatement")},Rt.parseDebuggerStatement=function(m){return this.next(),this.semicolon(),this.finishNode(m,"DebuggerStatement")},Rt.parseDoStatement=function(m){return this.next(),this.labels.push(dr),m.body=this.parseStatement("do"),this.labels.pop(),this.expect(re._while),m.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(re.semi):this.semicolon(),this.finishNode(m,"DoWhileStatement")},Rt.parseForStatement=function(m){this.next();var T=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(dr),this.enterScope(0),this.expect(re.parenL),this.type===re.semi)return T>-1&&this.unexpected(T),this.parseFor(m,null);var H=this.isLet();if(this.type===re._var||this.type===re._const||H){var R=this.startNode(),ce=H?"let":this.value;return this.next(),this.parseVar(R,!0,ce),this.finishNode(R,"VariableDeclaration"),(this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===re._in?T>-1&&this.unexpected(T):m.await=T>-1),this.parseForIn(m,R)):(T>-1&&this.unexpected(T),this.parseFor(m,R))}var ye=new Q,lt=this.parseExpression(!0,ye);return this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===re._in?T>-1&&this.unexpected(T):m.await=T>-1),this.toAssignable(lt,!1,ye),this.checkLVal(lt),this.parseForIn(m,lt)):(this.checkExpressionErrors(ye,!0),T>-1&&this.unexpected(T),this.parseFor(m,lt))},Rt.parseFunctionStatement=function(m,T,H){return this.next(),this.parseFunction(m,rt|(H?0:wt),!1,T)},Rt.parseIfStatement=function(m){return this.next(),m.test=this.parseParenExpression(),m.consequent=this.parseStatement("if"),m.alternate=this.eat(re._else)?this.parseStatement("if"):null,this.finishNode(m,"IfStatement")},Rt.parseReturnStatement=function(m){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(re.semi)||this.insertSemicolon()?m.argument=null:(m.argument=this.parseExpression(),this.semicolon()),this.finishNode(m,"ReturnStatement")},Rt.parseSwitchStatement=function(m){this.next(),m.discriminant=this.parseParenExpression(),m.cases=[],this.expect(re.braceL),this.labels.push(Cr),this.enterScope(0);for(var T,H=!1;this.type!==re.braceR;)if(this.type===re._case||this.type===re._default){var R=this.type===re._case;T&&this.finishNode(T,"SwitchCase"),m.cases.push(T=this.startNode()),T.consequent=[],this.next(),R?T.test=this.parseExpression():(H&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),H=!0,T.test=null),this.expect(re.colon)}else T||this.unexpected(),T.consequent.push(this.parseStatement(null));return this.exitScope(),T&&this.finishNode(T,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(m,"SwitchStatement")},Rt.parseThrowStatement=function(m){return this.next(),cr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),m.argument=this.parseExpression(),this.semicolon(),this.finishNode(m,"ThrowStatement")};var Xe=[];Rt.parseTryStatement=function(m){if(this.next(),m.block=this.parseBlock(),m.handler=null,this.type===re._catch){var T=this.startNode();if(this.next(),this.eat(re.parenL)){T.param=this.parseBindingAtom();var H=T.param.type==="Identifier";this.enterScope(H?Ge:0),this.checkLVal(T.param,H?w:sr),this.expect(re.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),T.param=null,this.enterScope(0);T.body=this.parseBlock(!1),this.exitScope(),m.handler=this.finishNode(T,"CatchClause")}return m.finalizer=this.eat(re._finally)?this.parseBlock():null,!m.handler&&!m.finalizer&&this.raise(m.start,"Missing catch or finally clause"),this.finishNode(m,"TryStatement")},Rt.parseVarStatement=function(m,T){return this.next(),this.parseVar(m,!1,T),this.semicolon(),this.finishNode(m,"VariableDeclaration")},Rt.parseWhileStatement=function(m){return this.next(),m.test=this.parseParenExpression(),this.labels.push(dr),m.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(m,"WhileStatement")},Rt.parseWithStatement=function(m){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),m.object=this.parseParenExpression(),m.body=this.parseStatement("with"),this.finishNode(m,"WithStatement")},Rt.parseEmptyStatement=function(m){return this.next(),this.finishNode(m,"EmptyStatement")},Rt.parseLabeledStatement=function(m,T,H,R){for(var ce=0,ye=this.labels;ce<ye.length;ce+=1){var lt=ye[ce];lt.name===T&&this.raise(H.start,"Label '"+T+"' is already declared")}for(var Vt=this.type.isLoop?"loop":this.type===re._switch?"switch":null,Mt=this.labels.length-1;Mt>=0;Mt--){var Ir=this.labels[Mt];if(Ir.statementStart===m.start)Ir.statementStart=this.start,Ir.kind=Vt;else break}return this.labels.push({name:T,kind:Vt,statementStart:this.start}),m.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),m.label=H,this.finishNode(m,"LabeledStatement")},Rt.parseExpressionStatement=function(m,T){return m.expression=T,this.semicolon(),this.finishNode(m,"ExpressionStatement")},Rt.parseBlock=function(m,T,H){for(m===void 0&&(m=!0),T===void 0&&(T=this.startNode()),T.body=[],this.expect(re.braceL),m&&this.enterScope(0);this.type!==re.braceR;){var R=this.parseStatement(null);T.body.push(R)}return H&&(this.strict=!1),this.next(),m&&this.exitScope(),this.finishNode(T,"BlockStatement")},Rt.parseFor=function(m,T){return m.init=T,this.expect(re.semi),m.test=this.type===re.semi?null:this.parseExpression(),this.expect(re.semi),m.update=this.type===re.parenR?null:this.parseExpression(),this.expect(re.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,"ForStatement")},Rt.parseForIn=function(m,T){var H=this.type===re._in;return this.next(),T.type==="VariableDeclaration"&&T.declarations[0].init!=null&&(!H||this.options.ecmaVersion<8||this.strict||T.kind!=="var"||T.declarations[0].id.type!=="Identifier")?this.raise(T.start,(H?"for-in":"for-of")+" loop variable declaration may not have an initializer"):T.type==="AssignmentPattern"&&this.raise(T.start,"Invalid left-hand side in for-loop"),m.left=T,m.right=H?this.parseExpression():this.parseMaybeAssign(),this.expect(re.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,H?"ForInStatement":"ForOfStatement")},Rt.parseVar=function(m,T,H){for(m.declarations=[],m.kind=H;;){var R=this.startNode();if(this.parseVarId(R,H),this.eat(re.eq)?R.init=this.parseMaybeAssign(T):H==="const"&&!(this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(T&&(this.type===re._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,m.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(re.comma))break}return m},Rt.parseVarId=function(m,T){m.id=this.parseBindingAtom(),this.checkLVal(m.id,T==="var"?Pr:sr,!1)};var rt=1,wt=2,Ot=4;Rt.parseFunction=function(m,T,H,R){this.initFunction(m),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===re.star&&T&wt&&this.unexpected(),m.generator=this.eat(re.star)),this.options.ecmaVersion>=8&&(m.async=!!R),T&rt&&(m.id=T&Ot&&this.type!==re.name?null:this.parseIdent(),m.id&&!(T&wt)&&this.checkLVal(m.id,this.strict||m.generator||m.async?this.treatFunctionsAsVar?Pr:sr:Rr));var ce=this.yieldPos,ye=this.awaitPos,lt=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(rr(m.async,m.generator)),T&rt||(m.id=this.type===re.name?this.parseIdent():null),this.parseFunctionParams(m),this.parseFunctionBody(m,H,!1),this.yieldPos=ce,this.awaitPos=ye,this.awaitIdentPos=lt,this.finishNode(m,T&rt?"FunctionDeclaration":"FunctionExpression")},Rt.parseFunctionParams=function(m){this.expect(re.parenL),m.params=this.parseBindingList(re.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Rt.parseClass=function(m,T){this.next();var H=this.strict;this.strict=!0,this.parseClassId(m,T),this.parseClassSuper(m);var R=this.startNode(),ce=!1;for(R.body=[],this.expect(re.braceL);this.type!==re.braceR;){var ye=this.parseClassElement(m.superClass!==null);ye&&(R.body.push(ye),ye.type==="MethodDefinition"&&ye.kind==="constructor"&&(ce&&this.raise(ye.start,"Duplicate constructor in the same class"),ce=!0))}return this.strict=H,this.next(),m.body=this.finishNode(R,"ClassBody"),this.finishNode(m,T?"ClassDeclaration":"ClassExpression")},Rt.parseClassElement=function(m){var T=this;if(this.eat(re.semi))return null;var H=this.startNode(),R=function(Mt,Ir){Ir===void 0&&(Ir=!1);var Hr=T.start,qn=T.startLoc;return T.eatContextual(Mt)?T.type!==re.parenL&&(!Ir||!T.canInsertSemicolon())?!0:(H.key&&T.unexpected(),H.computed=!1,H.key=T.startNodeAt(Hr,qn),H.key.name=Mt,T.finishNode(H.key,"Identifier"),!1):!1};H.kind="method",H.static=R("static");var ce=this.eat(re.star),ye=!1;ce||(this.options.ecmaVersion>=8&&R("async",!0)?(ye=!0,ce=this.options.ecmaVersion>=9&&this.eat(re.star)):R("get")?H.kind="get":R("set")&&(H.kind="set")),H.key||this.parsePropertyName(H);var lt=H.key,Vt=!1;return!H.computed&&!H.static&&(lt.type==="Identifier"&&lt.name==="constructor"||lt.type==="Literal"&&lt.value==="constructor")?(H.kind!=="method"&&this.raise(lt.start,"Constructor can't have get/set modifier"),ce&&this.raise(lt.start,"Constructor can't be a generator"),ye&&this.raise(lt.start,"Constructor can't be an async method"),H.kind="constructor",Vt=m):H.static&&lt.type==="Identifier"&&lt.name==="prototype"&&this.raise(lt.start,"Classes may not have a static property named prototype"),this.parseClassMethod(H,ce,ye,Vt),H.kind==="get"&&H.value.params.length!==0&&this.raiseRecoverable(H.value.start,"getter should have no params"),H.kind==="set"&&H.value.params.length!==1&&this.raiseRecoverable(H.value.start,"setter should have exactly one param"),H.kind==="set"&&H.value.params[0].type==="RestElement"&&this.raiseRecoverable(H.value.params[0].start,"Setter cannot use rest params"),H},Rt.parseClassMethod=function(m,T,H,R){return m.value=this.parseMethod(T,H,R),this.finishNode(m,"MethodDefinition")},Rt.parseClassId=function(m,T){this.type===re.name?(m.id=this.parseIdent(),T&&this.checkLVal(m.id,sr,!1)):(T===!0&&this.unexpected(),m.id=null)},Rt.parseClassSuper=function(m){m.superClass=this.eat(re._extends)?this.parseExprSubscripts():null},Rt.parseExport=function(m,T){if(this.next(),this.eat(re.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(m.exported=this.parseIdent(!0),this.checkExport(T,m.exported.name,this.lastTokStart)):m.exported=null),this.expectContextual("from"),this.type!==re.string&&this.unexpected(),m.source=this.parseExprAtom(),this.semicolon(),this.finishNode(m,"ExportAllDeclaration");if(this.eat(re._default)){this.checkExport(T,"default",this.lastTokStart);var H;if(this.type===re._function||(H=this.isAsyncFunction())){var R=this.startNode();this.next(),H&&this.next(),m.declaration=this.parseFunction(R,rt|Ot,!1,H)}else if(this.type===re._class){var ce=this.startNode();m.declaration=this.parseClass(ce,"nullableID")}else m.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(m,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())m.declaration=this.parseStatement(null),m.declaration.type==="VariableDeclaration"?this.checkVariableExport(T,m.declaration.declarations):this.checkExport(T,m.declaration.id.name,m.declaration.id.start),m.specifiers=[],m.source=null;else{if(m.declaration=null,m.specifiers=this.parseExportSpecifiers(T),this.eatContextual("from"))this.type!==re.string&&this.unexpected(),m.source=this.parseExprAtom();else{for(var ye=0,lt=m.specifiers;ye<lt.length;ye+=1){var Vt=lt[ye];this.checkUnreserved(Vt.local),this.checkLocalExport(Vt.local)}m.source=null}this.semicolon()}return this.finishNode(m,"ExportNamedDeclaration")},Rt.checkExport=function(m,T,H){!m||(zr(m,T)&&this.raiseRecoverable(H,"Duplicate export '"+T+"'"),m[T]=!0)},Rt.checkPatternExport=function(m,T){var H=T.type;if(H==="Identifier")this.checkExport(m,T.name,T.start);else if(H==="ObjectPattern")for(var R=0,ce=T.properties;R<ce.length;R+=1){var ye=ce[R];this.checkPatternExport(m,ye)}else if(H==="ArrayPattern")for(var lt=0,Vt=T.elements;lt<Vt.length;lt+=1){var Mt=Vt[lt];Mt&&this.checkPatternExport(m,Mt)}else H==="Property"?this.checkPatternExport(m,T.value):H==="AssignmentPattern"?this.checkPatternExport(m,T.left):H==="RestElement"?this.checkPatternExport(m,T.argument):H==="ParenthesizedExpression"&&this.checkPatternExport(m,T.expression)},Rt.checkVariableExport=function(m,T){if(!!m)for(var H=0,R=T;H<R.length;H+=1){var ce=R[H];this.checkPatternExport(m,ce.id)}},Rt.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Rt.parseExportSpecifiers=function(m){var T=[],H=!0;for(this.expect(re.braceL);!this.eat(re.braceR);){if(H)H=!1;else if(this.expect(re.comma),this.afterTrailingComma(re.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(m,R.exported.name,R.exported.start),T.push(this.finishNode(R,"ExportSpecifier"))}return T},Rt.parseImport=function(m){return this.next(),this.type===re.string?(m.specifiers=Xe,m.source=this.parseExprAtom()):(m.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),m.source=this.type===re.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(m,"ImportDeclaration")},Rt.parseImportSpecifiers=function(){var m=[],T=!0;if(this.type===re.name){var H=this.startNode();if(H.local=this.parseIdent(),this.checkLVal(H.local,sr),m.push(this.finishNode(H,"ImportDefaultSpecifier")),!this.eat(re.comma))return m}if(this.type===re.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,sr),m.push(this.finishNode(R,"ImportNamespaceSpecifier")),m}for(this.expect(re.braceL);!this.eat(re.braceR);){if(T)T=!1;else if(this.expect(re.comma),this.afterTrailingComma(re.braceR))break;var ce=this.startNode();ce.imported=this.parseIdent(!0),this.eatContextual("as")?ce.local=this.parseIdent():(this.checkUnreserved(ce.imported),ce.local=ce.imported),this.checkLVal(ce.local,sr),m.push(this.finishNode(ce,"ImportSpecifier"))}return m},Rt.adaptDirectivePrologue=function(m){for(var T=0;T<m.length&&this.isDirectiveCandidate(m[T]);++T)m[T].directive=m[T].expression.raw.slice(1,-1)},Rt.isDirectiveCandidate=function(m){return m.type==="ExpressionStatement"&&m.expression.type==="Literal"&&typeof m.expression.value=="string"&&(this.input[m.start]==='"'||this.input[m.start]==="'")};var gr=Ue.prototype;gr.toAssignable=function(m,T,H){if(this.options.ecmaVersion>=6&&m)switch(m.type){case"Identifier":this.inAsync&&m.name==="await"&&this.raise(m.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":m.type="ObjectPattern",H&&this.checkPatternErrors(H,!0);for(var R=0,ce=m.properties;R<ce.length;R+=1){var ye=ce[R];this.toAssignable(ye,T),ye.type==="RestElement"&&(ye.argument.type==="ArrayPattern"||ye.argument.type==="ObjectPattern")&&this.raise(ye.argument.start,"Unexpected token")}break;case"Property":m.kind!=="init"&&this.raise(m.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(m.value,T);break;case"ArrayExpression":m.type="ArrayPattern",H&&this.checkPatternErrors(H,!0),this.toAssignableList(m.elements,T);break;case"SpreadElement":m.type="RestElement",this.toAssignable(m.argument,T),m.argument.type==="AssignmentPattern"&&this.raise(m.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":m.operator!=="="&&this.raise(m.left.end,"Only '=' operator can be used for specifying default value."),m.type="AssignmentPattern",delete m.operator,this.toAssignable(m.left,T);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(m.expression,T,H);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!T)break;default:this.raise(m.start,"Assigning to rvalue")}else H&&this.checkPatternErrors(H,!0);return m},gr.toAssignableList=function(m,T){for(var H=m.length,R=0;R<H;R++){var ce=m[R];ce&&this.toAssignable(ce,T)}if(H){var ye=m[H-1];this.options.ecmaVersion===6&&T&&ye&&ye.type==="RestElement"&&ye.argument.type!=="Identifier"&&this.unexpected(ye.argument.start)}return m},gr.parseSpread=function(m){var T=this.startNode();return this.next(),T.argument=this.parseMaybeAssign(!1,m),this.finishNode(T,"SpreadElement")},gr.parseRestBinding=function(){var m=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==re.name&&this.unexpected(),m.argument=this.parseBindingAtom(),this.finishNode(m,"RestElement")},gr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case re.bracketL:var m=this.startNode();return this.next(),m.elements=this.parseBindingList(re.bracketR,!0,!0),this.finishNode(m,"ArrayPattern");case re.braceL:return this.parseObj(!0)}return this.parseIdent()},gr.parseBindingList=function(m,T,H){for(var R=[],ce=!0;!this.eat(m);)if(ce?ce=!1:this.expect(re.comma),T&&this.type===re.comma)R.push(null);else{if(H&&this.afterTrailingComma(m))break;if(this.type===re.ellipsis){var ye=this.parseRestBinding();this.parseBindingListItem(ye),R.push(ye),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(m);break}else{var lt=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(lt),R.push(lt)}}return R},gr.parseBindingListItem=function(m){return m},gr.parseMaybeDefault=function(m,T,H){if(H=H||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(re.eq))return H;var R=this.startNodeAt(m,T);return R.left=H,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},gr.checkLVal=function(m,T,H){switch(T===void 0&&(T=yr),m.type){case"Identifier":T===sr&&m.name==="let"&&this.raiseRecoverable(m.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(m.name)&&this.raiseRecoverable(m.start,(T?"Binding ":"Assigning to ")+m.name+" in strict mode"),H&&(zr(H,m.name)&&this.raiseRecoverable(m.start,"Argument name clash"),H[m.name]=!0),T!==yr&&T!==X&&this.declareName(m.name,T,m.start);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":T&&this.raiseRecoverable(m.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,ce=m.properties;R<ce.length;R+=1){var ye=ce[R];this.checkLVal(ye,T,H)}break;case"Property":this.checkLVal(m.value,T,H);break;case"ArrayPattern":for(var lt=0,Vt=m.elements;lt<Vt.length;lt+=1){var Mt=Vt[lt];Mt&&this.checkLVal(Mt,T,H)}break;case"AssignmentPattern":this.checkLVal(m.left,T,H);break;case"RestElement":this.checkLVal(m.argument,T,H);break;case"ParenthesizedExpression":this.checkLVal(m.expression,T,H);break;default:this.raise(m.start,(T?"Binding":"Assigning to")+" rvalue")}};var br=Ue.prototype;br.checkPropClash=function(m,T,H){if(!(this.options.ecmaVersion>=9&&m.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(m.computed||m.method||m.shorthand))){var R=m.key,ce;switch(R.type){case"Identifier":ce=R.name;break;case"Literal":ce=String(R.value);break;default:return}var ye=m.kind;if(this.options.ecmaVersion>=6){ce==="__proto__"&&ye==="init"&&(T.proto&&(H?H.doubleProto<0&&(H.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),T.proto=!0);return}ce="$"+ce;var lt=T[ce];if(lt){var Vt;ye==="init"?Vt=this.strict&&lt.init||lt.get||lt.set:Vt=lt.init||lt[ye],Vt&&this.raiseRecoverable(R.start,"Redefinition of property")}else lt=T[ce]={init:!1,get:!1,set:!1};lt[ye]=!0}},br.parseExpression=function(m,T){var H=this.start,R=this.startLoc,ce=this.parseMaybeAssign(m,T);if(this.type===re.comma){var ye=this.startNodeAt(H,R);for(ye.expressions=[ce];this.eat(re.comma);)ye.expressions.push(this.parseMaybeAssign(m,T));return this.finishNode(ye,"SequenceExpression")}return ce},br.parseMaybeAssign=function(m,T,H){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(m);this.exprAllowed=!1}var R=!1,ce=-1,ye=-1;T?(ce=T.parenthesizedAssign,ye=T.trailingComma,T.parenthesizedAssign=T.trailingComma=-1):(T=new Q,R=!0);var lt=this.start,Vt=this.startLoc;(this.type===re.parenL||this.type===re.name)&&(this.potentialArrowAt=this.start);var Mt=this.parseMaybeConditional(m,T);if(H&&(Mt=H.call(this,Mt,lt,Vt)),this.type.isAssign){var Ir=this.startNodeAt(lt,Vt);return Ir.operator=this.value,Ir.left=this.type===re.eq?this.toAssignable(Mt,!1,T):Mt,R||(T.parenthesizedAssign=T.trailingComma=T.doubleProto=-1),T.shorthandAssign>=Ir.left.start&&(T.shorthandAssign=-1),this.checkLVal(Mt),this.next(),Ir.right=this.parseMaybeAssign(m),this.finishNode(Ir,"AssignmentExpression")}else R&&this.checkExpressionErrors(T,!0);return ce>-1&&(T.parenthesizedAssign=ce),ye>-1&&(T.trailingComma=ye),Mt},br.parseMaybeConditional=function(m,T){var H=this.start,R=this.startLoc,ce=this.parseExprOps(m,T);if(this.checkExpressionErrors(T))return ce;if(this.eat(re.question)){var ye=this.startNodeAt(H,R);return ye.test=ce,ye.consequent=this.parseMaybeAssign(),this.expect(re.colon),ye.alternate=this.parseMaybeAssign(m),this.finishNode(ye,"ConditionalExpression")}return ce},br.parseExprOps=function(m,T){var H=this.start,R=this.startLoc,ce=this.parseMaybeUnary(T,!1);return this.checkExpressionErrors(T)||ce.start===H&&ce.type==="ArrowFunctionExpression"?ce:this.parseExprOp(ce,H,R,-1,m)},br.parseExprOp=function(m,T,H,R,ce){var ye=this.type.binop;if(ye!=null&&(!ce||this.type!==re._in)&&ye>R){var lt=this.type===re.logicalOR||this.type===re.logicalAND,Vt=this.type===re.coalesce;Vt&&(ye=re.logicalAND.binop);var Mt=this.value;this.next();var Ir=this.start,Hr=this.startLoc,qn=this.parseExprOp(this.parseMaybeUnary(null,!1),Ir,Hr,ye,ce),bi=this.buildBinary(T,H,m,qn,Mt,lt||Vt);return(lt&&this.type===re.coalesce||Vt&&(this.type===re.logicalOR||this.type===re.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(bi,T,H,R,ce)}return m},br.buildBinary=function(m,T,H,R,ce,ye){var lt=this.startNodeAt(m,T);return lt.left=H,lt.operator=ce,lt.right=R,this.finishNode(lt,ye?"LogicalExpression":"BinaryExpression")},br.parseMaybeUnary=function(m,T){var H=this.start,R=this.startLoc,ce;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))ce=this.parseAwait(),T=!0;else if(this.type.prefix){var ye=this.startNode(),lt=this.type===re.incDec;ye.operator=this.value,ye.prefix=!0,this.next(),ye.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(m,!0),lt?this.checkLVal(ye.argument):this.strict&&ye.operator==="delete"&&ye.argument.type==="Identifier"?this.raiseRecoverable(ye.start,"Deleting local variable in strict mode"):T=!0,ce=this.finishNode(ye,lt?"UpdateExpression":"UnaryExpression")}else{if(ce=this.parseExprSubscripts(m),this.checkExpressionErrors(m))return ce;for(;this.type.postfix&&!this.canInsertSemicolon();){var Vt=this.startNodeAt(H,R);Vt.operator=this.value,Vt.prefix=!1,Vt.argument=ce,this.checkLVal(ce),this.next(),ce=this.finishNode(Vt,"UpdateExpression")}}return!T&&this.eat(re.starstar)?this.buildBinary(H,R,ce,this.parseMaybeUnary(null,!1),"**",!1):ce},br.parseExprSubscripts=function(m){var T=this.start,H=this.startLoc,R=this.parseExprAtom(m);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var ce=this.parseSubscripts(R,T,H);return m&&ce.type==="MemberExpression"&&(m.parenthesizedAssign>=ce.start&&(m.parenthesizedAssign=-1),m.parenthesizedBind>=ce.start&&(m.parenthesizedBind=-1)),ce},br.parseSubscripts=function(m,T,H,R){for(var ce=this.options.ecmaVersion>=8&&m.type==="Identifier"&&m.name==="async"&&this.lastTokEnd===m.end&&!this.canInsertSemicolon()&&m.end-m.start==5&&this.potentialArrowAt===m.start,ye=!1;;){var lt=this.parseSubscript(m,T,H,R,ce,ye);if(lt.optional&&(ye=!0),lt===m||lt.type==="ArrowFunctionExpression"){if(ye){var Vt=this.startNodeAt(T,H);Vt.expression=lt,lt=this.finishNode(Vt,"ChainExpression")}return lt}m=lt}},br.parseSubscript=function(m,T,H,R,ce,ye){var lt=this.options.ecmaVersion>=11,Vt=lt&&this.eat(re.questionDot);R&&Vt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Mt=this.eat(re.bracketL);if(Mt||Vt&&this.type!==re.parenL&&this.type!==re.backQuote||this.eat(re.dot)){var Ir=this.startNodeAt(T,H);Ir.object=m,Ir.property=Mt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Ir.computed=!!Mt,Mt&&this.expect(re.bracketR),lt&&(Ir.optional=Vt),m=this.finishNode(Ir,"MemberExpression")}else if(!R&&this.eat(re.parenL)){var Hr=new Q,qn=this.yieldPos,bi=this.awaitPos,di=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var ca=this.parseExprList(re.parenR,this.options.ecmaVersion>=8,!1,Hr);if(ce&&!Vt&&!this.canInsertSemicolon()&&this.eat(re.arrow))return this.checkPatternErrors(Hr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=qn,this.awaitPos=bi,this.awaitIdentPos=di,this.parseArrowExpression(this.startNodeAt(T,H),ca,!0);this.checkExpressionErrors(Hr,!0),this.yieldPos=qn||this.yieldPos,this.awaitPos=bi||this.awaitPos,this.awaitIdentPos=di||this.awaitIdentPos;var Wi=this.startNodeAt(T,H);Wi.callee=m,Wi.arguments=ca,lt&&(Wi.optional=Vt),m=this.finishNode(Wi,"CallExpression")}else if(this.type===re.backQuote){(Vt||ye)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var ka=this.startNodeAt(T,H);ka.tag=m,ka.quasi=this.parseTemplate({isTagged:!0}),m=this.finishNode(ka,"TaggedTemplateExpression")}return m},br.parseExprAtom=function(m){this.type===re.slash&&this.readRegexp();var T,H=this.potentialArrowAt===this.start;switch(this.type){case re._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),T=this.startNode(),this.next(),this.type===re.parenL&&!this.allowDirectSuper&&this.raise(T.start,"super() call outside constructor of a subclass"),this.type!==re.dot&&this.type!==re.bracketL&&this.type!==re.parenL&&this.unexpected(),this.finishNode(T,"Super");case re._this:return T=this.startNode(),this.next(),this.finishNode(T,"ThisExpression");case re.name:var R=this.start,ce=this.startLoc,ye=this.containsEsc,lt=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!ye&&lt.name==="async"&&!this.canInsertSemicolon()&&this.eat(re._function))return this.parseFunction(this.startNodeAt(R,ce),0,!1,!0);if(H&&!this.canInsertSemicolon()){if(this.eat(re.arrow))return this.parseArrowExpression(this.startNodeAt(R,ce),[lt],!1);if(this.options.ecmaVersion>=8&&lt.name==="async"&&this.type===re.name&&!ye)return lt=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(re.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,ce),[lt],!0)}return lt;case re.regexp:var Vt=this.value;return T=this.parseLiteral(Vt.value),T.regex={pattern:Vt.pattern,flags:Vt.flags},T;case re.num:case re.string:return this.parseLiteral(this.value);case re._null:case re._true:case re._false:return T=this.startNode(),T.value=this.type===re._null?null:this.type===re._true,T.raw=this.type.keyword,this.next(),this.finishNode(T,"Literal");case re.parenL:var Mt=this.start,Ir=this.parseParenAndDistinguishExpression(H);return m&&(m.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Ir)&&(m.parenthesizedAssign=Mt),m.parenthesizedBind<0&&(m.parenthesizedBind=Mt)),Ir;case re.bracketL:return T=this.startNode(),this.next(),T.elements=this.parseExprList(re.bracketR,!0,!0,m),this.finishNode(T,"ArrayExpression");case re.braceL:return this.parseObj(!1,m);case re._function:return T=this.startNode(),this.next(),this.parseFunction(T,0);case re._class:return this.parseClass(this.startNode(),!1);case re._new:return this.parseNew();case re.backQuote:return this.parseTemplate();case re._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},br.parseExprImport=function(){var m=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var T=this.parseIdent(!0);switch(this.type){case re.parenL:return this.parseDynamicImport(m);case re.dot:return m.meta=T,this.parseImportMeta(m);default:this.unexpected()}},br.parseDynamicImport=function(m){if(this.next(),m.source=this.parseMaybeAssign(),!this.eat(re.parenR)){var T=this.start;this.eat(re.comma)&&this.eat(re.parenR)?this.raiseRecoverable(T,"Trailing comma is not allowed in import()"):this.unexpected(T)}return this.finishNode(m,"ImportExpression")},br.parseImportMeta=function(m){this.next();var T=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="meta"&&this.raiseRecoverable(m.property.start,"The only valid meta property for import is 'import.meta'"),T&&this.raiseRecoverable(m.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(m.start,"Cannot use 'import.meta' outside a module"),this.finishNode(m,"MetaProperty")},br.parseLiteral=function(m){var T=this.startNode();return T.value=m,T.raw=this.input.slice(this.start,this.end),T.raw.charCodeAt(T.raw.length-1)===110&&(T.bigint=T.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(T,"Literal")},br.parseParenExpression=function(){this.expect(re.parenL);var m=this.parseExpression();return this.expect(re.parenR),m},br.parseParenAndDistinguishExpression=function(m){var T=this.start,H=this.startLoc,R,ce=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var ye=this.start,lt=this.startLoc,Vt=[],Mt=!0,Ir=!1,Hr=new Q,qn=this.yieldPos,bi=this.awaitPos,di;for(this.yieldPos=0,this.awaitPos=0;this.type!==re.parenR;)if(Mt?Mt=!1:this.expect(re.comma),ce&&this.afterTrailingComma(re.parenR,!0)){Ir=!0;break}else if(this.type===re.ellipsis){di=this.start,Vt.push(this.parseParenItem(this.parseRestBinding())),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Vt.push(this.parseMaybeAssign(!1,Hr,this.parseParenItem));var ca=this.start,Wi=this.startLoc;if(this.expect(re.parenR),m&&!this.canInsertSemicolon()&&this.eat(re.arrow))return this.checkPatternErrors(Hr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=qn,this.awaitPos=bi,this.parseParenArrowList(T,H,Vt);(!Vt.length||Ir)&&this.unexpected(this.lastTokStart),di&&this.unexpected(di),this.checkExpressionErrors(Hr,!0),this.yieldPos=qn||this.yieldPos,this.awaitPos=bi||this.awaitPos,Vt.length>1?(R=this.startNodeAt(ye,lt),R.expressions=Vt,this.finishNodeAt(R,"SequenceExpression",ca,Wi)):R=Vt[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var ka=this.startNodeAt(T,H);return ka.expression=R,this.finishNode(ka,"ParenthesizedExpression")}else return R},br.parseParenItem=function(m){return m},br.parseParenArrowList=function(m,T,H){return this.parseArrowExpression(this.startNodeAt(m,T),H)};var Xt=[];br.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var m=this.startNode(),T=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(re.dot)){m.meta=T;var H=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="target"&&this.raiseRecoverable(m.property.start,"The only valid meta property for new is 'new.target'"),H&&this.raiseRecoverable(m.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(m.start,"'new.target' can only be used in functions"),this.finishNode(m,"MetaProperty")}var R=this.start,ce=this.startLoc,ye=this.type===re._import;return m.callee=this.parseSubscripts(this.parseExprAtom(),R,ce,!0),ye&&m.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(re.parenL)?m.arguments=this.parseExprList(re.parenR,this.options.ecmaVersion>=8,!1):m.arguments=Xt,this.finishNode(m,"NewExpression")},br.parseTemplateElement=function(m){var T=m.isTagged,H=this.startNode();return this.type===re.invalidTemplate?(T||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),H.value={raw:this.value,cooked:null}):H.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),H.tail=this.type===re.backQuote,this.finishNode(H,"TemplateElement")},br.parseTemplate=function(m){m===void 0&&(m={});var T=m.isTagged;T===void 0&&(T=!1);var H=this.startNode();this.next(),H.expressions=[];var R=this.parseTemplateElement({isTagged:T});for(H.quasis=[R];!R.tail;)this.type===re.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(re.dollarBraceL),H.expressions.push(this.parseExpression()),this.expect(re.braceR),H.quasis.push(R=this.parseTemplateElement({isTagged:T}));return this.next(),this.finishNode(H,"TemplateLiteral")},br.isAsyncProp=function(m){return!m.computed&&m.key.type==="Identifier"&&m.key.name==="async"&&(this.type===re.name||this.type===re.num||this.type===re.string||this.type===re.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===re.star)&&!cr.test(this.input.slice(this.lastTokEnd,this.start))},br.parseObj=function(m,T){var H=this.startNode(),R=!0,ce={};for(H.properties=[],this.next();!this.eat(re.braceR);){if(R)R=!1;else if(this.expect(re.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(re.braceR))break;var ye=this.parseProperty(m,T);m||this.checkPropClash(ye,ce,T),H.properties.push(ye)}return this.finishNode(H,m?"ObjectPattern":"ObjectExpression")},br.parseProperty=function(m,T){var H=this.startNode(),R,ce,ye,lt;if(this.options.ecmaVersion>=9&&this.eat(re.ellipsis))return m?(H.argument=this.parseIdent(!1),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(H,"RestElement")):(this.type===re.parenL&&T&&(T.parenthesizedAssign<0&&(T.parenthesizedAssign=this.start),T.parenthesizedBind<0&&(T.parenthesizedBind=this.start)),H.argument=this.parseMaybeAssign(!1,T),this.type===re.comma&&T&&T.trailingComma<0&&(T.trailingComma=this.start),this.finishNode(H,"SpreadElement"));this.options.ecmaVersion>=6&&(H.method=!1,H.shorthand=!1,(m||T)&&(ye=this.start,lt=this.startLoc),m||(R=this.eat(re.star)));var Vt=this.containsEsc;return this.parsePropertyName(H),!m&&!Vt&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(H)?(ce=!0,R=this.options.ecmaVersion>=9&&this.eat(re.star),this.parsePropertyName(H,T)):ce=!1,this.parsePropertyValue(H,m,R,ce,ye,lt,T,Vt),this.finishNode(H,"Property")},br.parsePropertyValue=function(m,T,H,R,ce,ye,lt,Vt){if((H||R)&&this.type===re.colon&&this.unexpected(),this.eat(re.colon))m.value=T?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,lt),m.kind="init";else if(this.options.ecmaVersion>=6&&this.type===re.parenL)T&&this.unexpected(),m.kind="init",m.method=!0,m.value=this.parseMethod(H,R);else if(!T&&!Vt&&this.options.ecmaVersion>=5&&!m.computed&&m.key.type==="Identifier"&&(m.key.name==="get"||m.key.name==="set")&&this.type!==re.comma&&this.type!==re.braceR&&this.type!==re.eq){(H||R)&&this.unexpected(),m.kind=m.key.name,this.parsePropertyName(m),m.value=this.parseMethod(!1);var Mt=m.kind==="get"?0:1;if(m.value.params.length!==Mt){var Ir=m.value.start;m.kind==="get"?this.raiseRecoverable(Ir,"getter should have no params"):this.raiseRecoverable(Ir,"setter should have exactly one param")}else m.kind==="set"&&m.value.params[0].type==="RestElement"&&this.raiseRecoverable(m.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!m.computed&&m.key.type==="Identifier"?((H||R)&&this.unexpected(),this.checkUnreserved(m.key),m.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=ce),m.kind="init",T?m.value=this.parseMaybeDefault(ce,ye,m.key):this.type===re.eq&&lt?(lt.shorthandAssign<0&&(lt.shorthandAssign=this.start),m.value=this.parseMaybeDefault(ce,ye,m.key)):m.value=m.key,m.shorthand=!0):this.unexpected()},br.parsePropertyName=function(m){if(this.options.ecmaVersion>=6){if(this.eat(re.bracketL))return m.computed=!0,m.key=this.parseMaybeAssign(),this.expect(re.bracketR),m.key;m.computed=!1}return m.key=this.type===re.num||this.type===re.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},br.initFunction=function(m){m.id=null,this.options.ecmaVersion>=6&&(m.generator=m.expression=!1),this.options.ecmaVersion>=8&&(m.async=!1)},br.parseMethod=function(m,T,H){var R=this.startNode(),ce=this.yieldPos,ye=this.awaitPos,lt=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=m),this.options.ecmaVersion>=8&&(R.async=!!T),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(rr(T,R.generator)|Re|(H?kt:0)),this.expect(re.parenL),R.params=this.parseBindingList(re.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=ce,this.awaitPos=ye,this.awaitIdentPos=lt,this.finishNode(R,"FunctionExpression")},br.parseArrowExpression=function(m,T,H){var R=this.yieldPos,ce=this.awaitPos,ye=this.awaitIdentPos;return this.enterScope(rr(H,!1)|Me),this.initFunction(m),this.options.ecmaVersion>=8&&(m.async=!!H),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,m.params=this.toAssignableList(T,!0),this.parseFunctionBody(m,!0,!1),this.yieldPos=R,this.awaitPos=ce,this.awaitIdentPos=ye,this.finishNode(m,"ArrowFunctionExpression")},br.parseFunctionBody=function(m,T,H){var R=T&&this.type!==re.braceL,ce=this.strict,ye=!1;if(R)m.body=this.parseMaybeAssign(),m.expression=!0,this.checkParams(m,!1);else{var lt=this.options.ecmaVersion>=7&&!this.isSimpleParamList(m.params);(!ce||lt)&&(ye=this.strictDirective(this.end),ye&&lt&&this.raiseRecoverable(m.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Vt=this.labels;this.labels=[],ye&&(this.strict=!0),this.checkParams(m,!ce&&!ye&&!T&&!H&&this.isSimpleParamList(m.params)),this.strict&&m.id&&this.checkLVal(m.id,X),m.body=this.parseBlock(!1,void 0,ye&&!ce),m.expression=!1,this.adaptDirectivePrologue(m.body.body),this.labels=Vt}this.exitScope()},br.isSimpleParamList=function(m){for(var T=0,H=m;T<H.length;T+=1){var R=H[T];if(R.type!=="Identifier")return!1}return!0},br.checkParams=function(m,T){for(var H={},R=0,ce=m.params;R<ce.length;R+=1){var ye=ce[R];this.checkLVal(ye,Pr,T?null:H)}},br.parseExprList=function(m,T,H,R){for(var ce=[],ye=!0;!this.eat(m);){if(ye)ye=!1;else if(this.expect(re.comma),T&&this.afterTrailingComma(m))break;var lt=void 0;H&&this.type===re.comma?lt=null:this.type===re.ellipsis?(lt=this.parseSpread(R),R&&this.type===re.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):lt=this.parseMaybeAssign(!1,R),ce.push(lt)}return ce},br.checkUnreserved=function(m){var T=m.start,H=m.end,R=m.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(T,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(T,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(T,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(T,H).indexOf("\\")!==-1)){var ce=this.strict?this.reservedWordsStrict:this.reservedWords;ce.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(T,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(T,"The keyword '"+R+"' is reserved"))}},br.parseIdent=function(m,T){var H=this.startNode();return this.type===re.name?H.name=this.value:this.type.keyword?(H.name=this.type.keyword,(H.name==="class"||H.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!m),this.finishNode(H,"Identifier"),m||(this.checkUnreserved(H),H.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=H.start)),H},br.parseYield=function(m){this.yieldPos||(this.yieldPos=this.start);var T=this.startNode();return this.next(),this.type===re.semi||this.canInsertSemicolon()||this.type!==re.star&&!this.type.startsExpr?(T.delegate=!1,T.argument=null):(T.delegate=this.eat(re.star),T.argument=this.parseMaybeAssign(m)),this.finishNode(T,"YieldExpression")},br.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var m=this.startNode();return this.next(),m.argument=this.parseMaybeUnary(null,!1),this.finishNode(m,"AwaitExpression")};var kr=Ue.prototype;kr.raise=function(m,T){var H=vt(this.input,m);T+=" ("+H.line+":"+H.column+")";var R=new SyntaxError(T);throw R.pos=m,R.loc=H,R.raisedAt=this.pos,R},kr.raiseRecoverable=kr.raise,kr.curPosition=function(){if(this.options.locations)return new ge(this.curLine,this.pos-this.lineStart)};var Mr=Ue.prototype,un=function(T){this.flags=T,this.var=[],this.lexical=[],this.functions=[]};Mr.enterScope=function(m){this.scopeStack.push(new un(m))},Mr.exitScope=function(){this.scopeStack.pop()},Mr.treatFunctionsAsVarInScope=function(m){return m.flags&mn||!this.inModule&&m.flags&pn},Mr.declareName=function(m,T,H){var R=!1;if(T===sr){var ce=this.currentScope();R=ce.lexical.indexOf(m)>-1||ce.functions.indexOf(m)>-1||ce.var.indexOf(m)>-1,ce.lexical.push(m),this.inModule&&ce.flags&pn&&delete this.undefinedExports[m]}else if(T===w){var ye=this.currentScope();ye.lexical.push(m)}else if(T===Rr){var lt=this.currentScope();this.treatFunctionsAsVar?R=lt.lexical.indexOf(m)>-1:R=lt.lexical.indexOf(m)>-1||lt.var.indexOf(m)>-1,lt.functions.push(m)}else for(var Vt=this.scopeStack.length-1;Vt>=0;--Vt){var Mt=this.scopeStack[Vt];if(Mt.lexical.indexOf(m)>-1&&!(Mt.flags&Ge&&Mt.lexical[0]===m)||!this.treatFunctionsAsVarInScope(Mt)&&Mt.functions.indexOf(m)>-1){R=!0;break}if(Mt.var.push(m),this.inModule&&Mt.flags&pn&&delete this.undefinedExports[m],Mt.flags&Ni)break}R&&this.raiseRecoverable(H,"Identifier '"+m+"' has already been declared")},Mr.checkLocalExport=function(m){this.scopeStack[0].lexical.indexOf(m.name)===-1&&this.scopeStack[0].var.indexOf(m.name)===-1&&(this.undefinedExports[m.name]=m)},Mr.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Mr.currentVarScope=function(){for(var m=this.scopeStack.length-1;;m--){var T=this.scopeStack[m];if(T.flags&Ni)return T}},Mr.currentThisScope=function(){for(var m=this.scopeStack.length-1;;m--){var T=this.scopeStack[m];if(T.flags&Ni&&!(T.flags&Me))return T}};var an=function(T,H,R){this.type="",this.start=H,this.end=0,T.options.locations&&(this.loc=new _t(T,R)),T.options.directSourceFile&&(this.sourceFile=T.options.directSourceFile),T.options.ranges&&(this.range=[H,0])},Kn=Ue.prototype;Kn.startNode=function(){return new an(this,this.start,this.startLoc)},Kn.startNodeAt=function(m,T){return new an(this,m,T)};function ti(m,T,H,R){return m.type=T,m.end=H,this.options.locations&&(m.loc.end=R),this.options.ranges&&(m.range[1]=H),m}Kn.finishNode=function(m,T){return ti.call(this,m,T,this.lastTokEnd,this.lastTokEndLoc)},Kn.finishNodeAt=function(m,T,H,R){return ti.call(this,m,T,H,R)};var Qi=function(T,H,R,ce,ye){this.token=T,this.isExpr=!!H,this.preserveSpace=!!R,this.override=ce,this.generator=!!ye},Ai={b_stat:new Qi("{",!1),b_expr:new Qi("{",!0),b_tmpl:new Qi("${",!1),p_stat:new Qi("(",!1),p_expr:new Qi("(",!0),q_tmpl:new Qi("`",!0,!0,function(m){return m.tryReadTemplateToken()}),f_stat:new Qi("function",!1),f_expr:new Qi("function",!0),f_expr_gen:new Qi("function",!0,!1,null,!0),f_gen:new Qi("function",!1,!1,null,!0)},Pi=Ue.prototype;Pi.initialContext=function(){return[Ai.b_stat]},Pi.braceIsBlock=function(m){var T=this.curContext();return T===Ai.f_expr||T===Ai.f_stat?!0:m===re.colon&&(T===Ai.b_stat||T===Ai.b_expr)?!T.isExpr:m===re._return||m===re.name&&this.exprAllowed?cr.test(this.input.slice(this.lastTokEnd,this.start)):m===re._else||m===re.semi||m===re.eof||m===re.parenR||m===re.arrow?!0:m===re.braceL?T===Ai.b_stat:m===re._var||m===re._const||m===re.name?!1:!this.exprAllowed},Pi.inGeneratorContext=function(){for(var m=this.context.length-1;m>=1;m--){var T=this.context[m];if(T.token==="function")return T.generator}return!1},Pi.updateContext=function(m){var T,H=this.type;H.keyword&&m===re.dot?this.exprAllowed=!1:(T=H.updateContext)?T.call(this,m):this.exprAllowed=H.beforeExpr},re.parenR.updateContext=re.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var m=this.context.pop();m===Ai.b_stat&&this.curContext().token==="function"&&(m=this.context.pop()),this.exprAllowed=!m.isExpr},re.braceL.updateContext=function(m){this.context.push(this.braceIsBlock(m)?Ai.b_stat:Ai.b_expr),this.exprAllowed=!0},re.dollarBraceL.updateContext=function(){this.context.push(Ai.b_tmpl),this.exprAllowed=!0},re.parenL.updateContext=function(m){var T=m===re._if||m===re._for||m===re._with||m===re._while;this.context.push(T?Ai.p_stat:Ai.p_expr),this.exprAllowed=!0},re.incDec.updateContext=function(){},re._function.updateContext=re._class.updateContext=function(m){m.beforeExpr&&m!==re.semi&&m!==re._else&&!(m===re._return&&cr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((m===re.colon||m===re.braceL)&&this.curContext()===Ai.b_stat)?this.context.push(Ai.f_expr):this.context.push(Ai.f_stat),this.exprAllowed=!1},re.backQuote.updateContext=function(){this.curContext()===Ai.q_tmpl?this.context.pop():this.context.push(Ai.q_tmpl),this.exprAllowed=!1},re.star.updateContext=function(m){if(m===re._function){var T=this.context.length-1;this.context[T]===Ai.f_expr?this.context[T]=Ai.f_expr_gen:this.context[T]=Ai.f_gen}this.exprAllowed=!0},re.name.updateContext=function(m){var T=!1;this.options.ecmaVersion>=6&&m!==re.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(T=!0),this.exprAllowed=T};var q="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",le=q+" Extended_Pictographic",pe=le,U={9:q,10:le,11:pe},ae="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",de="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Pe=de+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ue=Pe+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Ee={9:de,10:Pe,11:ue},mt={};function wr(m){var T=mt[m]={binary:ke(U[m]+" "+ae),nonBinary:{General_Category:ke(ae),Script:ke(Ee[m])}};T.nonBinary.Script_Extensions=T.nonBinary.Script,T.nonBinary.gc=T.nonBinary.General_Category,T.nonBinary.sc=T.nonBinary.Script,T.nonBinary.scx=T.nonBinary.Script_Extensions}wr(9),wr(10),wr(11);var Yt=Ue.prototype,tr=function(T){this.parser=T,this.validFlags="gim"+(T.options.ecmaVersion>=6?"uy":"")+(T.options.ecmaVersion>=9?"s":""),this.unicodeProperties=mt[T.options.ecmaVersion>=11?11:T.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};tr.prototype.reset=function(T,H,R){var ce=R.indexOf("u")!==-1;this.start=T|0,this.source=H+"",this.flags=R,this.switchU=ce&&this.parser.options.ecmaVersion>=6,this.switchN=ce&&this.parser.options.ecmaVersion>=9},tr.prototype.raise=function(T){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+T)},tr.prototype.at=function(T,H){H===void 0&&(H=!1);var R=this.source,ce=R.length;if(T>=ce)return-1;var ye=R.charCodeAt(T);if(!(H||this.switchU)||ye<=55295||ye>=57344||T+1>=ce)return ye;var lt=R.charCodeAt(T+1);return lt>=56320&&lt<=57343?(ye<<10)+lt-56613888:ye},tr.prototype.nextIndex=function(T,H){H===void 0&&(H=!1);var R=this.source,ce=R.length;if(T>=ce)return ce;var ye=R.charCodeAt(T),lt;return!(H||this.switchU)||ye<=55295||ye>=57344||T+1>=ce||(lt=R.charCodeAt(T+1))<56320||lt>57343?T+1:T+2},tr.prototype.current=function(T){return T===void 0&&(T=!1),this.at(this.pos,T)},tr.prototype.lookahead=function(T){return T===void 0&&(T=!1),this.at(this.nextIndex(this.pos,T),T)},tr.prototype.advance=function(T){T===void 0&&(T=!1),this.pos=this.nextIndex(this.pos,T)},tr.prototype.eat=function(T,H){return H===void 0&&(H=!1),this.current(H)===T?(this.advance(H),!0):!1};function Ur(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Yt.validateRegExpFlags=function(m){for(var T=m.validFlags,H=m.flags,R=0;R<H.length;R++){var ce=H.charAt(R);T.indexOf(ce)===-1&&this.raise(m.start,"Invalid regular expression flag"),H.indexOf(ce,R+1)>-1&&this.raise(m.start,"Duplicate regular expression flag")}},Yt.validateRegExpPattern=function(m){this.regexp_pattern(m),!m.switchN&&this.options.ecmaVersion>=9&&m.groupNames.length>0&&(m.switchN=!0,this.regexp_pattern(m))},Yt.regexp_pattern=function(m){m.pos=0,m.lastIntValue=0,m.lastStringValue="",m.lastAssertionIsQuantifiable=!1,m.numCapturingParens=0,m.maxBackReference=0,m.groupNames.length=0,m.backReferenceNames.length=0,this.regexp_disjunction(m),m.pos!==m.source.length&&(m.eat(41)&&m.raise("Unmatched ')'"),(m.eat(93)||m.eat(125))&&m.raise("Lone quantifier brackets")),m.maxBackReference>m.numCapturingParens&&m.raise("Invalid escape");for(var T=0,H=m.backReferenceNames;T<H.length;T+=1){var R=H[T];m.groupNames.indexOf(R)===-1&&m.raise("Invalid named capture referenced")}},Yt.regexp_disjunction=function(m){for(this.regexp_alternative(m);m.eat(124);)this.regexp_alternative(m);this.regexp_eatQuantifier(m,!0)&&m.raise("Nothing to repeat"),m.eat(123)&&m.raise("Lone quantifier brackets")},Yt.regexp_alternative=function(m){for(;m.pos<m.source.length&&this.regexp_eatTerm(m););},Yt.regexp_eatTerm=function(m){return this.regexp_eatAssertion(m)?(m.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(m)&&m.switchU&&m.raise("Invalid quantifier"),!0):(m.switchU?this.regexp_eatAtom(m):this.regexp_eatExtendedAtom(m))?(this.regexp_eatQuantifier(m),!0):!1},Yt.regexp_eatAssertion=function(m){var T=m.pos;if(m.lastAssertionIsQuantifiable=!1,m.eat(94)||m.eat(36))return!0;if(m.eat(92)){if(m.eat(66)||m.eat(98))return!0;m.pos=T}if(m.eat(40)&&m.eat(63)){var H=!1;if(this.options.ecmaVersion>=9&&(H=m.eat(60)),m.eat(61)||m.eat(33))return this.regexp_disjunction(m),m.eat(41)||m.raise("Unterminated group"),m.lastAssertionIsQuantifiable=!H,!0}return m.pos=T,!1},Yt.regexp_eatQuantifier=function(m,T){return T===void 0&&(T=!1),this.regexp_eatQuantifierPrefix(m,T)?(m.eat(63),!0):!1},Yt.regexp_eatQuantifierPrefix=function(m,T){return m.eat(42)||m.eat(43)||m.eat(63)||this.regexp_eatBracedQuantifier(m,T)},Yt.regexp_eatBracedQuantifier=function(m,T){var H=m.pos;if(m.eat(123)){var R=0,ce=-1;if(this.regexp_eatDecimalDigits(m)&&(R=m.lastIntValue,m.eat(44)&&this.regexp_eatDecimalDigits(m)&&(ce=m.lastIntValue),m.eat(125)))return ce!==-1&&ce<R&&!T&&m.raise("numbers out of order in {} quantifier"),!0;m.switchU&&!T&&m.raise("Incomplete quantifier"),m.pos=H}return!1},Yt.regexp_eatAtom=function(m){return this.regexp_eatPatternCharacters(m)||m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)},Yt.regexp_eatReverseSolidusAtomEscape=function(m){var T=m.pos;if(m.eat(92)){if(this.regexp_eatAtomEscape(m))return!0;m.pos=T}return!1},Yt.regexp_eatUncapturingGroup=function(m){var T=m.pos;if(m.eat(40)){if(m.eat(63)&&m.eat(58)){if(this.regexp_disjunction(m),m.eat(41))return!0;m.raise("Unterminated group")}m.pos=T}return!1},Yt.regexp_eatCapturingGroup=function(m){if(m.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(m):m.current()===63&&m.raise("Invalid group"),this.regexp_disjunction(m),m.eat(41))return m.numCapturingParens+=1,!0;m.raise("Unterminated group")}return!1},Yt.regexp_eatExtendedAtom=function(m){return m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)||this.regexp_eatInvalidBracedQuantifier(m)||this.regexp_eatExtendedPatternCharacter(m)},Yt.regexp_eatInvalidBracedQuantifier=function(m){return this.regexp_eatBracedQuantifier(m,!0)&&m.raise("Nothing to repeat"),!1},Yt.regexp_eatSyntaxCharacter=function(m){var T=m.current();return Fn(T)?(m.lastIntValue=T,m.advance(),!0):!1};function Fn(m){return m===36||m>=40&&m<=43||m===46||m===63||m>=91&&m<=94||m>=123&&m<=125}Yt.regexp_eatPatternCharacters=function(m){for(var T=m.pos,H=0;(H=m.current())!==-1&&!Fn(H);)m.advance();return m.pos!==T},Yt.regexp_eatExtendedPatternCharacter=function(m){var T=m.current();return T!==-1&&T!==36&&!(T>=40&&T<=43)&&T!==46&&T!==63&&T!==91&&T!==94&&T!==124?(m.advance(),!0):!1},Yt.regexp_groupSpecifier=function(m){if(m.eat(63)){if(this.regexp_eatGroupName(m)){m.groupNames.indexOf(m.lastStringValue)!==-1&&m.raise("Duplicate capture group name"),m.groupNames.push(m.lastStringValue);return}m.raise("Invalid group")}},Yt.regexp_eatGroupName=function(m){if(m.lastStringValue="",m.eat(60)){if(this.regexp_eatRegExpIdentifierName(m)&&m.eat(62))return!0;m.raise("Invalid capture group name")}return!1},Yt.regexp_eatRegExpIdentifierName=function(m){if(m.lastStringValue="",this.regexp_eatRegExpIdentifierStart(m)){for(m.lastStringValue+=Ur(m.lastIntValue);this.regexp_eatRegExpIdentifierPart(m);)m.lastStringValue+=Ur(m.lastIntValue);return!0}return!1},Yt.regexp_eatRegExpIdentifierStart=function(m){var T=m.pos,H=this.options.ecmaVersion>=11,R=m.current(H);return m.advance(H),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,H)&&(R=m.lastIntValue),Rn(R)?(m.lastIntValue=R,!0):(m.pos=T,!1)};function Rn(m){return Je(m,!0)||m===36||m===95}Yt.regexp_eatRegExpIdentifierPart=function(m){var T=m.pos,H=this.options.ecmaVersion>=11,R=m.current(H);return m.advance(H),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,H)&&(R=m.lastIntValue),qt(R)?(m.lastIntValue=R,!0):(m.pos=T,!1)};function qt(m){return Dt(m,!0)||m===36||m===95||m===8204||m===8205}Yt.regexp_eatAtomEscape=function(m){return this.regexp_eatBackReference(m)||this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)||m.switchN&&this.regexp_eatKGroupName(m)?!0:(m.switchU&&(m.current()===99&&m.raise("Invalid unicode escape"),m.raise("Invalid escape")),!1)},Yt.regexp_eatBackReference=function(m){var T=m.pos;if(this.regexp_eatDecimalEscape(m)){var H=m.lastIntValue;if(m.switchU)return H>m.maxBackReference&&(m.maxBackReference=H),!0;if(H<=m.numCapturingParens)return!0;m.pos=T}return!1},Yt.regexp_eatKGroupName=function(m){if(m.eat(107)){if(this.regexp_eatGroupName(m))return m.backReferenceNames.push(m.lastStringValue),!0;m.raise("Invalid named reference")}return!1},Yt.regexp_eatCharacterEscape=function(m){return this.regexp_eatControlEscape(m)||this.regexp_eatCControlLetter(m)||this.regexp_eatZero(m)||this.regexp_eatHexEscapeSequence(m)||this.regexp_eatRegExpUnicodeEscapeSequence(m,!1)||!m.switchU&&this.regexp_eatLegacyOctalEscapeSequence(m)||this.regexp_eatIdentityEscape(m)},Yt.regexp_eatCControlLetter=function(m){var T=m.pos;if(m.eat(99)){if(this.regexp_eatControlLetter(m))return!0;m.pos=T}return!1},Yt.regexp_eatZero=function(m){return m.current()===48&&!Ii(m.lookahead())?(m.lastIntValue=0,m.advance(),!0):!1},Yt.regexp_eatControlEscape=function(m){var T=m.current();return T===116?(m.lastIntValue=9,m.advance(),!0):T===110?(m.lastIntValue=10,m.advance(),!0):T===118?(m.lastIntValue=11,m.advance(),!0):T===102?(m.lastIntValue=12,m.advance(),!0):T===114?(m.lastIntValue=13,m.advance(),!0):!1},Yt.regexp_eatControlLetter=function(m){var T=m.current();return Tn(T)?(m.lastIntValue=T%32,m.advance(),!0):!1};function Tn(m){return m>=65&&m<=90||m>=97&&m<=122}Yt.regexp_eatRegExpUnicodeEscapeSequence=function(m,T){T===void 0&&(T=!1);var H=m.pos,R=T||m.switchU;if(m.eat(117)){if(this.regexp_eatFixedHexDigits(m,4)){var ce=m.lastIntValue;if(R&&ce>=55296&&ce<=56319){var ye=m.pos;if(m.eat(92)&&m.eat(117)&&this.regexp_eatFixedHexDigits(m,4)){var lt=m.lastIntValue;if(lt>=56320&&lt<=57343)return m.lastIntValue=(ce-55296)*1024+(lt-56320)+65536,!0}m.pos=ye,m.lastIntValue=ce}return!0}if(R&&m.eat(123)&&this.regexp_eatHexDigits(m)&&m.eat(125)&&ln(m.lastIntValue))return!0;R&&m.raise("Invalid unicode escape"),m.pos=H}return!1};function ln(m){return m>=0&&m<=1114111}Yt.regexp_eatIdentityEscape=function(m){if(m.switchU)return this.regexp_eatSyntaxCharacter(m)?!0:m.eat(47)?(m.lastIntValue=47,!0):!1;var T=m.current();return T!==99&&(!m.switchN||T!==107)?(m.lastIntValue=T,m.advance(),!0):!1},Yt.regexp_eatDecimalEscape=function(m){m.lastIntValue=0;var T=m.current();if(T>=49&&T<=57){do m.lastIntValue=10*m.lastIntValue+(T-48),m.advance();while((T=m.current())>=48&&T<=57);return!0}return!1},Yt.regexp_eatCharacterClassEscape=function(m){var T=m.current();if(on(T))return m.lastIntValue=-1,m.advance(),!0;if(m.switchU&&this.options.ecmaVersion>=9&&(T===80||T===112)){if(m.lastIntValue=-1,m.advance(),m.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(m)&&m.eat(125))return!0;m.raise("Invalid property name")}return!1};function on(m){return m===100||m===68||m===115||m===83||m===119||m===87}Yt.regexp_eatUnicodePropertyValueExpression=function(m){var T=m.pos;if(this.regexp_eatUnicodePropertyName(m)&&m.eat(61)){var H=m.lastStringValue;if(this.regexp_eatUnicodePropertyValue(m)){var R=m.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(m,H,R),!0}}if(m.pos=T,this.regexp_eatLoneUnicodePropertyNameOrValue(m)){var ce=m.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(m,ce),!0}return!1},Yt.regexp_validateUnicodePropertyNameAndValue=function(m,T,H){zr(m.unicodeProperties.nonBinary,T)||m.raise("Invalid property name"),m.unicodeProperties.nonBinary[T].test(H)||m.raise("Invalid property value")},Yt.regexp_validateUnicodePropertyNameOrValue=function(m,T){m.unicodeProperties.binary.test(T)||m.raise("Invalid property name")},Yt.regexp_eatUnicodePropertyName=function(m){var T=0;for(m.lastStringValue="";Li(T=m.current());)m.lastStringValue+=Ur(T),m.advance();return m.lastStringValue!==""};function Li(m){return Tn(m)||m===95}Yt.regexp_eatUnicodePropertyValue=function(m){var T=0;for(m.lastStringValue="";bn(T=m.current());)m.lastStringValue+=Ur(T),m.advance();return m.lastStringValue!==""};function bn(m){return Li(m)||Ii(m)}Yt.regexp_eatLoneUnicodePropertyNameOrValue=function(m){return this.regexp_eatUnicodePropertyValue(m)},Yt.regexp_eatCharacterClass=function(m){if(m.eat(91)){if(m.eat(94),this.regexp_classRanges(m),m.eat(93))return!0;m.raise("Unterminated character class")}return!1},Yt.regexp_classRanges=function(m){for(;this.regexp_eatClassAtom(m);){var T=m.lastIntValue;if(m.eat(45)&&this.regexp_eatClassAtom(m)){var H=m.lastIntValue;m.switchU&&(T===-1||H===-1)&&m.raise("Invalid character class"),T!==-1&&H!==-1&&T>H&&m.raise("Range out of order in character class")}}},Yt.regexp_eatClassAtom=function(m){var T=m.pos;if(m.eat(92)){if(this.regexp_eatClassEscape(m))return!0;if(m.switchU){var H=m.current();(H===99||qi(H))&&m.raise("Invalid class escape"),m.raise("Invalid escape")}m.pos=T}var R=m.current();return R!==93?(m.lastIntValue=R,m.advance(),!0):!1},Yt.regexp_eatClassEscape=function(m){var T=m.pos;if(m.eat(98))return m.lastIntValue=8,!0;if(m.switchU&&m.eat(45))return m.lastIntValue=45,!0;if(!m.switchU&&m.eat(99)){if(this.regexp_eatClassControlLetter(m))return!0;m.pos=T}return this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)},Yt.regexp_eatClassControlLetter=function(m){var T=m.current();return Ii(T)||T===95?(m.lastIntValue=T%32,m.advance(),!0):!1},Yt.regexp_eatHexEscapeSequence=function(m){var T=m.pos;if(m.eat(120)){if(this.regexp_eatFixedHexDigits(m,2))return!0;m.switchU&&m.raise("Invalid escape"),m.pos=T}return!1},Yt.regexp_eatDecimalDigits=function(m){var T=m.pos,H=0;for(m.lastIntValue=0;Ii(H=m.current());)m.lastIntValue=10*m.lastIntValue+(H-48),m.advance();return m.pos!==T};function Ii(m){return m>=48&&m<=57}Yt.regexp_eatHexDigits=function(m){var T=m.pos,H=0;for(m.lastIntValue=0;ea(H=m.current());)m.lastIntValue=16*m.lastIntValue+ci(H),m.advance();return m.pos!==T};function ea(m){return m>=48&&m<=57||m>=65&&m<=70||m>=97&&m<=102}function ci(m){return m>=65&&m<=70?10+(m-65):m>=97&&m<=102?10+(m-97):m-48}Yt.regexp_eatLegacyOctalEscapeSequence=function(m){if(this.regexp_eatOctalDigit(m)){var T=m.lastIntValue;if(this.regexp_eatOctalDigit(m)){var H=m.lastIntValue;T<=3&&this.regexp_eatOctalDigit(m)?m.lastIntValue=T*64+H*8+m.lastIntValue:m.lastIntValue=T*8+H}else m.lastIntValue=T;return!0}return!1},Yt.regexp_eatOctalDigit=function(m){var T=m.current();return qi(T)?(m.lastIntValue=T-48,m.advance(),!0):(m.lastIntValue=0,!1)};function qi(m){return m>=48&&m<=55}Yt.regexp_eatFixedHexDigits=function(m,T){var H=m.pos;m.lastIntValue=0;for(var R=0;R<T;++R){var ce=m.current();if(!ea(ce))return m.pos=H,!1;m.lastIntValue=16*m.lastIntValue+ci(ce),m.advance()}return!0};var zi=function(T){this.type=T.type,this.value=T.value,this.start=T.start,this.end=T.end,T.options.locations&&(this.loc=new _t(T,T.startLoc,T.endLoc)),T.options.ranges&&(this.range=[T.start,T.end])},Mi=Ue.prototype;Mi.next=function(m){!m&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new zi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Mi.getToken=function(){return this.next(),new zi(this)},typeof Symbol!="undefined"&&(Mi[Symbol.iterator]=function(){var m=this;return{next:function(){var T=m.getToken();return{done:T.type===re.eof,value:T}}}}),Mi.curContext=function(){return this.context[this.context.length-1]},Mi.nextToken=function(){var m=this.curContext();if((!m||!m.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(re.eof);if(m.override)return m.override(this);this.readToken(this.fullCharCodeAtPos())},Mi.readToken=function(m){return Je(m,this.options.ecmaVersion>=6)||m===92?this.readWord():this.getTokenFromCode(m)},Mi.fullCharCodeAtPos=function(){var m=this.input.charCodeAt(this.pos);if(m<=55295||m>=57344)return m;var T=this.input.charCodeAt(this.pos+1);return(m<<10)+T-56613888},Mi.skipBlockComment=function(){var m=this.options.onComment&&this.curPosition(),T=this.pos,H=this.input.indexOf("*/",this.pos+=2);if(H===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=H+2,this.options.locations){Ct.lastIndex=T;for(var R;(R=Ct.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(T+2,H),T,this.pos,m,this.curPosition())},Mi.skipLineComment=function(m){for(var T=this.pos,H=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=m);this.pos<this.input.length&&!Qe(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(T+m,this.pos),T,this.pos,H,this.curPosition())},Mi.skipSpace=function(){e:for(;this.pos<this.input.length;){var m=this.input.charCodeAt(this.pos);switch(m){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(m>8&&m<14||m>=5760&&Tt.test(String.fromCharCode(m)))++this.pos;else break e}}},Mi.finishToken=function(m,T){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var H=this.type;this.type=m,this.value=T,this.updateContext(H)},Mi.readToken_dot=function(){var m=this.input.charCodeAt(this.pos+1);if(m>=48&&m<=57)return this.readNumber(!0);var T=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&m===46&&T===46?(this.pos+=3,this.finishToken(re.ellipsis)):(++this.pos,this.finishToken(re.dot))},Mi.readToken_slash=function(){var m=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):m===61?this.finishOp(re.assign,2):this.finishOp(re.slash,1)},Mi.readToken_mult_modulo_exp=function(m){var T=this.input.charCodeAt(this.pos+1),H=1,R=m===42?re.star:re.modulo;return this.options.ecmaVersion>=7&&m===42&&T===42&&(++H,R=re.starstar,T=this.input.charCodeAt(this.pos+2)),T===61?this.finishOp(re.assign,H+1):this.finishOp(R,H)},Mi.readToken_pipe_amp=function(m){var T=this.input.charCodeAt(this.pos+1);if(T===m){if(this.options.ecmaVersion>=12){var H=this.input.charCodeAt(this.pos+2);if(H===61)return this.finishOp(re.assign,3)}return this.finishOp(m===124?re.logicalOR:re.logicalAND,2)}return T===61?this.finishOp(re.assign,2):this.finishOp(m===124?re.bitwiseOR:re.bitwiseAND,1)},Mi.readToken_caret=function(){var m=this.input.charCodeAt(this.pos+1);return m===61?this.finishOp(re.assign,2):this.finishOp(re.bitwiseXOR,1)},Mi.readToken_plus_min=function(m){var T=this.input.charCodeAt(this.pos+1);return T===m?T===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||cr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(re.incDec,2):T===61?this.finishOp(re.assign,2):this.finishOp(re.plusMin,1)},Mi.readToken_lt_gt=function(m){var T=this.input.charCodeAt(this.pos+1),H=1;return T===m?(H=m===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+H)===61?this.finishOp(re.assign,H+1):this.finishOp(re.bitShift,H)):T===33&&m===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(T===61&&(H=2),this.finishOp(re.relational,H))},Mi.readToken_eq_excl=function(m){var T=this.input.charCodeAt(this.pos+1);return T===61?this.finishOp(re.equality,this.input.charCodeAt(this.pos+2)===61?3:2):m===61&&T===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(re.arrow)):this.finishOp(m===61?re.eq:re.prefix,1)},Mi.readToken_question=function(){var m=this.options.ecmaVersion;if(m>=11){var T=this.input.charCodeAt(this.pos+1);if(T===46){var H=this.input.charCodeAt(this.pos+2);if(H<48||H>57)return this.finishOp(re.questionDot,2)}if(T===63){if(m>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(re.assign,3)}return this.finishOp(re.coalesce,2)}}return this.finishOp(re.question,1)},Mi.getTokenFromCode=function(m){switch(m){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(re.parenL);case 41:return++this.pos,this.finishToken(re.parenR);case 59:return++this.pos,this.finishToken(re.semi);case 44:return++this.pos,this.finishToken(re.comma);case 91:return++this.pos,this.finishToken(re.bracketL);case 93:return++this.pos,this.finishToken(re.bracketR);case 123:return++this.pos,this.finishToken(re.braceL);case 125:return++this.pos,this.finishToken(re.braceR);case 58:return++this.pos,this.finishToken(re.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(re.backQuote);case 48:var T=this.input.charCodeAt(this.pos+1);if(T===120||T===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(T===111||T===79)return this.readRadixNumber(8);if(T===98||T===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(m);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(m);case 124:case 38:return this.readToken_pipe_amp(m);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(m);case 60:case 62:return this.readToken_lt_gt(m);case 61:case 33:return this.readToken_eq_excl(m);case 63:return this.readToken_question();case 126:return this.finishOp(re.prefix,1)}this.raise(this.pos,"Unexpected character '"+ai(m)+"'")},Mi.finishOp=function(m,T){var H=this.input.slice(this.pos,this.pos+T);return this.pos+=T,this.finishToken(m,H)},Mi.readRegexp=function(){for(var m,T,H=this.pos;;){this.pos>=this.input.length&&this.raise(H,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(cr.test(R)&&this.raise(H,"Unterminated regular expression"),m)m=!1;else{if(R==="[")T=!0;else if(R==="]"&&T)T=!1;else if(R==="/"&&!T)break;m=R==="\\"}++this.pos}var ce=this.input.slice(H,this.pos);++this.pos;var ye=this.pos,lt=this.readWord1();this.containsEsc&&this.unexpected(ye);var Vt=this.regexpState||(this.regexpState=new tr(this));Vt.reset(H,ce,lt),this.validateRegExpFlags(Vt),this.validateRegExpPattern(Vt);var Mt=null;try{Mt=new RegExp(ce,lt)}catch(Ir){}return this.finishToken(re.regexp,{pattern:ce,flags:lt,value:Mt})},Mi.readInt=function(m,T,H){for(var R=this.options.ecmaVersion>=12&&T===void 0,ce=H&&this.input.charCodeAt(this.pos)===48,ye=this.pos,lt=0,Vt=0,Mt=0,Ir=T==null?Infinity:T;Mt<Ir;++Mt,++this.pos){var Hr=this.input.charCodeAt(this.pos),qn=void 0;if(R&&Hr===95){ce&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Vt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Mt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Vt=Hr;continue}if(Hr>=97?qn=Hr-97+10:Hr>=65?qn=Hr-65+10:Hr>=48&&Hr<=57?qn=Hr-48:qn=Infinity,qn>=m)break;Vt=Hr,lt=lt*m+qn}return R&&Vt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===ye||T!=null&&this.pos-ye!==T?null:lt};function la(m,T){return T?parseInt(m,8):parseFloat(m.replace(/_/g,""))}function Bi(m){return typeof BigInt!="function"?null:BigInt(m.replace(/_/g,""))}Mi.readRadixNumber=function(m){var T=this.pos;this.pos+=2;var H=this.readInt(m);return H==null&&this.raise(this.start+2,"Expected number in radix "+m),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(H=Bi(this.input.slice(T,this.pos)),++this.pos):Je(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(re.num,H)},Mi.readNumber=function(m){var T=this.pos;!m&&this.readInt(10,void 0,!0)===null&&this.raise(T,"Invalid number");var H=this.pos-T>=2&&this.input.charCodeAt(T)===48;H&&this.strict&&this.raise(T,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!H&&!m&&this.options.ecmaVersion>=11&&R===110){var ce=Bi(this.input.slice(T,this.pos));return++this.pos,Je(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(re.num,ce)}H&&/[89]/.test(this.input.slice(T,this.pos))&&(H=!1),R===46&&!H&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!H&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(T,"Invalid number")),Je(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var ye=la(this.input.slice(T,this.pos),H);return this.finishToken(re.num,ye)},Mi.readCodePoint=function(){var m=this.input.charCodeAt(this.pos),T;if(m===123){this.options.ecmaVersion<6&&this.unexpected();var H=++this.pos;T=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,T>1114111&&this.invalidStringToken(H,"Code point out of bounds")}else T=this.readHexChar(4);return T};function ai(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Mi.readString=function(m){for(var T="",H=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===m)break;R===92?(T+=this.input.slice(H,this.pos),T+=this.readEscapedChar(!1),H=this.pos):(Qe(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return T+=this.input.slice(H,this.pos++),this.finishToken(re.string,T)};var ki={};Mi.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(m){if(m===ki)this.readInvalidTemplateToken();else throw m}this.inTemplateElement=!1},Mi.invalidStringToken=function(m,T){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw ki;this.raise(m,T)},Mi.readTmplToken=function(){for(var m="",T=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var H=this.input.charCodeAt(this.pos);if(H===96||H===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===re.template||this.type===re.invalidTemplate)?H===36?(this.pos+=2,this.finishToken(re.dollarBraceL)):(++this.pos,this.finishToken(re.backQuote)):(m+=this.input.slice(T,this.pos),this.finishToken(re.template,m));if(H===92)m+=this.input.slice(T,this.pos),m+=this.readEscapedChar(!0),T=this.pos;else if(Qe(H)){switch(m+=this.input.slice(T,this.pos),++this.pos,H){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:m+=`
`;break;default:m+=String.fromCharCode(H);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),T=this.pos}else++this.pos}},Mi.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(re.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Mi.readEscapedChar=function(m){var T=this.input.charCodeAt(++this.pos);switch(++this.pos,T){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ai(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(m){var H=this.pos-1;return this.invalidStringToken(H,"Invalid escape sequence in template string"),null}default:if(T>=48&&T<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],ce=parseInt(R,8);return ce>255&&(R=R.slice(0,-1),ce=parseInt(R,8)),this.pos+=R.length-1,T=this.input.charCodeAt(this.pos),(R!=="0"||T===56||T===57)&&(this.strict||m)&&this.invalidStringToken(this.pos-1-R.length,m?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(ce)}return Qe(T)?"":String.fromCharCode(T)}},Mi.readHexChar=function(m){var T=this.pos,H=this.readInt(16,m);return H===null&&this.invalidStringToken(T,"Bad character escape sequence"),H},Mi.readWord1=function(){this.containsEsc=!1;for(var m="",T=!0,H=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var ce=this.fullCharCodeAtPos();if(Dt(ce,R))this.pos+=ce<=65535?1:2;else if(ce===92){this.containsEsc=!0,m+=this.input.slice(H,this.pos);var ye=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var lt=this.readCodePoint();(T?Je:Dt)(lt,R)||this.invalidStringToken(ye,"Invalid Unicode escape"),m+=ai(lt),H=this.pos}else break;T=!1}return m+this.input.slice(H,this.pos)},Mi.readWord=function(){var m=this.readWord1(),T=re.name;return this.keywords.test(m)&&(T=ct[m]),this.finishToken(T,m)};var wi="7.4.1";Ue.acorn={Parser:Ue,version:wi,defaultOptions:jt,Position:ge,SourceLocation:_t,getLineInfo:vt,Node:an,TokenType:It,tokTypes:re,keywordTypes:ct,TokContext:Qi,tokContexts:Ai,isIdentifierChar:Dt,isIdentifierStart:Je,Token:zi,isNewLine:Qe,lineBreak:cr,lineBreakG:Ct,nonASCIIwhitespace:Tt};function ro(m,T){return Ue.parse(m,T)}function po(m,T,H){return Ue.parseExpressionAt(m,T,H)}function ia(m,T){return Ue.tokenizer(m,T)}function Gi(m,T){m.prototype=Object.create(T.prototype),m.prototype.constructor=m,m.__proto__=T}function Zs(m){var T=typeof Map=="function"?new Map:void 0;return Zs=function(R){if(R===null||!No(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof T!="undefined"){if(T.has(R))return T.get(R);T.set(R,ce)}function ce(){return Aa(R,arguments,Wa(this).constructor)}return ce.prototype=Object.create(R.prototype,{constructor:{value:ce,enumerable:!1,writable:!0,configurable:!0}}),Hi(ce,R)},Zs(m)}function nu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function Aa(m,T,H){return nu()?Aa=Reflect.construct:Aa=function(ce,ye,lt){var Vt=[null];Vt.push.apply(Vt,ye);var Mt=Function.bind.apply(ce,Vt),Ir=new Mt;return lt&&Hi(Ir,lt.prototype),Ir},Aa.apply(null,arguments)}function No(m){return Function.toString.call(m).indexOf("[native code]")!==-1}function Hi(m,T){return Hi=Object.setPrototypeOf||function(R,ce){return R.__proto__=ce,R},Hi(m,T)}function Wa(m){return Wa=Object.setPrototypeOf?Object.getPrototypeOf:function(H){return H.__proto__||Object.getPrototypeOf(H)},Wa(m)}var ao=function(m){Gi(T,m);function T(){return m.apply(this,arguments)||this}return T}(Zs(Error)),ga=function(m){Gi(T,m);function T(){return m.apply(this,arguments)||this}return T}(Zs(SyntaxError)),Lo=function(m){Gi(T,m);function T(){return m.apply(this,arguments)||this}return T}(Zs(ReferenceError)),Fa=function(m){Gi(T,m);function T(){return m.apply(this,arguments)||this}return T}(Zs(TypeError)),Cs=function(m){Gi(T,m);function T(){return m.apply(this,arguments)||this}return T}(ao),Fi=function(m){Gi(T,m);function T(){return m.apply(this,arguments)||this}return T}(ga),Ko=function(m){Gi(T,m);function T(){return m.apply(this,arguments)||this}return T}(Lo),ya={UnknownError:[3001,"%0",Cs],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Cs],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Ko],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Ko],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Ko],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Ko],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Ko],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Ko],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Ko],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Ko],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Ko],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Ko],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Lo],VariableUndefinedReferenceError:[2002,"%0 is not defined",Lo],IsNotConstructor:[2003,"%0 is not a constructor",Fa]};function vo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function Da(m,T,H){return vo()?Da=Reflect.construct:Da=function(ce,ye,lt){var Vt=[null];Vt.push.apply(Vt,ye);var Mt=Function.bind.apply(ce,Vt),Ir=new Mt;return lt&&So(Ir,lt.prototype),Ir},Da.apply(null,arguments)}function So(m,T){return So=Object.setPrototypeOf||function(R,ce){return R.__proto__=ce,R},So(m,T)}var xe="0.0.2";function Fe(m,T){Object.defineProperty(m,"name",{value:T,writable:!1,enumerable:!1,configurable:!0})}var pt=Object.prototype.hasOwnProperty,Jt=Symbol("Break"),Yr=Symbol("Continue"),Qn=Symbol("DefaultCase"),Ci=Symbol("EmptyStatementReturn"),Za=Symbol("WithScopeName"),mo=Symbol("SuperScopeName"),oo=Symbol("RootScopeName"),es=Symbol("GlobalScopeName");function $s(m){return typeof m=="function"}var ja=function(){function m(H){this.interpreter=H}var T=m.prototype;return T.generator=function(){var R=this.interpreter;function ce(){return this.getCurrentScope()}function ye(){return this.getGlobalScope()}function lt(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:ce.bind(R),getGlobalScope:ye.bind(R),getCurrentContext:lt.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},m}();function Fu(m,T,H){if(H===void 0&&(H=!0),!(m instanceof ja))throw new Error("Illegal call");if(typeof T!="string")return T;if(!!T){var R=m.generator(),ce=R.getOptions(),ye={timeout:ce.timeout,_initEnv:function(){H||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},lt=H?R.getGlobalScope():R.getCurrentScope(),Vt=new uo(lt,ye);return Vt.evaluate(T)}}Object.defineProperty(Fu,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function ts(m){if(!(m instanceof ja))throw new Error("Illegal call");for(var T=m.generator(),H=arguments.length,R=new Array(H>1?H-1:0),ce=1;ce<H;ce++)R[ce-1]=arguments[ce];var ye=R.pop(),lt=new uo(T.getGlobalScope(),T.getOptions()),Vt=`
		    (function anonymous(`+R.join(",")+`){
		        `+ye+`
		    });
		    `;return lt.evaluate(Vt)}Object.defineProperty(ts,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var zo=function(T){this.value=T},so=function(T){this.value=T},oi=function(T){this.value=T},ys=function(T,H,R){H===void 0&&(H=null),this.name=R,this.parent=H,this.data=T,this.labelStack=[]};function rs(){}function Bs(m,T){return m===void 0&&(m=null),new ys(Object.create(null),m,T)}function ns(m){return Object.create(m)}var Pa={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Fu,Function:ts};typeof JSON!="undefined"&&(Pa.JSON=JSON),typeof Promise!="undefined"&&(Pa.Promise=Promise),typeof Set!="undefined"&&(Pa.Set=Set),typeof Map!="undefined"&&(Pa.Map=Map),typeof Symbol!="undefined"&&(Pa.Symbol=Symbol),typeof Proxy!="undefined"&&(Pa.Proxy=Proxy),typeof WeakMap!="undefined"&&(Pa.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Pa.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Pa.Reflect=Reflect);var uo=function(){function m(H,R){H===void 0&&(H=m.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||m.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?m.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=H||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var T=m.prototype;return T.initEnvironment=function(R){var ce;if(R instanceof ys)ce=R;else{var ye=null,lt=this.createSuperScope(R);this.options.rootContext&&(ye=new ys(ns(this.options.rootContext),lt,oo)),ce=new ys(R,ye||lt,es)}this.globalScope=ce,this.currentScope=this.globalScope,this.globalContext=ce.data,this.currentContext=ce.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Vt=this.options._initEnv;Vt&&Vt.call(this)},T.getExecStartTime=function(){return this.execStartTime},T.getExecutionTime=function(){return this.execEndTime-this.execStartTime},T.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},T.getOptions=function(){return this.options},T.getGlobalScope=function(){return this.globalScope},T.getCurrentScope=function(){return this.currentScope},T.getCurrentContext=function(){return this.currentContext},T.isInterruptThrow=function(R){return R instanceof Cs||R instanceof Ko||R instanceof Fi},T.createSuperScope=function(R){var ce=Object.assign({},Pa),ye=Object.keys(ce);return ye.forEach(function(lt){lt in R&&delete ce[lt]}),new ys(ce,null,mo)},T.setCurrentContext=function(R){this.currentContext=R},T.setCurrentScope=function(R){this.currentScope=R},T.evaluate=function(R){R===void 0&&(R="");var ce;if(!!R)return ce=ro(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||m.ecmaVersion}),this.evaluateNode(ce,R)},T.appendCode=function(R){return this.evaluate(R)},T.evaluateNode=function(R,ce){var ye=this;ce===void 0&&(ce=""),this.value=void 0,this.source=ce,this.sourceList.push(ce),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var lt=this.getCurrentScope(),Vt=this.getCurrentContext(),Mt=lt.labelStack.concat([]),Ir=this.callStack.concat([]),Hr=function(){ye.setCurrentScope(lt),ye.setCurrentContext(Vt),lt.labelStack=Mt,ye.callStack=Ir};try{var qn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),qn()}catch(bi){throw bi}finally{Hr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},T.createErrorMessage=function(R,ce,ye){var lt=R[1].replace("%0",String(ce));return ye!==null&&(lt+=this.getNodePosition(ye||this.lastExecNode)),lt},T.createError=function(R,ce){return new ce(R)},T.createThrowError=function(R,ce){return this.createError(R,ce)},T.createInternalThrowError=function(R,ce,ye){return this.createError(this.createErrorMessage(R,ce,ye),R[2])},T.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,ce=Date.now();return ce-this.execStartTime>R},T.getNodePosition=function(R){if(R){var ce="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+ce:""}return""},T.createClosure=function(R){var ce=this,ye;switch(R.type){case"BinaryExpression":ye=this.binaryExpressionHandler(R);break;case"LogicalExpression":ye=this.logicalExpressionHandler(R);break;case"UnaryExpression":ye=this.unaryExpressionHandler(R);break;case"UpdateExpression":ye=this.updateExpressionHandler(R);break;case"ObjectExpression":ye=this.objectExpressionHandler(R);break;case"ArrayExpression":ye=this.arrayExpressionHandler(R);break;case"CallExpression":ye=this.callExpressionHandler(R);break;case"NewExpression":ye=this.newExpressionHandler(R);break;case"MemberExpression":ye=this.memberExpressionHandler(R);break;case"ThisExpression":ye=this.thisExpressionHandler(R);break;case"SequenceExpression":ye=this.sequenceExpressionHandler(R);break;case"Literal":ye=this.literalHandler(R);break;case"Identifier":ye=this.identifierHandler(R);break;case"AssignmentExpression":ye=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":ye=this.functionDeclarationHandler(R);break;case"VariableDeclaration":ye=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":ye=this.programHandler(R);break;case"ExpressionStatement":ye=this.expressionStatementHandler(R);break;case"EmptyStatement":ye=this.emptyStatementHandler(R);break;case"ReturnStatement":ye=this.returnStatementHandler(R);break;case"FunctionExpression":ye=this.functionExpressionHandler(R);break;case"IfStatement":ye=this.ifStatementHandler(R);break;case"ConditionalExpression":ye=this.conditionalExpressionHandler(R);break;case"ForStatement":ye=this.forStatementHandler(R);break;case"WhileStatement":ye=this.whileStatementHandler(R);break;case"DoWhileStatement":ye=this.doWhileStatementHandler(R);break;case"ForInStatement":ye=this.forInStatementHandler(R);break;case"WithStatement":ye=this.withStatementHandler(R);break;case"ThrowStatement":ye=this.throwStatementHandler(R);break;case"TryStatement":ye=this.tryStatementHandler(R);break;case"ContinueStatement":ye=this.continueStatementHandler(R);break;case"BreakStatement":ye=this.breakStatementHandler(R);break;case"SwitchStatement":ye=this.switchStatementHandler(R);break;case"LabeledStatement":ye=this.labeledStatementHandler(R);break;case"DebuggerStatement":ye=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(ya.NodeTypeSyntaxError,R.type,R)}return function(){var lt=ce.options.timeout;if(lt&&lt>0&&ce.checkTimeout())throw ce.createInternalThrowError(ya.ExecutionTimeOutError,lt,null);return ce.lastExecNode=R,ye.apply(void 0,arguments)}},T.binaryExpressionHandler=function(R){var ce=this,ye=this.createClosure(R.left),lt=this.createClosure(R.right);return function(){var Vt=ye(),Mt=lt();switch(R.operator){case"==":return Vt==Mt;case"!=":return Vt!=Mt;case"===":return Vt===Mt;case"!==":return Vt!==Mt;case"<":return Vt<Mt;case"<=":return Vt<=Mt;case">":return Vt>Mt;case">=":return Vt>=Mt;case"<<":return Vt<<Mt;case">>":return Vt>>Mt;case">>>":return Vt>>>Mt;case"+":return Vt+Mt;case"-":return Vt-Mt;case"*":return Vt*Mt;case"**":return Math.pow(Vt,Mt);case"/":return Vt/Mt;case"%":return Vt%Mt;case"|":return Vt|Mt;case"^":return Vt^Mt;case"&":return Vt&Mt;case"in":return Vt in Mt;case"instanceof":return Vt instanceof Mt;default:throw ce.createInternalThrowError(ya.BinaryOperatorSyntaxError,R.operator,R)}}},T.logicalExpressionHandler=function(R){var ce=this,ye=this.createClosure(R.left),lt=this.createClosure(R.right);return function(){switch(R.operator){case"||":return ye()||lt();case"&&":return ye()&&lt();default:throw ce.createInternalThrowError(ya.LogicalOperatorSyntaxError,R.operator,R)}}},T.unaryExpressionHandler=function(R){var ce=this;switch(R.operator){case"delete":var ye=this.createObjectGetter(R.argument),lt=this.createNameGetter(R.argument);return function(){var Hr=ye(),qn=lt();return delete Hr[qn]};default:var Vt;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var Mt=this.createObjectGetter(R.argument),Ir=this.createNameGetter(R.argument);Vt=function(){return Mt()[Ir()]}}else Vt=this.createClosure(R.argument);return function(){var Hr=Vt();switch(R.operator){case"-":return-Hr;case"+":return+Hr;case"!":return!Hr;case"~":return~Hr;case"void":return;case"typeof":return typeof Hr;default:throw ce.createInternalThrowError(ya.UnaryOperatorSyntaxError,R.operator,R)}}}},T.updateExpressionHandler=function(R){var ce=this,ye=this.createObjectGetter(R.argument),lt=this.createNameGetter(R.argument);return function(){var Vt=ye(),Mt=lt();switch(ce.assertVariable(Vt,Mt,R),R.operator){case"++":return R.prefix?++Vt[Mt]:Vt[Mt]++;case"--":return R.prefix?--Vt[Mt]:Vt[Mt]--;default:throw ce.createInternalThrowError(ya.UpdateOperatorSyntaxError,R.operator,R)}}},T.objectExpressionHandler=function(R){var ce=this,ye=[];function lt(Mt){return Mt.type==="Identifier"?Mt.name:Mt.type==="Literal"?Mt.value:this.throwError(ya.ObjectStructureSyntaxError,Mt.type,Mt)}var Vt=Object.create(null);return R.properties.forEach(function(Mt){var Ir=Mt.kind,Hr=lt(Mt.key);(!Vt[Hr]||Ir==="init")&&(Vt[Hr]={}),Vt[Hr][Ir]=ce.createClosure(Mt.value),ye.push({key:Hr,property:Mt})}),function(){for(var Mt={},Ir=ye.length,Hr=0;Hr<Ir;Hr++){var qn=ye[Hr],bi=qn.key,di=Vt[bi],ca=di.init?di.init():void 0,Wi=di.get?di.get():function(){},ka=di.set?di.set():function(Cu){};if("set"in di||"get"in di){var Xi={configurable:!0,enumerable:!0,get:Wi,set:ka};Object.defineProperty(Mt,bi,Xi)}else{var Yi=qn.property,Js=Yi.kind;Yi.key.type==="Identifier"&&Yi.value.type==="FunctionExpression"&&Js==="init"&&!Yi.value.id&&Fe(ca,Yi.key.name),Mt[bi]=ca}}return Mt}},T.arrayExpressionHandler=function(R){var ce=this,ye=R.elements.map(function(lt){return lt&&ce.createClosure(lt)});return function(){for(var lt=ye.length,Vt=Array(lt),Mt=0;Mt<lt;Mt++){var Ir=ye[Mt];Ir&&(Vt[Mt]=Ir())}return Vt}},T.safeObjectGet=function(R,ce,ye){return R[ce]},T.createCallFunctionGetter=function(R){var ce=this;switch(R.type){case"MemberExpression":var ye=this.createClosure(R.object),lt=this.createMemberKeyGetter(R),Vt=this.source;return function(){var Ir=ye(),Hr=lt(),qn=ce.safeObjectGet(Ir,Hr,R);if(!qn||!$s(qn)){var bi=Vt.slice(R.start,R.end);throw ce.createInternalThrowError(ya.FunctionUndefinedReferenceError,bi,R)}return qn.__IS_EVAL_FUNC?function(di){return qn(new ja(ce),di,!0)}:qn.__IS_FUNCTION_FUNC?function(){for(var di=arguments.length,ca=new Array(di),Wi=0;Wi<di;Wi++)ca[Wi]=arguments[Wi];return qn.apply(void 0,[new ja(ce)].concat(ca))}:qn.bind(Ir)};default:var Mt=this.createClosure(R);return function(){var Ir="";R.type==="Identifier"&&(Ir=R.name);var Hr=Mt();if(!Hr||!$s(Hr))throw ce.createInternalThrowError(ya.FunctionUndefinedReferenceError,Ir,R);if(R.type==="Identifier"&&Hr.__IS_EVAL_FUNC&&Ir==="eval")return function(di){var ca=ce.getScopeFromName(Ir,ce.getCurrentScope()),Wi=ca.name===mo||ca.name===es||ca.name===oo;return Hr(new ja(ce),di,!Wi)};if(Hr.__IS_EVAL_FUNC)return function(di){return Hr(new ja(ce),di,!0)};if(Hr.__IS_FUNCTION_FUNC)return function(){for(var di=arguments.length,ca=new Array(di),Wi=0;Wi<di;Wi++)ca[Wi]=arguments[Wi];return Hr.apply(void 0,[new ja(ce)].concat(ca))};var qn=ce.options.globalContextInFunction;if(R.type==="Identifier"){var bi=ce.getIdentifierScope(R);bi.name===Za&&(qn=bi.data)}return Hr.bind(qn)}}},T.callExpressionHandler=function(R){var ce=this,ye=this.createCallFunctionGetter(R.callee),lt=R.arguments.map(function(Vt){return ce.createClosure(Vt)});return function(){return ye().apply(void 0,lt.map(function(Vt){return Vt()}))}},T.functionExpressionHandler=function(R){var ce=this,ye=this,lt=this.source,Vt=this.collectDeclVars,Mt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Ir=R.id?R.id.name:"",Hr=R.params.length,qn=R.params.map(function(Wi){return ce.createParamNameGetter(Wi)}),bi=this.createClosure(R.body),di=this.collectDeclVars,ca=this.collectDeclFuncs;return this.collectDeclVars=Vt,this.collectDeclFuncs=Mt,function(){var Wi=ye.getCurrentScope(),ka=function Xi(){for(var Yi=arguments.length,Js=new Array(Yi),Cu=0;Cu<Yi;Cu++)Js[Cu]=arguments[Cu];ye.callStack.push(""+Ir);var xl=ye.getCurrentScope(),wu=Bs(Wi,"FunctionScope("+Ir+")");ye.setCurrentScope(wu),ye.addDeclarationsToScope(di,ca,wu),Ir&&(wu.data[Ir]=Xi),wu.data.arguments=arguments,qn.forEach(function(ms,Ts){wu.data[ms()]=Js[Ts]});var ds=ye.getCurrentContext();ye.setCurrentContext(this);var vs=bi();if(ye.setCurrentContext(ds),ye.setCurrentScope(xl),ye.callStack.pop(),vs instanceof zo)return vs.value};return Fe(ka,Ir),Object.defineProperty(ka,"length",{value:Hr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(ka,"toString",{value:function(){return lt.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(ka,"valueOf",{value:function(){return lt.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),ka}},T.newExpressionHandler=function(R){var ce=this,ye=this.source,lt=this.createClosure(R.callee),Vt=R.arguments.map(function(Mt){return ce.createClosure(Mt)});return function(){var Mt=lt();if(!$s(Mt)||Mt.__IS_EVAL_FUNC){var Ir=R.callee,Hr=ye.slice(Ir.start,Ir.end);throw ce.createInternalThrowError(ya.IsNotConstructor,Hr,R)}return Mt.__IS_FUNCTION_FUNC?Mt.apply(void 0,[new ja(ce)].concat(Vt.map(function(qn){return qn()}))):Da(Mt,Vt.map(function(qn){return qn()}))}},T.memberExpressionHandler=function(R){var ce=this.createClosure(R.object),ye=this.createMemberKeyGetter(R);return function(){var lt=ce(),Vt=ye();return lt[Vt]}},T.thisExpressionHandler=function(R){var ce=this;return function(){return ce.getCurrentContext()}},T.sequenceExpressionHandler=function(R){var ce=this,ye=R.expressions.map(function(lt){return ce.createClosure(lt)});return function(){for(var lt,Vt=ye.length,Mt=0;Mt<Vt;Mt++){var Ir=ye[Mt];lt=Ir()}return lt}},T.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},T.identifierHandler=function(R){var ce=this;return function(){var ye=ce.getCurrentScope(),lt=ce.getScopeDataFromName(R.name,ye);return ce.assertVariable(lt,R.name,R),lt[R.name]}},T.getIdentifierScope=function(R){var ce=this.getCurrentScope(),ye=this.getScopeFromName(R.name,ce);return ye},T.assignmentExpressionHandler=function(R){var ce=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var ye=this.createObjectGetter(R.left),lt=this.createNameGetter(R.left),Vt=this.createClosure(R.right);return function(){var Mt=ye(),Ir=lt(),Hr=Vt();switch(R.operator!=="="&&ce.assertVariable(Mt,Ir,R),R.operator){case"=":return Mt[Ir]=Hr;case"+=":return Mt[Ir]+=Hr;case"-=":return Mt[Ir]-=Hr;case"*=":return Mt[Ir]*=Hr;case"**=":return Mt[Ir]=Math.pow(Mt[Ir],Hr);case"/=":return Mt[Ir]/=Hr;case"%=":return Mt[Ir]%=Hr;case"<<=":return Mt[Ir]<<=Hr;case">>=":return Mt[Ir]>>=Hr;case">>>=":return Mt[Ir]>>>=Hr;case"&=":return Mt[Ir]&=Hr;case"^=":return Mt[Ir]^=Hr;case"|=":return Mt[Ir]|=Hr;default:throw ce.createInternalThrowError(ya.AssignmentExpressionSyntaxError,R.type,R)}}},T.functionDeclarationHandler=function(R){if(R.id){var ce=this.functionExpressionHandler(R);Object.defineProperty(ce,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,ce)}return function(){return Ci}},T.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(ya.VariableTypeSyntaxError,R.type,R)},T.variableDeclarationHandler=function(R){for(var ce=this,ye,lt=[],Vt=0;Vt<R.declarations.length;Vt++){var Mt=R.declarations[Vt];this.varDeclaration(this.getVariableName(Mt.id)),Mt.init&&lt.push({type:"AssignmentExpression",operator:"=",left:Mt.id,right:Mt.init})}return lt.length&&(ye=this.createClosure({type:"BlockStatement",body:lt})),function(){if(ye){var Ir=ce.isVarDeclMode;ce.isVarDeclMode=!0,ye(),ce.isVarDeclMode=Ir}return Ci}},T.assertVariable=function(R,ce,ye){if(R===this.globalScope.data&&!(ce in R))throw this.createInternalThrowError(ya.VariableUndefinedReferenceError,ce,ye)},T.programHandler=function(R){var ce=this,ye=R.body.map(function(lt){return ce.createClosure(lt)});return function(){for(var lt=Ci,Vt=0;Vt<ye.length;Vt++){var Mt=ye[Vt],Ir=ce.setValue(Mt());if(Ir!==Ci&&(lt=Ir,lt instanceof zo||lt instanceof so||lt instanceof oi||lt===Jt||lt===Yr))break}return lt}},T.expressionStatementHandler=function(R){return this.createClosure(R.expression)},T.emptyStatementHandler=function(R){return function(){return Ci}},T.returnStatementHandler=function(R){var ce=R.argument?this.createClosure(R.argument):rs;return function(){return new zo(ce())}},T.ifStatementHandler=function(R){var ce=this.createClosure(R.test),ye=this.createClosure(R.consequent),lt=R.alternate?this.createClosure(R.alternate):function(){return Ci};return function(){return ce()?ye():lt()}},T.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},T.forStatementHandler=function(R){var ce=this,ye=rs,lt=R.test?this.createClosure(R.test):function(){return!0},Vt=rs,Mt=this.createClosure(R.body);return R.type==="ForStatement"&&(ye=R.init?this.createClosure(R.init):ye,Vt=R.update?this.createClosure(R.update):rs),function(Ir){var Hr,qn=Ci,bi=R.type==="DoWhileStatement";for(Ir&&Ir.type==="LabeledStatement"&&(Hr=Ir.label.name),ye();bi||lt();Vt()){bi=!1;var di=ce.setValue(Mt());if(!(di===Ci||di===Yr)){if(di===Jt)break;if(qn=di,qn instanceof oi&&qn.value===Hr){qn=Ci;continue}if(qn instanceof zo||qn instanceof so||qn instanceof oi)break}}return qn}},T.whileStatementHandler=function(R){return this.forStatementHandler(R)},T.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},T.forInStatementHandler=function(R){var ce=this,ye=R.left,lt=this.createClosure(R.right),Vt=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),ye=R.left.declarations[0].id),function(Mt){var Ir,Hr=Ci,qn;Mt&&Mt.type==="LabeledStatement"&&(Ir=Mt.label.name);var bi=lt();for(qn in bi){ce.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:ye,right:{type:"Literal",value:qn}})();var di=ce.setValue(Vt());if(!(di===Ci||di===Yr)){if(di===Jt)break;if(Hr=di,Hr instanceof oi&&Hr.value===Ir){Hr=Ci;continue}if(Hr instanceof zo||Hr instanceof so||Hr instanceof oi)break}}return Hr}},T.withStatementHandler=function(R){var ce=this,ye=this.createClosure(R.object),lt=this.createClosure(R.body);return function(){var Vt=ye(),Mt=ce.getCurrentScope(),Ir=new ys(Vt,Mt,Za);ce.setCurrentScope(Ir);var Hr=ce.setValue(lt());return ce.setCurrentScope(Mt),Hr}},T.throwStatementHandler=function(R){var ce=this,ye=this.createClosure(R.argument);return function(){throw ce.setValue(void 0),ye()}},T.tryStatementHandler=function(R){var ce=this,ye=this.createClosure(R.block),lt=R.handler?this.catchClauseHandler(R.handler):null,Vt=R.finalizer?this.createClosure(R.finalizer):null;return function(){var Mt=ce.getCurrentScope(),Ir=ce.getCurrentContext(),Hr=Mt.labelStack.concat([]),qn=ce.callStack.concat([]),bi=Ci,di,ca,Wi=function(){ce.setCurrentScope(Mt),ce.setCurrentContext(Ir),Mt.labelStack=Hr,ce.callStack=qn};try{bi=ce.setValue(ye()),bi instanceof zo&&(di=bi)}catch(ka){if(Wi(),ce.isInterruptThrow(ka))throw ka;if(lt)try{bi=ce.setValue(lt(ka)),bi instanceof zo&&(di=bi)}catch(Xi){if(Wi(),ce.isInterruptThrow(Xi))throw Xi;ca=Xi}}if(Vt)try{bi=Vt(),bi instanceof zo&&(di=bi)}catch(ka){if(Wi(),ce.isInterruptThrow(ka))throw ka;ca=ka}if(ca)throw ca;return di||bi}},T.catchClauseHandler=function(R){var ce=this,ye=this.createParamNameGetter(R.param),lt=this.createClosure(R.body);return function(Vt){var Mt,Ir=ce.getCurrentScope(),Hr=Ir.data,qn=ye(),bi=pt.call(Hr,qn),di=Hr[qn];return Hr[qn]=Vt,Mt=lt(),bi?Hr[qn]=di:delete Hr[qn],Mt}},T.continueStatementHandler=function(R){return function(){return R.label?new oi(R.label.name):Yr}},T.breakStatementHandler=function(R){return function(){return R.label?new so(R.label.name):Jt}},T.switchStatementHandler=function(R){var ce=this,ye=this.createClosure(R.discriminant),lt=R.cases.map(function(Vt){return ce.switchCaseHandler(Vt)});return function(){for(var Vt=ye(),Mt=!1,Ir,Hr,qn,bi=0;bi<lt.length;bi++){var di=lt[bi](),ca=di.testClosure();if(ca===Qn){qn=di;continue}if(Mt||ca===Vt){if(Mt=!0,Hr=ce.setValue(di.bodyClosure()),Hr===Ci)continue;if(Hr===Jt||(Ir=Hr,Ir instanceof zo||Ir instanceof so||Ir instanceof oi||Ir===Yr))break}}if(!Mt&&qn){Hr=ce.setValue(qn.bodyClosure());var Wi=Hr===Ci||Hr===Jt||Hr===Yr;Wi||(Ir=Hr)}return Ir}},T.switchCaseHandler=function(R){var ce=R.test?this.createClosure(R.test):function(){return Qn},ye=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:ce,bodyClosure:ye}}},T.labeledStatementHandler=function(R){var ce=this,ye=R.label.name,lt=this.createClosure(R.body);return function(){var Vt,Mt=ce.getCurrentScope();return Mt.labelStack.push(ye),Vt=lt(R),Vt instanceof so&&Vt.value===ye&&(Vt=Ci),Mt.labelStack.pop(),Vt}},T.debuggerStatementHandler=function(R){return function(){debugger;return Ci}},T.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(ya.ParamTypeSyntaxError,R.type,R)},T.createObjectKeyGetter=function(R){var ce;return R.type==="Identifier"?ce=function(){return R.name}:ce=this.createClosure(R),function(){return ce()}},T.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},T.createObjectGetter=function(R){var ce=this;switch(R.type){case"Identifier":return function(){return ce.getScopeDataFromName(R.name,ce.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(ya.AssignmentTypeSyntaxError,R.type,R)}},T.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(ya.AssignmentTypeSyntaxError,R.type,R)}},T.varDeclaration=function(R){var ce=this.collectDeclVars;ce[R]=void 0},T.funcDeclaration=function(R,ce){var ye=this.collectDeclFuncs;ye[R]=ce},T.addDeclarationsToScope=function(R,ce,ye){var lt=ye.data;for(var Vt in ce){var Mt=ce[Vt];lt[Vt]=Mt&&Mt()}for(var Ir in R)Ir in lt||(lt[Ir]=void 0)},T.getScopeValue=function(R,ce){var ye=this.getScopeFromName(R,ce);return ye.data[R]},T.getScopeDataFromName=function(R,ce){return this.getScopeFromName(R,ce).data},T.getScopeFromName=function(R,ce){var ye=ce;do if(R in ye.data)return ye;while(ye=ye.parent);return this.globalScope},T.setValue=function(R){var ce=this.callStack.length;return this.isVarDeclMode||ce||R===Ci||R===Jt||R===Yr||R instanceof so||R instanceof oi||(this.value=R instanceof zo?R.value:R),R},T.getValue=function(){return this.value},m}();uo.version=xe,uo.eval=Fu,uo.Function=ts,uo.ecmaVersion=5,uo.globalContextInFunction=void 0,uo.global=Object.create(null);function yl(m){return m===void 0&&(m=Object.create(null)),m}function _l(m,T,H){T===void 0&&(T=[]),H===void 0&&(H={});var R=H.parsingContext,ce=H.timeout===void 0?0:H.timeout,ye=`
    (function anonymous(`+T.join(",")+`){
         `+m+`
    });
    `,lt=new uo(R,{ecmaVersion:H.ecmaVersion,timeout:ce,rootContext:H.rootContext,globalContextInFunction:H.globalContextInFunction});return lt.evaluate(ye)}function Bu(m,T,H){var R=new uo(T,H);return R.evaluate(m)}var Vl=Bu,Eu=function(){function m(H){this._code=H}var T=m.prototype;return T.runInContext=function(R){return Bu(this._code,R)},T.runInNewContext=function(R){return Bu(this._code,R)},m}(),lo=function(m,T,H){return Bu(m,T,H)};function js(){for(var m=arguments.length,T=new Array(m),H=0;H<m;H++)T[H]=arguments[H];var R=T.pop();return _l(R||"",T)}var ws=lo},88307:function(qe,D,y){(function(j,b){qe.exports=b(y(18857))})(this,function(j){"use strict";var b=function(W){return W instanceof Uint8Array||W instanceof Uint16Array||W instanceof Uint32Array||W instanceof Int8Array||W instanceof Int16Array||W instanceof Int32Array||W instanceof Float32Array||W instanceof Float64Array||W instanceof Uint8ClampedArray},p=function(W,Oe){for(var et=Object.keys(Oe),ur=0;ur<et.length;++ur)W[et[ur]]=Oe[et[ur]];return W},E=`
`;function Z(W){return typeof atob!="undefined"?atob(W):"base64:"+W}function V(W){var Oe=new Error("(regl) "+W);throw console.error(Oe),Oe}function G(W,Oe){W||V(Oe)}function I(W){return W?": "+W:""}function L(W,Oe,et){W in Oe||V("unknown parameter ("+W+")"+I(et)+". possible values: "+Object.keys(Oe).join())}function _e(W,Oe){b(W)||V("invalid parameter type"+I(Oe)+". must be a typed array")}function be(W,Oe){switch(Oe){case"number":return typeof W=="number";case"object":return typeof W=="object";case"string":return typeof W=="string";case"boolean":return typeof W=="boolean";case"function":return typeof W=="function";case"undefined":return typeof W=="undefined";case"symbol":return typeof W=="symbol"}}function Le(W,Oe,et){be(W,Oe)||V("invalid parameter type"+I(et)+". expected "+Oe+", got "+typeof W)}function Je(W,Oe){W>=0&&(W|0)===W||V("invalid parameter type, ("+W+")"+I(Oe)+". must be a nonnegative integer")}function Dt(W,Oe,et){Oe.indexOf(W)<0&&V("invalid value"+I(et)+". must be one of: "+Oe)}var It=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Ut(W){Object.keys(W).forEach(function(Oe){It.indexOf(Oe)<0&&V('invalid regl constructor argument "'+Oe+'". must be one of '+It)})}function xt(W,Oe){for(W=W+"";W.length<Oe;)W=" "+W;return W}function bt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function ct(W,Oe){this.number=W,this.line=Oe,this.errors=[]}function ir(W,Oe,et){this.file=W,this.line=Oe,this.message=et}function re(){var W=new Error,Oe=(W.stack||W).toString(),et=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Oe);if(et)return et[1];var ur=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Oe);return ur?ur[1]:"unknown"}function cr(){var W=new Error,Oe=(W.stack||W).toString(),et=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Oe);if(et)return et[1];var ur=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Oe);return ur?ur[1]:"unknown"}function Ct(W,Oe){var et=W.split(`
`),ur=1,Dr=0,ar={unknown:new bt,0:new bt};ar.unknown.name=ar[0].name=Oe||re(),ar.unknown.lines.push(new ct(0,""));for(var Ar=0;Ar<et.length;++Ar){var jr=et[Ar],Wr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(jr);if(Wr)switch(Wr[1]){case"line":var Jr=/(\d+)(\s+\d+)?/.exec(Wr[2]);Jr&&(ur=Jr[1]|0,Jr[2]&&(Dr=Jr[2]|0,Dr in ar||(ar[Dr]=new bt)));break;case"define":var Qr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Wr[2]);Qr&&(ar[Dr].name=Qr[1]?Z(Qr[2]):Qr[2]);break}ar[Dr].lines.push(new ct(ur++,jr))}return Object.keys(ar).forEach(function(rn){var yn=ar[rn];yn.lines.forEach(function(Xr){yn.index[Xr.number]=Xr})}),ar}function Qe(W){var Oe=[];return W.split(`
`).forEach(function(et){if(!(et.length<5)){var ur=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(et);ur?Oe.push(new ir(ur[1]|0,ur[2]|0,ur[3].trim())):et.length>0&&Oe.push(new ir("unknown",0,et))}}),Oe}function Tt(W,Oe){Oe.forEach(function(et){var ur=W[et.file];if(ur){var Dr=ur.index[et.line];if(Dr){Dr.errors.push(et),ur.hasErrors=!0;return}}W.unknown.hasErrors=!0,W.unknown.lines[0].errors.push(et)})}function je(W,Oe,et,ur,Dr){if(!W.getShaderParameter(Oe,W.COMPILE_STATUS)){var ar=W.getShaderInfoLog(Oe),Ar=ur===W.FRAGMENT_SHADER?"fragment":"vertex";ge(et,"string",Ar+" shader source must be a string",Dr);var jr=Ct(et,Dr),Wr=Qe(ar);Tt(jr,Wr),Object.keys(jr).forEach(function(Jr){var Qr=jr[Jr];if(!Qr.hasErrors)return;var rn=[""],yn=[""];function Xr(en,Nt){rn.push(en),yn.push(Nt||"")}Xr("file number "+Jr+": "+Qr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Qr.lines.forEach(function(en){if(en.errors.length>0){Xr(xt(en.number,4)+"|  ","background-color:yellow; font-weight:bold"),Xr(en.line+E,"color:red; background-color:yellow; font-weight:bold");var Nt=0;en.errors.forEach(function(_r){var Kr=_r.message,Ln=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Kr);if(Ln){var Or=Ln[1];switch(Kr=Ln[2],Or){case"assign":Or="=";break}Nt=Math.max(en.line.indexOf(Or,Nt),0)}else Nt=0;Xr(xt("| ",6)),Xr(xt("^^^",Nt+3)+E,"font-weight:bold"),Xr(xt("| ",6)),Xr(Kr+E,"font-weight:bold")}),Xr(xt("| ",6)+E)}else Xr(xt(en.number,4)+"|  "),Xr(en.line+E,"color:red")}),typeof document!="undefined"&&!window.chrome?(yn[0]=rn.join("%c"),console.log.apply(console,yn)):console.log(rn.join(""))}),G.raise("Error compiling "+Ar+" shader, "+jr[0].name)}}function Pt(W,Oe,et,ur,Dr){if(!W.getProgramParameter(Oe,W.LINK_STATUS)){var ar=W.getProgramInfoLog(Oe),Ar=Ct(et,Dr),jr=Ct(ur,Dr),Wr='Error linking program with vertex shader, "'+jr[0].name+'", and fragment shader "'+Ar[0].name+'"';typeof document!="undefined"?console.log("%c"+Wr+E+"%c"+ar,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Wr+E+ar),G.raise(Wr)}}function fr(W){W._commandRef=re()}function $t(W,Oe,et,ur){fr(W);function Dr(Wr){return Wr?ur.id(Wr):0}W._fragId=Dr(W.static.frag),W._vertId=Dr(W.static.vert);function ar(Wr,Jr){Object.keys(Jr).forEach(function(Qr){Wr[ur.id(Qr)]=!0})}var Ar=W._uniformSet={};ar(Ar,Oe.static),ar(Ar,Oe.dynamic);var jr=W._attributeSet={};ar(jr,et.static),ar(jr,et.dynamic),W._hasCount="count"in W.static||"count"in W.dynamic||"elements"in W.static||"elements"in W.dynamic}function zr(W,Oe){var et=cr();V(W+" in command "+(Oe||re())+(et==="unknown"?"":" called from "+et))}function fe(W,Oe,et){W||zr(Oe,et||re())}function ke(W,Oe,et,ur){W in Oe||zr("unknown parameter ("+W+")"+I(et)+". possible values: "+Object.keys(Oe).join(),ur||re())}function ge(W,Oe,et,ur){be(W,Oe)||zr("invalid parameter type"+I(et)+". expected "+Oe+", got "+typeof W,ur||re())}function _t(W){W()}function vt(W,Oe,et){W.texture?Dt(W.texture._texture.internalformat,Oe,"unsupported texture format for attachment"):Dt(W.renderbuffer._renderbuffer.format,et,"unsupported renderbuffer format for attachment")}var jt=33071,Bt=9728,Nr=9984,pn=9985,mn=9986,Ni=9987,or=5120,ve=5121,Me=5122,Ge=5123,Re=5124,kt=5125,rr=5126,yr=32819,Pr=32820,sr=33635,Rr=34042,w=36193,X={};X[or]=X[ve]=1,X[Me]=X[Ge]=X[w]=X[sr]=X[yr]=X[Pr]=2,X[Re]=X[kt]=X[rr]=X[Rr]=4;function Ue(W,Oe){return W===Pr||W===yr||W===sr?2:W===Rr?4:X[W]*Oe}function Ve(W){return!(W&W-1)&&!!W}function ot(W,Oe,et){var ur,Dr=Oe.width,ar=Oe.height,Ar=Oe.channels;G(Dr>0&&Dr<=et.maxTextureSize&&ar>0&&ar<=et.maxTextureSize,"invalid texture shape"),(W.wrapS!==jt||W.wrapT!==jt)&&G(Ve(Dr)&&Ve(ar),"incompatible wrap mode for texture, both width and height must be power of 2"),Oe.mipmask===1?Dr!==1&&ar!==1&&G(W.minFilter!==Nr&&W.minFilter!==mn&&W.minFilter!==pn&&W.minFilter!==Ni,"min filter requires mipmap"):(G(Ve(Dr)&&Ve(ar),"texture must be a square power of 2 to support mipmapping"),G(Oe.mipmask===(Dr<<1)-1,"missing or incomplete mipmap data")),Oe.type===rr&&(et.extensions.indexOf("oes_texture_float_linear")<0&&G(W.minFilter===Bt&&W.magFilter===Bt,"filter not supported, must enable oes_texture_float_linear"),G(!W.genMipmaps,"mipmap generation not supported with float textures"));var jr=Oe.images;for(ur=0;ur<16;++ur)if(jr[ur]){var Wr=Dr>>ur,Jr=ar>>ur;G(Oe.mipmask&1<<ur,"missing mipmap data");var Qr=jr[ur];if(G(Qr.width===Wr&&Qr.height===Jr,"invalid shape for mip images"),G(Qr.format===Oe.format&&Qr.internalformat===Oe.internalformat&&Qr.type===Oe.type,"incompatible type for mip image"),!Qr.compressed)if(Qr.data){var rn=Math.ceil(Ue(Qr.type,Ar)*Wr/Qr.unpackAlignment)*Qr.unpackAlignment;G(Qr.data.byteLength===rn*Jr,"invalid data for image, buffer size is inconsistent with image format")}else Qr.element||Qr.copy}else W.genMipmaps||G((Oe.mipmask&1<<ur)==0,"extra mipmap data");Oe.compressed&&G(!W.genMipmaps,"mipmap generation for compressed images not supported")}function At(W,Oe,et,ur){var Dr=W.width,ar=W.height,Ar=W.channels;G(Dr>0&&Dr<=ur.maxTextureSize&&ar>0&&ar<=ur.maxTextureSize,"invalid texture shape"),G(Dr===ar,"cube map must be square"),G(Oe.wrapS===jt&&Oe.wrapT===jt,"wrap mode not supported by cube map");for(var jr=0;jr<et.length;++jr){var Wr=et[jr];G(Wr.width===Dr&&Wr.height===ar,"inconsistent cube map face shape"),Oe.genMipmaps&&(G(!Wr.compressed,"can not generate mipmap for compressed textures"),G(Wr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Jr=Wr.images,Qr=0;Qr<16;++Qr){var rn=Jr[Qr];if(rn){var yn=Dr>>Qr,Xr=ar>>Qr;G(Wr.mipmask&1<<Qr,"missing mipmap data"),G(rn.width===yn&&rn.height===Xr,"invalid shape for mip images"),G(rn.format===W.format&&rn.internalformat===W.internalformat&&rn.type===W.type,"incompatible type for mip image"),rn.compressed||(rn.data?G(rn.data.byteLength===yn*Xr*Math.max(Ue(rn.type,Ar),rn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):rn.element||rn.copy)}}}}var Q=p(G,{optional:_t,raise:V,commandRaise:zr,command:fe,parameter:L,commandParameter:ke,constructor:Ut,type:Le,commandType:ge,isTypedArray:_e,nni:Je,oneOf:Dt,shaderError:je,linkError:Pt,callSite:cr,saveCommandRef:fr,saveDrawInfo:$t,framebufferFormat:vt,guessCommand:re,texture2D:ot,textureCube:At}),Rt=0,dr=0,Cr=5,Xe=6;function rt(W,Oe){this.id=Rt++,this.type=W,this.data=Oe}function wt(W){return W.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Ot(W){if(W.length===0)return[];var Oe=W.charAt(0),et=W.charAt(W.length-1);if(W.length>1&&Oe===et&&(Oe==='"'||Oe==="'"))return['"'+wt(W.substr(1,W.length-2))+'"'];var ur=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(W);if(ur)return Ot(W.substr(0,ur.index)).concat(Ot(ur[1])).concat(Ot(W.substr(ur.index+ur[0].length)));var Dr=W.split(".");if(Dr.length===1)return['"'+wt(W)+'"'];for(var ar=[],Ar=0;Ar<Dr.length;++Ar)ar=ar.concat(Ot(Dr[Ar]));return ar}function gr(W){return"["+Ot(W).join("][")+"]"}function br(W,Oe){return new rt(W,gr(Oe+""))}function Xt(W){return typeof W=="function"&&!W._reglType||W instanceof rt}function kr(W,Oe){if(typeof W=="function")return new rt(dr,W);if(typeof W=="number"||typeof W=="boolean")return new rt(Cr,W);if(Array.isArray(W))return new rt(Xe,W.map(function(et,ur){return kr(et,Oe+"["+ur+"]")}));if(W instanceof rt)return W;Q(!1,"invalid option type in uniform "+Oe)}var Mr={DynamicVariable:rt,define:br,isDynamic:Xt,unbox:kr,accessor:gr},un={next:typeof requestAnimationFrame=="function"?function(W){return requestAnimationFrame(W)}:function(W){return setTimeout(W,16)},cancel:typeof cancelAnimationFrame=="function"?function(W){return cancelAnimationFrame(W)}:clearTimeout},an=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Kn=an?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ti(){var W={"":0},Oe=[""];return{id:function(et){var ur=W[et];return ur||(ur=W[et]=Oe.length,Oe.push(et),ur)},str:function(et){return Oe[et]}}}function Qi(W,Oe,et){var ur=document.createElement("canvas");p(ur.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),W.appendChild(ur),W===document.body&&(ur.style.position="absolute",p(W.style,{margin:0,padding:0}));function Dr(){var jr=window.innerWidth,Wr=window.innerHeight;if(W!==document.body){var Jr=ur.getBoundingClientRect();jr=Jr.right-Jr.left,Wr=Jr.bottom-Jr.top}ur.width=et*jr,ur.height=et*Wr}var ar;W!==document.body&&typeof ResizeObserver=="function"?(ar=new ResizeObserver(function(){setTimeout(Dr)}),ar.observe(W)):window.addEventListener("resize",Dr,!1);function Ar(){ar?ar.disconnect():window.removeEventListener("resize",Dr),W.removeChild(ur)}return Dr(),{canvas:ur,onDestroy:Ar}}function Ai(W,Oe){function et(ur){try{return W.getContext(ur,Oe)}catch(Dr){return null}}return et("webgl")||et("experimental-webgl")||et("webgl-experimental")}function Pi(W){return typeof W.nodeName=="string"&&typeof W.appendChild=="function"&&typeof W.getBoundingClientRect=="function"}function q(W){return typeof W.drawArrays=="function"||typeof W.drawElements=="function"}function le(W){return typeof W=="string"?W.split():(Q(Array.isArray(W),"invalid extension array"),W)}function pe(W){return typeof W=="string"?(Q(typeof document!="undefined","not supported outside of DOM"),document.querySelector(W)):W}function U(W){var Oe=W||{},et,ur,Dr,ar,Ar={},jr=[],Wr=[],Jr=typeof window=="undefined"?1:window.devicePixelRatio,Qr=!1,rn=function(en){en&&Q.raise(en)},yn=function(){};if(typeof Oe=="string"?(Q(typeof document!="undefined","selector queries only supported in DOM environments"),et=document.querySelector(Oe),Q(et,"invalid query string for element")):typeof Oe=="object"?Pi(Oe)?et=Oe:q(Oe)?(ar=Oe,Dr=ar.canvas):(Q.constructor(Oe),"gl"in Oe?ar=Oe.gl:"canvas"in Oe?Dr=pe(Oe.canvas):"container"in Oe&&(ur=pe(Oe.container)),"attributes"in Oe&&(Ar=Oe.attributes,Q.type(Ar,"object","invalid context attributes")),"extensions"in Oe&&(jr=le(Oe.extensions)),"optionalExtensions"in Oe&&(Wr=le(Oe.optionalExtensions)),"onDone"in Oe&&(Q.type(Oe.onDone,"function","invalid or missing onDone callback"),rn=Oe.onDone),"profile"in Oe&&(Qr=!!Oe.profile),"pixelRatio"in Oe&&(Jr=+Oe.pixelRatio,Q(Jr>0,"invalid pixel ratio"))):Q.raise("invalid arguments to regl"),et&&(et.nodeName.toLowerCase()==="canvas"?Dr=et:ur=et),!ar){if(!Dr){Q(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Xr=Qi(ur||document.body,rn,Jr);if(!Xr)return null;Dr=Xr.canvas,yn=Xr.onDestroy}Ar.premultipliedAlpha===void 0&&(Ar.premultipliedAlpha=!0),ar=Ai(Dr,Ar)}return ar?{gl:ar,canvas:Dr,container:ur,extensions:jr,optionalExtensions:Wr,pixelRatio:Jr,profile:Qr,onDone:rn,onDestroy:yn}:(yn(),rn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ae(W,Oe){var et={};function ur(jr){Q.type(jr,"string","extension name must be string");var Wr=jr.toLowerCase(),Jr;try{Jr=et[Wr]=Dr(jr)}catch(Qr){}return!!Jr}function Dr(jr){return W.getExtension(jr)?W.getExtension(jr):W.getExtension(jr.toLowerCase())?W.getExtension(jr.toLowerCase()):null}for(var ar=0;ar<Oe.extensions.length;++ar){var Ar=Oe.extensions[ar];if(!ur(Ar))return Oe.onDestroy(),Oe.onDone('"'+Ar+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Oe.optionalExtensions.forEach(ur),{extensions:et,restore:function(){Object.keys(et).forEach(function(jr){if(et[jr]&&!ur(jr))throw new Error("(regl): error restoring extension "+jr)})}}}function de(W,Oe){for(var et=Array(W),ur=0;ur<W;++ur)et[ur]=Oe(ur);return et}var Pe=5120,ue=5121,Ee=5122,mt=5123,wr=5124,Yt=5125,tr=5126;function Ur(W){for(var Oe=16;Oe<=1<<28;Oe*=16)if(W<=Oe)return Oe;return 0}function Fn(W){var Oe,et;return Oe=(W>65535)<<4,W>>>=Oe,et=(W>255)<<3,W>>>=et,Oe|=et,et=(W>15)<<2,W>>>=et,Oe|=et,et=(W>3)<<1,W>>>=et,Oe|=et,Oe|W>>1}function Rn(){var W=de(8,function(){return[]});function Oe(ar){var Ar=Ur(ar),jr=W[Fn(Ar)>>2];return jr.length>0?jr.pop():new ArrayBuffer(Ar)}function et(ar){W[Fn(ar.byteLength)>>2].push(ar)}function ur(ar,Ar){var jr=null;switch(ar){case Pe:jr=new Int8Array(Oe(Ar),0,Ar);break;case ue:jr=new Uint8Array(Oe(Ar),0,Ar);break;case Ee:jr=new Int16Array(Oe(2*Ar),0,Ar);break;case mt:jr=new Uint16Array(Oe(2*Ar),0,Ar);break;case wr:jr=new Int32Array(Oe(4*Ar),0,Ar);break;case Yt:jr=new Uint32Array(Oe(4*Ar),0,Ar);break;case tr:jr=new Float32Array(Oe(4*Ar),0,Ar);break;default:return null}return jr.length!==Ar?jr.subarray(0,Ar):jr}function Dr(ar){et(ar.buffer)}return{alloc:Oe,free:et,allocType:ur,freeType:Dr}}var qt=Rn();qt.zero=Rn();var Tn=3408,ln=3410,on=3411,Li=3412,bn=3413,Ii=3414,ea=3415,ci=33901,qi=33902,zi=3379,Mi=3386,la=34921,Bi=36347,ai=36348,ki=35661,wi=35660,ro=34930,po=36349,ia=34076,Gi=34024,Zs=7936,nu=7937,Aa=7938,No=35724,Hi=34047,Wa=36063,ao=34852,ga=3553,Lo=34067,Fa=34069,Cs=33984,Fi=6408,Ko=5126,ya=5121,vo=36160,Da=36053,So=36064,xe=16384,Fe=function(W,Oe){var et=1;Oe.ext_texture_filter_anisotropic&&(et=W.getParameter(Hi));var ur=1,Dr=1;Oe.webgl_draw_buffers&&(ur=W.getParameter(ao),Dr=W.getParameter(Wa));var ar=!!Oe.oes_texture_float;if(ar){var Ar=W.createTexture();W.bindTexture(ga,Ar),W.texImage2D(ga,0,Fi,1,1,0,Fi,Ko,null);var jr=W.createFramebuffer();if(W.bindFramebuffer(vo,jr),W.framebufferTexture2D(vo,So,ga,Ar,0),W.bindTexture(ga,null),W.checkFramebufferStatus(vo)!==Da)ar=!1;else{W.viewport(0,0,1,1),W.clearColor(1,0,0,1),W.clear(xe);var Wr=qt.allocType(Ko,4);W.readPixels(0,0,1,1,Fi,Ko,Wr),W.getError()?ar=!1:(W.deleteFramebuffer(jr),W.deleteTexture(Ar),ar=Wr[0]===1),qt.freeType(Wr)}}var Jr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Qr=!0;if(!Jr){var rn=W.createTexture(),yn=qt.allocType(ya,36);W.activeTexture(Cs),W.bindTexture(Lo,rn),W.texImage2D(Fa,0,Fi,3,3,0,Fi,ya,yn),qt.freeType(yn),W.bindTexture(Lo,null),W.deleteTexture(rn),Qr=!W.getError()}return{colorBits:[W.getParameter(ln),W.getParameter(on),W.getParameter(Li),W.getParameter(bn)],depthBits:W.getParameter(Ii),stencilBits:W.getParameter(ea),subpixelBits:W.getParameter(Tn),extensions:Object.keys(Oe).filter(function(Xr){return!!Oe[Xr]}),maxAnisotropic:et,maxDrawbuffers:ur,maxColorAttachments:Dr,pointSizeDims:W.getParameter(ci),lineWidthDims:W.getParameter(qi),maxViewportDims:W.getParameter(Mi),maxCombinedTextureUnits:W.getParameter(ki),maxCubeMapSize:W.getParameter(ia),maxRenderbufferSize:W.getParameter(Gi),maxTextureUnits:W.getParameter(ro),maxTextureSize:W.getParameter(zi),maxAttributes:W.getParameter(la),maxVertexUniforms:W.getParameter(Bi),maxVertexTextureUnits:W.getParameter(wi),maxVaryingVectors:W.getParameter(ai),maxFragmentUniforms:W.getParameter(po),glsl:W.getParameter(No),renderer:W.getParameter(nu),vendor:W.getParameter(Zs),version:W.getParameter(Aa),readFloat:ar,npotTextureCube:Qr}};function pt(W){return!!W&&typeof W=="object"&&Array.isArray(W.shape)&&Array.isArray(W.stride)&&typeof W.offset=="number"&&W.shape.length===W.stride.length&&(Array.isArray(W.data)||b(W.data))}var Jt=function(W){return Object.keys(W).map(function(Oe){return W[Oe]})},Yr={shape:es,flatten:oo};function Qn(W,Oe,et){for(var ur=0;ur<Oe;++ur)et[ur]=W[ur]}function Ci(W,Oe,et,ur){for(var Dr=0,ar=0;ar<Oe;++ar)for(var Ar=W[ar],jr=0;jr<et;++jr)ur[Dr++]=Ar[jr]}function Za(W,Oe,et,ur,Dr,ar){for(var Ar=ar,jr=0;jr<Oe;++jr)for(var Wr=W[jr],Jr=0;Jr<et;++Jr)for(var Qr=Wr[Jr],rn=0;rn<ur;++rn)Dr[Ar++]=Qr[rn]}function mo(W,Oe,et,ur,Dr){for(var ar=1,Ar=et+1;Ar<Oe.length;++Ar)ar*=Oe[Ar];var jr=Oe[et];if(Oe.length-et==4){var Wr=Oe[et+1],Jr=Oe[et+2],Qr=Oe[et+3];for(Ar=0;Ar<jr;++Ar)Za(W[Ar],Wr,Jr,Qr,ur,Dr),Dr+=ar}else for(Ar=0;Ar<jr;++Ar)mo(W[Ar],Oe,et+1,ur,Dr),Dr+=ar}function oo(W,Oe,et,ur){var Dr=1;if(Oe.length)for(var ar=0;ar<Oe.length;++ar)Dr*=Oe[ar];else Dr=0;var Ar=ur||qt.allocType(et,Dr);switch(Oe.length){case 0:break;case 1:Qn(W,Oe[0],Ar);break;case 2:Ci(W,Oe[0],Oe[1],Ar);break;case 3:Za(W,Oe[0],Oe[1],Oe[2],Ar,0);break;default:mo(W,Oe,0,Ar,0)}return Ar}function es(W){for(var Oe=[],et=W;et.length;et=et[0])Oe.push(et.length);return Oe}var $s={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ja=5120,Fu=5122,ts=5124,zo=5121,so=5123,oi=5125,ys=5126,rs=5126,Bs={int8:ja,int16:Fu,int32:ts,uint8:zo,uint16:so,uint32:oi,float:ys,float32:rs},ns=35048,Pa=35040,uo={dynamic:ns,stream:Pa,static:35044},yl=Yr.flatten,_l=Yr.shape,Bu=35044,Vl=35040,Eu=5121,lo=5126,js=[];js[5120]=1,js[5122]=2,js[5124]=4,js[5121]=1,js[5123]=2,js[5125]=4,js[5126]=4;function ws(W){return $s[Object.prototype.toString.call(W)]|0}function m(W,Oe){for(var et=0;et<Oe.length;++et)W[et]=Oe[et]}function T(W,Oe,et,ur,Dr,ar,Ar){for(var jr=0,Wr=0;Wr<et;++Wr)for(var Jr=0;Jr<ur;++Jr)W[jr++]=Oe[Dr*Wr+ar*Jr+Ar]}function H(W,Oe,et,ur){var Dr=0,ar={};function Ar(Nt){this.id=Dr++,this.buffer=W.createBuffer(),this.type=Nt,this.usage=Bu,this.byteLength=0,this.dimension=1,this.dtype=Eu,this.persistentData=null,et.profile&&(this.stats={size:0})}Ar.prototype.bind=function(){W.bindBuffer(this.type,this.buffer)},Ar.prototype.destroy=function(){yn(this)};var jr=[];function Wr(Nt,_r){var Kr=jr.pop();return Kr||(Kr=new Ar(Nt)),Kr.bind(),rn(Kr,_r,Vl,0,1,!1),Kr}function Jr(Nt){jr.push(Nt)}function Qr(Nt,_r,Kr){Nt.byteLength=_r.byteLength,W.bufferData(Nt.type,_r,Kr)}function rn(Nt,_r,Kr,Ln,Or,Sn){var tn;if(Nt.usage=Kr,Array.isArray(_r)){if(Nt.dtype=Ln||lo,_r.length>0){var li;if(Array.isArray(_r[0])){tn=_l(_r);for(var Lr=1,Tr=1;Tr<tn.length;++Tr)Lr*=tn[Tr];Nt.dimension=Lr,li=yl(_r,tn,Nt.dtype),Qr(Nt,li,Kr),Sn?Nt.persistentData=li:qt.freeType(li)}else if(typeof _r[0]=="number"){Nt.dimension=Or;var Xn=qt.allocType(Nt.dtype,_r.length);m(Xn,_r),Qr(Nt,Xn,Kr),Sn?Nt.persistentData=Xn:qt.freeType(Xn)}else b(_r[0])?(Nt.dimension=_r[0].length,Nt.dtype=Ln||ws(_r[0])||lo,li=yl(_r,[_r.length,_r[0].length],Nt.dtype),Qr(Nt,li,Kr),Sn?Nt.persistentData=li:qt.freeType(li)):Q.raise("invalid buffer data")}}else if(b(_r))Nt.dtype=Ln||ws(_r),Nt.dimension=Or,Qr(Nt,_r,Kr),Sn&&(Nt.persistentData=new Uint8Array(new Uint8Array(_r.buffer)));else if(pt(_r)){tn=_r.shape;var _n=_r.stride,$r=_r.offset,An=0,En=0,ji=0,Ri=0;tn.length===1?(An=tn[0],En=1,ji=_n[0],Ri=0):tn.length===2?(An=tn[0],En=tn[1],ji=_n[0],Ri=_n[1]):Q.raise("invalid shape"),Nt.dtype=Ln||ws(_r.data)||lo,Nt.dimension=En;var Pn=qt.allocType(Nt.dtype,An*En);T(Pn,_r.data,An,En,ji,Ri,$r),Qr(Nt,Pn,Kr),Sn?Nt.persistentData=Pn:qt.freeType(Pn)}else _r instanceof ArrayBuffer?(Nt.dtype=Eu,Nt.dimension=Or,Qr(Nt,_r,Kr),Sn&&(Nt.persistentData=new Uint8Array(new Uint8Array(_r)))):Q.raise("invalid buffer data")}function yn(Nt){Oe.bufferCount--,ur(Nt);var _r=Nt.buffer;Q(_r,"buffer must not be deleted already"),W.deleteBuffer(_r),Nt.buffer=null,delete ar[Nt.id]}function Xr(Nt,_r,Kr,Ln){Oe.bufferCount++;var Or=new Ar(_r);ar[Or.id]=Or;function Sn(Lr){var Tr=Bu,Xn=null,_n=0,$r=0,An=1;return Array.isArray(Lr)||b(Lr)||pt(Lr)||Lr instanceof ArrayBuffer?Xn=Lr:typeof Lr=="number"?_n=Lr|0:Lr&&(Q.type(Lr,"object","buffer arguments must be an object, a number or an array"),"data"in Lr&&(Q(Xn===null||Array.isArray(Xn)||b(Xn)||pt(Xn),"invalid data for buffer"),Xn=Lr.data),"usage"in Lr&&(Q.parameter(Lr.usage,uo,"invalid buffer usage"),Tr=uo[Lr.usage]),"type"in Lr&&(Q.parameter(Lr.type,Bs,"invalid buffer type"),$r=Bs[Lr.type]),"dimension"in Lr&&(Q.type(Lr.dimension,"number","invalid dimension"),An=Lr.dimension|0),"length"in Lr&&(Q.nni(_n,"buffer length must be a nonnegative integer"),_n=Lr.length|0)),Or.bind(),Xn?rn(Or,Xn,Tr,$r,An,Ln):(_n&&W.bufferData(Or.type,_n,Tr),Or.dtype=$r||Eu,Or.usage=Tr,Or.dimension=An,Or.byteLength=_n),et.profile&&(Or.stats.size=Or.byteLength*js[Or.dtype]),Sn}function tn(Lr,Tr){Q(Tr+Lr.byteLength<=Or.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Lr.byteLength+" starting from offset "+Tr+" to a buffer of size "+Or.byteLength),W.bufferSubData(Or.type,Tr,Lr)}function li(Lr,Tr){var Xn=(Tr||0)|0,_n;if(Or.bind(),b(Lr)||Lr instanceof ArrayBuffer)tn(Lr,Xn);else if(Array.isArray(Lr)){if(Lr.length>0)if(typeof Lr[0]=="number"){var $r=qt.allocType(Or.dtype,Lr.length);m($r,Lr),tn($r,Xn),qt.freeType($r)}else if(Array.isArray(Lr[0])||b(Lr[0])){_n=_l(Lr);var An=yl(Lr,_n,Or.dtype);tn(An,Xn),qt.freeType(An)}else Q.raise("invalid buffer data")}else if(pt(Lr)){_n=Lr.shape;var En=Lr.stride,ji=0,Ri=0,Pn=0,Cn=0;_n.length===1?(ji=_n[0],Ri=1,Pn=En[0],Cn=0):_n.length===2?(ji=_n[0],Ri=_n[1],Pn=En[0],Cn=En[1]):Q.raise("invalid shape");var Ei=Array.isArray(Lr.data)?Or.dtype:ws(Lr.data),Di=qt.allocType(Ei,ji*Ri);T(Di,Lr.data,ji,Ri,Pn,Cn,Lr.offset),tn(Di,Xn),qt.freeType(Di)}else Q.raise("invalid data for buffer subdata");return Sn}return Kr||Sn(Nt),Sn._reglType="buffer",Sn._buffer=Or,Sn.subdata=li,et.profile&&(Sn.stats=Or.stats),Sn.destroy=function(){yn(Or)},Sn}function en(){Jt(ar).forEach(function(Nt){Nt.buffer=W.createBuffer(),W.bindBuffer(Nt.type,Nt.buffer),W.bufferData(Nt.type,Nt.persistentData||Nt.byteLength,Nt.usage)})}return et.profile&&(Oe.getTotalBufferSize=function(){var Nt=0;return Object.keys(ar).forEach(function(_r){Nt+=ar[_r].stats.size}),Nt}),{create:Xr,createStream:Wr,destroyStream:Jr,clear:function(){Jt(ar).forEach(yn),jr.forEach(yn)},getBuffer:function(Nt){return Nt&&Nt._buffer instanceof Ar?Nt._buffer:null},restore:en,_initBuffer:rn}}var R=0,ce=0,ye=1,lt=1,Vt=4,Mt=4,Ir={points:R,point:ce,lines:ye,line:lt,triangles:Vt,triangle:Mt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Hr=0,qn=1,bi=4,di=5120,ca=5121,Wi=5122,ka=5123,Xi=5124,Yi=5125,Js=34963,Cu=35040,xl=35044;function wu(W,Oe,et,ur){var Dr={},ar=0,Ar={uint8:ca,uint16:ka};Oe.oes_element_index_uint&&(Ar.uint32=Yi);function jr(en){this.id=ar++,Dr[this.id]=this,this.buffer=en,this.primType=bi,this.vertCount=0,this.type=0}jr.prototype.bind=function(){this.buffer.bind()};var Wr=[];function Jr(en){var Nt=Wr.pop();return Nt||(Nt=new jr(et.create(null,Js,!0,!1)._buffer)),rn(Nt,en,Cu,-1,-1,0,0),Nt}function Qr(en){Wr.push(en)}function rn(en,Nt,_r,Kr,Ln,Or,Sn){en.buffer.bind();var tn;if(Nt){var li=Sn;!Sn&&(!b(Nt)||pt(Nt)&&!b(Nt.data))&&(li=Oe.oes_element_index_uint?Yi:ka),et._initBuffer(en.buffer,Nt,_r,li,3)}else W.bufferData(Js,Or,_r),en.buffer.dtype=tn||ca,en.buffer.usage=_r,en.buffer.dimension=3,en.buffer.byteLength=Or;if(tn=Sn,!Sn){switch(en.buffer.dtype){case ca:case di:tn=ca;break;case ka:case Wi:tn=ka;break;case Yi:case Xi:tn=Yi;break;default:Q.raise("unsupported type for element array")}en.buffer.dtype=tn}en.type=tn,Q(tn!==Yi||!!Oe.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Lr=Ln;Lr<0&&(Lr=en.buffer.byteLength,tn===ka?Lr>>=1:tn===Yi&&(Lr>>=2)),en.vertCount=Lr;var Tr=Kr;if(Kr<0){Tr=bi;var Xn=en.buffer.dimension;Xn===1&&(Tr=Hr),Xn===2&&(Tr=qn),Xn===3&&(Tr=bi)}en.primType=Tr}function yn(en){ur.elementsCount--,Q(en.buffer!==null,"must not double destroy elements"),delete Dr[en.id],en.buffer.destroy(),en.buffer=null}function Xr(en,Nt){var _r=et.create(null,Js,!0),Kr=new jr(_r._buffer);ur.elementsCount++;function Ln(Or){if(!Or)_r(),Kr.primType=bi,Kr.vertCount=0,Kr.type=ca;else if(typeof Or=="number")_r(Or),Kr.primType=bi,Kr.vertCount=Or|0,Kr.type=ca;else{var Sn=null,tn=xl,li=-1,Lr=-1,Tr=0,Xn=0;Array.isArray(Or)||b(Or)||pt(Or)?Sn=Or:(Q.type(Or,"object","invalid arguments for elements"),"data"in Or&&(Sn=Or.data,Q(Array.isArray(Sn)||b(Sn)||pt(Sn),"invalid data for element buffer")),"usage"in Or&&(Q.parameter(Or.usage,uo,"invalid element buffer usage"),tn=uo[Or.usage]),"primitive"in Or&&(Q.parameter(Or.primitive,Ir,"invalid element buffer primitive"),li=Ir[Or.primitive]),"count"in Or&&(Q(typeof Or.count=="number"&&Or.count>=0,"invalid vertex count for elements"),Lr=Or.count|0),"type"in Or&&(Q.parameter(Or.type,Ar,"invalid buffer type"),Xn=Ar[Or.type]),"length"in Or?Tr=Or.length|0:(Tr=Lr,Xn===ka||Xn===Wi?Tr*=2:(Xn===Yi||Xn===Xi)&&(Tr*=4))),rn(Kr,Sn,tn,li,Lr,Tr,Xn)}return Ln}return Ln(en),Ln._reglType="elements",Ln._elements=Kr,Ln.subdata=function(Or,Sn){return _r.subdata(Or,Sn),Ln},Ln.destroy=function(){yn(Kr)},Ln}return{create:Xr,createStream:Jr,destroyStream:Qr,getElements:function(en){return typeof en=="function"&&en._elements instanceof jr?en._elements:null},clear:function(){Jt(Dr).forEach(yn)}}}var ds=new Float32Array(1),vs=new Uint32Array(ds.buffer),ms=5123;function Ts(W){for(var Oe=qt.allocType(ms,W.length),et=0;et<W.length;++et)if(isNaN(W[et]))Oe[et]=65535;else if(W[et]===Infinity)Oe[et]=31744;else if(W[et]===-Infinity)Oe[et]=64512;else{ds[0]=W[et];var ur=vs[0],Dr=ur>>>31<<15,ar=(ur<<1>>>24)-127,Ar=ur>>13&(1<<10)-1;if(ar<-24)Oe[et]=Dr;else if(ar<-14){var jr=-14-ar;Oe[et]=Dr+(Ar+(1<<10)>>jr)}else ar>15?Oe[et]=Dr+31744:Oe[et]=Dr+(ar+15<<10)+Ar}return Oe}function co(W){return Array.isArray(W)||b(W)}var Gl=function(W){return!(W&W-1)&&!!W},Hl=34467,is=3553,Wl=34067,As=34069,_s=6408,Xl=6406,Nu=6407,Ia=6409,zu=6410,Fc=32854,Tu=32855,Yl=36194,Bc=32819,rl=32820,nl=33635,bl=34042,il=6402,Sl=34041,al=35904,ol=35906,sl=36193,iu=33776,Qs=33777,gc=33778,yc=33779,Nc=35986,Uu=35987,El=34798,Kl=35840,_c=35841,$l=35842,Jl=35843,Au=36196,Pu=5121,Ql=5123,ql=5125,pu=5126,xc=10242,Cl=10243,bc=10497,Zu=33071,Va=33648,ul=10240,Xa=10241,ju=9728,Mu=9729,qs=9984,aa=9985,Ba=9986,Ps=9987,ec=33170,du=4352,tc=4353,nf=4354,af=34046,ll=3317,wl=37440,Iu=37441,Ro=37443,Tl=37444,Vs=33984,Eo=[qs,Ba,aa,Ps],Nn=[0,Ia,zu,Nu,_s],fo={};fo[Ia]=fo[Xl]=fo[il]=1,fo[Sl]=fo[zu]=2,fo[Nu]=fo[al]=3,fo[_s]=fo[ol]=4;function vu(W){return"[object "+W+"]"}var cl=vu("HTMLCanvasElement"),eu=vu("OffscreenCanvas"),Ms=vu("CanvasRenderingContext2D"),Sc=vu("ImageBitmap"),gn=vu("HTMLImageElement"),rc=vu("HTMLVideoElement"),nc=Object.keys($s).concat([cl,eu,Ms,Sc,gn,rc]),Ou=[];Ou[Pu]=1,Ou[pu]=4,Ou[sl]=2,Ou[Ql]=2,Ou[ql]=4;var Ua=[];Ua[Fc]=2,Ua[Tu]=2,Ua[Yl]=2,Ua[Sl]=4,Ua[iu]=.5,Ua[Qs]=.5,Ua[gc]=1,Ua[yc]=1,Ua[Nc]=.5,Ua[Uu]=1,Ua[El]=1,Ua[Kl]=.5,Ua[_c]=.25,Ua[$l]=.5,Ua[Jl]=.25,Ua[Au]=.5;function Is(W){return Array.isArray(W)&&(W.length===0||typeof W[0]=="number")}function ic(W){if(!Array.isArray(W))return!1;var Oe=W.length;return!(Oe===0||!co(W[0]))}function mu(W){return Object.prototype.toString.call(W)}function Os(W){return mu(W)===cl}function gu(W){return mu(W)===eu}function zc(W){return mu(W)===Ms}function Al(W){return mu(W)===Sc}function Ec(W){return mu(W)===gn}function Cc(W){return mu(W)===rc}function Gs(W){var Oe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(Oe&&W&&W.getContext)}function Ls(W){if(!W)return!1;if(Gs(W))return!0;var Oe=mu(W);return nc.indexOf(Oe)>=0?!0:Is(W)||ic(W)||pt(W)}function ta(W){return $s[Object.prototype.toString.call(W)]|0}function yu(W,Oe){var et=Oe.length;switch(W.type){case Pu:case Ql:case ql:case pu:var ur=qt.allocType(W.type,et);ur.set(Oe),W.data=ur;break;case sl:W.data=Ts(Oe);break;default:Q.raise("unsupported texture type, must specify a typed array")}}function Hs(W,Oe){return qt.allocType(W.type===sl?pu:W.type,Oe)}function Uo(W,Oe){W.type===sl?(W.data=Ts(Oe),qt.freeType(Oe)):W.data=Oe}function Vu(W,Oe,et,ur,Dr,ar){for(var Ar=W.width,jr=W.height,Wr=W.channels,Jr=Ar*jr*Wr,Qr=Hs(W,Jr),rn=0,yn=0;yn<jr;++yn)for(var Xr=0;Xr<Ar;++Xr)for(var en=0;en<Wr;++en)Qr[rn++]=Oe[et*Xr+ur*yn+Dr*en+ar];Uo(W,Qr)}function au(W,Oe,et,ur,Dr,ar){var Ar;if(typeof Ua[W]!="undefined"?Ar=Ua[W]:Ar=fo[W]*Ou[Oe],ar&&(Ar*=6),Dr){for(var jr=0,Wr=et;Wr>=1;)jr+=Ar*Wr*Wr,Wr/=2;return jr}else return Ar*et*ur}function ou(W,Oe,et,ur,Dr,ar,Ar){var jr={"don't care":du,"dont care":du,nice:nf,fast:tc},Wr={repeat:bc,clamp:Zu,mirror:Va},Jr={nearest:ju,linear:Mu},Qr=p({mipmap:Ps,"nearest mipmap nearest":qs,"linear mipmap nearest":aa,"nearest mipmap linear":Ba,"linear mipmap linear":Ps},Jr),rn={none:0,browser:Tl},yn={uint8:Pu,rgba4:Bc,rgb565:nl,"rgb5 a1":rl},Xr={alpha:Xl,luminance:Ia,"luminance alpha":zu,rgb:Nu,rgba:_s,rgba4:Fc,"rgb5 a1":Tu,rgb565:Yl},en={};Oe.ext_srgb&&(Xr.srgb=al,Xr.srgba=ol),Oe.oes_texture_float&&(yn.float32=yn.float=pu),Oe.oes_texture_half_float&&(yn.float16=yn["half float"]=sl),Oe.webgl_depth_texture&&(p(Xr,{depth:il,"depth stencil":Sl}),p(yn,{uint16:Ql,uint32:ql,"depth stencil":bl})),Oe.webgl_compressed_texture_s3tc&&p(en,{"rgb s3tc dxt1":iu,"rgba s3tc dxt1":Qs,"rgba s3tc dxt3":gc,"rgba s3tc dxt5":yc}),Oe.webgl_compressed_texture_atc&&p(en,{"rgb atc":Nc,"rgba atc explicit alpha":Uu,"rgba atc interpolated alpha":El}),Oe.webgl_compressed_texture_pvrtc&&p(en,{"rgb pvrtc 4bppv1":Kl,"rgb pvrtc 2bppv1":_c,"rgba pvrtc 4bppv1":$l,"rgba pvrtc 2bppv1":Jl}),Oe.webgl_compressed_texture_etc1&&(en["rgb etc1"]=Au);var Nt=Array.prototype.slice.call(W.getParameter(Hl)||new Uint32Array(0));Object.keys(en).forEach(function(He){var nr=en[He];Nt.indexOf(nr)>=0&&(Xr[He]=nr)});var _r=Object.keys(Xr);et.textureFormats=_r;var Kr=[];Object.keys(Xr).forEach(function(He){var nr=Xr[He];Kr[nr]=He});var Ln=[];Object.keys(yn).forEach(function(He){var nr=yn[He];Ln[nr]=He});var Or=[];Object.keys(Jr).forEach(function(He){var nr=Jr[He];Or[nr]=He});var Sn=[];Object.keys(Qr).forEach(function(He){var nr=Qr[He];Sn[nr]=He});var tn=[];Object.keys(Wr).forEach(function(He){var nr=Wr[He];tn[nr]=He});var li=_r.reduce(function(He,nr){var er=Xr[nr];return er===Ia||er===Xl||er===Ia||er===zu||er===il||er===Sl||Oe.ext_srgb&&(er===al||er===ol)?He[er]=er:er===Tu||nr.indexOf("rgba")>=0?He[er]=_s:He[er]=Nu,He},{});function Lr(){this.internalformat=_s,this.format=_s,this.type=Pu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Tl,this.width=0,this.height=0,this.channels=0}function Tr(He,nr){He.internalformat=nr.internalformat,He.format=nr.format,He.type=nr.type,He.compressed=nr.compressed,He.premultiplyAlpha=nr.premultiplyAlpha,He.flipY=nr.flipY,He.unpackAlignment=nr.unpackAlignment,He.colorSpace=nr.colorSpace,He.width=nr.width,He.height=nr.height,He.channels=nr.channels}function Xn(He,nr){if(!(typeof nr!="object"||!nr)){if("premultiplyAlpha"in nr&&(Q.type(nr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),He.premultiplyAlpha=nr.premultiplyAlpha),"flipY"in nr&&(Q.type(nr.flipY,"boolean","invalid texture flip"),He.flipY=nr.flipY),"alignment"in nr&&(Q.oneOf(nr.alignment,[1,2,4,8],"invalid texture unpack alignment"),He.unpackAlignment=nr.alignment),"colorSpace"in nr&&(Q.parameter(nr.colorSpace,rn,"invalid colorSpace"),He.colorSpace=rn[nr.colorSpace]),"type"in nr){var er=nr.type;Q(Oe.oes_texture_float||!(er==="float"||er==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),Q(Oe.oes_texture_half_float||!(er==="half float"||er==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),Q(Oe.webgl_depth_texture||!(er==="uint16"||er==="uint32"||er==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Q.parameter(er,yn,"invalid texture type"),He.type=yn[er]}var Un=He.width,ua=He.height,Be=He.channels,we=!1;"shape"in nr?(Q(Array.isArray(nr.shape)&&nr.shape.length>=2,"shape must be an array"),Un=nr.shape[0],ua=nr.shape[1],nr.shape.length===3&&(Be=nr.shape[2],Q(Be>0&&Be<=4,"invalid number of channels"),we=!0),Q(Un>=0&&Un<=et.maxTextureSize,"invalid width"),Q(ua>=0&&ua<=et.maxTextureSize,"invalid height")):("radius"in nr&&(Un=ua=nr.radius,Q(Un>=0&&Un<=et.maxTextureSize,"invalid radius")),"width"in nr&&(Un=nr.width,Q(Un>=0&&Un<=et.maxTextureSize,"invalid width")),"height"in nr&&(ua=nr.height,Q(ua>=0&&ua<=et.maxTextureSize,"invalid height")),"channels"in nr&&(Be=nr.channels,Q(Be>0&&Be<=4,"invalid number of channels"),we=!0)),He.width=Un|0,He.height=ua|0,He.channels=Be|0;var ut=!1;if("format"in nr){var zt=nr.format;Q(Oe.webgl_depth_texture||!(zt==="depth"||zt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Q.parameter(zt,Xr,"invalid texture format");var lr=He.internalformat=Xr[zt];He.format=li[lr],zt in yn&&("type"in nr||(He.type=yn[zt])),zt in en&&(He.compressed=!0),ut=!0}!we&&ut?He.channels=fo[He.format]:we&&!ut?He.channels!==Nn[He.format]&&(He.format=He.internalformat=Nn[He.channels]):ut&&we&&Q(He.channels===fo[He.format],"number of channels inconsistent with specified format")}}function _n(He){W.pixelStorei(wl,He.flipY),W.pixelStorei(Iu,He.premultiplyAlpha),W.pixelStorei(Ro,He.colorSpace),W.pixelStorei(ll,He.unpackAlignment)}function $r(){Lr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function An(He,nr){var er=null;if(Ls(nr)?er=nr:nr&&(Q.type(nr,"object","invalid pixel data type"),Xn(He,nr),"x"in nr&&(He.xOffset=nr.x|0),"y"in nr&&(He.yOffset=nr.y|0),Ls(nr.data)&&(er=nr.data)),Q(!He.compressed||er instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),nr.copy){Q(!er,"can not specify copy and data field for the same texture");var Un=Dr.viewportWidth,ua=Dr.viewportHeight;He.width=He.width||Un-He.xOffset,He.height=He.height||ua-He.yOffset,He.needsCopy=!0,Q(He.xOffset>=0&&He.xOffset<Un&&He.yOffset>=0&&He.yOffset<ua&&He.width>0&&He.width<=Un&&He.height>0&&He.height<=ua,"copy texture read out of bounds")}else if(!er)He.width=He.width||1,He.height=He.height||1,He.channels=He.channels||4;else if(b(er))He.channels=He.channels||4,He.data=er,!("type"in nr)&&He.type===Pu&&(He.type=ta(er));else if(Is(er))He.channels=He.channels||4,yu(He,er),He.alignment=1,He.needsFree=!0;else if(pt(er)){var Be=er.data;!Array.isArray(Be)&&He.type===Pu&&(He.type=ta(Be));var we=er.shape,ut=er.stride,zt,lr,yt,dt,it,De;we.length===3?(yt=we[2],De=ut[2]):(Q(we.length===2,"invalid ndarray pixel data, must be 2 or 3D"),yt=1,De=1),zt=we[0],lr=we[1],dt=ut[0],it=ut[1],He.alignment=1,He.width=zt,He.height=lr,He.channels=yt,He.format=He.internalformat=Nn[yt],He.needsFree=!0,Vu(He,Be,dt,it,De,er.offset)}else if(Gs(er)||Os(er)||gu(er)||zc(er))Gs(er)||Os(er)||gu(er)?He.element=er:He.element=er.canvas,He.width=He.element.width,He.height=He.element.height,He.channels=4;else if(Al(er))He.element=er,He.width=er.width,He.height=er.height,He.channels=4;else if(Ec(er))He.element=er,He.width=er.naturalWidth,He.height=er.naturalHeight,He.channels=4;else if(Cc(er))He.element=er,He.width=er.videoWidth,He.height=er.videoHeight,He.channels=4;else if(ic(er)){var tt=He.width||er[0].length,Ne=He.height||er.length,Zt=He.channels;co(er[0][0])?Zt=Zt||er[0][0].length:Zt=Zt||1;for(var Kt=Yr.shape(er),Vr=1,cn=0;cn<Kt.length;++cn)Vr*=Kt[cn];var dn=Hs(He,Vr);Yr.flatten(er,Kt,"",dn),Uo(He,dn),He.alignment=1,He.width=tt,He.height=Ne,He.channels=Zt,He.format=He.internalformat=Nn[Zt],He.needsFree=!0}He.type===pu?Q(et.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):He.type===sl&&Q(et.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function En(He,nr,er){var Un=He.element,ua=He.data,Be=He.internalformat,we=He.format,ut=He.type,zt=He.width,lr=He.height;_n(He),Un?W.texImage2D(nr,er,we,we,ut,Un):He.compressed?W.compressedTexImage2D(nr,er,Be,zt,lr,0,ua):He.needsCopy?(ur(),W.copyTexImage2D(nr,er,we,He.xOffset,He.yOffset,zt,lr,0)):W.texImage2D(nr,er,we,zt,lr,0,we,ut,ua||null)}function ji(He,nr,er,Un,ua){var Be=He.element,we=He.data,ut=He.internalformat,zt=He.format,lr=He.type,yt=He.width,dt=He.height;_n(He),Be?W.texSubImage2D(nr,ua,er,Un,zt,lr,Be):He.compressed?W.compressedTexSubImage2D(nr,ua,er,Un,ut,yt,dt,we):He.needsCopy?(ur(),W.copyTexSubImage2D(nr,ua,er,Un,He.xOffset,He.yOffset,yt,dt)):W.texSubImage2D(nr,ua,er,Un,yt,dt,zt,lr,we)}var Ri=[];function Pn(){return Ri.pop()||new $r}function Cn(He){He.needsFree&&qt.freeType(He.data),$r.call(He),Ri.push(He)}function Ei(){Lr.call(this),this.genMipmaps=!1,this.mipmapHint=du,this.mipmask=0,this.images=Array(16)}function Di(He,nr,er){var Un=He.images[0]=Pn();He.mipmask=1,Un.width=He.width=nr,Un.height=He.height=er,Un.channels=He.channels=4}function ra(He,nr){var er=null;if(Ls(nr))er=He.images[0]=Pn(),Tr(er,He),An(er,nr),He.mipmask=1;else if(Xn(He,nr),Array.isArray(nr.mipmap))for(var Un=nr.mipmap,ua=0;ua<Un.length;++ua)er=He.images[ua]=Pn(),Tr(er,He),er.width>>=ua,er.height>>=ua,An(er,Un[ua]),He.mipmask|=1<<ua;else er=He.images[0]=Pn(),Tr(er,He),An(er,nr),He.mipmask=1;Tr(He,He.images[0]),He.compressed&&(He.internalformat===iu||He.internalformat===Qs||He.internalformat===gc||He.internalformat===yc)&&Q(He.width%4==0&&He.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function yo(He,nr){for(var er=He.images,Un=0;Un<er.length;++Un){if(!er[Un])return;En(er[Un],nr,Un)}}var Fo=[];function da(){var He=Fo.pop()||new Ei;Lr.call(He),He.mipmask=0;for(var nr=0;nr<16;++nr)He.images[nr]=null;return He}function bs(He){for(var nr=He.images,er=0;er<nr.length;++er)nr[er]&&Cn(nr[er]),nr[er]=null;Fo.push(He)}function ho(){this.minFilter=ju,this.magFilter=ju,this.wrapS=Zu,this.wrapT=Zu,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=du}function $a(He,nr){if("min"in nr){var er=nr.min;Q.parameter(er,Qr),He.minFilter=Qr[er],Eo.indexOf(He.minFilter)>=0&&!("faces"in nr)&&(He.genMipmaps=!0)}if("mag"in nr){var Un=nr.mag;Q.parameter(Un,Jr),He.magFilter=Jr[Un]}var ua=He.wrapS,Be=He.wrapT;if("wrap"in nr){var we=nr.wrap;typeof we=="string"?(Q.parameter(we,Wr),ua=Be=Wr[we]):Array.isArray(we)&&(Q.parameter(we[0],Wr),Q.parameter(we[1],Wr),ua=Wr[we[0]],Be=Wr[we[1]])}else{if("wrapS"in nr){var ut=nr.wrapS;Q.parameter(ut,Wr),ua=Wr[ut]}if("wrapT"in nr){var zt=nr.wrapT;Q.parameter(zt,Wr),Be=Wr[zt]}}if(He.wrapS=ua,He.wrapT=Be,"anisotropic"in nr){var lr=nr.anisotropic;Q(typeof lr=="number"&&lr>=1&&lr<=et.maxAnisotropic,"aniso samples must be between 1 and "),He.anisotropic=nr.anisotropic}if("mipmap"in nr){var yt=!1;switch(typeof nr.mipmap){case"string":Q.parameter(nr.mipmap,jr,"invalid mipmap hint"),He.mipmapHint=jr[nr.mipmap],He.genMipmaps=!0,yt=!0;break;case"boolean":yt=He.genMipmaps=nr.mipmap;break;case"object":Q(Array.isArray(nr.mipmap),"invalid mipmap type"),He.genMipmaps=!1,yt=!0;break;default:Q.raise("invalid mipmap type")}yt&&!("min"in nr)&&(He.minFilter=qs)}}function Io(He,nr){W.texParameteri(nr,Xa,He.minFilter),W.texParameteri(nr,ul,He.magFilter),W.texParameteri(nr,xc,He.wrapS),W.texParameteri(nr,Cl,He.wrapT),Oe.ext_texture_filter_anisotropic&&W.texParameteri(nr,af,He.anisotropic),He.genMipmaps&&(W.hint(ec,He.mipmapHint),W.generateMipmap(nr))}var cs=0,fs={},Ss=et.maxTextureUnits,Go=Array(Ss).map(function(){return null});function $i(He){Lr.call(this),this.mipmask=0,this.internalformat=_s,this.id=cs++,this.refCount=1,this.target=He,this.texture=W.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ho,Ar.profile&&(this.stats={size:0})}function Jo(He){W.activeTexture(Vs),W.bindTexture(He.target,He.texture)}function Ma(){var He=Go[0];He?W.bindTexture(He.target,He.texture):W.bindTexture(is,null)}function _o(He){var nr=He.texture;Q(nr,"must not double destroy texture");var er=He.unit,Un=He.target;er>=0&&(W.activeTexture(Vs+er),W.bindTexture(Un,null),Go[er]=null),W.deleteTexture(nr),He.texture=null,He.params=null,He.pixels=null,He.refCount=0,delete fs[He.id],ar.textureCount--}p($i.prototype,{bind:function(){var He=this;He.bindCount+=1;var nr=He.unit;if(nr<0){for(var er=0;er<Ss;++er){var Un=Go[er];if(Un){if(Un.bindCount>0)continue;Un.unit=-1}Go[er]=He,nr=er;break}nr>=Ss&&Q.raise("insufficient number of texture units"),Ar.profile&&ar.maxTextureUnits<nr+1&&(ar.maxTextureUnits=nr+1),He.unit=nr,W.activeTexture(Vs+nr),W.bindTexture(He.target,He.texture)}return nr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&_o(this)}});function _i(He,nr){var er=new $i(is);fs[er.id]=er,ar.textureCount++;function Un(we,ut){var zt=er.texInfo;ho.call(zt);var lr=da();return typeof we=="number"?typeof ut=="number"?Di(lr,we|0,ut|0):Di(lr,we|0,we|0):we?(Q.type(we,"object","invalid arguments to regl.texture"),$a(zt,we),ra(lr,we)):Di(lr,1,1),zt.genMipmaps&&(lr.mipmask=(lr.width<<1)-1),er.mipmask=lr.mipmask,Tr(er,lr),Q.texture2D(zt,lr,et),er.internalformat=lr.internalformat,Un.width=lr.width,Un.height=lr.height,Jo(er),yo(lr,is),Io(zt,is),Ma(),bs(lr),Ar.profile&&(er.stats.size=au(er.internalformat,er.type,lr.width,lr.height,zt.genMipmaps,!1)),Un.format=Kr[er.internalformat],Un.type=Ln[er.type],Un.mag=Or[zt.magFilter],Un.min=Sn[zt.minFilter],Un.wrapS=tn[zt.wrapS],Un.wrapT=tn[zt.wrapT],Un}function ua(we,ut,zt,lr){Q(!!we,"must specify image data");var yt=ut|0,dt=zt|0,it=lr|0,De=Pn();return Tr(De,er),De.width=0,De.height=0,An(De,we),De.width=De.width||(er.width>>it)-yt,De.height=De.height||(er.height>>it)-dt,Q(er.type===De.type&&er.format===De.format&&er.internalformat===De.internalformat,"incompatible format for texture.subimage"),Q(yt>=0&&dt>=0&&yt+De.width<=er.width&&dt+De.height<=er.height,"texture.subimage write out of bounds"),Q(er.mipmask&1<<it,"missing mipmap data"),Q(De.data||De.element||De.needsCopy,"missing image data"),Jo(er),ji(De,is,yt,dt,it),Ma(),Cn(De),Un}function Be(we,ut){var zt=we|0,lr=ut|0||zt;if(zt===er.width&&lr===er.height)return Un;Un.width=er.width=zt,Un.height=er.height=lr,Jo(er);for(var yt=0;er.mipmask>>yt;++yt){var dt=zt>>yt,it=lr>>yt;if(!dt||!it)break;W.texImage2D(is,yt,er.format,dt,it,0,er.format,er.type,null)}return Ma(),Ar.profile&&(er.stats.size=au(er.internalformat,er.type,zt,lr,!1,!1)),Un}return Un(He,nr),Un.subimage=ua,Un.resize=Be,Un._reglType="texture2d",Un._texture=er,Ar.profile&&(Un.stats=er.stats),Un.destroy=function(){er.decRef()},Un}function pa(He,nr,er,Un,ua,Be){var we=new $i(Wl);fs[we.id]=we,ar.cubeCount++;var ut=new Array(6);function zt(dt,it,De,tt,Ne,Zt){var Kt,Vr=we.texInfo;for(ho.call(Vr),Kt=0;Kt<6;++Kt)ut[Kt]=da();if(typeof dt=="number"||!dt){var cn=dt|0||1;for(Kt=0;Kt<6;++Kt)Di(ut[Kt],cn,cn)}else if(typeof dt=="object")if(it)ra(ut[0],dt),ra(ut[1],it),ra(ut[2],De),ra(ut[3],tt),ra(ut[4],Ne),ra(ut[5],Zt);else if($a(Vr,dt),Xn(we,dt),"faces"in dt){var dn=dt.faces;for(Q(Array.isArray(dn)&&dn.length===6,"cube faces must be a length 6 array"),Kt=0;Kt<6;++Kt)Q(typeof dn[Kt]=="object"&&!!dn[Kt],"invalid input for cube map face"),Tr(ut[Kt],we),ra(ut[Kt],dn[Kt])}else for(Kt=0;Kt<6;++Kt)ra(ut[Kt],dt);else Q.raise("invalid arguments to cube map");for(Tr(we,ut[0]),Q.optional(function(){et.npotTextureCube||Q(Gl(we.width)&&Gl(we.height),"your browser does not support non power or two texture dimensions")}),Vr.genMipmaps?we.mipmask=(ut[0].width<<1)-1:we.mipmask=ut[0].mipmask,Q.textureCube(we,Vr,ut,et),we.internalformat=ut[0].internalformat,zt.width=ut[0].width,zt.height=ut[0].height,Jo(we),Kt=0;Kt<6;++Kt)yo(ut[Kt],As+Kt);for(Io(Vr,Wl),Ma(),Ar.profile&&(we.stats.size=au(we.internalformat,we.type,zt.width,zt.height,Vr.genMipmaps,!0)),zt.format=Kr[we.internalformat],zt.type=Ln[we.type],zt.mag=Or[Vr.magFilter],zt.min=Sn[Vr.minFilter],zt.wrapS=tn[Vr.wrapS],zt.wrapT=tn[Vr.wrapT],Kt=0;Kt<6;++Kt)bs(ut[Kt]);return zt}function lr(dt,it,De,tt,Ne){Q(!!it,"must specify image data"),Q(typeof dt=="number"&&dt===(dt|0)&&dt>=0&&dt<6,"invalid face");var Zt=De|0,Kt=tt|0,Vr=Ne|0,cn=Pn();return Tr(cn,we),cn.width=0,cn.height=0,An(cn,it),cn.width=cn.width||(we.width>>Vr)-Zt,cn.height=cn.height||(we.height>>Vr)-Kt,Q(we.type===cn.type&&we.format===cn.format&&we.internalformat===cn.internalformat,"incompatible format for texture.subimage"),Q(Zt>=0&&Kt>=0&&Zt+cn.width<=we.width&&Kt+cn.height<=we.height,"texture.subimage write out of bounds"),Q(we.mipmask&1<<Vr,"missing mipmap data"),Q(cn.data||cn.element||cn.needsCopy,"missing image data"),Jo(we),ji(cn,As+dt,Zt,Kt,Vr),Ma(),Cn(cn),zt}function yt(dt){var it=dt|0;if(it!==we.width){zt.width=we.width=it,zt.height=we.height=it,Jo(we);for(var De=0;De<6;++De)for(var tt=0;we.mipmask>>tt;++tt)W.texImage2D(As+De,tt,we.format,it>>tt,it>>tt,0,we.format,we.type,null);return Ma(),Ar.profile&&(we.stats.size=au(we.internalformat,we.type,zt.width,zt.height,!1,!0)),zt}}return zt(He,nr,er,Un,ua,Be),zt.subimage=lr,zt.resize=yt,zt._reglType="textureCube",zt._texture=we,Ar.profile&&(zt.stats=we.stats),zt.destroy=function(){we.decRef()},zt}function no(){for(var He=0;He<Ss;++He)W.activeTexture(Vs+He),W.bindTexture(is,null),Go[He]=null;Jt(fs).forEach(_o),ar.cubeCount=0,ar.textureCount=0}Ar.profile&&(ar.getTotalTextureSize=function(){var He=0;return Object.keys(fs).forEach(function(nr){He+=fs[nr].stats.size}),He});function xo(){for(var He=0;He<Ss;++He){var nr=Go[He];nr&&(nr.bindCount=0,nr.unit=-1,Go[He]=null)}Jt(fs).forEach(function(er){er.texture=W.createTexture(),W.bindTexture(er.target,er.texture);for(var Un=0;Un<32;++Un)if((er.mipmask&1<<Un)!=0)if(er.target===is)W.texImage2D(is,Un,er.internalformat,er.width>>Un,er.height>>Un,0,er.internalformat,er.type,null);else for(var ua=0;ua<6;++ua)W.texImage2D(As+ua,Un,er.internalformat,er.width>>Un,er.height>>Un,0,er.internalformat,er.type,null);Io(er.texInfo,er.target)})}function xu(){for(var He=0;He<Ss;++He){var nr=Go[He];nr&&(nr.bindCount=0,nr.unit=-1,Go[He]=null),W.activeTexture(Vs+He),W.bindTexture(is,null),W.bindTexture(Wl,null)}}return{create2D:_i,createCube:pa,clear:no,getTexture:function(He){return null},restore:xo,refresh:xu}}var Co=36161,Gu=32854,ni=32855,$n=36194,Pl=33189,as=36168,Ws=34041,Zo=35907,su=34836,wc=34842,ac=34843,oa=[];oa[Gu]=2,oa[ni]=2,oa[$n]=2,oa[Pl]=2,oa[as]=1,oa[Ws]=4,oa[Zo]=4,oa[su]=16,oa[wc]=8,oa[ac]=6;function Do(W,Oe,et){return oa[W]*Oe*et}var Uc=function(W,Oe,et,ur,Dr){var ar={rgba4:Gu,rgb565:$n,"rgb5 a1":ni,depth:Pl,stencil:as,"depth stencil":Ws};Oe.ext_srgb&&(ar.srgba=Zo),Oe.ext_color_buffer_half_float&&(ar.rgba16f=wc,ar.rgb16f=ac),Oe.webgl_color_buffer_float&&(ar.rgba32f=su);var Ar=[];Object.keys(ar).forEach(function(Xr){var en=ar[Xr];Ar[en]=Xr});var jr=0,Wr={};function Jr(Xr){this.id=jr++,this.refCount=1,this.renderbuffer=Xr,this.format=Gu,this.width=0,this.height=0,Dr.profile&&(this.stats={size:0})}Jr.prototype.decRef=function(){--this.refCount<=0&&Qr(this)};function Qr(Xr){var en=Xr.renderbuffer;Q(en,"must not double destroy renderbuffer"),W.bindRenderbuffer(Co,null),W.deleteRenderbuffer(en),Xr.renderbuffer=null,Xr.refCount=0,delete Wr[Xr.id],ur.renderbufferCount--}function rn(Xr,en){var Nt=new Jr(W.createRenderbuffer());Wr[Nt.id]=Nt,ur.renderbufferCount++;function _r(Ln,Or){var Sn=0,tn=0,li=Gu;if(typeof Ln=="object"&&Ln){var Lr=Ln;if("shape"in Lr){var Tr=Lr.shape;Q(Array.isArray(Tr)&&Tr.length>=2,"invalid renderbuffer shape"),Sn=Tr[0]|0,tn=Tr[1]|0}else"radius"in Lr&&(Sn=tn=Lr.radius|0),"width"in Lr&&(Sn=Lr.width|0),"height"in Lr&&(tn=Lr.height|0);"format"in Lr&&(Q.parameter(Lr.format,ar,"invalid renderbuffer format"),li=ar[Lr.format])}else typeof Ln=="number"?(Sn=Ln|0,typeof Or=="number"?tn=Or|0:tn=Sn):Ln?Q.raise("invalid arguments to renderbuffer constructor"):Sn=tn=1;if(Q(Sn>0&&tn>0&&Sn<=et.maxRenderbufferSize&&tn<=et.maxRenderbufferSize,"invalid renderbuffer size"),!(Sn===Nt.width&&tn===Nt.height&&li===Nt.format))return _r.width=Nt.width=Sn,_r.height=Nt.height=tn,Nt.format=li,W.bindRenderbuffer(Co,Nt.renderbuffer),W.renderbufferStorage(Co,li,Sn,tn),Q(W.getError()===0,"invalid render buffer format"),Dr.profile&&(Nt.stats.size=Do(Nt.format,Nt.width,Nt.height)),_r.format=Ar[Nt.format],_r}function Kr(Ln,Or){var Sn=Ln|0,tn=Or|0||Sn;return Sn===Nt.width&&tn===Nt.height||(Q(Sn>0&&tn>0&&Sn<=et.maxRenderbufferSize&&tn<=et.maxRenderbufferSize,"invalid renderbuffer size"),_r.width=Nt.width=Sn,_r.height=Nt.height=tn,W.bindRenderbuffer(Co,Nt.renderbuffer),W.renderbufferStorage(Co,Nt.format,Sn,tn),Q(W.getError()===0,"invalid render buffer format"),Dr.profile&&(Nt.stats.size=Do(Nt.format,Nt.width,Nt.height))),_r}return _r(Xr,en),_r.resize=Kr,_r._reglType="renderbuffer",_r._renderbuffer=Nt,Dr.profile&&(_r.stats=Nt.stats),_r.destroy=function(){Nt.decRef()},_r}Dr.profile&&(ur.getTotalRenderbufferSize=function(){var Xr=0;return Object.keys(Wr).forEach(function(en){Xr+=Wr[en].stats.size}),Xr});function yn(){Jt(Wr).forEach(function(Xr){Xr.renderbuffer=W.createRenderbuffer(),W.bindRenderbuffer(Co,Xr.renderbuffer),W.renderbufferStorage(Co,Xr.format,Xr.width,Xr.height)}),W.bindRenderbuffer(Co,null)}return{create:rn,clear:function(){Jt(Wr).forEach(Qr)},restore:yn}},xs=36160,Ml=36161,Rs=3553,os=34069,fl=36064,uu=36096,oc=36128,Hu=33306,Wu=36053,Zc=36054,Il=36055,hl=36057,jc=36061,Xu=36193,Lu=5121,sc=5126,Ru=6407,Xs=6408,Tc=6402,uc=[Ru,Xs],lc=[];lc[Xs]=4,lc[Ru]=3;var Yu=[];Yu[Lu]=1,Yu[sc]=4,Yu[Xu]=2;var i=32854,u=32855,o=36194,h=33189,_=36168,C=34041,P=35907,N=34836,K=34842,se=34843,Ce=[i,u,o,P,K,se,N],Ae={};Ae[Wu]="complete",Ae[Zc]="incomplete attachment",Ae[hl]="incomplete dimensions",Ae[Il]="incomplete, missing attachment",Ae[jc]="unsupported";function Ie(W,Oe,et,ur,Dr,ar){var Ar={cur:null,next:null,dirty:!1,setFBO:null},jr=["rgba"],Wr=["rgba4","rgb565","rgb5 a1"];Oe.ext_srgb&&Wr.push("srgba"),Oe.ext_color_buffer_half_float&&Wr.push("rgba16f","rgb16f"),Oe.webgl_color_buffer_float&&Wr.push("rgba32f");var Jr=["uint8"];Oe.oes_texture_half_float&&Jr.push("half float","float16"),Oe.oes_texture_float&&Jr.push("float","float32");function Qr($r,An,En){this.target=$r,this.texture=An,this.renderbuffer=En;var ji=0,Ri=0;An?(ji=An.width,Ri=An.height):En&&(ji=En.width,Ri=En.height),this.width=ji,this.height=Ri}function rn($r){$r&&($r.texture&&$r.texture._texture.decRef(),$r.renderbuffer&&$r.renderbuffer._renderbuffer.decRef())}function yn($r,An,En){if(!!$r)if($r.texture){var ji=$r.texture._texture,Ri=Math.max(1,ji.width),Pn=Math.max(1,ji.height);Q(Ri===An&&Pn===En,"inconsistent width/height for supplied texture"),ji.refCount+=1}else{var Cn=$r.renderbuffer._renderbuffer;Q(Cn.width===An&&Cn.height===En,"inconsistent width/height for renderbuffer"),Cn.refCount+=1}}function Xr($r,An){An&&(An.texture?W.framebufferTexture2D(xs,$r,An.target,An.texture._texture.texture,0):W.framebufferRenderbuffer(xs,$r,Ml,An.renderbuffer._renderbuffer.renderbuffer))}function en($r){var An=Rs,En=null,ji=null,Ri=$r;typeof $r=="object"&&(Ri=$r.data,"target"in $r&&(An=$r.target|0)),Q.type(Ri,"function","invalid attachment data");var Pn=Ri._reglType;return Pn==="texture2d"?(En=Ri,Q(An===Rs)):Pn==="textureCube"?(En=Ri,Q(An>=os&&An<os+6,"invalid cube map target")):Pn==="renderbuffer"?(ji=Ri,An=Ml):Q.raise("invalid regl object for attachment"),new Qr(An,En,ji)}function Nt($r,An,En,ji,Ri){if(En){var Pn=ur.create2D({width:$r,height:An,format:ji,type:Ri});return Pn._texture.refCount=0,new Qr(Rs,Pn,null)}else{var Cn=Dr.create({width:$r,height:An,format:ji});return Cn._renderbuffer.refCount=0,new Qr(Ml,null,Cn)}}function _r($r){return $r&&($r.texture||$r.renderbuffer)}function Kr($r,An,En){$r&&($r.texture?$r.texture.resize(An,En):$r.renderbuffer&&$r.renderbuffer.resize(An,En),$r.width=An,$r.height=En)}var Ln=0,Or={};function Sn(){this.id=Ln++,Or[this.id]=this,this.framebuffer=W.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function tn($r){$r.colorAttachments.forEach(rn),rn($r.depthAttachment),rn($r.stencilAttachment),rn($r.depthStencilAttachment)}function li($r){var An=$r.framebuffer;Q(An,"must not double destroy framebuffer"),W.deleteFramebuffer(An),$r.framebuffer=null,ar.framebufferCount--,delete Or[$r.id]}function Lr($r){var An;W.bindFramebuffer(xs,$r.framebuffer);var En=$r.colorAttachments;for(An=0;An<En.length;++An)Xr(fl+An,En[An]);for(An=En.length;An<et.maxColorAttachments;++An)W.framebufferTexture2D(xs,fl+An,Rs,null,0);W.framebufferTexture2D(xs,Hu,Rs,null,0),W.framebufferTexture2D(xs,uu,Rs,null,0),W.framebufferTexture2D(xs,oc,Rs,null,0),Xr(uu,$r.depthAttachment),Xr(oc,$r.stencilAttachment),Xr(Hu,$r.depthStencilAttachment);var ji=W.checkFramebufferStatus(xs);!W.isContextLost()&&ji!==Wu&&Q.raise("framebuffer configuration not supported, status = "+Ae[ji]),W.bindFramebuffer(xs,Ar.next?Ar.next.framebuffer:null),Ar.cur=Ar.next,W.getError()}function Tr($r,An){var En=new Sn;ar.framebufferCount++;function ji(Pn,Cn){var Ei;Q(Ar.next!==En,"can not update framebuffer which is currently in use");var Di=0,ra=0,yo=!0,Fo=!0,da=null,bs=!0,ho="rgba",$a="uint8",Io=1,cs=null,fs=null,Ss=null,Go=!1;if(typeof Pn=="number")Di=Pn|0,ra=Cn|0||Di;else if(!Pn)Di=ra=1;else{Q.type(Pn,"object","invalid arguments for framebuffer");var $i=Pn;if("shape"in $i){var Jo=$i.shape;Q(Array.isArray(Jo)&&Jo.length>=2,"invalid shape for framebuffer"),Di=Jo[0],ra=Jo[1]}else"radius"in $i&&(Di=ra=$i.radius),"width"in $i&&(Di=$i.width),"height"in $i&&(ra=$i.height);("color"in $i||"colors"in $i)&&(da=$i.color||$i.colors,Array.isArray(da)&&Q(da.length===1||Oe.webgl_draw_buffers,"multiple render targets not supported")),da||("colorCount"in $i&&(Io=$i.colorCount|0,Q(Io>0,"invalid color buffer count")),"colorTexture"in $i&&(bs=!!$i.colorTexture,ho="rgba4"),"colorType"in $i&&($a=$i.colorType,bs?(Q(Oe.oes_texture_float||!($a==="float"||$a==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),Q(Oe.oes_texture_half_float||!($a==="half float"||$a==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):$a==="half float"||$a==="float16"?(Q(Oe.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ho="rgba16f"):($a==="float"||$a==="float32")&&(Q(Oe.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ho="rgba32f"),Q.oneOf($a,Jr,"invalid color type")),"colorFormat"in $i&&(ho=$i.colorFormat,jr.indexOf(ho)>=0?bs=!0:Wr.indexOf(ho)>=0?bs=!1:Q.optional(function(){bs?Q.oneOf($i.colorFormat,jr,"invalid color format for texture"):Q.oneOf($i.colorFormat,Wr,"invalid color format for renderbuffer")}))),("depthTexture"in $i||"depthStencilTexture"in $i)&&(Go=!!($i.depthTexture||$i.depthStencilTexture),Q(!Go||Oe.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in $i&&(typeof $i.depth=="boolean"?yo=$i.depth:(cs=$i.depth,Fo=!1)),"stencil"in $i&&(typeof $i.stencil=="boolean"?Fo=$i.stencil:(fs=$i.stencil,yo=!1)),"depthStencil"in $i&&(typeof $i.depthStencil=="boolean"?yo=Fo=$i.depthStencil:(Ss=$i.depthStencil,yo=!1,Fo=!1))}var Ma=null,_o=null,_i=null,pa=null;if(Array.isArray(da))Ma=da.map(en);else if(da)Ma=[en(da)];else for(Ma=new Array(Io),Ei=0;Ei<Io;++Ei)Ma[Ei]=Nt(Di,ra,bs,ho,$a);Q(Oe.webgl_draw_buffers||Ma.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),Q(Ma.length<=et.maxColorAttachments,"too many color attachments, not supported"),Di=Di||Ma[0].width,ra=ra||Ma[0].height,cs?_o=en(cs):yo&&!Fo&&(_o=Nt(Di,ra,Go,"depth","uint32")),fs?_i=en(fs):Fo&&!yo&&(_i=Nt(Di,ra,!1,"stencil","uint8")),Ss?pa=en(Ss):!cs&&!fs&&Fo&&yo&&(pa=Nt(Di,ra,Go,"depth stencil","depth stencil")),Q(!!cs+!!fs+!!Ss<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var no=null;for(Ei=0;Ei<Ma.length;++Ei)if(yn(Ma[Ei],Di,ra),Q(!Ma[Ei]||Ma[Ei].texture&&uc.indexOf(Ma[Ei].texture._texture.format)>=0||Ma[Ei].renderbuffer&&Ce.indexOf(Ma[Ei].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ei+" is invalid"),Ma[Ei]&&Ma[Ei].texture){var xo=lc[Ma[Ei].texture._texture.format]*Yu[Ma[Ei].texture._texture.type];no===null?no=xo:Q(no===xo,"all color attachments much have the same number of bits per pixel.")}return yn(_o,Di,ra),Q(!_o||_o.texture&&_o.texture._texture.format===Tc||_o.renderbuffer&&_o.renderbuffer._renderbuffer.format===h,"invalid depth attachment for framebuffer object"),yn(_i,Di,ra),Q(!_i||_i.renderbuffer&&_i.renderbuffer._renderbuffer.format===_,"invalid stencil attachment for framebuffer object"),yn(pa,Di,ra),Q(!pa||pa.texture&&pa.texture._texture.format===C||pa.renderbuffer&&pa.renderbuffer._renderbuffer.format===C,"invalid depth-stencil attachment for framebuffer object"),tn(En),En.width=Di,En.height=ra,En.colorAttachments=Ma,En.depthAttachment=_o,En.stencilAttachment=_i,En.depthStencilAttachment=pa,ji.color=Ma.map(_r),ji.depth=_r(_o),ji.stencil=_r(_i),ji.depthStencil=_r(pa),ji.width=En.width,ji.height=En.height,Lr(En),ji}function Ri(Pn,Cn){Q(Ar.next!==En,"can not resize a framebuffer which is currently in use");var Ei=Math.max(Pn|0,1),Di=Math.max(Cn|0||Ei,1);if(Ei===En.width&&Di===En.height)return ji;for(var ra=En.colorAttachments,yo=0;yo<ra.length;++yo)Kr(ra[yo],Ei,Di);return Kr(En.depthAttachment,Ei,Di),Kr(En.stencilAttachment,Ei,Di),Kr(En.depthStencilAttachment,Ei,Di),En.width=ji.width=Ei,En.height=ji.height=Di,Lr(En),ji}return ji($r,An),p(ji,{resize:Ri,_reglType:"framebuffer",_framebuffer:En,destroy:function(){li(En),tn(En)},use:function(Pn){Ar.setFBO({framebuffer:ji},Pn)}})}function Xn($r){var An=Array(6);function En(Ri){var Pn;Q(An.indexOf(Ar.next)<0,"can not update framebuffer which is currently in use");var Cn={color:null},Ei=0,Di=null,ra="rgba",yo="uint8",Fo=1;if(typeof Ri=="number")Ei=Ri|0;else if(!Ri)Ei=1;else{Q.type(Ri,"object","invalid arguments for framebuffer");var da=Ri;if("shape"in da){var bs=da.shape;Q(Array.isArray(bs)&&bs.length>=2,"invalid shape for framebuffer"),Q(bs[0]===bs[1],"cube framebuffer must be square"),Ei=bs[0]}else"radius"in da&&(Ei=da.radius|0),"width"in da?(Ei=da.width|0,"height"in da&&Q(da.height===Ei,"must be square")):"height"in da&&(Ei=da.height|0);("color"in da||"colors"in da)&&(Di=da.color||da.colors,Array.isArray(Di)&&Q(Di.length===1||Oe.webgl_draw_buffers,"multiple render targets not supported")),Di||("colorCount"in da&&(Fo=da.colorCount|0,Q(Fo>0,"invalid color buffer count")),"colorType"in da&&(Q.oneOf(da.colorType,Jr,"invalid color type"),yo=da.colorType),"colorFormat"in da&&(ra=da.colorFormat,Q.oneOf(da.colorFormat,jr,"invalid color format for texture"))),"depth"in da&&(Cn.depth=da.depth),"stencil"in da&&(Cn.stencil=da.stencil),"depthStencil"in da&&(Cn.depthStencil=da.depthStencil)}var ho;if(Di)if(Array.isArray(Di))for(ho=[],Pn=0;Pn<Di.length;++Pn)ho[Pn]=Di[Pn];else ho=[Di];else{ho=Array(Fo);var $a={radius:Ei,format:ra,type:yo};for(Pn=0;Pn<Fo;++Pn)ho[Pn]=ur.createCube($a)}for(Cn.color=Array(ho.length),Pn=0;Pn<ho.length;++Pn){var Io=ho[Pn];Q(typeof Io=="function"&&Io._reglType==="textureCube","invalid cube map"),Ei=Ei||Io.width,Q(Io.width===Ei&&Io.height===Ei,"invalid cube map shape"),Cn.color[Pn]={target:os,data:ho[Pn]}}for(Pn=0;Pn<6;++Pn){for(var cs=0;cs<ho.length;++cs)Cn.color[cs].target=os+Pn;Pn>0&&(Cn.depth=An[0].depth,Cn.stencil=An[0].stencil,Cn.depthStencil=An[0].depthStencil),An[Pn]?An[Pn](Cn):An[Pn]=Tr(Cn)}return p(En,{width:Ei,height:Ei,color:ho})}function ji(Ri){var Pn,Cn=Ri|0;if(Q(Cn>0&&Cn<=et.maxCubeMapSize,"invalid radius for cube fbo"),Cn===En.width)return En;var Ei=En.color;for(Pn=0;Pn<Ei.length;++Pn)Ei[Pn].resize(Cn);for(Pn=0;Pn<6;++Pn)An[Pn].resize(Cn);return En.width=En.height=Cn,En}return En($r),p(En,{faces:An,resize:ji,_reglType:"framebufferCube",destroy:function(){An.forEach(function(Ri){Ri.destroy()})}})}function _n(){Ar.cur=null,Ar.next=null,Ar.dirty=!0,Jt(Or).forEach(function($r){$r.framebuffer=W.createFramebuffer(),Lr($r)})}return p(Ar,{getFramebuffer:function($r){if(typeof $r=="function"&&$r._reglType==="framebuffer"){var An=$r._framebuffer;if(An instanceof Sn)return An}return null},create:Tr,createCube:Xn,clear:function(){Jt(Or).forEach(li)},restore:_n})}var Ke=5126,We=34962,at=34963,Ze=["attributes","elements","offset","count","primitive","instances"];function st(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ke,this.offset=0,this.stride=0,this.divisor=0}function St(W,Oe,et,ur,Dr,ar,Ar){for(var jr=et.maxAttributes,Wr=new Array(jr),Jr=0;Jr<jr;++Jr)Wr[Jr]=new st;var Qr=0,rn={},yn={Record:st,scope:{},state:Wr,currentVAO:null,targetVAO:null,restore:en()?tn:function(){},createVAO:li,getVAO:_r,destroyBuffer:Xr,setVAO:en()?Kr:Ln,clear:en()?Or:function(){}};function Xr(Lr){for(var Tr=0;Tr<Wr.length;++Tr){var Xn=Wr[Tr];Xn.buffer===Lr&&(W.disableVertexAttribArray(Tr),Xn.buffer=null)}}function en(){return Oe.oes_vertex_array_object}function Nt(){return Oe.angle_instanced_arrays}function _r(Lr){return typeof Lr=="function"&&Lr._vao?Lr._vao:null}function Kr(Lr){if(Lr!==yn.currentVAO){var Tr=en();Lr?Tr.bindVertexArrayOES(Lr.vao):Tr.bindVertexArrayOES(null),yn.currentVAO=Lr}}function Ln(Lr){if(Lr!==yn.currentVAO){if(Lr)Lr.bindAttrs();else{for(var Tr=Nt(),Xn=0;Xn<Wr.length;++Xn){var _n=Wr[Xn];_n.buffer?(W.enableVertexAttribArray(Xn),_n.buffer.bind(),W.vertexAttribPointer(Xn,_n.size,_n.type,_n.normalized,_n.stride,_n.offfset),Tr&&_n.divisor&&Tr.vertexAttribDivisorANGLE(Xn,_n.divisor)):(W.disableVertexAttribArray(Xn),W.vertexAttrib4f(Xn,_n.x,_n.y,_n.z,_n.w))}Ar.elements?W.bindBuffer(at,Ar.elements.buffer.buffer):W.bindBuffer(at,null)}yn.currentVAO=Lr}}function Or(){Jt(rn).forEach(function(Lr){Lr.destroy()})}function Sn(){this.id=++Qr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Lr=en();Lr?this.vao=Lr.createVertexArrayOES():this.vao=null,rn[this.id]=this,this.buffers=[]}Sn.prototype.bindAttrs=function(){for(var Lr=Nt(),Tr=this.attributes,Xn=0;Xn<Tr.length;++Xn){var _n=Tr[Xn];_n.buffer?(W.enableVertexAttribArray(Xn),W.bindBuffer(We,_n.buffer.buffer),W.vertexAttribPointer(Xn,_n.size,_n.type,_n.normalized,_n.stride,_n.offset),Lr&&_n.divisor&&Lr.vertexAttribDivisorANGLE(Xn,_n.divisor)):(W.disableVertexAttribArray(Xn),W.vertexAttrib4f(Xn,_n.x,_n.y,_n.z,_n.w))}for(var $r=Tr.length;$r<jr;++$r)W.disableVertexAttribArray($r);var An=ar.getElements(this.elements);An?W.bindBuffer(at,An.buffer.buffer):W.bindBuffer(at,null)},Sn.prototype.refresh=function(){var Lr=en();Lr&&(Lr.bindVertexArrayOES(this.vao),this.bindAttrs(),yn.currentVAO=null,Lr.bindVertexArrayOES(null))},Sn.prototype.destroy=function(){if(this.vao){var Lr=en();this===yn.currentVAO&&(yn.currentVAO=null,Lr.bindVertexArrayOES(null)),Lr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),rn[this.id]&&(delete rn[this.id],ur.vaoCount-=1)};function tn(){var Lr=en();Lr&&Jt(rn).forEach(function(Tr){Tr.refresh()})}function li(Lr){var Tr=new Sn;ur.vaoCount+=1;function Xn(_n){var $r;if(Array.isArray(_n))$r=_n,Tr.elements&&Tr.ownsElements&&Tr.elements.destroy(),Tr.elements=null,Tr.ownsElements=!1,Tr.offset=0,Tr.count=0,Tr.instances=-1,Tr.primitive=4;else{if(Q(typeof _n=="object","invalid arguments for create vao"),Q("attributes"in _n,"must specify attributes for vao"),_n.elements){var An=_n.elements;Tr.ownsElements?typeof An=="function"&&An._reglType==="elements"?(Tr.elements.destroy(),Tr.ownsElements=!1):(Tr.elements(An),Tr.ownsElements=!1):ar.getElements(_n.elements)?(Tr.elements=_n.elements,Tr.ownsElements=!1):(Tr.elements=ar.create(_n.elements),Tr.ownsElements=!0)}else Tr.elements=null,Tr.ownsElements=!1;$r=_n.attributes,Tr.offset=0,Tr.count=-1,Tr.instances=-1,Tr.primitive=4,Tr.elements&&(Tr.count=Tr.elements._elements.vertCount,Tr.primitive=Tr.elements._elements.primType),"offset"in _n&&(Tr.offset=_n.offset|0),"count"in _n&&(Tr.count=_n.count|0),"instances"in _n&&(Tr.instances=_n.instances|0),"primitive"in _n&&(Q(_n.primitive in Ir,"bad primitive type: "+_n.primitive),Tr.primitive=Ir[_n.primitive]),Q.optional(()=>{for(var yo=Object.keys(_n),Fo=0;Fo<yo.length;++Fo)Q(Ze.indexOf(yo[Fo])>=0,'invalid option for vao: "'+yo[Fo]+'" valid options are '+Ze)}),Q(Array.isArray($r),"attributes must be an array")}Q($r.length<jr,"too many attributes"),Q($r.length>0,"must specify at least one attribute");var En={},ji=Tr.attributes;ji.length=$r.length;for(var Ri=0;Ri<$r.length;++Ri){var Pn=$r[Ri],Cn=ji[Ri]=new st,Ei=Pn.data||Pn;if(Array.isArray(Ei)||b(Ei)||pt(Ei)){var Di;Tr.buffers[Ri]&&(Di=Tr.buffers[Ri],b(Ei)&&Di._buffer.byteLength>=Ei.byteLength?Di.subdata(Ei):(Di.destroy(),Tr.buffers[Ri]=null)),Tr.buffers[Ri]||(Di=Tr.buffers[Ri]=Dr.create(Pn,We,!1,!0)),Cn.buffer=Dr.getBuffer(Di),Cn.size=Cn.buffer.dimension|0,Cn.normalized=!1,Cn.type=Cn.buffer.dtype,Cn.offset=0,Cn.stride=0,Cn.divisor=0,Cn.state=1,En[Ri]=1}else Dr.getBuffer(Pn)?(Cn.buffer=Dr.getBuffer(Pn),Cn.size=Cn.buffer.dimension|0,Cn.normalized=!1,Cn.type=Cn.buffer.dtype,Cn.offset=0,Cn.stride=0,Cn.divisor=0,Cn.state=1):Dr.getBuffer(Pn.buffer)?(Cn.buffer=Dr.getBuffer(Pn.buffer),Cn.size=(+Pn.size||Cn.buffer.dimension)|0,Cn.normalized=!!Pn.normalized||!1,"type"in Pn?(Q.parameter(Pn.type,Bs,"invalid buffer type"),Cn.type=Bs[Pn.type]):Cn.type=Cn.buffer.dtype,Cn.offset=(Pn.offset||0)|0,Cn.stride=(Pn.stride||0)|0,Cn.divisor=(Pn.divisor||0)|0,Cn.state=1,Q(Cn.size>=1&&Cn.size<=4,"size must be between 1 and 4"),Q(Cn.offset>=0,"invalid offset"),Q(Cn.stride>=0&&Cn.stride<=255,"stride must be between 0 and 255"),Q(Cn.divisor>=0,"divisor must be positive"),Q(!Cn.divisor||!!Oe.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Pn?(Q(Ri>0,"first attribute must not be a constant"),Cn.x=+Pn.x||0,Cn.y=+Pn.y||0,Cn.z=+Pn.z||0,Cn.w=+Pn.w||0,Cn.state=2):Q(!1,"invalid attribute spec for location "+Ri)}for(var ra=0;ra<Tr.buffers.length;++ra)!En[ra]&&Tr.buffers[ra]&&(Tr.buffers[ra].destroy(),Tr.buffers[ra]=null);return Tr.refresh(),Xn}return Xn.destroy=function(){for(var _n=0;_n<Tr.buffers.length;++_n)Tr.buffers[_n]&&Tr.buffers[_n].destroy();Tr.buffers.length=0,Tr.ownsElements&&(Tr.elements.destroy(),Tr.elements=null,Tr.ownsElements=!1),Tr.destroy()},Xn._vao=Tr,Xn._reglType="vao",Xn(Lr)}return yn}var Wt=35632,xr=35633,hr=35718,Sr=35721;function Gr(W,Oe,et,ur){var Dr={},ar={};function Ar(Nt,_r,Kr,Ln){this.name=Nt,this.id=_r,this.location=Kr,this.info=Ln}function jr(Nt,_r){for(var Kr=0;Kr<Nt.length;++Kr)if(Nt[Kr].id===_r.id){Nt[Kr].location=_r.location;return}Nt.push(_r)}function Wr(Nt,_r,Kr){var Ln=Nt===Wt?Dr:ar,Or=Ln[_r];if(!Or){var Sn=Oe.str(_r);Or=W.createShader(Nt),W.shaderSource(Or,Sn),W.compileShader(Or),Q.shaderError(W,Or,Sn,Nt,Kr),Ln[_r]=Or}return Or}var Jr={},Qr=[],rn=0;function yn(Nt,_r){this.id=rn++,this.fragId=Nt,this.vertId=_r,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,ur.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Xr(Nt,_r,Kr){var Ln,Or,Sn=Wr(Wt,Nt.fragId),tn=Wr(xr,Nt.vertId),li=Nt.program=W.createProgram();if(W.attachShader(li,Sn),W.attachShader(li,tn),Kr)for(Ln=0;Ln<Kr.length;++Ln){var Lr=Kr[Ln];W.bindAttribLocation(li,Lr[0],Lr[1])}W.linkProgram(li),Q.linkError(W,li,Oe.str(Nt.fragId),Oe.str(Nt.vertId),_r);var Tr=W.getProgramParameter(li,hr);ur.profile&&(Nt.stats.uniformsCount=Tr);var Xn=Nt.uniforms;for(Ln=0;Ln<Tr;++Ln)if(Or=W.getActiveUniform(li,Ln),Or)if(Or.size>1)for(var _n=0;_n<Or.size;++_n){var $r=Or.name.replace("[0]","["+_n+"]");jr(Xn,new Ar($r,Oe.id($r),W.getUniformLocation(li,$r),Or))}else jr(Xn,new Ar(Or.name,Oe.id(Or.name),W.getUniformLocation(li,Or.name),Or));var An=W.getProgramParameter(li,Sr);ur.profile&&(Nt.stats.attributesCount=An);var En=Nt.attributes;for(Ln=0;Ln<An;++Ln)Or=W.getActiveAttrib(li,Ln),Or&&jr(En,new Ar(Or.name,Oe.id(Or.name),W.getAttribLocation(li,Or.name),Or))}ur.profile&&(et.getMaxUniformsCount=function(){var Nt=0;return Qr.forEach(function(_r){_r.stats.uniformsCount>Nt&&(Nt=_r.stats.uniformsCount)}),Nt},et.getMaxAttributesCount=function(){var Nt=0;return Qr.forEach(function(_r){_r.stats.attributesCount>Nt&&(Nt=_r.stats.attributesCount)}),Nt});function en(){Dr={},ar={};for(var Nt=0;Nt<Qr.length;++Nt)Xr(Qr[Nt],null,Qr[Nt].attributes.map(function(_r){return[_r.location,_r.name]}))}return{clear:function(){var Nt=W.deleteShader.bind(W);Jt(Dr).forEach(Nt),Dr={},Jt(ar).forEach(Nt),ar={},Qr.forEach(function(_r){W.deleteProgram(_r.program)}),Qr.length=0,Jr={},et.shaderCount=0},program:function(Nt,_r,Kr,Ln){Q.command(Nt>=0,"missing vertex shader",Kr),Q.command(_r>=0,"missing fragment shader",Kr);var Or=Jr[_r];Or||(Or=Jr[_r]={});var Sn=Or[Nt];if(Sn&&(Sn.refCount++,!Ln))return Sn;var tn=new yn(_r,Nt);return et.shaderCount++,Xr(tn,Kr,Ln),Sn||(Or[Nt]=tn),Qr.push(tn),p(tn,{destroy:function(){if(tn.refCount--,tn.refCount<=0){W.deleteProgram(tn.program);var li=Qr.indexOf(tn);Qr.splice(li,1),et.shaderCount--}Or[tn.vertId].refCount<=0&&(W.deleteShader(ar[tn.vertId]),delete ar[tn.vertId],delete Jr[tn.fragId][tn.vertId]),Object.keys(Jr[tn.fragId]).length||(W.deleteShader(Dr[tn.fragId]),delete Dr[tn.fragId],delete Jr[tn.fragId])}})},restore:en,shader:Wr,frag:-1,vert:-1}}var sn=6408,qr=5121,Mn=3333,ei=5126;function fi(W,Oe,et,ur,Dr,ar,Ar){function jr(Qr){var rn;Oe.next===null?(Q(Dr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),rn=qr):(Q(Oe.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),rn=Oe.next.colorAttachments[0].texture._texture.type,Q.optional(function(){ar.oes_texture_float?(Q(rn===qr||rn===ei,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),rn===ei&&Q(Ar.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):Q(rn===qr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var yn=0,Xr=0,en=ur.framebufferWidth,Nt=ur.framebufferHeight,_r=null;b(Qr)?_r=Qr:Qr&&(Q.type(Qr,"object","invalid arguments to regl.read()"),yn=Qr.x|0,Xr=Qr.y|0,Q(yn>=0&&yn<ur.framebufferWidth,"invalid x offset for regl.read"),Q(Xr>=0&&Xr<ur.framebufferHeight,"invalid y offset for regl.read"),en=(Qr.width||ur.framebufferWidth-yn)|0,Nt=(Qr.height||ur.framebufferHeight-Xr)|0,_r=Qr.data||null),_r&&(rn===qr?Q(_r instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):rn===ei&&Q(_r instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),Q(en>0&&en+yn<=ur.framebufferWidth,"invalid width for read pixels"),Q(Nt>0&&Nt+Xr<=ur.framebufferHeight,"invalid height for read pixels"),et();var Kr=en*Nt*4;return _r||(rn===qr?_r=new Uint8Array(Kr):rn===ei&&(_r=_r||new Float32Array(Kr))),Q.isTypedArray(_r,"data buffer for regl.read() must be a typedarray"),Q(_r.byteLength>=Kr,"data buffer for regl.read() too small"),W.pixelStorei(Mn,4),W.readPixels(yn,Xr,en,Nt,sn,rn,_r),_r}function Wr(Qr){var rn;return Oe.setFBO({framebuffer:Qr.framebuffer},function(){rn=jr(Qr)}),rn}function Jr(Qr){return!Qr||!("framebuffer"in Qr)?jr(Qr):Wr(Qr)}return Jr}function ri(W){return Array.prototype.slice.call(W)}function sa(W){return ri(W).join("")}function Vn(){var W=0,Oe=[],et=[];function ur(rn){for(var yn=0;yn<et.length;++yn)if(et[yn]===rn)return Oe[yn];var Xr="g"+W++;return Oe.push(Xr),et.push(rn),Xr}function Dr(){var rn=[];function yn(){rn.push.apply(rn,ri(arguments))}var Xr=[];function en(){var Nt="v"+W++;return Xr.push(Nt),arguments.length>0&&(rn.push(Nt,"="),rn.push.apply(rn,ri(arguments)),rn.push(";")),Nt}return p(yn,{def:en,toString:function(){return sa([Xr.length>0?"var "+Xr.join(",")+";":"",sa(rn)])}})}function ar(){var rn=Dr(),yn=Dr(),Xr=rn.toString,en=yn.toString;function Nt(_r,Kr){yn(_r,Kr,"=",rn.def(_r,Kr),";")}return p(function(){rn.apply(rn,ri(arguments))},{def:rn.def,entry:rn,exit:yn,save:Nt,set:function(_r,Kr,Ln){Nt(_r,Kr),rn(_r,Kr,"=",Ln,";")},toString:function(){return Xr()+en()}})}function Ar(){var rn=sa(arguments),yn=ar(),Xr=ar(),en=yn.toString,Nt=Xr.toString;return p(yn,{then:function(){return yn.apply(yn,ri(arguments)),this},else:function(){return Xr.apply(Xr,ri(arguments)),this},toString:function(){var _r=Nt();return _r&&(_r="else{"+_r+"}"),sa(["if(",rn,"){",en(),"}",_r])}})}var jr=Dr(),Wr={};function Jr(rn,yn){var Xr=[];function en(){var Or="a"+Xr.length;return Xr.push(Or),Or}yn=yn||0;for(var Nt=0;Nt<yn;++Nt)en();var _r=ar(),Kr=_r.toString,Ln=Wr[rn]=p(_r,{arg:en,toString:function(){return sa(["function(",Xr.join(),"){",Kr(),"}"])}});return Ln}function Qr(){var rn=['"use strict";',jr,"return {"];Object.keys(Wr).forEach(function(Nt){rn.push('"',Nt,'":',Wr[Nt].toString(),",")}),rn.push("}");var yn=sa(rn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Xr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",en=Xr?j.Function.apply(null,Oe.concat(yn)):Function.apply(null,Oe.concat(yn));return en.apply(null,et)}return{global:jr,link:ur,block:Dr,proc:Jr,scope:ar,cond:Ar,compile:Qr}}var Si="xyzw".split(""),Ui=5121,ee=1,ne=2,k=0,F=1,ie=2,Te=3,ft=4,Gt=5,Et=6,Qt="dither",Fr="blend.enable",Bn="blend.color",zn="blend.equation",hi="blend.func",ui="depth.enable",yi="depth.func",Ki="depth.range",_a="depth.mask",xa="colorMask",Ya="cull.enable",Na="cull.face",wo="frontFace",La="lineWidth",Ea="polygonOffset.enable",fa="polygonOffset.offset",ma="sample.alpha",Ga="sample.enable",za="sample.coverage",ko="stencil.enable",Zi="stencil.mask",$o="stencil.func",Po="stencil.opFront",To="stencil.opBack",Ac="scissor.enable",Du="scissor.box",Ku="viewport",$u="profile",Ol="framebuffer",Ju="vert",pl="frag",Ll="elements",_u="primitive",Mo="count",Bf="offset",Rl="instances",of="vao",xf="Width",bf="Height",Dl=Ol+xf,kl=Ol+bf,Mh=Ku+xf,Nf=Ku+bf,zf="drawingBuffer",ss=zf+xf,sf=zf+bf,sp=[hi,zn,$o,Po,To,za,Ku,Du,fa],uf=34962,cc=34963,up=35632,zp=35633,lp=3553,Up=34067,Ih=2884,Zp=3042,Sf=3024,cp=2960,jo=2929,Ef=3089,ch=32823,Cf=32926,Uf=32928,Pc=5126,Zf=35664,wf=35665,Mc=35666,jf=5124,Tf=35667,fh=35668,Vc=35669,Oh=35670,fc=35671,hh=35672,lf=35673,cf=35674,lu=35675,Vf=35676,Gf=35678,ff=35680,Lh=4,hc=1028,dl=1029,Rh=2304,Dh=2305,kh=32775,fp=32776,jp=519,Gc=7680,Ic=0,ph=1,Hf=32774,hf=513,Qu=36160,hp=36064,Fl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Fh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],vl={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Bl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},dh={frag:up,vert:zp},vh={cw:Rh,ccw:Dh};function Wf(W){return Array.isArray(W)||b(W)||pt(W)}function Bh(W){return W.sort(function(Oe,et){return Oe===Ku?-1:et===Ku?1:Oe<et?-1:1})}function us(W,Oe,et,ur){this.thisDep=W,this.contextDep=Oe,this.propDep=et,this.append=ur}function Vo(W){return W&&!(W.thisDep||W.contextDep||W.propDep)}function ls(W){return new us(!1,!1,!1,W)}function cu(W,Oe){var et=W.type;if(et===k){var ur=W.data.length;return new us(!0,ur>=1,ur>=2,Oe)}else if(et===ft){var Dr=W.data;return new us(Dr.thisDep,Dr.contextDep,Dr.propDep,Oe)}else{if(et===Gt)return new us(!1,!1,!1,Oe);if(et===Et){for(var ar=!1,Ar=!1,jr=!1,Wr=0;Wr<W.data.length;++Wr){var Jr=W.data[Wr];if(Jr.type===F)jr=!0;else if(Jr.type===ie)Ar=!0;else if(Jr.type===Te)ar=!0;else if(Jr.type===k){ar=!0;var Qr=Jr.data;Qr>=1&&(Ar=!0),Qr>=2&&(jr=!0)}else Jr.type===ft&&(ar=ar||Jr.data.thisDep,Ar=Ar||Jr.data.contextDep,jr=jr||Jr.data.propDep)}return new us(ar,Ar,jr,Oe)}else return new us(et===Te,et===ie,et===F,Oe)}}var Xf=new us(!1,!1,!1,function(){});function Nh(W,Oe,et,ur,Dr,ar,Ar,jr,Wr,Jr,Qr,rn,yn,Xr,en){var Nt=Jr.Record,_r={add:32774,subtract:32778,"reverse subtract":32779};et.ext_blend_minmax&&(_r.min=kh,_r.max=fp);var Kr=et.angle_instanced_arrays,Ln=et.webgl_draw_buffers,Or=et.oes_vertex_array_object,Sn={dirty:!0,profile:en.profile},tn={},li=[],Lr={},Tr={};function Xn(Be){return Be.replace(".","_")}function _n(Be,we,ut){var zt=Xn(Be);li.push(Be),tn[zt]=Sn[zt]=!!ut,Lr[zt]=we}function $r(Be,we,ut){var zt=Xn(Be);li.push(Be),Array.isArray(ut)?(Sn[zt]=ut.slice(),tn[zt]=ut.slice()):Sn[zt]=tn[zt]=ut,Tr[zt]=we}_n(Qt,Sf),_n(Fr,Zp),$r(Bn,"blendColor",[0,0,0,0]),$r(zn,"blendEquationSeparate",[Hf,Hf]),$r(hi,"blendFuncSeparate",[ph,Ic,ph,Ic]),_n(ui,jo,!0),$r(yi,"depthFunc",hf),$r(Ki,"depthRange",[0,1]),$r(_a,"depthMask",!0),$r(xa,xa,[!0,!0,!0,!0]),_n(Ya,Ih),$r(Na,"cullFace",dl),$r(wo,wo,Dh),$r(La,La,1),_n(Ea,ch),$r(fa,"polygonOffset",[0,0]),_n(ma,Cf),_n(Ga,Uf),$r(za,"sampleCoverage",[1,!1]),_n(ko,cp),$r(Zi,"stencilMask",-1),$r($o,"stencilFunc",[jp,0,-1]),$r(Po,"stencilOpSeparate",[hc,Gc,Gc,Gc]),$r(To,"stencilOpSeparate",[dl,Gc,Gc,Gc]),_n(Ac,Ef),$r(Du,"scissor",[0,0,W.drawingBufferWidth,W.drawingBufferHeight]),$r(Ku,Ku,[0,0,W.drawingBufferWidth,W.drawingBufferHeight]);var An={gl:W,context:yn,strings:Oe,next:tn,current:Sn,draw:rn,elements:ar,buffer:Dr,shader:Qr,attributes:Jr.state,vao:Jr,uniforms:Wr,framebuffer:jr,extensions:et,timer:Xr,isBufferArgs:Wf},En={primTypes:Ir,compareFuncs:vl,blendFuncs:Fl,blendEquations:_r,stencilOps:Bl,glTypes:Bs,orientationType:vh};Q.optional(function(){An.isArrayLike=co}),Ln&&(En.backBuffer=[dl],En.drawBuffer=de(ur.maxDrawbuffers,function(Be){return Be===0?[0]:de(Be,function(we){return hp+we})}));var ji=0;function Ri(){var Be=Vn(),we=Be.link,ut=Be.global;Be.id=ji++,Be.batchId="0";var zt=we(An),lr=Be.shared={props:"a0"};Object.keys(An).forEach(function(tt){lr[tt]=ut.def(zt,".",tt)}),Q.optional(function(){Be.CHECK=we(Q),Be.commandStr=Q.guessCommand(),Be.command=we(Be.commandStr),Be.assert=function(tt,Ne,Zt){tt("if(!(",Ne,"))",this.CHECK,".commandRaise(",we(Zt),",",this.command,");")},En.invalidBlendCombinations=Fh});var yt=Be.next={},dt=Be.current={};Object.keys(Tr).forEach(function(tt){Array.isArray(Sn[tt])&&(yt[tt]=ut.def(lr.next,".",tt),dt[tt]=ut.def(lr.current,".",tt))});var it=Be.constants={};Object.keys(En).forEach(function(tt){it[tt]=ut.def(JSON.stringify(En[tt]))}),Be.invoke=function(tt,Ne){switch(Ne.type){case k:var Zt=["this",lr.context,lr.props,Be.batchId];return tt.def(we(Ne.data),".call(",Zt.slice(0,Math.max(Ne.data.length+1,4)),")");case F:return tt.def(lr.props,Ne.data);case ie:return tt.def(lr.context,Ne.data);case Te:return tt.def("this",Ne.data);case ft:return Ne.data.append(Be,tt),Ne.data.ref;case Gt:return Ne.data.toString();case Et:return Ne.data.map(function(Kt){return Be.invoke(tt,Kt)})}},Be.attribCache={};var De={};return Be.scopeAttrib=function(tt){var Ne=Oe.id(tt);if(Ne in De)return De[Ne];var Zt=Jr.scope[Ne];Zt||(Zt=Jr.scope[Ne]=new Nt);var Kt=De[Ne]=we(Zt);return Kt},Be}function Pn(Be){var we=Be.static,ut=Be.dynamic,zt;if($u in we){var lr=!!we[$u];zt=ls(function(dt,it){return lr}),zt.enable=lr}else if($u in ut){var yt=ut[$u];zt=cu(yt,function(dt,it){return dt.invoke(it,yt)})}return zt}function Cn(Be,we){var ut=Be.static,zt=Be.dynamic;if(Ol in ut){var lr=ut[Ol];return lr?(lr=jr.getFramebuffer(lr),Q.command(lr,"invalid framebuffer object"),ls(function(dt,it){var De=dt.link(lr),tt=dt.shared;it.set(tt.framebuffer,".next",De);var Ne=tt.context;return it.set(Ne,"."+Dl,De+".width"),it.set(Ne,"."+kl,De+".height"),De})):ls(function(dt,it){var De=dt.shared;it.set(De.framebuffer,".next","null");var tt=De.context;return it.set(tt,"."+Dl,tt+"."+ss),it.set(tt,"."+kl,tt+"."+sf),"null"})}else if(Ol in zt){var yt=zt[Ol];return cu(yt,function(dt,it){var De=dt.invoke(it,yt),tt=dt.shared,Ne=tt.framebuffer,Zt=it.def(Ne,".getFramebuffer(",De,")");Q.optional(function(){dt.assert(it,"!"+De+"||"+Zt,"invalid framebuffer object")}),it.set(Ne,".next",Zt);var Kt=tt.context;return it.set(Kt,"."+Dl,Zt+"?"+Zt+".width:"+Kt+"."+ss),it.set(Kt,"."+kl,Zt+"?"+Zt+".height:"+Kt+"."+sf),Zt})}else return null}function Ei(Be,we,ut){var zt=Be.static,lr=Be.dynamic;function yt(De){if(De in zt){var tt=zt[De];Q.commandType(tt,"object","invalid "+De,ut.commandStr);var Ne=!0,Zt=tt.x|0,Kt=tt.y|0,Vr,cn;return"width"in tt?(Vr=tt.width|0,Q.command(Vr>=0,"invalid "+De,ut.commandStr)):Ne=!1,"height"in tt?(cn=tt.height|0,Q.command(cn>=0,"invalid "+De,ut.commandStr)):Ne=!1,new us(!Ne&&we&&we.thisDep,!Ne&&we&&we.contextDep,!Ne&&we&&we.propDep,function(fn,Wn){var Dn=fn.shared.context,Yn=Vr;"width"in tt||(Yn=Wn.def(Dn,".",Dl,"-",Zt));var Gn=cn;return"height"in tt||(Gn=Wn.def(Dn,".",kl,"-",Kt)),[Zt,Kt,Yn,Gn]})}else if(De in lr){var dn=lr[De],In=cu(dn,function(fn,Wn){var Dn=fn.invoke(Wn,dn);Q.optional(function(){fn.assert(Wn,Dn+"&&typeof "+Dn+'==="object"',"invalid "+De)});var Yn=fn.shared.context,Gn=Wn.def(Dn,".x|0"),Zn=Wn.def(Dn,".y|0"),vi=Wn.def('"width" in ',Dn,"?",Dn,".width|0:","(",Yn,".",Dl,"-",Gn,")"),Ja=Wn.def('"height" in ',Dn,"?",Dn,".height|0:","(",Yn,".",kl,"-",Zn,")");return Q.optional(function(){fn.assert(Wn,vi+">=0&&"+Ja+">=0","invalid "+De)}),[Gn,Zn,vi,Ja]});return we&&(In.thisDep=In.thisDep||we.thisDep,In.contextDep=In.contextDep||we.contextDep,In.propDep=In.propDep||we.propDep),In}else return we?new us(we.thisDep,we.contextDep,we.propDep,function(fn,Wn){var Dn=fn.shared.context;return[0,0,Wn.def(Dn,".",Dl),Wn.def(Dn,".",kl)]}):null}var dt=yt(Ku);if(dt){var it=dt;dt=new us(dt.thisDep,dt.contextDep,dt.propDep,function(De,tt){var Ne=it.append(De,tt),Zt=De.shared.context;return tt.set(Zt,"."+Mh,Ne[2]),tt.set(Zt,"."+Nf,Ne[3]),Ne})}return{viewport:dt,scissor_box:yt(Du)}}function Di(Be,we){var ut=Be.static,zt=typeof ut[pl]=="string"&&typeof ut[Ju]=="string";if(zt){if(Object.keys(we.dynamic).length>0)return null;var lr=we.static,yt=Object.keys(lr);if(yt.length>0&&typeof lr[yt[0]]=="number"){for(var dt=[],it=0;it<yt.length;++it)Q(typeof lr[yt[it]]=="number","must specify all vertex attribute locations when using vaos"),dt.push([lr[yt[it]]|0,yt[it]]);return dt}}return null}function ra(Be,we,ut){var zt=Be.static,lr=Be.dynamic;function yt(Ne){if(Ne in zt){var Zt=Oe.id(zt[Ne]);Q.optional(function(){Qr.shader(dh[Ne],Zt,Q.guessCommand())});var Kt=ls(function(){return Zt});return Kt.id=Zt,Kt}else if(Ne in lr){var Vr=lr[Ne];return cu(Vr,function(cn,dn){var In=cn.invoke(dn,Vr),fn=dn.def(cn.shared.strings,".id(",In,")");return Q.optional(function(){dn(cn.shared.shader,".shader(",dh[Ne],",",fn,",",cn.command,");")}),fn})}return null}var dt=yt(pl),it=yt(Ju),De=null,tt;return Vo(dt)&&Vo(it)?(De=Qr.program(it.id,dt.id,null,ut),tt=ls(function(Ne,Zt){return Ne.link(De)})):tt=new us(dt&&dt.thisDep||it&&it.thisDep,dt&&dt.contextDep||it&&it.contextDep,dt&&dt.propDep||it&&it.propDep,function(Ne,Zt){var Kt=Ne.shared.shader,Vr;dt?Vr=dt.append(Ne,Zt):Vr=Zt.def(Kt,".",pl);var cn;it?cn=it.append(Ne,Zt):cn=Zt.def(Kt,".",Ju);var dn=Kt+".program("+cn+","+Vr;return Q.optional(function(){dn+=","+Ne.command}),Zt.def(dn+")")}),{frag:dt,vert:it,progVar:tt,program:De}}function yo(Be,we){var ut=Be.static,zt=Be.dynamic,lr={},yt=!1;function dt(){if(of in ut){var Wn=ut[of];return Wn!==null&&Jr.getVAO(Wn)===null&&(Wn=Jr.createVAO(Wn)),yt=!0,lr.vao=Wn,ls(function(Yn){var Gn=Jr.getVAO(Wn);return Gn?Yn.link(Gn):"null"})}else if(of in zt){yt=!0;var Dn=zt[of];return cu(Dn,function(Yn,Gn){var Zn=Yn.invoke(Gn,Dn);return Gn.def(Yn.shared.vao+".getVAO("+Zn+")")})}return null}var it=dt(),De=!1;function tt(){if(Ll in ut){var Wn=ut[Ll];if(lr.elements=Wn,Wf(Wn)){var Dn=lr.elements=ar.create(Wn,!0);Wn=ar.getElements(Dn),De=!0}else Wn&&(Wn=ar.getElements(Wn),De=!0,Q.command(Wn,"invalid elements",we.commandStr));var Yn=ls(function(Zn,vi){if(Wn){var Ja=Zn.link(Wn);return Zn.ELEMENTS=Ja,Ja}return Zn.ELEMENTS=null,null});return Yn.value=Wn,Yn}else if(Ll in zt){De=!0;var Gn=zt[Ll];return cu(Gn,function(Zn,vi){var Ja=Zn.shared,Ho=Ja.isBufferArgs,Nl=Ja.elements,Qa=Zn.invoke(vi,Gn),Ra=vi.def("null"),Ns=vi.def(Ho,"(",Qa,")"),qu=Zn.cond(Ns).then(Ra,"=",Nl,".createStream(",Qa,");").else(Ra,"=",Nl,".getElements(",Qa,");");return Q.optional(function(){Zn.assert(qu.else,"!"+Qa+"||"+Ra,"invalid elements")}),vi.entry(qu),vi.exit(Zn.cond(Ns).then(Nl,".destroyStream(",Ra,");")),Zn.ELEMENTS=Ra,Ra})}else if(yt)return new us(it.thisDep,it.contextDep,it.propDep,function(Zn,vi){return vi.def(Zn.shared.vao+".currentVAO?"+Zn.shared.elements+".getElements("+Zn.shared.vao+".currentVAO.elements):null")});return null}var Ne=tt();function Zt(){if(_u in ut){var Wn=ut[_u];return lr.primitive=Wn,Q.commandParameter(Wn,Ir,"invalid primitve",we.commandStr),ls(function(Yn,Gn){return Ir[Wn]})}else if(_u in zt){var Dn=zt[_u];return cu(Dn,function(Yn,Gn){var Zn=Yn.constants.primTypes,vi=Yn.invoke(Gn,Dn);return Q.optional(function(){Yn.assert(Gn,vi+" in "+Zn,"invalid primitive, must be one of "+Object.keys(Ir))}),Gn.def(Zn,"[",vi,"]")})}else{if(De)return Vo(Ne)?Ne.value?ls(function(Yn,Gn){return Gn.def(Yn.ELEMENTS,".primType")}):ls(function(){return Lh}):new us(Ne.thisDep,Ne.contextDep,Ne.propDep,function(Yn,Gn){var Zn=Yn.ELEMENTS;return Gn.def(Zn,"?",Zn,".primType:",Lh)});if(yt)return new us(it.thisDep,it.contextDep,it.propDep,function(Yn,Gn){return Gn.def(Yn.shared.vao+".currentVAO?"+Yn.shared.vao+".currentVAO.primitive:"+Lh)})}return null}function Kt(Wn,Dn){if(Wn in ut){var Yn=ut[Wn]|0;return Dn?lr.offset=Yn:lr.instances=Yn,Q.command(!Dn||Yn>=0,"invalid "+Wn,we.commandStr),ls(function(Zn,vi){return Dn&&(Zn.OFFSET=Yn),Yn})}else if(Wn in zt){var Gn=zt[Wn];return cu(Gn,function(Zn,vi){var Ja=Zn.invoke(vi,Gn);return Dn&&(Zn.OFFSET=Ja,Q.optional(function(){Zn.assert(vi,Ja+">=0","invalid "+Wn)})),Ja})}else if(Dn){if(De)return ls(function(Zn,vi){return Zn.OFFSET=0,0});if(yt)return new us(it.thisDep,it.contextDep,it.propDep,function(Zn,vi){return vi.def(Zn.shared.vao+".currentVAO?"+Zn.shared.vao+".currentVAO.offset:0")})}else if(yt)return new us(it.thisDep,it.contextDep,it.propDep,function(Zn,vi){return vi.def(Zn.shared.vao+".currentVAO?"+Zn.shared.vao+".currentVAO.instances:-1")});return null}var Vr=Kt(Bf,!0);function cn(){if(Mo in ut){var Wn=ut[Mo]|0;return lr.count=Wn,Q.command(typeof Wn=="number"&&Wn>=0,"invalid vertex count",we.commandStr),ls(function(){return Wn})}else if(Mo in zt){var Dn=zt[Mo];return cu(Dn,function(vi,Ja){var Ho=vi.invoke(Ja,Dn);return Q.optional(function(){vi.assert(Ja,"typeof "+Ho+'==="number"&&'+Ho+">=0&&"+Ho+"===("+Ho+"|0)","invalid vertex count")}),Ho})}else if(De)if(Vo(Ne)){if(Ne)return Vr?new us(Vr.thisDep,Vr.contextDep,Vr.propDep,function(vi,Ja){var Ho=Ja.def(vi.ELEMENTS,".vertCount-",vi.OFFSET);return Q.optional(function(){vi.assert(Ja,Ho+">=0","invalid vertex offset/element buffer too small")}),Ho}):ls(function(vi,Ja){return Ja.def(vi.ELEMENTS,".vertCount")});var Yn=ls(function(){return-1});return Q.optional(function(){Yn.MISSING=!0}),Yn}else{var Gn=new us(Ne.thisDep||Vr.thisDep,Ne.contextDep||Vr.contextDep,Ne.propDep||Vr.propDep,function(vi,Ja){var Ho=vi.ELEMENTS;return vi.OFFSET?Ja.def(Ho,"?",Ho,".vertCount-",vi.OFFSET,":-1"):Ja.def(Ho,"?",Ho,".vertCount:-1")});return Q.optional(function(){Gn.DYNAMIC=!0}),Gn}else if(yt){var Zn=new us(it.thisDep,it.contextDep,it.propDep,function(vi,Ja){return Ja.def(vi.shared.vao,".currentVAO?",vi.shared.vao,".currentVAO.count:-1")});return Zn}return null}var dn=Zt(),In=cn(),fn=Kt(Rl,!1);return{elements:Ne,primitive:dn,count:In,instances:fn,offset:Vr,vao:it,vaoActive:yt,elementsActive:De,static:lr}}function Fo(Be,we){var ut=Be.static,zt=Be.dynamic,lr={};return li.forEach(function(yt){var dt=Xn(yt);function it(De,tt){if(yt in ut){var Ne=De(ut[yt]);lr[dt]=ls(function(){return Ne})}else if(yt in zt){var Zt=zt[yt];lr[dt]=cu(Zt,function(Kt,Vr){return tt(Kt,Vr,Kt.invoke(Vr,Zt))})}}switch(yt){case Ya:case Fr:case Qt:case ko:case ui:case Ac:case Ea:case ma:case Ga:case _a:return it(function(De){return Q.commandType(De,"boolean",yt,we.commandStr),De},function(De,tt,Ne){return Q.optional(function(){De.assert(tt,"typeof "+Ne+'==="boolean"',"invalid flag "+yt,De.commandStr)}),Ne});case yi:return it(function(De){return Q.commandParameter(De,vl,"invalid "+yt,we.commandStr),vl[De]},function(De,tt,Ne){var Zt=De.constants.compareFuncs;return Q.optional(function(){De.assert(tt,Ne+" in "+Zt,"invalid "+yt+", must be one of "+Object.keys(vl))}),tt.def(Zt,"[",Ne,"]")});case Ki:return it(function(De){return Q.command(co(De)&&De.length===2&&typeof De[0]=="number"&&typeof De[1]=="number"&&De[0]<=De[1],"depth range is 2d array",we.commandStr),De},function(De,tt,Ne){Q.optional(function(){De.assert(tt,De.shared.isArrayLike+"("+Ne+")&&"+Ne+".length===2&&typeof "+Ne+'[0]==="number"&&typeof '+Ne+'[1]==="number"&&'+Ne+"[0]<="+Ne+"[1]","depth range must be a 2d array")});var Zt=tt.def("+",Ne,"[0]"),Kt=tt.def("+",Ne,"[1]");return[Zt,Kt]});case hi:return it(function(De){Q.commandType(De,"object","blend.func",we.commandStr);var tt="srcRGB"in De?De.srcRGB:De.src,Ne="srcAlpha"in De?De.srcAlpha:De.src,Zt="dstRGB"in De?De.dstRGB:De.dst,Kt="dstAlpha"in De?De.dstAlpha:De.dst;return Q.commandParameter(tt,Fl,dt+".srcRGB",we.commandStr),Q.commandParameter(Ne,Fl,dt+".srcAlpha",we.commandStr),Q.commandParameter(Zt,Fl,dt+".dstRGB",we.commandStr),Q.commandParameter(Kt,Fl,dt+".dstAlpha",we.commandStr),Q.command(Fh.indexOf(tt+", "+Zt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+tt+", "+Zt+")",we.commandStr),[Fl[tt],Fl[Zt],Fl[Ne],Fl[Kt]]},function(De,tt,Ne){var Zt=De.constants.blendFuncs;Q.optional(function(){De.assert(tt,Ne+"&&typeof "+Ne+'==="object"',"invalid blend func, must be an object")});function Kt(Dn,Yn){var Gn=tt.def('"',Dn,Yn,'" in ',Ne,"?",Ne,".",Dn,Yn,":",Ne,".",Dn);return Q.optional(function(){De.assert(tt,Gn+" in "+Zt,"invalid "+yt+"."+Dn+Yn+", must be one of "+Object.keys(Fl))}),Gn}var Vr=Kt("src","RGB"),cn=Kt("dst","RGB");Q.optional(function(){var Dn=De.constants.invalidBlendCombinations;De.assert(tt,Dn+".indexOf("+Vr+'+", "+'+cn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var dn=tt.def(Zt,"[",Vr,"]"),In=tt.def(Zt,"[",Kt("src","Alpha"),"]"),fn=tt.def(Zt,"[",cn,"]"),Wn=tt.def(Zt,"[",Kt("dst","Alpha"),"]");return[dn,fn,In,Wn]});case zn:return it(function(De){if(typeof De=="string")return Q.commandParameter(De,_r,"invalid "+yt,we.commandStr),[_r[De],_r[De]];if(typeof De=="object")return Q.commandParameter(De.rgb,_r,yt+".rgb",we.commandStr),Q.commandParameter(De.alpha,_r,yt+".alpha",we.commandStr),[_r[De.rgb],_r[De.alpha]];Q.commandRaise("invalid blend.equation",we.commandStr)},function(De,tt,Ne){var Zt=De.constants.blendEquations,Kt=tt.def(),Vr=tt.def(),cn=De.cond("typeof ",Ne,'==="string"');return Q.optional(function(){function dn(In,fn,Wn){De.assert(In,Wn+" in "+Zt,"invalid "+fn+", must be one of "+Object.keys(_r))}dn(cn.then,yt,Ne),De.assert(cn.else,Ne+"&&typeof "+Ne+'==="object"',"invalid "+yt),dn(cn.else,yt+".rgb",Ne+".rgb"),dn(cn.else,yt+".alpha",Ne+".alpha")}),cn.then(Kt,"=",Vr,"=",Zt,"[",Ne,"];"),cn.else(Kt,"=",Zt,"[",Ne,".rgb];",Vr,"=",Zt,"[",Ne,".alpha];"),tt(cn),[Kt,Vr]});case Bn:return it(function(De){return Q.command(co(De)&&De.length===4,"blend.color must be a 4d array",we.commandStr),de(4,function(tt){return+De[tt]})},function(De,tt,Ne){return Q.optional(function(){De.assert(tt,De.shared.isArrayLike+"("+Ne+")&&"+Ne+".length===4","blend.color must be a 4d array")}),de(4,function(Zt){return tt.def("+",Ne,"[",Zt,"]")})});case Zi:return it(function(De){return Q.commandType(De,"number",dt,we.commandStr),De|0},function(De,tt,Ne){return Q.optional(function(){De.assert(tt,"typeof "+Ne+'==="number"',"invalid stencil.mask")}),tt.def(Ne,"|0")});case $o:return it(function(De){Q.commandType(De,"object",dt,we.commandStr);var tt=De.cmp||"keep",Ne=De.ref||0,Zt="mask"in De?De.mask:-1;return Q.commandParameter(tt,vl,yt+".cmp",we.commandStr),Q.commandType(Ne,"number",yt+".ref",we.commandStr),Q.commandType(Zt,"number",yt+".mask",we.commandStr),[vl[tt],Ne,Zt]},function(De,tt,Ne){var Zt=De.constants.compareFuncs;Q.optional(function(){function dn(){De.assert(tt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}dn(Ne+"&&typeof ",Ne,'==="object"'),dn('!("cmp" in ',Ne,")||(",Ne,".cmp in ",Zt,")")});var Kt=tt.def('"cmp" in ',Ne,"?",Zt,"[",Ne,".cmp]",":",Gc),Vr=tt.def(Ne,".ref|0"),cn=tt.def('"mask" in ',Ne,"?",Ne,".mask|0:-1");return[Kt,Vr,cn]});case Po:case To:return it(function(De){Q.commandType(De,"object",dt,we.commandStr);var tt=De.fail||"keep",Ne=De.zfail||"keep",Zt=De.zpass||"keep";return Q.commandParameter(tt,Bl,yt+".fail",we.commandStr),Q.commandParameter(Ne,Bl,yt+".zfail",we.commandStr),Q.commandParameter(Zt,Bl,yt+".zpass",we.commandStr),[yt===To?dl:hc,Bl[tt],Bl[Ne],Bl[Zt]]},function(De,tt,Ne){var Zt=De.constants.stencilOps;Q.optional(function(){De.assert(tt,Ne+"&&typeof "+Ne+'==="object"',"invalid "+yt)});function Kt(Vr){return Q.optional(function(){De.assert(tt,'!("'+Vr+'" in '+Ne+")||("+Ne+"."+Vr+" in "+Zt+")","invalid "+yt+"."+Vr+", must be one of "+Object.keys(Bl))}),tt.def('"',Vr,'" in ',Ne,"?",Zt,"[",Ne,".",Vr,"]:",Gc)}return[yt===To?dl:hc,Kt("fail"),Kt("zfail"),Kt("zpass")]});case fa:return it(function(De){Q.commandType(De,"object",dt,we.commandStr);var tt=De.factor|0,Ne=De.units|0;return Q.commandType(tt,"number",dt+".factor",we.commandStr),Q.commandType(Ne,"number",dt+".units",we.commandStr),[tt,Ne]},function(De,tt,Ne){Q.optional(function(){De.assert(tt,Ne+"&&typeof "+Ne+'==="object"',"invalid "+yt)});var Zt=tt.def(Ne,".factor|0"),Kt=tt.def(Ne,".units|0");return[Zt,Kt]});case Na:return it(function(De){var tt=0;return De==="front"?tt=hc:De==="back"&&(tt=dl),Q.command(!!tt,dt,we.commandStr),tt},function(De,tt,Ne){return Q.optional(function(){De.assert(tt,Ne+'==="front"||'+Ne+'==="back"',"invalid cull.face")}),tt.def(Ne,'==="front"?',hc,":",dl)});case La:return it(function(De){return Q.command(typeof De=="number"&&De>=ur.lineWidthDims[0]&&De<=ur.lineWidthDims[1],"invalid line width, must be a positive number between "+ur.lineWidthDims[0]+" and "+ur.lineWidthDims[1],we.commandStr),De},function(De,tt,Ne){return Q.optional(function(){De.assert(tt,"typeof "+Ne+'==="number"&&'+Ne+">="+ur.lineWidthDims[0]+"&&"+Ne+"<="+ur.lineWidthDims[1],"invalid line width")}),Ne});case wo:return it(function(De){return Q.commandParameter(De,vh,dt,we.commandStr),vh[De]},function(De,tt,Ne){return Q.optional(function(){De.assert(tt,Ne+'==="cw"||'+Ne+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),tt.def(Ne+'==="cw"?'+Rh+":"+Dh)});case xa:return it(function(De){return Q.command(co(De)&&De.length===4,"color.mask must be length 4 array",we.commandStr),De.map(function(tt){return!!tt})},function(De,tt,Ne){return Q.optional(function(){De.assert(tt,De.shared.isArrayLike+"("+Ne+")&&"+Ne+".length===4","invalid color.mask")}),de(4,function(Zt){return"!!"+Ne+"["+Zt+"]"})});case za:return it(function(De){Q.command(typeof De=="object"&&De,dt,we.commandStr);var tt="value"in De?De.value:1,Ne=!!De.invert;return Q.command(typeof tt=="number"&&tt>=0&&tt<=1,"sample.coverage.value must be a number between 0 and 1",we.commandStr),[tt,Ne]},function(De,tt,Ne){Q.optional(function(){De.assert(tt,Ne+"&&typeof "+Ne+'==="object"',"invalid sample.coverage")});var Zt=tt.def('"value" in ',Ne,"?+",Ne,".value:1"),Kt=tt.def("!!",Ne,".invert");return[Zt,Kt]})}}),lr}function da(Be,we){var ut=Be.static,zt=Be.dynamic,lr={};return Object.keys(ut).forEach(function(yt){var dt=ut[yt],it;if(typeof dt=="number"||typeof dt=="boolean")it=ls(function(){return dt});else if(typeof dt=="function"){var De=dt._reglType;De==="texture2d"||De==="textureCube"?it=ls(function(tt){return tt.link(dt)}):De==="framebuffer"||De==="framebufferCube"?(Q.command(dt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+yt+'"',we.commandStr),it=ls(function(tt){return tt.link(dt.color[0])})):Q.commandRaise('invalid data for uniform "'+yt+'"',we.commandStr)}else co(dt)?it=ls(function(tt){var Ne=tt.global.def("[",de(dt.length,function(Zt){return Q.command(typeof dt[Zt]=="number"||typeof dt[Zt]=="boolean","invalid uniform "+yt,tt.commandStr),dt[Zt]}),"]");return Ne}):Q.commandRaise('invalid or missing data for uniform "'+yt+'"',we.commandStr);it.value=dt,lr[yt]=it}),Object.keys(zt).forEach(function(yt){var dt=zt[yt];lr[yt]=cu(dt,function(it,De){return it.invoke(De,dt)})}),lr}function bs(Be,we){var ut=Be.static,zt=Be.dynamic,lr={};return Object.keys(ut).forEach(function(yt){var dt=ut[yt],it=Oe.id(yt),De=new Nt;if(Wf(dt))De.state=ee,De.buffer=Dr.getBuffer(Dr.create(dt,uf,!1,!0)),De.type=0;else{var tt=Dr.getBuffer(dt);if(tt)De.state=ee,De.buffer=tt,De.type=0;else if(Q.command(typeof dt=="object"&&dt,"invalid data for attribute "+yt,we.commandStr),"constant"in dt){var Ne=dt.constant;De.buffer="null",De.state=ne,typeof Ne=="number"?De.x=Ne:(Q.command(co(Ne)&&Ne.length>0&&Ne.length<=4,"invalid constant for attribute "+yt,we.commandStr),Si.forEach(function(fn,Wn){Wn<Ne.length&&(De[fn]=Ne[Wn])}))}else{Wf(dt.buffer)?tt=Dr.getBuffer(Dr.create(dt.buffer,uf,!1,!0)):tt=Dr.getBuffer(dt.buffer),Q.command(!!tt,'missing buffer for attribute "'+yt+'"',we.commandStr);var Zt=dt.offset|0;Q.command(Zt>=0,'invalid offset for attribute "'+yt+'"',we.commandStr);var Kt=dt.stride|0;Q.command(Kt>=0&&Kt<256,'invalid stride for attribute "'+yt+'", must be integer betweeen [0, 255]',we.commandStr);var Vr=dt.size|0;Q.command(!("size"in dt)||Vr>0&&Vr<=4,'invalid size for attribute "'+yt+'", must be 1,2,3,4',we.commandStr);var cn=!!dt.normalized,dn=0;"type"in dt&&(Q.commandParameter(dt.type,Bs,"invalid type for attribute "+yt,we.commandStr),dn=Bs[dt.type]);var In=dt.divisor|0;Q.optional(function(){"divisor"in dt&&(Q.command(In===0||Kr,'cannot specify divisor for attribute "'+yt+'", instancing not supported',we.commandStr),Q.command(In>=0,'invalid divisor for attribute "'+yt+'"',we.commandStr));var fn=we.commandStr,Wn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(dt).forEach(function(Dn){Q.command(Wn.indexOf(Dn)>=0,'unknown parameter "'+Dn+'" for attribute pointer "'+yt+'" (valid parameters are '+Wn+")",fn)})}),De.buffer=tt,De.state=ee,De.size=Vr,De.normalized=cn,De.type=dn||tt.dtype,De.offset=Zt,De.stride=Kt,De.divisor=In}}lr[yt]=ls(function(fn,Wn){var Dn=fn.attribCache;if(it in Dn)return Dn[it];var Yn={isStream:!1};return Object.keys(De).forEach(function(Gn){Yn[Gn]=De[Gn]}),De.buffer&&(Yn.buffer=fn.link(De.buffer),Yn.type=Yn.type||Yn.buffer+".dtype"),Dn[it]=Yn,Yn})}),Object.keys(zt).forEach(function(yt){var dt=zt[yt];function it(De,tt){var Ne=De.invoke(tt,dt),Zt=De.shared,Kt=De.constants,Vr=Zt.isBufferArgs,cn=Zt.buffer;Q.optional(function(){De.assert(tt,Ne+"&&(typeof "+Ne+'==="object"||typeof '+Ne+'==="function")&&('+Vr+"("+Ne+")||"+cn+".getBuffer("+Ne+")||"+cn+".getBuffer("+Ne+".buffer)||"+Vr+"("+Ne+'.buffer)||("constant" in '+Ne+"&&(typeof "+Ne+'.constant==="number"||'+Zt.isArrayLike+"("+Ne+".constant))))",'invalid dynamic attribute "'+yt+'"')});var dn={isStream:tt.def(!1)},In=new Nt;In.state=ee,Object.keys(In).forEach(function(Yn){dn[Yn]=tt.def(""+In[Yn])});var fn=dn.buffer,Wn=dn.type;tt("if(",Vr,"(",Ne,")){",dn.isStream,"=true;",fn,"=",cn,".createStream(",uf,",",Ne,");",Wn,"=",fn,".dtype;","}else{",fn,"=",cn,".getBuffer(",Ne,");","if(",fn,"){",Wn,"=",fn,".dtype;",'}else if("constant" in ',Ne,"){",dn.state,"=",ne,";","if(typeof "+Ne+'.constant === "number"){',dn[Si[0]],"=",Ne,".constant;",Si.slice(1).map(function(Yn){return dn[Yn]}).join("="),"=0;","}else{",Si.map(function(Yn,Gn){return dn[Yn]+"="+Ne+".constant.length>"+Gn+"?"+Ne+".constant["+Gn+"]:0;"}).join(""),"}}else{","if(",Vr,"(",Ne,".buffer)){",fn,"=",cn,".createStream(",uf,",",Ne,".buffer);","}else{",fn,"=",cn,".getBuffer(",Ne,".buffer);","}",Wn,'="type" in ',Ne,"?",Kt.glTypes,"[",Ne,".type]:",fn,".dtype;",dn.normalized,"=!!",Ne,".normalized;");function Dn(Yn){tt(dn[Yn],"=",Ne,".",Yn,"|0;")}return Dn("size"),Dn("offset"),Dn("stride"),Dn("divisor"),tt("}}"),tt.exit("if(",dn.isStream,"){",cn,".destroyStream(",fn,");","}"),dn}lr[yt]=cu(dt,it)}),lr}function ho(Be){var we=Be.static,ut=Be.dynamic,zt={};return Object.keys(we).forEach(function(lr){var yt=we[lr];zt[lr]=ls(function(dt,it){return typeof yt=="number"||typeof yt=="boolean"?""+yt:dt.link(yt)})}),Object.keys(ut).forEach(function(lr){var yt=ut[lr];zt[lr]=cu(yt,function(dt,it){return dt.invoke(it,yt)})}),zt}function $a(Be,we,ut,zt,lr){var yt=Be.static,dt=Be.dynamic;Q.optional(function(){var Dn=[Ol,Ju,pl,Ll,_u,Bf,Mo,Rl,$u,of].concat(li);function Yn(Gn){Object.keys(Gn).forEach(function(Zn){Q.command(Dn.indexOf(Zn)>=0,'unknown parameter "'+Zn+'"',lr.commandStr)})}Yn(yt),Yn(dt)});var it=Di(Be,we),De=Cn(Be,lr),tt=Ei(Be,De,lr),Ne=yo(Be,lr),Zt=Fo(Be,lr),Kt=ra(Be,lr,it);function Vr(Dn){var Yn=tt[Dn];Yn&&(Zt[Dn]=Yn)}Vr(Ku),Vr(Xn(Du));var cn=Object.keys(Zt).length>0,dn={framebuffer:De,draw:Ne,shader:Kt,state:Zt,dirty:cn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(dn.profile=Pn(Be,lr),dn.uniforms=da(ut,lr),dn.drawVAO=dn.scopeVAO=Ne.vao,!dn.drawVAO&&Kt.program&&!it&&et.angle_instanced_arrays&&Ne.static.elements){var In=!0,fn=Kt.program.attributes.map(function(Dn){var Yn=we.static[Dn];return In=In&&!!Yn,Yn});if(In&&fn.length>0){var Wn=Jr.getVAO(Jr.createVAO({attributes:fn,elements:Ne.static.elements}));dn.drawVAO=new us(null,null,null,function(Dn,Yn){return Dn.link(Wn)}),dn.useVAO=!0}}return it?dn.useVAO=!0:dn.attributes=bs(we,lr),dn.context=ho(zt,lr),dn}function Io(Be,we,ut){var zt=Be.shared,lr=zt.context,yt=Be.scope();Object.keys(ut).forEach(function(dt){we.save(lr,"."+dt);var it=ut[dt],De=it.append(Be,we);Array.isArray(De)?yt(lr,".",dt,"=[",De.join(),"];"):yt(lr,".",dt,"=",De,";")}),we(yt)}function cs(Be,we,ut,zt){var lr=Be.shared,yt=lr.gl,dt=lr.framebuffer,it;Ln&&(it=we.def(lr.extensions,".webgl_draw_buffers"));var De=Be.constants,tt=De.drawBuffer,Ne=De.backBuffer,Zt;ut?Zt=ut.append(Be,we):Zt=we.def(dt,".next"),zt||we("if(",Zt,"!==",dt,".cur){"),we("if(",Zt,"){",yt,".bindFramebuffer(",Qu,",",Zt,".framebuffer);"),Ln&&we(it,".drawBuffersWEBGL(",tt,"[",Zt,".colorAttachments.length]);"),we("}else{",yt,".bindFramebuffer(",Qu,",null);"),Ln&&we(it,".drawBuffersWEBGL(",Ne,");"),we("}",dt,".cur=",Zt,";"),zt||we("}")}function fs(Be,we,ut){var zt=Be.shared,lr=zt.gl,yt=Be.current,dt=Be.next,it=zt.current,De=zt.next,tt=Be.cond(it,".dirty");li.forEach(function(Ne){var Zt=Xn(Ne);if(!(Zt in ut.state)){var Kt,Vr;if(Zt in dt){Kt=dt[Zt],Vr=yt[Zt];var cn=de(Sn[Zt].length,function(In){return tt.def(Kt,"[",In,"]")});tt(Be.cond(cn.map(function(In,fn){return In+"!=="+Vr+"["+fn+"]"}).join("||")).then(lr,".",Tr[Zt],"(",cn,");",cn.map(function(In,fn){return Vr+"["+fn+"]="+In}).join(";"),";"))}else{Kt=tt.def(De,".",Zt);var dn=Be.cond(Kt,"!==",it,".",Zt);tt(dn),Zt in Lr?dn(Be.cond(Kt).then(lr,".enable(",Lr[Zt],");").else(lr,".disable(",Lr[Zt],");"),it,".",Zt,"=",Kt,";"):dn(lr,".",Tr[Zt],"(",Kt,");",it,".",Zt,"=",Kt,";")}}}),Object.keys(ut.state).length===0&&tt(it,".dirty=false;"),we(tt)}function Ss(Be,we,ut,zt){var lr=Be.shared,yt=Be.current,dt=lr.current,it=lr.gl;Bh(Object.keys(ut)).forEach(function(De){var tt=ut[De];if(!(zt&&!zt(tt))){var Ne=tt.append(Be,we);if(Lr[De]){var Zt=Lr[De];Vo(tt)?Ne?we(it,".enable(",Zt,");"):we(it,".disable(",Zt,");"):we(Be.cond(Ne).then(it,".enable(",Zt,");").else(it,".disable(",Zt,");")),we(dt,".",De,"=",Ne,";")}else if(co(Ne)){var Kt=yt[De];we(it,".",Tr[De],"(",Ne,");",Ne.map(function(Vr,cn){return Kt+"["+cn+"]="+Vr}).join(";"),";")}else we(it,".",Tr[De],"(",Ne,");",dt,".",De,"=",Ne,";")}})}function Go(Be,we){Kr&&(Be.instancing=we.def(Be.shared.extensions,".angle_instanced_arrays"))}function $i(Be,we,ut,zt,lr){var yt=Be.shared,dt=Be.stats,it=yt.current,De=yt.timer,tt=ut.profile;function Ne(){var Dn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return Dn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Zt,Kt;function Vr(Dn){Zt=we.def(),Dn(Zt,"=",Ne(),";"),typeof lr=="string"?Dn(dt,".count+=",lr,";"):Dn(dt,".count++;"),Xr&&(zt?(Kt=we.def(),Dn(Kt,"=",De,".getNumPendingQueries();")):Dn(De,".beginQuery(",dt,");"))}function cn(Dn){Dn(dt,".cpuTime+=",Ne(),"-",Zt,";"),Xr&&(zt?Dn(De,".pushScopeStats(",Kt,",",De,".getNumPendingQueries(),",dt,");"):Dn(De,".endQuery();"))}function dn(Dn){var Yn=we.def(it,".profile");we(it,".profile=",Dn,";"),we.exit(it,".profile=",Yn,";")}var In;if(tt){if(Vo(tt)){tt.enable?(Vr(we),cn(we.exit),dn("true")):dn("false");return}In=tt.append(Be,we),dn(In)}else In=we.def(it,".profile");var fn=Be.block();Vr(fn),we("if(",In,"){",fn,"}");var Wn=Be.block();cn(Wn),we.exit("if(",In,"){",Wn,"}")}function Jo(Be,we,ut,zt,lr){var yt=Be.shared;function dt(De){switch(De){case Zf:case Tf:case fc:return 2;case wf:case fh:case hh:return 3;case Mc:case Vc:case lf:return 4;default:return 1}}function it(De,tt,Ne){var Zt=yt.gl,Kt=we.def(De,".location"),Vr=we.def(yt.attributes,"[",Kt,"]"),cn=Ne.state,dn=Ne.buffer,In=[Ne.x,Ne.y,Ne.z,Ne.w],fn=["buffer","normalized","offset","stride"];function Wn(){we("if(!",Vr,".buffer){",Zt,".enableVertexAttribArray(",Kt,");}");var Yn=Ne.type,Gn;if(Ne.size?Gn=we.def(Ne.size,"||",tt):Gn=tt,we("if(",Vr,".type!==",Yn,"||",Vr,".size!==",Gn,"||",fn.map(function(vi){return Vr+"."+vi+"!=="+Ne[vi]}).join("||"),"){",Zt,".bindBuffer(",uf,",",dn,".buffer);",Zt,".vertexAttribPointer(",[Kt,Gn,Yn,Ne.normalized,Ne.stride,Ne.offset],");",Vr,".type=",Yn,";",Vr,".size=",Gn,";",fn.map(function(vi){return Vr+"."+vi+"="+Ne[vi]+";"}).join(""),"}"),Kr){var Zn=Ne.divisor;we("if(",Vr,".divisor!==",Zn,"){",Be.instancing,".vertexAttribDivisorANGLE(",[Kt,Zn],");",Vr,".divisor=",Zn,";}")}}function Dn(){we("if(",Vr,".buffer){",Zt,".disableVertexAttribArray(",Kt,");",Vr,".buffer=null;","}if(",Si.map(function(Yn,Gn){return Vr+"."+Yn+"!=="+In[Gn]}).join("||"),"){",Zt,".vertexAttrib4f(",Kt,",",In,");",Si.map(function(Yn,Gn){return Vr+"."+Yn+"="+In[Gn]+";"}).join(""),"}")}cn===ee?Wn():cn===ne?Dn():(we("if(",cn,"===",ee,"){"),Wn(),we("}else{"),Dn(),we("}"))}zt.forEach(function(De){var tt=De.name,Ne=ut.attributes[tt],Zt;if(Ne){if(!lr(Ne))return;Zt=Ne.append(Be,we)}else{if(!lr(Xf))return;var Kt=Be.scopeAttrib(tt);Q.optional(function(){Be.assert(we,Kt+".state","missing attribute "+tt)}),Zt={},Object.keys(new Nt).forEach(function(Vr){Zt[Vr]=we.def(Kt,".",Vr)})}it(Be.link(De),dt(De.info.type),Zt)})}function Ma(Be,we,ut,zt,lr,yt){for(var dt=Be.shared,it=dt.gl,De,tt=0;tt<zt.length;++tt){var Ne=zt[tt],Zt=Ne.name,Kt=Ne.info.type,Vr=ut.uniforms[Zt],cn=Be.link(Ne),dn=cn+".location",In;if(Vr){if(!lr(Vr))continue;if(Vo(Vr)){var fn=Vr.value;if(Q.command(fn!==null&&typeof fn!="undefined",'missing uniform "'+Zt+'"',Be.commandStr),Kt===Gf||Kt===ff){Q.command(typeof fn=="function"&&(Kt===Gf&&(fn._reglType==="texture2d"||fn._reglType==="framebuffer")||Kt===ff&&(fn._reglType==="textureCube"||fn._reglType==="framebufferCube")),"invalid texture for uniform "+Zt,Be.commandStr);var Wn=Be.link(fn._texture||fn.color[0]._texture);we(it,".uniform1i(",dn,",",Wn+".bind());"),we.exit(Wn,".unbind();")}else if(Kt===cf||Kt===lu||Kt===Vf){Q.optional(function(){Q.command(co(fn),"invalid matrix for uniform "+Zt,Be.commandStr),Q.command(Kt===cf&&fn.length===4||Kt===lu&&fn.length===9||Kt===Vf&&fn.length===16,"invalid length for matrix uniform "+Zt,Be.commandStr)});var Dn=Be.global.def("new Float32Array(["+Array.prototype.slice.call(fn)+"])"),Yn=2;Kt===lu?Yn=3:Kt===Vf&&(Yn=4),we(it,".uniformMatrix",Yn,"fv(",dn,",false,",Dn,");")}else{switch(Kt){case Pc:Q.commandType(fn,"number","uniform "+Zt,Be.commandStr),De="1f";break;case Zf:Q.command(co(fn)&&fn.length===2,"uniform "+Zt,Be.commandStr),De="2f";break;case wf:Q.command(co(fn)&&fn.length===3,"uniform "+Zt,Be.commandStr),De="3f";break;case Mc:Q.command(co(fn)&&fn.length===4,"uniform "+Zt,Be.commandStr),De="4f";break;case Oh:Q.commandType(fn,"boolean","uniform "+Zt,Be.commandStr),De="1i";break;case jf:Q.commandType(fn,"number","uniform "+Zt,Be.commandStr),De="1i";break;case fc:Q.command(co(fn)&&fn.length===2,"uniform "+Zt,Be.commandStr),De="2i";break;case Tf:Q.command(co(fn)&&fn.length===2,"uniform "+Zt,Be.commandStr),De="2i";break;case hh:Q.command(co(fn)&&fn.length===3,"uniform "+Zt,Be.commandStr),De="3i";break;case fh:Q.command(co(fn)&&fn.length===3,"uniform "+Zt,Be.commandStr),De="3i";break;case lf:Q.command(co(fn)&&fn.length===4,"uniform "+Zt,Be.commandStr),De="4i";break;case Vc:Q.command(co(fn)&&fn.length===4,"uniform "+Zt,Be.commandStr),De="4i";break}we(it,".uniform",De,"(",dn,",",co(fn)?Array.prototype.slice.call(fn):fn,");")}continue}else In=Vr.append(Be,we)}else{if(!lr(Xf))continue;In=we.def(dt.uniforms,"[",Oe.id(Zt),"]")}Kt===Gf?(Q(!Array.isArray(In),"must specify a scalar prop for textures"),we("if(",In,"&&",In,'._reglType==="framebuffer"){',In,"=",In,".color[0];","}")):Kt===ff&&(Q(!Array.isArray(In),"must specify a scalar prop for cube maps"),we("if(",In,"&&",In,'._reglType==="framebufferCube"){',In,"=",In,".color[0];","}")),Q.optional(function(){function Ns(ku,$f){Be.assert(we,ku,'bad data or missing for uniform "'+Zt+'".  '+$f)}function qu(ku){Q(!Array.isArray(In),"must not specify an array type for uniform"),Ns("typeof "+In+'==="'+ku+'"',"invalid type, expected "+ku)}function bu(ku,$f){Array.isArray(In)?Q(In.length===ku,"must have length "+ku):Ns(dt.isArrayLike+"("+In+")&&"+In+".length==="+ku,"invalid vector, should have length "+ku,Be.commandStr)}function Kf(ku){Q(!Array.isArray(In),"must not specify a value type"),Ns("typeof "+In+'==="function"&&'+In+'._reglType==="texture'+(ku===lp?"2d":"Cube")+'"',"invalid texture type",Be.commandStr)}switch(Kt){case jf:qu("number");break;case Tf:bu(2,"number");break;case fh:bu(3,"number");break;case Vc:bu(4,"number");break;case Pc:qu("number");break;case Zf:bu(2,"number");break;case wf:bu(3,"number");break;case Mc:bu(4,"number");break;case Oh:qu("boolean");break;case fc:bu(2,"boolean");break;case hh:bu(3,"boolean");break;case lf:bu(4,"boolean");break;case cf:bu(4,"number");break;case lu:bu(9,"number");break;case Vf:bu(16,"number");break;case Gf:Kf(lp);break;case ff:Kf(Up);break}});var Gn=1;switch(Kt){case Gf:case ff:var Zn=we.def(In,"._texture");we(it,".uniform1i(",dn,",",Zn,".bind());"),we.exit(Zn,".unbind();");continue;case jf:case Oh:De="1i";break;case Tf:case fc:De="2i",Gn=2;break;case fh:case hh:De="3i",Gn=3;break;case Vc:case lf:De="4i",Gn=4;break;case Pc:De="1f";break;case Zf:De="2f",Gn=2;break;case wf:De="3f",Gn=3;break;case Mc:De="4f",Gn=4;break;case cf:De="Matrix2fv";break;case lu:De="Matrix3fv";break;case Vf:De="Matrix4fv";break}if(De.charAt(0)==="M"){we(it,".uniform",De,"(",dn,",");var vi=Math.pow(Kt-cf+2,2),Ja=Be.global.def("new Float32Array(",vi,")");Array.isArray(In)?we("false,(",de(vi,function(Ns){return Ja+"["+Ns+"]="+In[Ns]}),",",Ja,")"):we("false,(Array.isArray(",In,")||",In," instanceof Float32Array)?",In,":(",de(vi,function(Ns){return Ja+"["+Ns+"]="+In+"["+Ns+"]"}),",",Ja,")"),we(");")}else if(Gn>1){for(var Ho=[],Nl=[],Qa=0;Qa<Gn;++Qa)Array.isArray(In)?Nl.push(In[Qa]):Nl.push(we.def(In+"["+Qa+"]")),yt&&Ho.push(we.def());yt&&we("if(!",Be.batchId,"||",Ho.map(function(Ns,qu){return Ns+"!=="+Nl[qu]}).join("||"),"){",Ho.map(function(Ns,qu){return Ns+"="+Nl[qu]+";"}).join("")),we(it,".uniform",De,"(",dn,",",Nl.join(","),");"),yt&&we("}")}else{if(Q(!Array.isArray(In),"uniform value must not be an array"),yt){var Ra=we.def();we("if(!",Be.batchId,"||",Ra,"!==",In,"){",Ra,"=",In,";")}we(it,".uniform",De,"(",dn,",",In,");"),yt&&we("}")}}}function _o(Be,we,ut,zt){var lr=Be.shared,yt=lr.gl,dt=lr.draw,it=zt.draw;function De(){var Gn=it.elements,Zn,vi=we;return Gn?((Gn.contextDep&&zt.contextDynamic||Gn.propDep)&&(vi=ut),Zn=Gn.append(Be,vi),it.elementsActive&&vi("if("+Zn+")"+yt+".bindBuffer("+cc+","+Zn+".buffer.buffer);")):(Zn=vi.def(),vi(Zn,"=",dt,".",Ll,";","if(",Zn,"){",yt,".bindBuffer(",cc,",",Zn,".buffer.buffer);}","else if(",lr.vao,".currentVAO){",Zn,"=",Be.shared.elements+".getElements("+lr.vao,".currentVAO.elements);",Or?"":"if("+Zn+")"+yt+".bindBuffer("+cc+","+Zn+".buffer.buffer);","}")),Zn}function tt(){var Gn=it.count,Zn,vi=we;return Gn?((Gn.contextDep&&zt.contextDynamic||Gn.propDep)&&(vi=ut),Zn=Gn.append(Be,vi),Q.optional(function(){Gn.MISSING&&Be.assert(we,"false","missing vertex count"),Gn.DYNAMIC&&Be.assert(vi,Zn+">=0","missing vertex count")})):(Zn=vi.def(dt,".",Mo),Q.optional(function(){Be.assert(vi,Zn+">=0","missing vertex count")})),Zn}var Ne=De();function Zt(Gn){var Zn=it[Gn];return Zn?Zn.contextDep&&zt.contextDynamic||Zn.propDep?Zn.append(Be,ut):Zn.append(Be,we):we.def(dt,".",Gn)}var Kt=Zt(_u),Vr=Zt(Bf),cn=tt();if(typeof cn=="number"){if(cn===0)return}else ut("if(",cn,"){"),ut.exit("}");var dn,In;Kr&&(dn=Zt(Rl),In=Be.instancing);var fn=Ne+".type",Wn=it.elements&&Vo(it.elements)&&!it.vaoActive;function Dn(){function Gn(){ut(In,".drawElementsInstancedANGLE(",[Kt,cn,fn,Vr+"<<(("+fn+"-"+Ui+")>>1)",dn],");")}function Zn(){ut(In,".drawArraysInstancedANGLE(",[Kt,Vr,cn,dn],");")}Ne&&Ne!=="null"?Wn?Gn():(ut("if(",Ne,"){"),Gn(),ut("}else{"),Zn(),ut("}")):Zn()}function Yn(){function Gn(){ut(yt+".drawElements("+[Kt,cn,fn,Vr+"<<(("+fn+"-"+Ui+")>>1)"]+");")}function Zn(){ut(yt+".drawArrays("+[Kt,Vr,cn]+");")}Ne&&Ne!=="null"?Wn?Gn():(ut("if(",Ne,"){"),Gn(),ut("}else{"),Zn(),ut("}")):Zn()}Kr&&(typeof dn!="number"||dn>=0)?typeof dn=="string"?(ut("if(",dn,">0){"),Dn(),ut("}else if(",dn,"<0){"),Yn(),ut("}")):Dn():Yn()}function _i(Be,we,ut,zt,lr){var yt=Ri(),dt=yt.proc("body",lr);return Q.optional(function(){yt.commandStr=we.commandStr,yt.command=yt.link(we.commandStr)}),Kr&&(yt.instancing=dt.def(yt.shared.extensions,".angle_instanced_arrays")),Be(yt,dt,ut,zt),yt.compile().body}function pa(Be,we,ut,zt){Go(Be,we),ut.useVAO?ut.drawVAO?we(Be.shared.vao,".setVAO(",ut.drawVAO.append(Be,we),");"):we(Be.shared.vao,".setVAO(",Be.shared.vao,".targetVAO);"):(we(Be.shared.vao,".setVAO(null);"),Jo(Be,we,ut,zt.attributes,function(){return!0})),Ma(Be,we,ut,zt.uniforms,function(){return!0},!1),_o(Be,we,we,ut)}function no(Be,we){var ut=Be.proc("draw",1);Go(Be,ut),Io(Be,ut,we.context),cs(Be,ut,we.framebuffer),fs(Be,ut,we),Ss(Be,ut,we.state),$i(Be,ut,we,!1,!0);var zt=we.shader.progVar.append(Be,ut);if(ut(Be.shared.gl,".useProgram(",zt,".program);"),we.shader.program)pa(Be,ut,we,we.shader.program);else{ut(Be.shared.vao,".setVAO(null);");var lr=Be.global.def("{}"),yt=ut.def(zt,".id"),dt=ut.def(lr,"[",yt,"]");ut(Be.cond(dt).then(dt,".call(this,a0);").else(dt,"=",lr,"[",yt,"]=",Be.link(function(it){return _i(pa,Be,we,it,1)}),"(",zt,");",dt,".call(this,a0);"))}Object.keys(we.state).length>0&&ut(Be.shared.current,".dirty=true;"),Be.shared.vao&&ut(Be.shared.vao,".setVAO(null);")}function xo(Be,we,ut,zt){Be.batchId="a1",Go(Be,we);function lr(){return!0}Jo(Be,we,ut,zt.attributes,lr),Ma(Be,we,ut,zt.uniforms,lr,!1),_o(Be,we,we,ut)}function xu(Be,we,ut,zt){Go(Be,we);var lr=ut.contextDep,yt=we.def(),dt="a0",it="a1",De=we.def();Be.shared.props=De,Be.batchId=yt;var tt=Be.scope(),Ne=Be.scope();we(tt.entry,"for(",yt,"=0;",yt,"<",it,";++",yt,"){",De,"=",dt,"[",yt,"];",Ne,"}",tt.exit);function Zt(fn){return fn.contextDep&&lr||fn.propDep}function Kt(fn){return!Zt(fn)}if(ut.needsContext&&Io(Be,Ne,ut.context),ut.needsFramebuffer&&cs(Be,Ne,ut.framebuffer),Ss(Be,Ne,ut.state,Zt),ut.profile&&Zt(ut.profile)&&$i(Be,Ne,ut,!1,!0),zt)ut.useVAO?ut.drawVAO?Zt(ut.drawVAO)?Ne(Be.shared.vao,".setVAO(",ut.drawVAO.append(Be,Ne),");"):tt(Be.shared.vao,".setVAO(",ut.drawVAO.append(Be,tt),");"):tt(Be.shared.vao,".setVAO(",Be.shared.vao,".targetVAO);"):(tt(Be.shared.vao,".setVAO(null);"),Jo(Be,tt,ut,zt.attributes,Kt),Jo(Be,Ne,ut,zt.attributes,Zt)),Ma(Be,tt,ut,zt.uniforms,Kt,!1),Ma(Be,Ne,ut,zt.uniforms,Zt,!0),_o(Be,tt,Ne,ut);else{var Vr=Be.global.def("{}"),cn=ut.shader.progVar.append(Be,Ne),dn=Ne.def(cn,".id"),In=Ne.def(Vr,"[",dn,"]");Ne(Be.shared.gl,".useProgram(",cn,".program);","if(!",In,"){",In,"=",Vr,"[",dn,"]=",Be.link(function(fn){return _i(xo,Be,ut,fn,2)}),"(",cn,");}",In,".call(this,a0[",yt,"],",yt,");")}}function He(Be,we){var ut=Be.proc("batch",2);Be.batchId="0",Go(Be,ut);var zt=!1,lr=!0;Object.keys(we.context).forEach(function(Vr){zt=zt||we.context[Vr].propDep}),zt||(Io(Be,ut,we.context),lr=!1);var yt=we.framebuffer,dt=!1;yt?(yt.propDep?zt=dt=!0:yt.contextDep&&zt&&(dt=!0),dt||cs(Be,ut,yt)):cs(Be,ut,null),we.state.viewport&&we.state.viewport.propDep&&(zt=!0);function it(Vr){return Vr.contextDep&&zt||Vr.propDep}fs(Be,ut,we),Ss(Be,ut,we.state,function(Vr){return!it(Vr)}),(!we.profile||!it(we.profile))&&$i(Be,ut,we,!1,"a1"),we.contextDep=zt,we.needsContext=lr,we.needsFramebuffer=dt;var De=we.shader.progVar;if(De.contextDep&&zt||De.propDep)xu(Be,ut,we,null);else{var tt=De.append(Be,ut);if(ut(Be.shared.gl,".useProgram(",tt,".program);"),we.shader.program)xu(Be,ut,we,we.shader.program);else{ut(Be.shared.vao,".setVAO(null);");var Ne=Be.global.def("{}"),Zt=ut.def(tt,".id"),Kt=ut.def(Ne,"[",Zt,"]");ut(Be.cond(Kt).then(Kt,".call(this,a0,a1);").else(Kt,"=",Ne,"[",Zt,"]=",Be.link(function(Vr){return _i(xu,Be,we,Vr,2)}),"(",tt,");",Kt,".call(this,a0,a1);"))}}Object.keys(we.state).length>0&&ut(Be.shared.current,".dirty=true;"),Be.shared.vao&&ut(Be.shared.vao,".setVAO(null);")}function nr(Be,we){var ut=Be.proc("scope",3);Be.batchId="a2";var zt=Be.shared,lr=zt.current;Io(Be,ut,we.context),we.framebuffer&&we.framebuffer.append(Be,ut),Bh(Object.keys(we.state)).forEach(function(dt){var it=we.state[dt],De=it.append(Be,ut);co(De)?De.forEach(function(tt,Ne){ut.set(Be.next[dt],"["+Ne+"]",tt)}):ut.set(zt.next,"."+dt,De)}),$i(Be,ut,we,!0,!0),[Ll,Bf,Mo,Rl,_u].forEach(function(dt){var it=we.draw[dt];!it||ut.set(zt.draw,"."+dt,""+it.append(Be,ut))}),Object.keys(we.uniforms).forEach(function(dt){var it=we.uniforms[dt].append(Be,ut);Array.isArray(it)&&(it="["+it.join()+"]"),ut.set(zt.uniforms,"["+Oe.id(dt)+"]",it)}),Object.keys(we.attributes).forEach(function(dt){var it=we.attributes[dt].append(Be,ut),De=Be.scopeAttrib(dt);Object.keys(new Nt).forEach(function(tt){ut.set(De,"."+tt,it[tt])})}),we.scopeVAO&&ut.set(zt.vao,".targetVAO",we.scopeVAO.append(Be,ut));function yt(dt){var it=we.shader[dt];it&&ut.set(zt.shader,"."+dt,it.append(Be,ut))}yt(Ju),yt(pl),Object.keys(we.state).length>0&&(ut(lr,".dirty=true;"),ut.exit(lr,".dirty=true;")),ut("a1(",Be.shared.context,",a0,",Be.batchId,");")}function er(Be){if(!(typeof Be!="object"||co(Be))){for(var we=Object.keys(Be),ut=0;ut<we.length;++ut)if(Mr.isDynamic(Be[we[ut]]))return!0;return!1}}function Un(Be,we,ut){var zt=we.static[ut];if(!zt||!er(zt))return;var lr=Be.global,yt=Object.keys(zt),dt=!1,it=!1,De=!1,tt=Be.global.def("{}");yt.forEach(function(Zt){var Kt=zt[Zt];if(Mr.isDynamic(Kt)){typeof Kt=="function"&&(Kt=zt[Zt]=Mr.unbox(Kt));var Vr=cu(Kt,null);dt=dt||Vr.thisDep,De=De||Vr.propDep,it=it||Vr.contextDep}else{switch(lr(tt,".",Zt,"="),typeof Kt){case"number":lr(Kt);break;case"string":lr('"',Kt,'"');break;case"object":Array.isArray(Kt)&&lr("[",Kt.join(),"]");break;default:lr(Be.link(Kt));break}lr(";")}});function Ne(Zt,Kt){yt.forEach(function(Vr){var cn=zt[Vr];if(!!Mr.isDynamic(cn)){var dn=Zt.invoke(Kt,cn);Kt(tt,".",Vr,"=",dn,";")}})}we.dynamic[ut]=new Mr.DynamicVariable(ft,{thisDep:dt,contextDep:it,propDep:De,ref:tt,append:Ne}),delete we.static[ut]}function ua(Be,we,ut,zt,lr){var yt=Ri();yt.stats=yt.link(lr),Object.keys(we.static).forEach(function(it){Un(yt,we,it)}),sp.forEach(function(it){Un(yt,Be,it)});var dt=$a(Be,we,ut,zt,yt);return no(yt,dt),nr(yt,dt),He(yt,dt),p(yt.compile(),{destroy:function(){dt.shader.program.destroy()}})}return{next:tn,current:Sn,procs:function(){var Be=Ri(),we=Be.proc("poll"),ut=Be.proc("refresh"),zt=Be.block();we(zt),ut(zt);var lr=Be.shared,yt=lr.gl,dt=lr.next,it=lr.current;zt(it,".dirty=false;"),cs(Be,we),cs(Be,ut,null,!0);var De;Kr&&(De=Be.link(Kr)),et.oes_vertex_array_object&&ut(Be.link(et.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var tt=0;tt<ur.maxAttributes;++tt){var Ne=ut.def(lr.attributes,"[",tt,"]"),Zt=Be.cond(Ne,".buffer");Zt.then(yt,".enableVertexAttribArray(",tt,");",yt,".bindBuffer(",uf,",",Ne,".buffer.buffer);",yt,".vertexAttribPointer(",tt,",",Ne,".size,",Ne,".type,",Ne,".normalized,",Ne,".stride,",Ne,".offset);").else(yt,".disableVertexAttribArray(",tt,");",yt,".vertexAttrib4f(",tt,",",Ne,".x,",Ne,".y,",Ne,".z,",Ne,".w);",Ne,".buffer=null;"),ut(Zt),Kr&&ut(De,".vertexAttribDivisorANGLE(",tt,",",Ne,".divisor);")}return ut(Be.shared.vao,".currentVAO=null;",Be.shared.vao,".setVAO(",Be.shared.vao,".targetVAO);"),Object.keys(Lr).forEach(function(Kt){var Vr=Lr[Kt],cn=zt.def(dt,".",Kt),dn=Be.block();dn("if(",cn,"){",yt,".enable(",Vr,")}else{",yt,".disable(",Vr,")}",it,".",Kt,"=",cn,";"),ut(dn),we("if(",cn,"!==",it,".",Kt,"){",dn,"}")}),Object.keys(Tr).forEach(function(Kt){var Vr=Tr[Kt],cn=Sn[Kt],dn,In,fn=Be.block();if(fn(yt,".",Vr,"("),co(cn)){var Wn=cn.length;dn=Be.global.def(dt,".",Kt),In=Be.global.def(it,".",Kt),fn(de(Wn,function(Dn){return dn+"["+Dn+"]"}),");",de(Wn,function(Dn){return In+"["+Dn+"]="+dn+"["+Dn+"];"}).join("")),we("if(",de(Wn,function(Dn){return dn+"["+Dn+"]!=="+In+"["+Dn+"]"}).join("||"),"){",fn,"}")}else dn=zt.def(dt,".",Kt),In=zt.def(it,".",Kt),fn(dn,");",it,".",Kt,"=",dn,";"),we("if(",dn,"!==",In,"){",fn,"}");ut(fn)}),Be.compile()}(),compile:ua}}function zh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var pp=34918,dp=34919,Uh=35007,Zh=function(W,Oe){if(!Oe.ext_disjoint_timer_query)return null;var et=[];function ur(){return et.pop()||Oe.ext_disjoint_timer_query.createQueryEXT()}function Dr(Kr){et.push(Kr)}var ar=[];function Ar(Kr){var Ln=ur();Oe.ext_disjoint_timer_query.beginQueryEXT(Uh,Ln),ar.push(Ln),Xr(ar.length-1,ar.length,Kr)}function jr(){Oe.ext_disjoint_timer_query.endQueryEXT(Uh)}function Wr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Jr=[];function Qr(){return Jr.pop()||new Wr}function rn(Kr){Jr.push(Kr)}var yn=[];function Xr(Kr,Ln,Or){var Sn=Qr();Sn.startQueryIndex=Kr,Sn.endQueryIndex=Ln,Sn.sum=0,Sn.stats=Or,yn.push(Sn)}var en=[],Nt=[];function _r(){var Kr,Ln,Or=ar.length;if(Or!==0){Nt.length=Math.max(Nt.length,Or+1),en.length=Math.max(en.length,Or+1),en[0]=0,Nt[0]=0;var Sn=0;for(Kr=0,Ln=0;Ln<ar.length;++Ln){var tn=ar[Ln];Oe.ext_disjoint_timer_query.getQueryObjectEXT(tn,dp)?(Sn+=Oe.ext_disjoint_timer_query.getQueryObjectEXT(tn,pp),Dr(tn)):ar[Kr++]=tn,en[Ln+1]=Sn,Nt[Ln+1]=Kr}for(ar.length=Kr,Kr=0,Ln=0;Ln<yn.length;++Ln){var li=yn[Ln],Lr=li.startQueryIndex,Tr=li.endQueryIndex;li.sum+=en[Tr]-en[Lr];var Xn=Nt[Lr],_n=Nt[Tr];_n===Xn?(li.stats.gpuTime+=li.sum/1e6,rn(li)):(li.startQueryIndex=Xn,li.endQueryIndex=_n,yn[Kr++]=li)}yn.length=Kr}}return{beginQuery:Ar,endQuery:jr,pushScopeStats:Xr,update:_r,getNumPendingQueries:function(){return ar.length},clear:function(){et.push.apply(et,ar);for(var Kr=0;Kr<et.length;Kr++)Oe.ext_disjoint_timer_query.deleteQueryEXT(et[Kr]);ar.length=0,et.length=0},restore:function(){ar.length=0,et.length=0}}},jh=16384,vp=256,pf=1024,Yf=34962,mh="webglcontextlost",Af="webglcontextrestored",Ka=1,Vh=2,pc=3;function Hc(W,Oe){for(var et=0;et<W.length;++et)if(W[et]===Oe)return et;return-1}function Wc(W){var Oe=U(W);if(!Oe)return null;var et=Oe.gl,ur=et.getContextAttributes(),Dr=et.isContextLost(),ar=ae(et,Oe);if(!ar)return null;var Ar=ti(),jr=zh(),Wr=ar.extensions,Jr=Zh(et,Wr),Qr=Kn(),rn=et.drawingBufferWidth,yn=et.drawingBufferHeight,Xr={tick:0,time:0,viewportWidth:rn,viewportHeight:yn,framebufferWidth:rn,framebufferHeight:yn,drawingBufferWidth:rn,drawingBufferHeight:yn,pixelRatio:Oe.pixelRatio},en={},Nt={elements:null,primitive:4,count:-1,offset:0,instances:-1},_r=Fe(et,Wr),Kr=H(et,jr,Oe,Sn),Ln=wu(et,Wr,Kr,jr),Or=St(et,Wr,_r,jr,Kr,Ln,Nt);function Sn(_i){return Or.destroyBuffer(_i)}var tn=Gr(et,Ar,jr,Oe),li=ou(et,Wr,_r,function(){Xn.procs.poll()},Xr,jr,Oe),Lr=Uc(et,Wr,_r,jr,Oe),Tr=Ie(et,Wr,_r,li,Lr,jr),Xn=Nh(et,Ar,Wr,_r,Kr,Ln,li,Tr,en,Or,tn,Nt,Xr,Jr,Oe),_n=fi(et,Tr,Xn.procs.poll,Xr,ur,Wr,_r),$r=Xn.next,An=et.canvas,En=[],ji=[],Ri=[],Pn=[Oe.onDestroy],Cn=null;function Ei(){if(En.length===0){Jr&&Jr.update(),Cn=null;return}Cn=un.next(Ei),Go();for(var _i=En.length-1;_i>=0;--_i){var pa=En[_i];pa&&pa(Xr,null,0)}et.flush(),Jr&&Jr.update()}function Di(){!Cn&&En.length>0&&(Cn=un.next(Ei))}function ra(){Cn&&(un.cancel(Ei),Cn=null)}function yo(_i){_i.preventDefault(),Dr=!0,ra(),ji.forEach(function(pa){pa()})}function Fo(_i){et.getError(),Dr=!1,ar.restore(),tn.restore(),Kr.restore(),li.restore(),Lr.restore(),Tr.restore(),Or.restore(),Jr&&Jr.restore(),Xn.procs.refresh(),Di(),Ri.forEach(function(pa){pa()})}var da=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!da&&An&&(An.addEventListener(mh,yo,!1),An.addEventListener(Af,Fo,!1));function bs(){En.length=0,ra(),!da&&An&&(An.removeEventListener(mh,yo),An.removeEventListener(Af,Fo)),tn.clear(),Tr.clear(),Lr.clear(),Or.clear(),li.clear(),Ln.clear(),Kr.clear(),Jr&&Jr.clear(),Pn.forEach(function(_i){_i()})}function ho(_i){Q(!!_i,"invalid args to regl({...})"),Q.type(_i,"object","invalid args to regl({...})");function pa(yt){var dt=p({},yt);delete dt.uniforms,delete dt.attributes,delete dt.context,delete dt.vao,"stencil"in dt&&dt.stencil.op&&(dt.stencil.opBack=dt.stencil.opFront=dt.stencil.op,delete dt.stencil.op);function it(De){if(De in dt){var tt=dt[De];delete dt[De],Object.keys(tt).forEach(function(Ne){dt[De+"."+Ne]=tt[Ne]})}}return it("blend"),it("depth"),it("cull"),it("stencil"),it("polygonOffset"),it("scissor"),it("sample"),"vao"in yt&&(dt.vao=yt.vao),dt}function no(yt,dt){var it={},De={};return Object.keys(yt).forEach(function(tt){var Ne=yt[tt];if(Mr.isDynamic(Ne)){De[tt]=Mr.unbox(Ne,tt);return}else if(dt&&Array.isArray(Ne)){for(var Zt=0;Zt<Ne.length;++Zt)if(Mr.isDynamic(Ne[Zt])){De[tt]=Mr.unbox(Ne,tt);return}}it[tt]=Ne}),{dynamic:De,static:it}}var xo=no(_i.context||{},!0),xu=no(_i.uniforms||{},!0),He=no(_i.attributes||{},!1),nr=no(pa(_i),!1),er={gpuTime:0,cpuTime:0,count:0},Un=Xn.compile(nr,He,xu,xo,er),ua=Un.draw,Be=Un.batch,we=Un.scope,ut=[];function zt(yt){for(;ut.length<yt;)ut.push(null);return ut}function lr(yt,dt){var it;if(Dr&&Q.raise("context lost"),typeof yt=="function")return we.call(this,null,yt,0);if(typeof dt=="function")if(typeof yt=="number")for(it=0;it<yt;++it)we.call(this,null,dt,it);else if(Array.isArray(yt))for(it=0;it<yt.length;++it)we.call(this,yt[it],dt,it);else return we.call(this,yt,dt,0);else if(typeof yt=="number"){if(yt>0)return Be.call(this,zt(yt|0),yt|0)}else if(Array.isArray(yt)){if(yt.length)return Be.call(this,yt,yt.length)}else return ua.call(this,yt)}return p(lr,{stats:er,destroy:function(){Un.destroy()}})}var $a=Tr.setFBO=ho({framebuffer:Mr.define.call(null,Ka,"framebuffer")});function Io(_i,pa){var no=0;Xn.procs.poll();var xo=pa.color;xo&&(et.clearColor(+xo[0]||0,+xo[1]||0,+xo[2]||0,+xo[3]||0),no|=jh),"depth"in pa&&(et.clearDepth(+pa.depth),no|=vp),"stencil"in pa&&(et.clearStencil(pa.stencil|0),no|=pf),Q(!!no,"called regl.clear with no buffer specified"),et.clear(no)}function cs(_i){if(Q(typeof _i=="object"&&_i,"regl.clear() takes an object as input"),"framebuffer"in _i)if(_i.framebuffer&&_i.framebuffer_reglType==="framebufferCube")for(var pa=0;pa<6;++pa)$a(p({framebuffer:_i.framebuffer.faces[pa]},_i),Io);else $a(_i,Io);else Io(null,_i)}function fs(_i){Q.type(_i,"function","regl.frame() callback must be a function"),En.push(_i);function pa(){var no=Hc(En,_i);Q(no>=0,"cannot cancel a frame twice");function xo(){var xu=Hc(En,xo);En[xu]=En[En.length-1],En.length-=1,En.length<=0&&ra()}En[no]=xo}return Di(),{cancel:pa}}function Ss(){var _i=$r.viewport,pa=$r.scissor_box;_i[0]=_i[1]=pa[0]=pa[1]=0,Xr.viewportWidth=Xr.framebufferWidth=Xr.drawingBufferWidth=_i[2]=pa[2]=et.drawingBufferWidth,Xr.viewportHeight=Xr.framebufferHeight=Xr.drawingBufferHeight=_i[3]=pa[3]=et.drawingBufferHeight}function Go(){Xr.tick+=1,Xr.time=Jo(),Ss(),Xn.procs.poll()}function $i(){li.refresh(),Ss(),Xn.procs.refresh(),Jr&&Jr.update()}function Jo(){return(Kn()-Qr)/1e3}$i();function Ma(_i,pa){Q.type(pa,"function","listener callback must be a function");var no;switch(_i){case"frame":return fs(pa);case"lost":no=ji;break;case"restore":no=Ri;break;case"destroy":no=Pn;break;default:Q.raise("invalid event, must be one of frame,lost,restore,destroy")}return no.push(pa),{cancel:function(){for(var xo=0;xo<no.length;++xo)if(no[xo]===pa){no[xo]=no[no.length-1],no.pop();return}}}}var _o=p(ho,{clear:cs,prop:Mr.define.bind(null,Ka),context:Mr.define.bind(null,Vh),this:Mr.define.bind(null,pc),draw:ho({}),buffer:function(_i){return Kr.create(_i,Yf,!1,!1)},elements:function(_i){return Ln.create(_i,!1)},texture:li.create2D,cube:li.createCube,renderbuffer:Lr.create,framebuffer:Tr.create,framebufferCube:Tr.createCube,vao:Or.createVAO,attributes:ur,frame:fs,on:Ma,limits:_r,hasExtension:function(_i){return _r.extensions.indexOf(_i.toLowerCase())>=0},read:_n,destroy:bs,_gl:et,_refresh:$i,poll:function(){Go(),Jr&&Jr.update()},now:Jo,stats:jr});return Oe.onDone(null,_o),_o}return Wc})},58380:function(qe){function D(y,j,b){switch(b.length){case 0:return y.call(j);case 1:return y.call(j,b[0]);case 2:return y.call(j,b[0],b[1]);case 3:return y.call(j,b[0],b[1],b[2])}return y.apply(j,b)}qe.exports=D},77412:function(qe){function D(y,j){for(var b=-1,p=y==null?0:y.length;++b<p&&j(y[b],b,y)!==!1;);return y}qe.exports=D},47443:function(qe,D,y){var j=y(42118);function b(p,E){var Z=p==null?0:p.length;return!!Z&&j(p,E,0)>-1}qe.exports=b},1196:function(qe){function D(y,j,b){for(var p=-1,E=y==null?0:y.length;++p<E;)if(b(j,y[p]))return!0;return!1}qe.exports=D},29932:function(qe){function D(y,j){for(var b=-1,p=y==null?0:y.length,E=Array(p);++b<p;)E[b]=j(y[b],b,y);return E}qe.exports=D},62663:function(qe){function D(y,j,b,p){var E=-1,Z=y==null?0:y.length;for(p&&Z&&(b=y[++E]);++E<Z;)b=j(b,y[E],E,y);return b}qe.exports=D},49029:function(qe){var D=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function y(j){return j.match(D)||[]}qe.exports=y},86556:function(qe,D,y){var j=y(89465),b=y(77813);function p(E,Z,V){(V!==void 0&&!b(E[Z],V)||V===void 0&&!(Z in E))&&j(E,Z,V)}qe.exports=p},34865:function(qe,D,y){var j=y(89465),b=y(77813),p=Object.prototype,E=p.hasOwnProperty;function Z(V,G,I){var L=V[G];(!(E.call(V,G)&&b(L,I))||I===void 0&&!(G in V))&&j(V,G,I)}qe.exports=Z},44037:function(qe,D,y){var j=y(98363),b=y(3674);function p(E,Z){return E&&j(Z,b(Z),E)}qe.exports=p},63886:function(qe,D,y){var j=y(98363),b=y(81704);function p(E,Z){return E&&j(Z,b(Z),E)}qe.exports=p},89465:function(qe,D,y){var j=y(38777);function b(p,E,Z){E=="__proto__"&&j?j(p,E,{configurable:!0,enumerable:!0,value:Z,writable:!0}):p[E]=Z}qe.exports=b},29750:function(qe){function D(y,j,b){return y===y&&(b!==void 0&&(y=y<=b?y:b),j!==void 0&&(y=y>=j?y:j)),y}qe.exports=D},85990:function(qe,D,y){var j=y(46384),b=y(77412),p=y(34865),E=y(44037),Z=y(63886),V=y(64626),G=y(278),I=y(18805),L=y(1911),_e=y(58234),be=y(46904),Le=y(64160),Je=y(43824),Dt=y(29148),It=y(38517),Ut=y(1469),xt=y(44144),bt=y(56688),ct=y(13218),ir=y(72928),re=y(3674),cr=y(81704),Ct=1,Qe=2,Tt=4,je="[object Arguments]",Pt="[object Array]",fr="[object Boolean]",$t="[object Date]",zr="[object Error]",fe="[object Function]",ke="[object GeneratorFunction]",ge="[object Map]",_t="[object Number]",vt="[object Object]",jt="[object RegExp]",Bt="[object Set]",Nr="[object String]",pn="[object Symbol]",mn="[object WeakMap]",Ni="[object ArrayBuffer]",or="[object DataView]",ve="[object Float32Array]",Me="[object Float64Array]",Ge="[object Int8Array]",Re="[object Int16Array]",kt="[object Int32Array]",rr="[object Uint8Array]",yr="[object Uint8ClampedArray]",Pr="[object Uint16Array]",sr="[object Uint32Array]",Rr={};Rr[je]=Rr[Pt]=Rr[Ni]=Rr[or]=Rr[fr]=Rr[$t]=Rr[ve]=Rr[Me]=Rr[Ge]=Rr[Re]=Rr[kt]=Rr[ge]=Rr[_t]=Rr[vt]=Rr[jt]=Rr[Bt]=Rr[Nr]=Rr[pn]=Rr[rr]=Rr[yr]=Rr[Pr]=Rr[sr]=!0,Rr[zr]=Rr[fe]=Rr[mn]=!1;function w(X,Ue,Ve,ot,At,Q){var Rt,dr=Ue&Ct,Cr=Ue&Qe,Xe=Ue&Tt;if(Ve&&(Rt=At?Ve(X,ot,At,Q):Ve(X)),Rt!==void 0)return Rt;if(!ct(X))return X;var rt=Ut(X);if(rt){if(Rt=Je(X),!dr)return G(X,Rt)}else{var wt=Le(X),Ot=wt==fe||wt==ke;if(xt(X))return V(X,dr);if(wt==vt||wt==je||Ot&&!At){if(Rt=Cr||Ot?{}:It(X),!dr)return Cr?L(X,Z(Rt,X)):I(X,E(Rt,X))}else{if(!Rr[wt])return At?X:{};Rt=Dt(X,wt,dr)}}Q||(Q=new j);var gr=Q.get(X);if(gr)return gr;Q.set(X,Rt),ir(X)?X.forEach(function(kr){Rt.add(w(kr,Ue,Ve,kr,X,Q))}):bt(X)&&X.forEach(function(kr,Mr){Rt.set(Mr,w(kr,Ue,Ve,Mr,X,Q))});var br=Xe?Cr?be:_e:Cr?cr:re,Xt=rt?void 0:br(X);return b(Xt||X,function(kr,Mr){Xt&&(Mr=kr,kr=X[Mr]),p(Rt,Mr,w(kr,Ue,Ve,Mr,X,Q))}),Rt}qe.exports=w},3118:function(qe,D,y){var j=y(13218),b=Object.create,p=function(){function E(){}return function(Z){if(!j(Z))return{};if(b)return b(Z);E.prototype=Z;var V=new E;return E.prototype=void 0,V}}();qe.exports=p},41848:function(qe){function D(y,j,b,p){for(var E=y.length,Z=b+(p?1:-1);p?Z--:++Z<E;)if(j(y[Z],Z,y))return Z;return-1}qe.exports=D},28483:function(qe,D,y){var j=y(25063),b=j();qe.exports=b},42118:function(qe,D,y){var j=y(41848),b=y(62722),p=y(42351);function E(Z,V,G){return V===V?p(Z,V,G):j(Z,b,G)}qe.exports=E},25588:function(qe,D,y){var j=y(64160),b=y(37005),p="[object Map]";function E(Z){return b(Z)&&j(Z)==p}qe.exports=E},62722:function(qe){function D(y){return y!==y}qe.exports=D},29221:function(qe,D,y){var j=y(64160),b=y(37005),p="[object Set]";function E(Z){return b(Z)&&j(Z)==p}qe.exports=E},10313:function(qe,D,y){var j=y(13218),b=y(25726),p=y(33498),E=Object.prototype,Z=E.hasOwnProperty;function V(G){if(!j(G))return p(G);var I=b(G),L=[];for(var _e in G)_e=="constructor"&&(I||!Z.call(G,_e))||L.push(_e);return L}qe.exports=V},42980:function(qe,D,y){var j=y(46384),b=y(86556),p=y(28483),E=y(59783),Z=y(13218),V=y(81704),G=y(36390);function I(L,_e,be,Le,Je){L!==_e&&p(_e,function(Dt,It){if(Je||(Je=new j),Z(Dt))E(L,_e,It,be,I,Le,Je);else{var Ut=Le?Le(G(L,It),Dt,It+"",L,_e,Je):void 0;Ut===void 0&&(Ut=Dt),b(L,It,Ut)}},V)}qe.exports=I},59783:function(qe,D,y){var j=y(86556),b=y(64626),p=y(77133),E=y(278),Z=y(38517),V=y(35694),G=y(1469),I=y(29246),L=y(44144),_e=y(23560),be=y(13218),Le=y(68630),Je=y(36719),Dt=y(36390),It=y(59881);function Ut(xt,bt,ct,ir,re,cr,Ct){var Qe=Dt(xt,ct),Tt=Dt(bt,ct),je=Ct.get(Tt);if(je){j(xt,ct,je);return}var Pt=cr?cr(Qe,Tt,ct+"",xt,bt,Ct):void 0,fr=Pt===void 0;if(fr){var $t=G(Tt),zr=!$t&&L(Tt),fe=!$t&&!zr&&Je(Tt);Pt=Tt,$t||zr||fe?G(Qe)?Pt=Qe:I(Qe)?Pt=E(Qe):zr?(fr=!1,Pt=b(Tt,!0)):fe?(fr=!1,Pt=p(Tt,!0)):Pt=[]:Le(Tt)||V(Tt)?(Pt=Qe,V(Qe)?Pt=It(Qe):(!be(Qe)||_e(Qe))&&(Pt=Z(Tt))):fr=!1}fr&&(Ct.set(Tt,Pt),re(Pt,Tt,ir,cr,Ct),Ct.delete(Tt)),j(xt,ct,Pt)}qe.exports=Ut},40371:function(qe){function D(y){return function(j){return j==null?void 0:j[y]}}qe.exports=D},18674:function(qe){function D(y){return function(j){return y==null?void 0:y[j]}}qe.exports=D},5976:function(qe,D,y){var j=y(6557),b=y(45357),p=y(30061);function E(Z,V){return p(b(Z,V,j),Z+"")}qe.exports=E},56560:function(qe,D,y){var j=y(75703),b=y(38777),p=y(6557),E=b?function(Z,V){return b(Z,"toString",{configurable:!0,enumerable:!1,value:j(V),writable:!0})}:p;qe.exports=E},80531:function(qe,D,y){var j=y(62705),b=y(29932),p=y(1469),E=y(33448),Z=1/0,V=j?j.prototype:void 0,G=V?V.toString:void 0;function I(L){if(typeof L=="string")return L;if(p(L))return b(L,I)+"";if(E(L))return G?G.call(L):"";var _e=L+"";return _e=="0"&&1/L==-Z?"-0":_e}qe.exports=I},45652:function(qe,D,y){var j=y(88668),b=y(47443),p=y(1196),E=y(74757),Z=y(23593),V=y(21814),G=200;function I(L,_e,be){var Le=-1,Je=b,Dt=L.length,It=!0,Ut=[],xt=Ut;if(be)It=!1,Je=p;else if(Dt>=G){var bt=_e?null:Z(L);if(bt)return V(bt);It=!1,Je=E,xt=new j}else xt=_e?[]:Ut;e:for(;++Le<Dt;){var ct=L[Le],ir=_e?_e(ct):ct;if(ct=be||ct!==0?ct:0,It&&ir===ir){for(var re=xt.length;re--;)if(xt[re]===ir)continue e;_e&&xt.push(ir),Ut.push(ct)}else Je(xt,ir,be)||(xt!==Ut&&xt.push(ir),Ut.push(ct))}return Ut}qe.exports=I},74318:function(qe,D,y){var j=y(11149);function b(p){var E=new p.constructor(p.byteLength);return new j(E).set(new j(p)),E}qe.exports=b},64626:function(qe,D,y){qe=y.nmd(qe);var j=y(55639),b=D&&!D.nodeType&&D,p=b&&!0&&qe&&!qe.nodeType&&qe,E=p&&p.exports===b,Z=E?j.Buffer:void 0,V=Z?Z.allocUnsafe:void 0;function G(I,L){if(L)return I.slice();var _e=I.length,be=V?V(_e):new I.constructor(_e);return I.copy(be),be}qe.exports=G},57157:function(qe,D,y){var j=y(74318);function b(p,E){var Z=E?j(p.buffer):p.buffer;return new p.constructor(Z,p.byteOffset,p.byteLength)}qe.exports=b},93147:function(qe){var D=/\w*$/;function y(j){var b=new j.constructor(j.source,D.exec(j));return b.lastIndex=j.lastIndex,b}qe.exports=y},40419:function(qe,D,y){var j=y(62705),b=j?j.prototype:void 0,p=b?b.valueOf:void 0;function E(Z){return p?Object(p.call(Z)):{}}qe.exports=E},77133:function(qe,D,y){var j=y(74318);function b(p,E){var Z=E?j(p.buffer):p.buffer;return new p.constructor(Z,p.byteOffset,p.length)}qe.exports=b},278:function(qe){function D(y,j){var b=-1,p=y.length;for(j||(j=Array(p));++b<p;)j[b]=y[b];return j}qe.exports=D},98363:function(qe,D,y){var j=y(34865),b=y(89465);function p(E,Z,V,G){var I=!V;V||(V={});for(var L=-1,_e=Z.length;++L<_e;){var be=Z[L],Le=G?G(V[be],E[be],be,V,E):void 0;Le===void 0&&(Le=E[be]),I?b(V,be,Le):j(V,be,Le)}return V}qe.exports=p},18805:function(qe,D,y){var j=y(98363),b=y(99551);function p(E,Z){return j(E,b(E),Z)}qe.exports=p},1911:function(qe,D,y){var j=y(98363),b=y(51442);function p(E,Z){return j(E,b(E),Z)}qe.exports=p},21463:function(qe,D,y){var j=y(5976),b=y(16612);function p(E){return j(function(Z,V){var G=-1,I=V.length,L=I>1?V[I-1]:void 0,_e=I>2?V[2]:void 0;for(L=E.length>3&&typeof L=="function"?(I--,L):void 0,_e&&b(V[0],V[1],_e)&&(L=I<3?void 0:L,I=1),Z=Object(Z);++G<I;){var be=V[G];be&&E(Z,be,G,L)}return Z})}qe.exports=p},25063:function(qe){function D(y){return function(j,b,p){for(var E=-1,Z=Object(j),V=p(j),G=V.length;G--;){var I=V[y?G:++E];if(b(Z[I],I,Z)===!1)break}return j}}qe.exports=D},98805:function(qe,D,y){var j=y(40180),b=y(62689),p=y(83140),E=y(79833);function Z(V){return function(G){G=E(G);var I=b(G)?p(G):void 0,L=I?I[0]:G.charAt(0),_e=I?j(I,1).join(""):G.slice(1);return L[V]()+_e}}qe.exports=Z},35393:function(qe,D,y){var j=y(62663),b=y(53816),p=y(58748),E="['\u2019]",Z=RegExp(E,"g");function V(G){return function(I){return j(p(b(I).replace(Z,"")),G,"")}}qe.exports=V},23593:function(qe,D,y){var j=y(58525),b=y(50308),p=y(21814),E=1/0,Z=j&&1/p(new j([,-0]))[1]==E?function(V){return new j(V)}:b;qe.exports=Z},69389:function(qe,D,y){var j=y(18674),b={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=j(b);qe.exports=p},38777:function(qe,D,y){var j=y(10852),b=function(){try{var p=j(Object,"defineProperty");return p({},"",{}),p}catch(E){}}();qe.exports=b},46904:function(qe,D,y){var j=y(68866),b=y(51442),p=y(81704);function E(Z){return j(Z,p,b)}qe.exports=E},85924:function(qe,D,y){var j=y(5569),b=j(Object.getPrototypeOf,Object);qe.exports=b},51442:function(qe,D,y){var j=y(62488),b=y(85924),p=y(99551),E=y(70479),Z=Object.getOwnPropertySymbols,V=Z?function(G){for(var I=[];G;)j(I,p(G)),G=b(G);return I}:E;qe.exports=V},93157:function(qe){var D=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function y(j){return D.test(j)}qe.exports=y},43824:function(qe){var D=Object.prototype,y=D.hasOwnProperty;function j(b){var p=b.length,E=new b.constructor(p);return p&&typeof b[0]=="string"&&y.call(b,"index")&&(E.index=b.index,E.input=b.input),E}qe.exports=j},29148:function(qe,D,y){var j=y(74318),b=y(57157),p=y(93147),E=y(40419),Z=y(77133),V="[object Boolean]",G="[object Date]",I="[object Map]",L="[object Number]",_e="[object RegExp]",be="[object Set]",Le="[object String]",Je="[object Symbol]",Dt="[object ArrayBuffer]",It="[object DataView]",Ut="[object Float32Array]",xt="[object Float64Array]",bt="[object Int8Array]",ct="[object Int16Array]",ir="[object Int32Array]",re="[object Uint8Array]",cr="[object Uint8ClampedArray]",Ct="[object Uint16Array]",Qe="[object Uint32Array]";function Tt(je,Pt,fr){var $t=je.constructor;switch(Pt){case Dt:return j(je);case V:case G:return new $t(+je);case It:return b(je,fr);case Ut:case xt:case bt:case ct:case ir:case re:case cr:case Ct:case Qe:return Z(je,fr);case I:return new $t;case L:case Le:return new $t(je);case _e:return p(je);case be:return new $t;case Je:return E(je)}}qe.exports=Tt},38517:function(qe,D,y){var j=y(3118),b=y(85924),p=y(25726);function E(Z){return typeof Z.constructor=="function"&&!p(Z)?j(b(Z)):{}}qe.exports=E},16612:function(qe,D,y){var j=y(77813),b=y(98612),p=y(65776),E=y(13218);function Z(V,G,I){if(!E(I))return!1;var L=typeof G;return(L=="number"?b(I)&&p(G,I.length):L=="string"&&G in I)?j(I[G],V):!1}qe.exports=Z},33498:function(qe){function D(y){var j=[];if(y!=null)for(var b in Object(y))j.push(b);return j}qe.exports=D},45357:function(qe,D,y){var j=y(58380),b=Math.max;function p(E,Z,V){return Z=b(Z===void 0?E.length-1:Z,0),function(){for(var G=arguments,I=-1,L=b(G.length-Z,0),_e=Array(L);++I<L;)_e[I]=G[Z+I];I=-1;for(var be=Array(Z+1);++I<Z;)be[I]=G[I];return be[Z]=V(_e),j(E,this,be)}}qe.exports=p},36390:function(qe){function D(y,j){if(!(j==="constructor"&&typeof y[j]=="function")&&j!="__proto__")return y[j]}qe.exports=D},30061:function(qe,D,y){var j=y(56560),b=y(21275),p=b(j);qe.exports=p},21275:function(qe){var D=800,y=16,j=Date.now;function b(p){var E=0,Z=0;return function(){var V=j(),G=y-(V-Z);if(Z=V,G>0){if(++E>=D)return arguments[0]}else E=0;return p.apply(void 0,arguments)}}qe.exports=b},42351:function(qe){function D(y,j,b){for(var p=b-1,E=y.length;++p<E;)if(y[p]===j)return p;return-1}qe.exports=D},2757:function(qe){var D="\\ud800-\\udfff",y="\\u0300-\\u036f",j="\\ufe20-\\ufe2f",b="\\u20d0-\\u20ff",p=y+j+b,E="\\u2700-\\u27bf",Z="a-z\\xdf-\\xf6\\xf8-\\xff",V="\\xac\\xb1\\xd7\\xf7",G="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",I="\\u2000-\\u206f",L=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",_e="A-Z\\xc0-\\xd6\\xd8-\\xde",be="\\ufe0e\\ufe0f",Le=V+G+I+L,Je="['\u2019]",Dt="["+Le+"]",It="["+p+"]",Ut="\\d+",xt="["+E+"]",bt="["+Z+"]",ct="[^"+D+Le+Ut+E+Z+_e+"]",ir="\\ud83c[\\udffb-\\udfff]",re="(?:"+It+"|"+ir+")",cr="[^"+D+"]",Ct="(?:\\ud83c[\\udde6-\\uddff]){2}",Qe="[\\ud800-\\udbff][\\udc00-\\udfff]",Tt="["+_e+"]",je="\\u200d",Pt="(?:"+bt+"|"+ct+")",fr="(?:"+Tt+"|"+ct+")",$t="(?:"+Je+"(?:d|ll|m|re|s|t|ve))?",zr="(?:"+Je+"(?:D|LL|M|RE|S|T|VE))?",fe=re+"?",ke="["+be+"]?",ge="(?:"+je+"(?:"+[cr,Ct,Qe].join("|")+")"+ke+fe+")*",_t="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",jt=ke+fe+ge,Bt="(?:"+[xt,Ct,Qe].join("|")+")"+jt,Nr=RegExp([Tt+"?"+bt+"+"+$t+"(?="+[Dt,Tt,"$"].join("|")+")",fr+"+"+zr+"(?="+[Dt,Tt+Pt,"$"].join("|")+")",Tt+"?"+Pt+"+"+$t,Tt+"+"+zr,vt,_t,Ut,Bt].join("|"),"g");function pn(mn){return mn.match(Nr)||[]}qe.exports=pn},68929:function(qe,D,y){var j=y(48403),b=y(35393),p=b(function(E,Z,V){return Z=Z.toLowerCase(),E+(V?j(Z):Z)});qe.exports=p},48403:function(qe,D,y){var j=y(79833),b=y(11700);function p(E){return b(j(E).toLowerCase())}qe.exports=p},74691:function(qe,D,y){var j=y(29750),b=y(14841);function p(E,Z,V){return V===void 0&&(V=Z,Z=void 0),V!==void 0&&(V=b(V),V=V===V?V:0),Z!==void 0&&(Z=b(Z),Z=Z===Z?Z:0),j(b(E),Z,V)}qe.exports=p},50361:function(qe,D,y){var j=y(85990),b=1,p=4;function E(Z){return j(Z,b|p)}qe.exports=E},75703:function(qe){function D(y){return function(){return y}}qe.exports=D},53816:function(qe,D,y){var j=y(69389),b=y(79833),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,E="\\u0300-\\u036f",Z="\\ufe20-\\ufe2f",V="\\u20d0-\\u20ff",G=E+Z+V,I="["+G+"]",L=RegExp(I,"g");function _e(be){return be=b(be),be&&be.replace(p,j).replace(L,"")}qe.exports=_e},6557:function(qe){function D(y){return y}qe.exports=D},29246:function(qe,D,y){var j=y(98612),b=y(37005);function p(E){return b(E)&&j(E)}qe.exports=p},56688:function(qe,D,y){var j=y(25588),b=y(7518),p=y(31167),E=p&&p.isMap,Z=E?b(E):j;qe.exports=Z},14293:function(qe){function D(y){return y==null}qe.exports=D},81763:function(qe,D,y){var j=y(44239),b=y(37005),p="[object Number]";function E(Z){return typeof Z=="number"||b(Z)&&j(Z)==p}qe.exports=E},68630:function(qe,D,y){var j=y(44239),b=y(85924),p=y(37005),E="[object Object]",Z=Function.prototype,V=Object.prototype,G=Z.toString,I=V.hasOwnProperty,L=G.call(Object);function _e(be){if(!p(be)||j(be)!=E)return!1;var Le=b(be);if(Le===null)return!0;var Je=I.call(Le,"constructor")&&Le.constructor;return typeof Je=="function"&&Je instanceof Je&&G.call(Je)==L}qe.exports=_e},72928:function(qe,D,y){var j=y(29221),b=y(7518),p=y(31167),E=p&&p.isSet,Z=E?b(E):j;qe.exports=Z},47037:function(qe,D,y){var j=y(44239),b=y(1469),p=y(37005),E="[object String]";function Z(V){return typeof V=="string"||!b(V)&&p(V)&&j(V)==E}qe.exports=Z},81704:function(qe,D,y){var j=y(14636),b=y(10313),p=y(98612);function E(Z){return p(Z)?j(Z,!0):b(Z)}qe.exports=E},82492:function(qe,D,y){var j=y(42980),b=y(21463),p=b(function(E,Z,V){j(E,Z,V)});qe.exports=p},30236:function(qe,D,y){var j=y(42980),b=y(21463),p=b(function(E,Z,V,G){j(E,Z,V,G)});qe.exports=p},50308:function(qe){function D(){}qe.exports=D},59881:function(qe,D,y){var j=y(98363),b=y(81704);function p(E){return j(E,b(E))}qe.exports=p},79833:function(qe,D,y){var j=y(80531);function b(p){return p==null?"":j(p)}qe.exports=b},44908:function(qe,D,y){var j=y(45652);function b(p){return p&&p.length?j(p):[]}qe.exports=b},11700:function(qe,D,y){var j=y(98805),b=j("toUpperCase");qe.exports=b},58748:function(qe,D,y){var j=y(49029),b=y(93157),p=y(79833),E=y(2757);function Z(V,G,I){return V=p(V),G=I?void 0:G,G===void 0?b(V)?E(V):j(V):V.match(G)||[]}qe.exports=Z},6158:function(qe){(function(D,y){qe.exports=y()})(this,function(){"use strict";var D,y,j;function b(p,E){if(!D)D=E;else if(!y)y=E;else{var Z="var sharedChunk = {}; ("+D+")(sharedChunk); ("+y+")(sharedChunk);",V={};D(V),j=E(V),typeof window!="undefined"&&(j.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}return b(["exports"],function(p){"use strict";function E(e,t){return e(t={exports:{}},t.exports),t.exports}var Z=V;function V(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}V.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},V.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},V.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},V.prototype.solveCurveX=function(e,t){var r,f,v,g,S;for(t===void 0&&(t=1e-6),v=e,S=0;S<8;S++){if(g=this.sampleCurveX(v)-e,Math.abs(g)<t)return v;var M=this.sampleCurveDerivativeX(v);if(Math.abs(M)<1e-6)break;v-=g/M}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(g=this.sampleCurveX(v),Math.abs(g-e)<t)return v;e>g?r=v:f=v,v=.5*(f-r)+r}return v},V.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var G=I;function I(e,t){this.x=e,this.y=t}I.prototype={clone:function(){return new I(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),f=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=f,this},_rotateAround:function(e,t){var r=Math.cos(e),f=Math.sin(e),v=t.y+f*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-f*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},I.convert=function(e){return e instanceof I?e:Array.isArray(e)?new I(e[0],e[1]):e};var L=typeof self!="undefined"?self:{},_e=Math.pow(2,53)-1;function be(e,t,r,f){var v=new Z(e,t,r,f);return function(g){return v.solve(g)}}var Le=be(.25,.1,.25,1);function Je(e,t,r){return Math.min(r,Math.max(t,e))}function Dt(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function It(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var g=v[f];for(var S in g)e[S]=g[S]}return e}var Ut=1;function xt(){return Ut++}function bt(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function ct(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function ir(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function re(e,t){return e.indexOf(t,e.length-t.length)!==-1}function cr(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function Ct(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function Qe(e){return Array.isArray(e)?e.map(Qe):typeof e=="object"&&e?cr(e,Qe):e}var Tt={};function je(e){Tt[e]||(typeof console!="undefined"&&console.warn(e),Tt[e]=!0)}function Pt(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function fr(e){for(var t=0,r=0,f=e.length,v=f-1,g=void 0,S=void 0;r<f;v=r++)t+=((S=e[v]).x-(g=e[r]).x)*(g.y+S.y);return t}function $t(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function zr(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,g,S){var M=g||S;return t[v]=!M||M.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var fe=null;function ke(e){if(fe==null){var t=e.navigator?e.navigator.userAgent:null;fe=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return fe}function ge(e){try{var t=L[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var _t,vt,jt,Bt,Nr=L.performance&&L.performance.now?L.performance.now.bind(L.performance):Date.now.bind(Date),pn=L.requestAnimationFrame||L.mozRequestAnimationFrame||L.webkitRequestAnimationFrame||L.msRequestAnimationFrame,mn=L.cancelAnimationFrame||L.mozCancelAnimationFrame||L.webkitCancelAnimationFrame||L.msCancelAnimationFrame,Ni={now:Nr,frame:function(e){var t=pn(e);return{cancel:function(){return mn(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=L.document.createElement("canvas"),f=r.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return _t||(_t=L.document.createElement("a")),_t.href=e,_t.href},hardwareConcurrency:L.navigator&&L.navigator.hardwareConcurrency||4,get devicePixelRatio(){return L.devicePixelRatio},get prefersReducedMotion(){return!!L.matchMedia&&(vt==null&&(vt=L.matchMedia("(prefers-reduced-motion: reduce)")),vt.matches)}},or={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ve={supported:!1,testSupport:function(e){!Me&&Bt&&(Ge?Re(e):jt=e)}},Me=!1,Ge=!1;function Re(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Bt),e.isContextLost())return;ve.supported=!0}catch(r){}e.deleteTexture(t),Me=!0}L.document&&((Bt=L.document.createElement("img")).onload=function(){jt&&Re(jt),jt=null,Ge=!0},Bt.onerror=function(){Me=!0,jt=null},Bt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var kt="01",rr=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function yr(e){return e.indexOf("mapbox:")===0}rr.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",kt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},rr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},rr.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},rr.prototype.normalizeStyleURL=function(e,t){if(!yr(e))return e;var r=w(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},rr.prototype.normalizeGlyphsURL=function(e,t){if(!yr(e))return e;var r=w(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},rr.prototype.normalizeSourceURL=function(e,t){if(!yr(e))return e;var r=w(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},rr.prototype.normalizeSpriteURL=function(e,t,r,f){var v=w(e);return yr(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,X(v))},rr.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!yr(e))return e;var r=w(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Ni.devicePixelRatio>=2||t===512?"@2x":"")+(ve.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var g=0,S=v;g<S.length;g+=1){var M=S[g].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(r.params)||or.ACCESS_TOKEN;return or.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},rr.prototype.canonicalizeTileURL=function(e,t){var r=w(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(g){return!g.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},rr.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&yr(t),f=[],v=0,g=e.tiles||[];v<g.length;v+=1){var S=g[v];sr(S)?f.push(this.canonicalizeTileURL(S,r)):f.push(S)}return f},rr.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=w(or.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!or.REQUIRE_ACCESS_TOKEN)return X(e);if(!(t=t||or.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(g){return g.indexOf("access_token")===-1}),e.params.push("access_token="+t),X(e)};var Pr=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function sr(e){return Pr.test(e)}var Rr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function w(e){var t=e.match(Rr);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function X(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function Ue(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(L.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var Ve=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Ve.prototype.getStorageKey=function(e){var t,r=Ue(or.ACCESS_TOKEN);return t=r&&r.u?L.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):or.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},Ve.prototype.fetchEventData=function(){var e=ge("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=L.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=L.localStorage.getItem(r);v&&(this.anonId=v)}catch(g){je("Unable to read from LocalStorage")}},Ve.prototype.saveEventData=function(){var e=ge("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{L.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&L.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){je("Unable to write to LocalStorage")}},Ve.prototype.processRequests=function(e){},Ve.prototype.postEvent=function(e,t,r,f){var v=this;if(or.EVENTS_URL){var g=w(or.EVENTS_URL);g.params.push("access_token="+(f||or.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:kt,userId:this.anonId},M=t?It(S,t):S,z={url:X(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=Pi(z,function(Y){v.pendingRequest=null,r(Y),v.saveEventData(),v.processRequests(f)})}},Ve.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var ot,At,Q=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,g){this.skuToken=v,(or.EVENTS_URL&&g||or.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(S){return yr(S)||sr(S)}))&&this.queueRequest({id:f,timestamp:Date.now()},g)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),g=v.id,S=v.timestamp;g&&this.success[g]||(this.anonId||this.fetchEventData(),ct(this.anonId)||(this.anonId=bt()),this.postEvent(S,{skuToken:this.skuToken},function(M){M||g&&(f.success[g]=!0)},r))}},t}(Ve),Rt=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){or.EVENTS_URL&&or.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return yr(v)||sr(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=Ue(or.ACCESS_TOKEN),g=v?v.u:or.ACCESS_TOKEN,S=g!==this.eventData.tokenU;ct(this.anonId)||(this.anonId=bt(),S=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var z=new Date(this.eventData.lastSuccess),Y=new Date(M),J=(M-this.eventData.lastSuccess)/864e5;S=S||J>=1||J<-1||z.getDate()!==Y.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(oe){oe||(f.eventData.lastSuccess=M,f.eventData.tokenU=g)},r)}},t}(Ve)),dr=Rt.postTurnstileEvent.bind(Rt),Cr=new Q,Xe=Cr.postMapLoadEvent.bind(Cr),rt=500,wt=50;function Ot(){L.caches&&!ot&&(ot=L.caches.open("mapbox-tiles"))}function gr(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var br,Xt=1/0;function kr(){return br==null&&(br=L.OffscreenCanvas&&new L.OffscreenCanvas(1,1).getContext("2d")&&typeof L.createImageBitmap=="function"),br}var Mr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Mr);var un=function(e){function t(r,f,v){f===401&&sr(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),an=$t()?function(){return self.worker&&self.worker.referrer}:function(){return(L.location.protocol==="blob:"?L.parent:L).location.href},Kn,ti,Qi=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(an())&&!/^\w+:/.test(r))){if(L.fetch&&L.Request&&L.AbortController&&L.Request.prototype.hasOwnProperty("signal"))return function(f,v){var g,S=new L.AbortController,M=new L.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:an(),signal:S.signal}),z=!1,Y=!1,J=(g=M.url).indexOf("sku=")>0&&sr(g);f.type==="json"&&M.headers.set("Accept","application/json");var oe=function(Se,Ye,$e){if(!Y){if(Se&&Se.message!=="SecurityError"&&je(Se),Ye&&$e)return he(Ye);var gt=Date.now();L.fetch(M).then(function(nt){if(nt.ok){var Lt=J?nt.clone():null;return he(nt,Lt,gt)}return v(new un(nt.statusText,nt.status,f.url))}).catch(function(nt){nt.code!==20&&v(new Error(nt.message))})}},he=function(Se,Ye,$e){(f.type==="arrayBuffer"?Se.arrayBuffer():f.type==="json"?Se.json():Se.text()).then(function(gt){Y||(Ye&&$e&&function(nt,Lt,Ht){if(Ot(),ot){var pr={status:Lt.status,statusText:Lt.statusText,headers:new L.Headers};Lt.headers.forEach(function(Br,nn){return pr.headers.set(nn,Br)});var vr=zr(Lt.headers.get("Cache-Control")||"");vr["no-store"]||(vr["max-age"]&&pr.headers.set("Expires",new Date(Ht+1e3*vr["max-age"]).toUTCString()),new Date(pr.headers.get("Expires")).getTime()-Ht<42e4||function(Br,nn){if(At===void 0)try{new Response(new ReadableStream),At=!0}catch(xn){At=!1}At?nn(Br.body):Br.blob().then(nn)}(Lt,function(Br){var nn=new L.Response(Br,pr);Ot(),ot&&ot.then(function(xn){return xn.put(gr(nt.url),nn)}).catch(function(xn){return je(xn.message)})}))}}(M,Ye,$e),z=!0,v(null,gt,Se.headers.get("Cache-Control"),Se.headers.get("Expires")))}).catch(function(gt){Y||v(new Error(gt.message))})};return J?function(Se,Ye){if(Ot(),!ot)return Ye(null);var $e=gr(Se.url);ot.then(function(gt){gt.match($e).then(function(nt){var Lt=function(Ht){if(!Ht)return!1;var pr=new Date(Ht.headers.get("Expires")||0),vr=zr(Ht.headers.get("Cache-Control")||"");return pr>Date.now()&&!vr["no-cache"]}(nt);gt.delete($e),Lt&&gt.put($e,nt.clone()),Ye(null,nt,Lt)}).catch(Ye)}).catch(Ye)}(M,oe):oe(null,null),{cancel:function(){Y=!0,z||S.abort()}}}(e,t);if($t()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(f,v){var g=new L.XMLHttpRequest;for(var S in g.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(g.responseType="arraybuffer"),f.headers)g.setRequestHeader(S,f.headers[S]);return f.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=f.credentials==="include",g.onerror=function(){v(new Error(g.statusText))},g.onload=function(){if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){var M=g.response;if(f.type==="json")try{M=JSON.parse(g.response)}catch(z){return v(z)}v(null,M,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else v(new un(g.statusText,g.status,f.url))},g.send(f.body),{cancel:function(){return g.abort()}}}(e,t)},Ai=function(e,t){return Qi(It(e,{type:"arrayBuffer"}),t)},Pi=function(e,t){return Qi(It(e,{method:"POST"}),t)},q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Kn=[],ti=0;var le=function(e,t){if(ve.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),ti>=or.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return Kn.push(r),r}ti++;var f=!1,v=function(){if(!f)for(f=!0,ti--;Kn.length&&ti<or.MAX_PARALLEL_IMAGE_REQUESTS;){var S=Kn.shift();S.cancelled||(S.cancel=le(S.requestParameters,S.callback).cancel)}},g=Ai(e,function(S,M,z,Y){v(),S?t(S):M&&(kr()?function(J,oe){var he=new L.Blob([new Uint8Array(J)],{type:"image/png"});L.createImageBitmap(he).then(function(Se){oe(null,Se)}).catch(function(Se){oe(new Error("Could not load image because of "+Se.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,t):function(J,oe,he,Se){var Ye=new L.Image,$e=L.URL;Ye.onload=function(){oe(null,Ye),$e.revokeObjectURL(Ye.src),Ye.onload=null,L.requestAnimationFrame(function(){Ye.src=q})},Ye.onerror=function(){return oe(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var gt=new L.Blob([new Uint8Array(J)],{type:"image/png"});Ye.cacheControl=he,Ye.expires=Se,Ye.src=J.byteLength?$e.createObjectURL(gt):q}(M,t,z,Y))});return{cancel:function(){g.cancel(),v()}}};function pe(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function U(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var ae=function(e,t){t===void 0&&(t={}),It(this,t),this.type=e},de=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",It({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ae),Pe=function(){};Pe.prototype.on=function(e,t){return this._listeners=this._listeners||{},pe(e,t,this._listeners),this},Pe.prototype.off=function(e,t){return U(e,t,this._listeners),U(e,t,this._oneTimeListeners),this},Pe.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},pe(e,t,this._oneTimeListeners),this},Pe.prototype.fire=function(e,t){typeof e=="string"&&(e=new ae(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var g=0,S=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];g<S.length;g+=1){var M=S[g];U(r,M,this._oneTimeListeners),M.call(this,e)}var z=this._eventedParent;z&&(It(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),z.fire(e))}else e instanceof de&&console.error(e.error);return this},Pe.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Pe.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var ue={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ee=function(e,t,r,f){this.message=(e?e+": ":"")+r,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function mt(e){var t=e.value;return t?[new Ee(e.key,t,"constants have been deprecated as of v8")]:[]}function wr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var g=v[f];for(var S in g)e[S]=g[S]}return e}function Yt(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function tr(e){if(Array.isArray(e))return e.map(tr);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=tr(e[r]);return t}return Yt(e)}var Ur=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),Fn=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,f=t;r<f.length;r+=1){var v=f[r];this.bindings[v[0]]=v[1]}};Fn.prototype.concat=function(e){return new Fn(this,e)},Fn.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},Fn.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Rn={kind:"null"},qt={kind:"number"},Tn={kind:"string"},ln={kind:"boolean"},on={kind:"color"},Li={kind:"object"},bn={kind:"value"},Ii={kind:"collator"},ea={kind:"formatted"},ci={kind:"resolvedImage"};function qi(e,t){return{kind:"array",itemType:e,N:t}}function zi(e){if(e.kind==="array"){var t=zi(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var Mi=[Rn,qt,Tn,ln,on,ea,Li,qi(bn),ci];function la(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!la(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=Mi;r<f.length;r+=1)if(!la(f[r],t))return null}}return"Expected "+zi(e)+" but found "+zi(t)+" instead."}function Bi(e,t){return t.some(function(r){return r.kind===e.kind})}function ai(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var ki=E(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(M){return(M=Math.round(M))<0?0:M>255?255:M}function v(M){return f(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function g(M){return(z=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:z>1?1:z;var z}function S(M,z,Y){return Y<0?Y+=1:Y>1&&(Y-=1),6*Y<1?M+(z-M)*Y*6:2*Y<1?z:3*Y<2?M+(z-M)*(2/3-Y)*6:M}try{t.parseCSSColor=function(M){var z,Y=M.replace(/ /g,"").toLowerCase();if(Y in r)return r[Y].slice();if(Y[0]==="#")return Y.length===4?(z=parseInt(Y.substr(1),16))>=0&&z<=4095?[(3840&z)>>4|(3840&z)>>8,240&z|(240&z)>>4,15&z|(15&z)<<4,1]:null:Y.length===7&&(z=parseInt(Y.substr(1),16))>=0&&z<=16777215?[(16711680&z)>>16,(65280&z)>>8,255&z,1]:null;var J=Y.indexOf("("),oe=Y.indexOf(")");if(J!==-1&&oe+1===Y.length){var he=Y.substr(0,J),Se=Y.substr(J+1,oe-(J+1)).split(","),Ye=1;switch(he){case"rgba":if(Se.length!==4)return null;Ye=g(Se.pop());case"rgb":return Se.length!==3?null:[v(Se[0]),v(Se[1]),v(Se[2]),Ye];case"hsla":if(Se.length!==4)return null;Ye=g(Se.pop());case"hsl":if(Se.length!==3)return null;var $e=(parseFloat(Se[0])%360+360)%360/360,gt=g(Se[1]),nt=g(Se[2]),Lt=nt<=.5?nt*(gt+1):nt+gt-nt*gt,Ht=2*nt-Lt;return[f(255*S(Ht,Lt,$e+1/3)),f(255*S(Ht,Lt,$e)),f(255*S(Ht,Lt,$e-1/3)),Ye];default:return null}}return null}}catch(M){}}).parseCSSColor,wi=function(e,t,r,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=r,this.a=f};wi.parse=function(e){if(e){if(e instanceof wi)return e;if(typeof e=="string"){var t=ki(e);if(t)return new wi(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},wi.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},wi.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},wi.black=new wi(0,0,0,1),wi.white=new wi(1,1,1,1),wi.transparent=new wi(0,0,0,0),wi.red=new wi(1,0,0,1);var ro=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ro.prototype.compare=function(e,t){return this.collator.compare(e,t)},ro.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var po=function(e,t,r,f,v){this.text=e,this.image=t,this.scale=r,this.fontStack=f,this.textColor=v},ia=function(e){this.sections=e};ia.fromString=function(e){return new ia([new po(e,null,null,null,null)])},ia.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},ia.factory=function(e){return e instanceof ia?e:ia.fromString(e)},ia.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},ia.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var Gi=function(e){this.name=e.name,this.available=e.available};function Zs(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function nu(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof wi||e instanceof ro||e instanceof ia||e instanceof Gi)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!nu(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!nu(e[f]))return!1;return!0}return!1}function Aa(e){if(e===null)return Rn;if(typeof e=="string")return Tn;if(typeof e=="boolean")return ln;if(typeof e=="number")return qt;if(e instanceof wi)return on;if(e instanceof ro)return Ii;if(e instanceof ia)return ea;if(e instanceof Gi)return ci;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var g=Aa(v[f]);if(t){if(t===g)continue;t=bn;break}t=g}return qi(t||bn,r)}return Li}function No(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof wi||e instanceof ia||e instanceof Gi?e.toString():JSON.stringify(e)}Gi.prototype.toString=function(){return this.name},Gi.fromString=function(e){return e?new Gi({name:e,available:!1}):null},Gi.prototype.serialize=function(){return["image",this.name]};var Hi=function(e,t){this.type=e,this.value=t};Hi.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!nu(e[1]))return t.error("invalid value");var r=e[1],f=Aa(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new Hi(f,r)},Hi.prototype.evaluate=function(){return this.value},Hi.prototype.eachChild=function(){},Hi.prototype.outputDefined=function(){return!0},Hi.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof wi?["rgba"].concat(this.value.toArray()):this.value instanceof ia?this.value.serialize():this.value};var Wa=function(e){this.name="ExpressionEvaluationError",this.message=e};Wa.prototype.toJSON=function(){return this.message};var ao={string:Tn,number:qt,boolean:ln,object:Li},ga=function(e,t){this.type=e,this.args=t};ga.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var g,S;if(e.length>2){var M=e[1];if(typeof M!="string"||!(M in ao)||M==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);g=ao[M],f++}else g=bn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);S=e[2],f++}r=qi(g,S)}else r=ao[v];for(var z=[];f<e.length;f++){var Y=t.parse(e[f],f,bn);if(!Y)return null;z.push(Y)}return new ga(r,z)},ga.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!la(this.type,Aa(r)))return r;if(t===this.args.length-1)throw new Wa("Expected value to be of type "+zi(this.type)+", but found "+zi(Aa(r))+" instead.")}return null},ga.prototype.eachChild=function(e){this.args.forEach(e)},ga.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},ga.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Lo=function(e){this.type=ea,this.sections=e};Lo.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,g=1;g<=e.length-1;++g){var S=e[g];if(v&&typeof S=="object"&&!Array.isArray(S)){v=!1;var M=null;if(S["font-scale"]&&!(M=t.parse(S["font-scale"],1,qt)))return null;var z=null;if(S["text-font"]&&!(z=t.parse(S["text-font"],1,qi(Tn))))return null;var Y=null;if(S["text-color"]&&!(Y=t.parse(S["text-color"],1,on)))return null;var J=f[f.length-1];J.scale=M,J.font=z,J.textColor=Y}else{var oe=t.parse(e[g],1,bn);if(!oe)return null;var he=oe.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:oe,scale:null,font:null,textColor:null})}}return new Lo(f)},Lo.prototype.evaluate=function(e){return new ia(this.sections.map(function(t){var r=t.content.evaluate(e);return Aa(r)===ci?new po("",r,null,null,null):new po(No(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Lo.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},Lo.prototype.outputDefined=function(){return!1},Lo.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var Fa=function(e){this.type=ci,this.input=e};Fa.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,Tn);return r?new Fa(r):t.error("No image name provided.")},Fa.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=Gi.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},Fa.prototype.eachChild=function(e){e(this.input)},Fa.prototype.outputDefined=function(){return!1},Fa.prototype.serialize=function(){return["image",this.input.serialize()]};var Cs={"to-boolean":ln,"to-color":on,"to-number":qt,"to-string":Tn},Fi=function(e,t){this.type=e,this.args=t};Fi.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=Cs[r],v=[],g=1;g<e.length;g++){var S=t.parse(e[g],g,bn);if(!S)return null;v.push(S)}return new Fi(f,v)},Fi.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof wi)return t;if(typeof t=="string"){var g=e.parseColor(t);if(g)return g}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":Zs(t[0],t[1],t[2],t[3])))return new wi(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Wa(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var S=null,M=0,z=this.args;M<z.length;M+=1){if((S=z[M].evaluate(e))===null)return 0;var Y=Number(S);if(!isNaN(Y))return Y}throw new Wa("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?ia.fromString(No(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Gi.fromString(No(this.args[0].evaluate(e))):No(this.args[0].evaluate(e))},Fi.prototype.eachChild=function(e){this.args.forEach(e)},Fi.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Fi.prototype.serialize=function(){if(this.type.kind==="formatted")return new Lo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Fa(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ko=["Unknown","Point","LineString","Polygon"],ya=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ya.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ya.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Ko[this.feature.type]:this.feature.type:null},ya.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ya.prototype.canonicalID=function(){return this.canonical},ya.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ya.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=wi.parse(e)),t};var vo=function(e,t,r,f){this.name=e,this.type=t,this._evaluate=r,this.args=f};vo.prototype.evaluate=function(e){return this._evaluate(e,this.args)},vo.prototype.eachChild=function(e){this.args.forEach(e)},vo.prototype.outputDefined=function(){return!1},vo.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},vo.parse=function(e,t){var r,f=e[0],v=vo.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var g=Array.isArray(v)?v[0]:v.type,S=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,M=S.filter(function(si){var jn=si[0];return!Array.isArray(jn)||jn.length===e.length-1}),z=null,Y=0,J=M;Y<J.length;Y+=1){var oe=J[Y],he=oe[0],Se=oe[1];z=new rs(t.registry,t.path,null,t.scope);for(var Ye=[],$e=!1,gt=1;gt<e.length;gt++){var nt=e[gt],Lt=Array.isArray(he)?he[gt-1]:he.type,Ht=z.parse(nt,1+Ye.length,Lt);if(!Ht){$e=!0;break}Ye.push(Ht)}if(!$e)if(Array.isArray(he)&&he.length!==Ye.length)z.error("Expected "+he.length+" arguments, but found "+Ye.length+" instead.");else{for(var pr=0;pr<Ye.length;pr++){var vr=Array.isArray(he)?he[pr]:he.type,Br=Ye[pr];z.concat(pr+1).checkSubtype(vr,Br.type)}if(z.errors.length===0)return new vo(f,g,Se,Ye)}}if(M.length===1)(r=t.errors).push.apply(r,z.errors);else{for(var nn=(M.length?M:S).map(function(si){var jn;return jn=si[0],Array.isArray(jn)?"("+jn.map(zi).join(", ")+")":"("+zi(jn.type)+"...)"}).join(" | "),xn=[],pi=1;pi<e.length;pi++){var kn=t.parse(e[pi],1+xn.length);if(!kn)return null;xn.push(zi(kn.type))}t.error("Expected arguments of type "+nn+", but found ("+xn.join(", ")+") instead.")}return null},vo.register=function(e,t){for(var r in vo.definitions=t,t)e[r]=vo};var Da=function(e,t,r){this.type=Ii,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function So(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function xe(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Fe(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function pt(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function Jt(e,t){for(var r,f,v,g,S,M,z,Y=!1,J=0,oe=t.length;J<oe;J++)for(var he=t[J],Se=0,Ye=he.length;Se<Ye-1;Se++){if((g=(r=e)[0]-(f=he[Se])[0])*(z=r[1]-(v=he[Se+1])[1])-(M=r[0]-v[0])*(S=r[1]-f[1])==0&&g*M<=0&&S*z<=0)return!1;pt(e,he[Se],he[Se+1])&&(Y=!Y)}return Y}function Yr(e,t){for(var r=0;r<t.length;r++)if(Jt(e,t[r]))return!0;return!1}function Qn(e,t,r,f){var v=f[0]-r[0],g=f[1]-r[1],S=(e[0]-r[0])*g-v*(e[1]-r[1]),M=(t[0]-r[0])*g-v*(t[1]-r[1]);return S>0&&M<0||S<0&&M>0}function Ci(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var g=v[f],S=0;S<g.length-1;++S)if((oe=[(J=g[S+1])[0]-(Y=g[S])[0],J[1]-Y[1]])[0]*(he=[(z=t)[0]-(M=e)[0],z[1]-M[1]])[1]-oe[1]*he[0]!=0&&Qn(M,z,Y,J)&&Qn(Y,J,M,z))return!0;var M,z,Y,J,oe,he;return!1}function Za(e,t){for(var r=0;r<e.length;++r)if(!Jt(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(Ci(e[f],e[f+1],t))return!1;return!0}function mo(e,t){for(var r=0;r<t.length;r++)if(Za(e,t[r]))return!0;return!1}function oo(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var g=[],S=0;S<e[v].length;S++){var M=Fe(e[v][S],r);So(t,M),g.push(M)}f.push(g)}return f}function es(e,t,r){for(var f=[],v=0;v<e.length;v++){var g=oo(e[v],t,r);f.push(g)}return f}function $s(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,g=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;g===0&&(g=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=g}So(t,e)}function ja(e,t,r,f){for(var v=8192*Math.pow(2,f.z),g=[8192*f.x,8192*f.y],S=[],M=0,z=e;M<z.length;M+=1)for(var Y=0,J=z[M];Y<J.length;Y+=1){var oe=J[Y],he=[oe.x+g[0],oe.y+g[1]];$s(he,t,r,v),S.push(he)}return S}function Fu(e,t,r,f){for(var v,g=8192*Math.pow(2,f.z),S=[8192*f.x,8192*f.y],M=[],z=0,Y=e;z<Y.length;z+=1){for(var J=[],oe=0,he=Y[z];oe<he.length;oe+=1){var Se=he[oe],Ye=[Se.x+S[0],Se.y+S[1]];So(t,Ye),J.push(Ye)}M.push(J)}if(t[2]-t[0]<=g/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var $e=0,gt=M;$e<gt.length;$e+=1)for(var nt=0,Lt=gt[$e];nt<Lt.length;nt+=1)$s(Lt[nt],t,r,g)}return M}Da.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,ln);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,ln);if(!v)return null;var g=null;return r.locale&&!(g=t.parse(r.locale,1,Tn))?null:new Da(f,v,g)},Da.prototype.evaluate=function(e){return new ro(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},Da.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},Da.prototype.outputDefined=function(){return!1},Da.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var ts=function(e,t){this.type=ln,this.geojson=e,this.geometries=t};function zo(e){if(e instanceof vo&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof ts)return!1;var t=!0;return e.eachChild(function(r){t&&!zo(r)&&(t=!1)}),t}function so(e){if(e instanceof vo&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!so(r)&&(t=!1)}),t}function oi(e,t){if(e instanceof vo&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!oi(f,t)&&(r=!1)}),r}ts.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(nu(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new ts(r,r.features[f].geometry)}else if(r.type==="Feature"){var g=r.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new ts(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new ts(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ts.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],g=t.canonicalID();if(r.type==="Polygon"){var S=oo(r.coordinates,v,g),M=ja(t.geometry(),f,v,g);if(!xe(f,v))return!1;for(var z=0,Y=M;z<Y.length;z+=1)if(!Jt(Y[z],S))return!1}if(r.type==="MultiPolygon"){var J=es(r.coordinates,v,g),oe=ja(t.geometry(),f,v,g);if(!xe(f,v))return!1;for(var he=0,Se=oe;he<Se.length;he+=1)if(!Yr(Se[he],J))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],g=t.canonicalID();if(r.type==="Polygon"){var S=oo(r.coordinates,v,g),M=Fu(t.geometry(),f,v,g);if(!xe(f,v))return!1;for(var z=0,Y=M;z<Y.length;z+=1)if(!Za(Y[z],S))return!1}if(r.type==="MultiPolygon"){var J=es(r.coordinates,v,g),oe=Fu(t.geometry(),f,v,g);if(!xe(f,v))return!1;for(var he=0,Se=oe;he<Se.length;he+=1)if(!mo(Se[he],J))return!1}return!0}(e,this.geometries)}return!1},ts.prototype.eachChild=function(){},ts.prototype.outputDefined=function(){return!0},ts.prototype.serialize=function(){return["within",this.geojson]};var ys=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};ys.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new ys(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},ys.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},ys.prototype.eachChild=function(){},ys.prototype.outputDefined=function(){return!1},ys.prototype.serialize=function(){return["var",this.name]};var rs=function(e,t,r,f,v){t===void 0&&(t=[]),f===void 0&&(f=new Fn),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(g){return"["+g+"]"}).join(""),this.scope=f,this.errors=v,this.expectedType=r};function Bs(e,t){for(var r,f=e.length-1,v=0,g=f,S=0;v<=g;)if((r=e[S=Math.floor((v+g)/2)])<=t){if(S===f||t<e[S+1])return S;v=S+1}else{if(!(r>t))throw new Wa("Input is not a number.");g=S-1}return 0}rs.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},rs.prototype._parse=function(e,t){function r(Y,J,oe){return oe==="assert"?new ga(J,[Y]):oe==="coerce"?new Fi(J,[Y]):Y}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var g=v.parse(e,this);if(!g)return null;if(this.expectedType){var S=this.expectedType,M=g.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||M.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(S,M))return null}else g=r(g,S,t.typeAnnotation||"coerce");else g=r(g,S,t.typeAnnotation||"assert")}if(!(g instanceof Hi)&&g.type.kind!=="resolvedImage"&&function Y(J){if(J instanceof ys)return Y(J.boundExpression);if(J instanceof vo&&J.name==="error"||J instanceof Da||J instanceof ts)return!1;var oe=J instanceof Fi||J instanceof ga,he=!0;return J.eachChild(function(Se){he=oe?he&&Y(Se):he&&Se instanceof Hi}),!!he&&zo(J)&&oi(J,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(g)){var z=new ya;try{g=new Hi(g.type,g.evaluate(z))}catch(Y){return this.error(Y.message),null}}return g}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},rs.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new rs(this.registry,f,t||null,v,this.errors)},rs.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new Ur(f,e))},rs.prototype.checkSubtype=function(e,t){var r=la(e,t);return r&&this.error(r),r};var ns=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,v=r;f<v.length;f+=1){var g=v[f],S=g[1];this.labels.push(g[0]),this.outputs.push(S)}};function Pa(e,t,r){return e*(1-r)+t*r}ns.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,qt);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var g=1;g<e.length;g+=2){var S=g===1?-1/0:e[g],M=e[g+1],z=g,Y=g+1;if(typeof S!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(f.length&&f[f.length-1][0]>=S)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);var J=t.parse(M,Y,v);if(!J)return null;v=v||J.type,f.push([S,J])}return new ns(v,r,f)},ns.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[Bs(t,f)].evaluate(e)},ns.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},ns.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ns.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var uo=Object.freeze({__proto__:null,number:Pa,color:function(e,t,r){return new wi(Pa(e.r,t.r,r),Pa(e.g,t.g,r),Pa(e.b,t.b,r),Pa(e.a,t.a,r))},array:function(e,t,r){return e.map(function(f,v){return Pa(f,t[v],r)})}}),yl=6/29*3*(6/29),_l=Math.PI/180,Bu=180/Math.PI;function Vl(e){return e>.008856451679035631?Math.pow(e,1/3):e/yl+4/29}function Eu(e){return e>6/29?e*e*e:yl*(e-4/29)}function lo(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function js(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ws(e){var t=js(e.r),r=js(e.g),f=js(e.b),v=Vl((.4124564*t+.3575761*r+.1804375*f)/.95047),g=Vl((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*g-16,a:500*(v-g),b:200*(g-Vl((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function m(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*Eu(t),r=.95047*Eu(r),f=1.08883*Eu(f),new wi(lo(3.2404542*r-1.5371385*t-.4985314*f),lo(-.969266*r+1.8760108*t+.041556*f),lo(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function T(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var H={forward:ws,reverse:m,interpolate:function(e,t,r){return{l:Pa(e.l,t.l,r),a:Pa(e.a,t.a,r),b:Pa(e.b,t.b,r),alpha:Pa(e.alpha,t.alpha,r)}}},R={forward:function(e){var t=ws(e),r=t.l,f=t.a,v=t.b,g=Math.atan2(v,f)*Bu;return{h:g<0?g+360:g,c:Math.sqrt(f*f+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*_l,r=e.c;return m({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:T(e.h,t.h,r),c:Pa(e.c,t.c,r),l:Pa(e.l,t.l,r),alpha:Pa(e.alpha,t.alpha,r)}}},ce=Object.freeze({__proto__:null,lab:H,hcl:R}),ye=function(e,t,r,f,v){this.type=e,this.operator=t,this.interpolation=r,this.input=f,this.labels=[],this.outputs=[];for(var g=0,S=v;g<S.length;g+=1){var M=S[g],z=M[1];this.labels.push(M[0]),this.outputs.push(z)}};function lt(e,t,r,f){var v=f-r,g=e-r;return v===0?0:t===1?g/v:(Math.pow(t,g)-1)/(Math.pow(t,v)-1)}ye.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=lt(t,e.base,r,f);else if(e.name==="linear")v=lt(t,1,r,f);else if(e.name==="cubic-bezier"){var g=e.controlPoints;v=new Z(g[0],g[1],g[2],g[3]).solve(lt(t,1,r,f))}return v},ye.parse=function(e,t){var r=e[0],f=e[1],v=e[2],g=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var S=f[1];if(typeof S!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:S}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var M=f.slice(1);if(M.length!==4||M.some(function(gt){return typeof gt!="number"||gt<0||gt>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:M}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,qt)))return null;var z=[],Y=null;r==="interpolate-hcl"||r==="interpolate-lab"?Y=on:t.expectedType&&t.expectedType.kind!=="value"&&(Y=t.expectedType);for(var J=0;J<g.length;J+=2){var oe=g[J],he=g[J+1],Se=J+3,Ye=J+4;if(typeof oe!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Se);if(z.length&&z[z.length-1][0]>=oe)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Se);var $e=t.parse(he,Ye,Y);if(!$e)return null;Y=Y||$e.type,z.push([oe,$e])}return Y.kind==="number"||Y.kind==="color"||Y.kind==="array"&&Y.itemType.kind==="number"&&typeof Y.N=="number"?new ye(Y,r,f,v,z):t.error("Type "+zi(Y)+" is not interpolatable.")},ye.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var g=Bs(t,f),S=ye.interpolationFactor(this.interpolation,f,t[g],t[g+1]),M=r[g].evaluate(e),z=r[g+1].evaluate(e);return this.operator==="interpolate"?uo[this.type.kind.toLowerCase()](M,z,S):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(M),R.forward(z),S)):H.reverse(H.interpolate(H.forward(M),H.forward(z),S))},ye.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},ye.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ye.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Vt=function(e,t){this.type=e,this.args=t};Vt.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],g=0,S=e.slice(1);g<S.length;g+=1){var M=t.parse(S[g],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!M)return null;r=r||M.type,v.push(M)}var z=f&&v.some(function(Y){return la(f,Y.type)});return new Vt(z?bn:r,v)},Vt.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,g=this.args;v<g.length&&(f++,(r=g[v].evaluate(e))&&r instanceof Gi&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},Vt.prototype.eachChild=function(e){this.args.forEach(e)},Vt.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Vt.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Mt=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Mt.prototype.evaluate=function(e){return this.result.evaluate(e)},Mt.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},Mt.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var g=t.parse(e[f+1],f+1);if(!g)return null;r.push([v,g])}var S=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return S?new Mt(r,S):null},Mt.prototype.outputDefined=function(){return this.result.outputDefined()},Mt.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var Ir=function(e,t,r){this.type=e,this.index=t,this.input=r};Ir.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,qt),f=t.parse(e[2],2,qi(t.expectedType||bn));return r&&f?new Ir(f.type.itemType,r,f):null},Ir.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Wa("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Wa("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Wa("Array index must be an integer, but found "+t+" instead.");return r[t]},Ir.prototype.eachChild=function(e){e(this.index),e(this.input)},Ir.prototype.outputDefined=function(){return!1},Ir.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Hr=function(e,t){this.type=ln,this.needle=e,this.haystack=t};Hr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,bn),f=t.parse(e[2],2,bn);return r&&f?Bi(r.type,[ln,Tn,qt,Rn,bn])?new Hr(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+zi(r.type)+" instead"):null},Hr.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!ai(t,["boolean","string","number","null"]))throw new Wa("Expected first argument to be of type boolean, string, number or null, but found "+zi(Aa(t))+" instead.");if(!ai(r,["string","array"]))throw new Wa("Expected second argument to be of type array or string, but found "+zi(Aa(r))+" instead.");return r.indexOf(t)>=0},Hr.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Hr.prototype.outputDefined=function(){return!0},Hr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var qn=function(e,t,r){this.type=qt,this.needle=e,this.haystack=t,this.fromIndex=r};qn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,bn),f=t.parse(e[2],2,bn);if(!r||!f)return null;if(!Bi(r.type,[ln,Tn,qt,Rn,bn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+zi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,qt);return v?new qn(r,f,v):null}return new qn(r,f)},qn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!ai(t,["boolean","string","number","null"]))throw new Wa("Expected first argument to be of type boolean, string, number or null, but found "+zi(Aa(t))+" instead.");if(!ai(r,["string","array"]))throw new Wa("Expected second argument to be of type array or string, but found "+zi(Aa(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},qn.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},qn.prototype.outputDefined=function(){return!1},qn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var bi=function(e,t,r,f,v,g){this.inputType=e,this.type=t,this.input=r,this.cases=f,this.outputs=v,this.otherwise=g};bi.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},g=[],S=2;S<e.length-1;S+=2){var M=e[S],z=e[S+1];Array.isArray(M)||(M=[M]);var Y=t.concat(S);if(M.length===0)return Y.error("Expected at least one branch label.");for(var J=0,oe=M;J<oe.length;J+=1){var he=oe[J];if(typeof he!="number"&&typeof he!="string")return Y.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return Y.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof he=="number"&&Math.floor(he)!==he)return Y.error("Numeric branch labels must be integer values.");if(r){if(Y.checkSubtype(r,Aa(he)))return null}else r=Aa(he);if(v[String(he)]!==void 0)return Y.error("Branch labels must be unique.");v[String(he)]=g.length}var Se=t.parse(z,S,f);if(!Se)return null;f=f||Se.type,g.push(Se)}var Ye=t.parse(e[1],1,bn);if(!Ye)return null;var $e=t.parse(e[e.length-1],e.length-1,f);return $e?Ye.type.kind!=="value"&&t.concat(1).checkSubtype(r,Ye.type)?null:new bi(r,f,Ye,v,g,$e):null},bi.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(Aa(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},bi.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},bi.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},bi.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,g=Object.keys(this.cases).sort();v<g.length;v+=1){var S=g[v];(oe=f[this.cases[S]])===void 0?(f[this.cases[S]]=r.length,r.push([this.cases[S],[S]])):r[oe][1].push(S)}for(var M=function(Se){return e.inputType.kind==="number"?Number(Se):Se},z=0,Y=r;z<Y.length;z+=1){var J=Y[z],oe=J[0],he=J[1];t.push(he.length===1?M(he[0]):he.map(M)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var di=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};di.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var g=t.parse(e[v],v,ln);if(!g)return null;var S=t.parse(e[v+1],v+1,r);if(!S)return null;f.push([g,S]),r=r||S.type}var M=t.parse(e[e.length-1],e.length-1,r);return M?new di(r,f,M):null},di.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},di.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},di.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},di.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var ca=function(e,t,r,f){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=f};function Wi(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ka(e,t,r,f){return f.compare(t,r)===0}function Xi(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(g,S,M){this.type=ln,this.lhs=g,this.rhs=S,this.collator=M,this.hasUntypedArgument=g.type.kind==="value"||S.type.kind==="value"}return v.parse=function(g,S){if(g.length!==3&&g.length!==4)return S.error("Expected two or three arguments.");var M=g[0],z=S.parse(g[1],1,bn);if(!z)return null;if(!Wi(M,z.type))return S.concat(1).error('"'+M+`" comparisons are not supported for type '`+zi(z.type)+"'.");var Y=S.parse(g[2],2,bn);if(!Y)return null;if(!Wi(M,Y.type))return S.concat(2).error('"'+M+`" comparisons are not supported for type '`+zi(Y.type)+"'.");if(z.type.kind!==Y.type.kind&&z.type.kind!=="value"&&Y.type.kind!=="value")return S.error("Cannot compare types '"+zi(z.type)+"' and '"+zi(Y.type)+"'.");f&&(z.type.kind==="value"&&Y.type.kind!=="value"?z=new ga(Y.type,[z]):z.type.kind!=="value"&&Y.type.kind==="value"&&(Y=new ga(z.type,[Y])));var J=null;if(g.length===4){if(z.type.kind!=="string"&&Y.type.kind!=="string"&&z.type.kind!=="value"&&Y.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(J=S.parse(g[3],3,Ii)))return null}return new v(z,Y,J)},v.prototype.evaluate=function(g){var S=this.lhs.evaluate(g),M=this.rhs.evaluate(g);if(f&&this.hasUntypedArgument){var z=Aa(S),Y=Aa(M);if(z.kind!==Y.kind||z.kind!=="string"&&z.kind!=="number")throw new Wa('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+z.kind+", "+Y.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var J=Aa(S),oe=Aa(M);if(J.kind!=="string"||oe.kind!=="string")return t(g,S,M)}return this.collator?r(g,S,M,this.collator.evaluate(g)):t(g,S,M)},v.prototype.eachChild=function(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var g=[e];return this.eachChild(function(S){g.push(S.serialize())}),g},v}()}ca.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,bn),f=t.parse(e[2],2,qt);if(!r||!f)return null;if(!Bi(r.type,[qi(bn),Tn,bn]))return t.error("Expected first argument to be of type array or string, but found "+zi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,qt);return v?new ca(r.type,r,f,v):null}return new ca(r.type,r,f)},ca.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!ai(t,["string","array"]))throw new Wa("Expected first argument to be of type array or string, but found "+zi(Aa(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},ca.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},ca.prototype.outputDefined=function(){return!1},ca.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Yi=Xi("==",function(e,t,r){return t===r},ka),Js=Xi("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!ka(0,t,r,f)}),Cu=Xi("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),xl=Xi(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),wu=Xi("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),ds=Xi(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),vs=function(e,t,r,f,v){this.type=Tn,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=f,this.maxFractionDigits=v};vs.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,qt);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,Tn)))return null;var g=null;if(f.currency&&!(g=t.parse(f.currency,1,Tn)))return null;var S=null;if(f["min-fraction-digits"]&&!(S=t.parse(f["min-fraction-digits"],1,qt)))return null;var M=null;return f["max-fraction-digits"]&&!(M=t.parse(f["max-fraction-digits"],1,qt))?null:new vs(r,v,g,S,M)},vs.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},vs.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},vs.prototype.outputDefined=function(){return!1},vs.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var ms=function(e){this.type=qt,this.input=e};ms.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+zi(r.type)+" instead."):new ms(r):null},ms.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Wa("Expected value to be of type string or array, but found "+zi(Aa(t))+" instead.")},ms.prototype.eachChild=function(e){e(this.input)},ms.prototype.outputDefined=function(){return!1},ms.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ts={"==":Yi,"!=":Js,">":xl,"<":Cu,">=":ds,"<=":wu,array:ga,at:Ir,boolean:ga,case:di,coalesce:Vt,collator:Da,format:Lo,image:Fa,in:Hr,"index-of":qn,interpolate:ye,"interpolate-hcl":ye,"interpolate-lab":ye,length:ms,let:Mt,literal:Hi,match:bi,number:ga,"number-format":vs,object:ga,slice:ca,step:ns,string:ga,"to-boolean":Fi,"to-color":Fi,"to-number":Fi,"to-string":Fi,var:ys,within:ts};function co(e,t){var r=t[0],f=t[1],v=t[2],g=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var S=g?g.evaluate(e):1,M=Zs(r,f,v,S);if(M)throw new Wa(M);return new wi(r/255*S,f/255*S,v/255*S,S)}function Gl(e,t){return e in t}function Hl(e,t){var r=t[e];return r===void 0?null:r}function is(e){return{type:e}}function Wl(e){return{result:"success",value:e}}function As(e){return{result:"error",value:e}}function _s(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function Xl(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Nu(e){return!!e.expression&&e.expression.interpolated}function Ia(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function zu(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Fc(e){return e}function Tu(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function Yl(e,t,r,f,v){return Tu(typeof r===v?f[r]:void 0,e.default,t.default)}function Bc(e,t,r){if(Ia(r)!=="number")return Tu(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=Bs(e.stops.map(function(g){return g[0]}),r);return e.stops[v][1]}function rl(e,t,r){var f=e.base!==void 0?e.base:1;if(Ia(r)!=="number")return Tu(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var g=Bs(e.stops.map(function(oe){return oe[0]}),r),S=function(oe,he,Se,Ye){var $e=Ye-Se,gt=oe-Se;return $e===0?0:he===1?gt/$e:(Math.pow(he,gt)-1)/(Math.pow(he,$e)-1)}(r,f,e.stops[g][0],e.stops[g+1][0]),M=e.stops[g][1],z=e.stops[g+1][1],Y=uo[t.type]||Fc;if(e.colorSpace&&e.colorSpace!=="rgb"){var J=ce[e.colorSpace];Y=function(oe,he){return J.reverse(J.interpolate(J.forward(oe),J.forward(he),S))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var oe=[],he=arguments.length;he--;)oe[he]=arguments[he];var Se=M.evaluate.apply(void 0,oe),Ye=z.evaluate.apply(void 0,oe);if(Se!==void 0&&Ye!==void 0)return Y(Se,Ye,S)}}:Y(M,z,S)}function nl(e,t,r){return t.type==="color"?r=wi.parse(r):t.type==="formatted"?r=ia.fromString(r.toString()):t.type==="resolvedImage"?r=Gi.fromString(r.toString()):Ia(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),Tu(r,e.default,t.default)}vo.register(Ts,{error:[{kind:"error"},[Tn],function(e,t){throw new Wa(t[0].evaluate(e))}],typeof:[Tn,[bn],function(e,t){return zi(Aa(t[0].evaluate(e)))}],"to-rgba":[qi(qt,4),[on],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[on,[qt,qt,qt],co],rgba:[on,[qt,qt,qt,qt],co],has:{type:ln,overloads:[[[Tn],function(e,t){return Gl(t[0].evaluate(e),e.properties())}],[[Tn,Li],function(e,t){var r=t[1];return Gl(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:bn,overloads:[[[Tn],function(e,t){return Hl(t[0].evaluate(e),e.properties())}],[[Tn,Li],function(e,t){var r=t[1];return Hl(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[bn,[Tn],function(e,t){return Hl(t[0].evaluate(e),e.featureState||{})}],properties:[Li,[],function(e){return e.properties()}],"geometry-type":[Tn,[],function(e){return e.geometryType()}],id:[bn,[],function(e){return e.id()}],zoom:[qt,[],function(e){return e.globals.zoom}],"heatmap-density":[qt,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[qt,[],function(e){return e.globals.lineProgress||0}],accumulated:[bn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[qt,is(qt),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[qt,is(qt),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:qt,overloads:[[[qt,qt],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[qt],function(e,t){return-t[0].evaluate(e)}]]},"/":[qt,[qt,qt],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[qt,[qt,qt],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[qt,[],function(){return Math.LN2}],pi:[qt,[],function(){return Math.PI}],e:[qt,[],function(){return Math.E}],"^":[qt,[qt,qt],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[qt,[qt],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[qt,[qt],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[qt,[qt],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[qt,[qt],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[qt,[qt],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[qt,[qt],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[qt,[qt],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[qt,[qt],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[qt,[qt],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[qt,[qt],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[qt,is(qt),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[qt,is(qt),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[qt,[qt],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[qt,[qt],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[qt,[qt],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[qt,[qt],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[ln,[Tn,bn],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[ln,[bn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[ln,[Tn],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[ln,[Tn,bn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v<g}],"filter-id-<":[ln,[bn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[ln,[Tn,bn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v>g}],"filter-id->":[ln,[bn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[ln,[Tn,bn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v<=g}],"filter-id-<=":[ln,[bn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[ln,[Tn,bn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v>=g}],"filter-id->=":[ln,[bn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[ln,[bn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[ln,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[ln,[qi(Tn)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[ln,[qi(bn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[ln,[Tn,qi(bn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[ln,[Tn,qi(bn)],function(e,t){var r=t[0],f=t[1];return function(v,g,S,M){for(;S<=M;){var z=S+M>>1;if(g[z]===v)return!0;g[z]>v?M=z-1:S=z+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:ln,overloads:[[[ln,ln],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[is(ln),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:ln,overloads:[[[ln,ln],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[is(ln),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[ln,[ln],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[ln,[Tn],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[Tn,[Tn],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[Tn,[Tn],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[Tn,is(bn),function(e,t){return t.map(function(r){return No(r.evaluate(e))}).join("")}],"resolved-locale":[Tn,[Ii],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var bl=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new ya,this._defaultValue=t?function(r){return r.type==="color"&&zu(r.default)?new wi(0,0,0,0):r.type==="color"?wi.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function il(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Ts}function Sl(e,t){var r=new rs(Ts,[],t?function(v){var g={color:on,string:Tn,number:qt,enum:Tn,boolean:ln,formatted:ea,resolvedImage:ci};return v.type==="array"?qi(g[v.value]||bn,v.length):g[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Wl(new bl(f,t)):As(r.errors)}bl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)},bl.prototype.evaluate=function(e,t,r,f,v,g){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=g||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Wa("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var al=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!so(t.expression)};al.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,g)},al.prototype.evaluate=function(e,t,r,f,v,g){return this._styleExpression.evaluate(e,t,r,f,v,g)};var ol=function(e,t,r,f){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!so(t.expression),this.interpolationType=f};function sl(e,t){if((e=Sl(e,t)).result==="error")return e;var r=e.value.expression,f=zo(r);if(!f&&!_s(t))return As([new Ur("","data expressions not supported")]);var v=oi(r,["zoom"]);if(!v&&!Xl(t))return As([new Ur("","zoom expressions not supported")]);var g=function S(M){var z=null;if(M instanceof Mt)z=S(M.result);else if(M instanceof Vt)for(var Y=0,J=M.args;Y<J.length&&!(z=S(J[Y]));Y+=1);else(M instanceof ns||M instanceof ye)&&M.input instanceof vo&&M.input.name==="zoom"&&(z=M);return z instanceof Ur||M.eachChild(function(oe){var he=S(oe);he instanceof Ur?z=he:!z&&he?z=new Ur("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):z&&he&&z!==he&&(z=new Ur("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),z}(r);return g||v?g instanceof Ur?As([g]):g instanceof ye&&!Nu(t)?As([new Ur("",'"interpolate" expressions cannot be used with this property')]):Wl(g?new ol(f?"camera":"composite",e.value,g.labels,g instanceof ye?g.interpolation:void 0):new al(f?"constant":"source",e.value)):As([new Ur("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ol.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,g)},ol.prototype.evaluate=function(e,t,r,f,v,g){return this._styleExpression.evaluate(e,t,r,f,v,g)},ol.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?ye.interpolationFactor(this.interpolationType,e,t,r):0};var iu=function(e,t){this._parameters=e,this._specification=t,wr(this,function r(f,v){var g,S,M,z=v.type==="color",Y=f.stops&&typeof f.stops[0][0]=="object",J=Y||!(Y||f.property!==void 0),oe=f.type||(Nu(v)?"exponential":"interval");if(z&&((f=wr({},f)).stops&&(f.stops=f.stops.map(function(kn){return[kn[0],wi.parse(kn[1])]})),f.default=wi.parse(f.default?f.default:v.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!ce[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(oe==="exponential")g=rl;else if(oe==="interval")g=Bc;else if(oe==="categorical"){g=Yl,S=Object.create(null);for(var he=0,Se=f.stops;he<Se.length;he+=1){var Ye=Se[he];S[Ye[0]]=Ye[1]}M=typeof f.stops[0][0]}else{if(oe!=="identity")throw new Error('Unknown function type "'+oe+'"');g=nl}if(Y){for(var $e={},gt=[],nt=0;nt<f.stops.length;nt++){var Lt=f.stops[nt],Ht=Lt[0].zoom;$e[Ht]===void 0&&($e[Ht]={zoom:Ht,type:f.type,property:f.property,default:f.default,stops:[]},gt.push(Ht)),$e[Ht].stops.push([Lt[0].value,Lt[1]])}for(var pr=[],vr=0,Br=gt;vr<Br.length;vr+=1){var nn=Br[vr];pr.push([$e[nn].zoom,r($e[nn],v)])}var xn={name:"linear"};return{kind:"composite",interpolationType:xn,interpolationFactor:ye.interpolationFactor.bind(void 0,xn),zoomStops:pr.map(function(kn){return kn[0]}),evaluate:function(kn,si){var jn=kn.zoom;return rl({stops:pr,base:f.base},v,jn).evaluate(jn,si)}}}if(J){var pi=oe==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:pi,interpolationFactor:ye.interpolationFactor.bind(void 0,pi),zoomStops:f.stops.map(function(kn){return kn[0]}),evaluate:function(kn){return g(f,v,kn.zoom,S,M)}}}return{kind:"source",evaluate:function(kn,si){var jn=si&&si.properties?si.properties[f.property]:void 0;return jn===void 0?Tu(f.default,v.default):g(f,v,jn,S,M)}}}(this._parameters,this._specification))};function Qs(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},g=e.style,S=e.styleSpec,M=[],z=Ia(r);if(z!=="object")return[new Ee(t,r,"object expected, "+z+" found")];for(var Y in r){var J=Y.split(".")[0],oe=f[J]||f["*"],he=void 0;if(v[J])he=v[J];else if(f[J])he=aa;else if(v["*"])he=v["*"];else{if(!f["*"]){M.push(new Ee(t,r[Y],'unknown property "'+Y+'"'));continue}he=aa}M=M.concat(he({key:(t&&t+".")+Y,value:r[Y],valueSpec:oe,style:g,styleSpec:S,object:r,objectKey:Y},r))}for(var Se in f)v[Se]||f[Se].required&&f[Se].default===void 0&&r[Se]===void 0&&M.push(new Ee(t,r,'missing required property "'+Se+'"'));return M}function gc(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,g=e.key,S=e.arrayElementValidator||aa;if(Ia(t)!=="array")return[new Ee(g,t,"array expected, "+Ia(t)+" found")];if(r.length&&t.length!==r.length)return[new Ee(g,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new Ee(g,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var M={type:r.value,values:r.values};v.$version<7&&(M.function=r.function),Ia(r.value)==="object"&&(M=r.value);for(var z=[],Y=0;Y<t.length;Y++)z=z.concat(S({array:t,arrayIndex:Y,value:t[Y],valueSpec:M,style:f,styleSpec:v,key:g+"["+Y+"]"}));return z}function yc(e){var t=e.key,r=e.value,f=e.valueSpec,v=Ia(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new Ee(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new Ee(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new Ee(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function Nc(e){var t,r,f,v=e.valueSpec,g=Yt(e.value.type),S={},M=g!=="categorical"&&e.value.property===void 0,z=!M,Y=Ia(e.value.stops)==="array"&&Ia(e.value.stops[0])==="array"&&Ia(e.value.stops[0][0])==="object",J=Qs({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(Se){if(g==="identity")return[new Ee(Se.key,Se.value,'identity function may not have a "stops" property')];var Ye=[],$e=Se.value;return Ye=Ye.concat(gc({key:Se.key,value:$e,valueSpec:Se.valueSpec,style:Se.style,styleSpec:Se.styleSpec,arrayElementValidator:oe})),Ia($e)==="array"&&$e.length===0&&Ye.push(new Ee(Se.key,$e,"array must have at least one stop")),Ye},default:function(Se){return aa({key:Se.key,value:Se.value,valueSpec:v,style:Se.style,styleSpec:Se.styleSpec})}}});return g==="identity"&&M&&J.push(new Ee(e.key,e.value,'missing required property "property"')),g==="identity"||e.value.stops||J.push(new Ee(e.key,e.value,'missing required property "stops"')),g==="exponential"&&e.valueSpec.expression&&!Nu(e.valueSpec)&&J.push(new Ee(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(z&&!_s(e.valueSpec)?J.push(new Ee(e.key,e.value,"property functions not supported")):M&&!Xl(e.valueSpec)&&J.push(new Ee(e.key,e.value,"zoom functions not supported"))),g!=="categorical"&&!Y||e.value.property!==void 0||J.push(new Ee(e.key,e.value,'"property" property is required')),J;function oe(Se){var Ye=[],$e=Se.value,gt=Se.key;if(Ia($e)!=="array")return[new Ee(gt,$e,"array expected, "+Ia($e)+" found")];if($e.length!==2)return[new Ee(gt,$e,"array length 2 expected, length "+$e.length+" found")];if(Y){if(Ia($e[0])!=="object")return[new Ee(gt,$e,"object expected, "+Ia($e[0])+" found")];if($e[0].zoom===void 0)return[new Ee(gt,$e,"object stop key must have zoom")];if($e[0].value===void 0)return[new Ee(gt,$e,"object stop key must have value")];if(f&&f>Yt($e[0].zoom))return[new Ee(gt,$e[0].zoom,"stop zoom values must appear in ascending order")];Yt($e[0].zoom)!==f&&(f=Yt($e[0].zoom),r=void 0,S={}),Ye=Ye.concat(Qs({key:gt+"[0]",value:$e[0],valueSpec:{zoom:{}},style:Se.style,styleSpec:Se.styleSpec,objectElementValidators:{zoom:yc,value:he}}))}else Ye=Ye.concat(he({key:gt+"[0]",value:$e[0],valueSpec:{},style:Se.style,styleSpec:Se.styleSpec},$e));return il(tr($e[1]))?Ye.concat([new Ee(gt+"[1]",$e[1],"expressions are not allowed in function stops.")]):Ye.concat(aa({key:gt+"[1]",value:$e[1],valueSpec:v,style:Se.style,styleSpec:Se.styleSpec}))}function he(Se,Ye){var $e=Ia(Se.value),gt=Yt(Se.value),nt=Se.value!==null?Se.value:Ye;if(t){if($e!==t)return[new Ee(Se.key,nt,$e+" stop domain type must match previous stop domain type "+t)]}else t=$e;if($e!=="number"&&$e!=="string"&&$e!=="boolean")return[new Ee(Se.key,nt,"stop domain value must be a number, string, or boolean")];if($e!=="number"&&g!=="categorical"){var Lt="number expected, "+$e+" found";return _s(v)&&g===void 0&&(Lt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ee(Se.key,nt,Lt)]}return g!=="categorical"||$e!=="number"||isFinite(gt)&&Math.floor(gt)===gt?g!=="categorical"&&$e==="number"&&r!==void 0&&gt<r?[new Ee(Se.key,nt,"stop domain values must appear in ascending order")]:(r=gt,g==="categorical"&&gt in S?[new Ee(Se.key,nt,"stop domain values must be unique")]:(S[gt]=!0,[])):[new Ee(Se.key,nt,"integer expected, found "+gt)]}}function Uu(e){var t=(e.expressionContext==="property"?sl:Sl)(tr(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new Ee(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new Ee(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!so(r))return[new Ee(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!so(r))return[new Ee(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!oi(r,["zoom","feature-state"]))return[new Ee(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!zo(r))return[new Ee(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function El(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(Yt(r))===-1&&v.push(new Ee(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(Yt(r))===-1&&v.push(new Ee(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function Kl(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!Kl(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}iu.deserialize=function(e){return new iu(e._parameters,e._specification)},iu.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var _c={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function $l(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Kl(e)||(e=Au(e));var t=Sl(e,_c);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,f,v){return t.value.evaluate(r,f,{},v)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function Jl(e,t){return e<t?-1:e>t?1:0}function Au(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?Pu(e[1],e[2],"=="):r==="!="?pu(Pu(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Pu(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(Au))):r==="all"?["all"].concat(e.slice(1).map(Au)):r==="none"?["all"].concat(e.slice(1).map(Au).map(pu)):r==="in"?Ql(e[1],e.slice(2)):r==="!in"?pu(Ql(e[1],e.slice(2))):r==="has"?ql(e[1]):r==="!has"?pu(ql(e[1])):r!=="within"||e}function Pu(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function Ql(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(Jl)]]:["filter-in-small",e,["literal",t]]}}function ql(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function pu(e){return["!",e]}function xc(e){return Kl(tr(e.value))?Uu(wr({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(Ia(f)!=="array")return[new Ee(v,f,"array expected, "+Ia(f)+" found")];var g,S=r.styleSpec,M=[];if(f.length<1)return[new Ee(v,f,"filter array must have at least 1 element")];switch(M=M.concat(El({key:v+"[0]",value:f[0],valueSpec:S.filter_operator,style:r.style,styleSpec:r.styleSpec})),Yt(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&Yt(f[1])==="$type"&&M.push(new Ee(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&M.push(new Ee(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(g=Ia(f[1]))!=="string"&&M.push(new Ee(v+"[1]",f[1],"string expected, "+g+" found"));for(var z=2;z<f.length;z++)g=Ia(f[z]),Yt(f[1])==="$type"?M=M.concat(El({key:v+"["+z+"]",value:f[z],valueSpec:S.geometry_type,style:r.style,styleSpec:r.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&M.push(new Ee(v+"["+z+"]",f[z],"string, number, or boolean expected, "+g+" found"));break;case"any":case"all":case"none":for(var Y=1;Y<f.length;Y++)M=M.concat(t({key:v+"["+Y+"]",value:f[Y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":g=Ia(f[1]),f.length!==2?M.push(new Ee(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):g!=="string"&&M.push(new Ee(v+"[1]",f[1],"string expected, "+g+" found"));break;case"within":g=Ia(f[1]),f.length!==2?M.push(new Ee(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):g!=="object"&&M.push(new Ee(v+"[1]",f[1],"object expected, "+g+" found"))}return M}(e)}function Cl(e,t){var r=e.key,f=e.style,v=e.styleSpec,g=e.value,S=e.objectKey,M=v[t+"_"+e.layerType];if(!M)return[];var z=S.match(/^(.*)-transition$/);if(t==="paint"&&z&&M[z[1]]&&M[z[1]].transition)return aa({key:r,value:g,valueSpec:v.transition,style:f,styleSpec:v});var Y,J=e.valueSpec||M[S];if(!J)return[new Ee(r,g,'unknown property "'+S+'"')];if(Ia(g)==="string"&&_s(J)&&!J.tokens&&(Y=/^{([^}]+)}$/.exec(g)))return[new Ee(r,g,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(Y[1])+" }`.")];var oe=[];return e.layerType==="symbol"&&(S==="text-field"&&f&&!f.glyphs&&oe.push(new Ee(r,g,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&zu(tr(g))&&Yt(g.type)==="identity"&&oe.push(new Ee(r,g,'"text-font" does not support identity functions'))),oe.concat(aa({key:e.key,value:g,valueSpec:J,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:S}))}function bc(e){return Cl(e,"paint")}function Zu(e){return Cl(e,"layout")}function Va(e){var t=[],r=e.value,f=e.key,v=e.style,g=e.styleSpec;r.type||r.ref||t.push(new Ee(f,r,'either "type" or "ref" is required'));var S,M=Yt(r.type),z=Yt(r.ref);if(r.id)for(var Y=Yt(r.id),J=0;J<e.arrayIndex;J++){var oe=v.layers[J];Yt(oe.id)===Y&&t.push(new Ee(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+oe.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(Ye){Ye in r&&t.push(new Ee(f,r[Ye],'"'+Ye+'" is prohibited for ref layers'))}),v.layers.forEach(function(Ye){Yt(Ye.id)===z&&(S=Ye)}),S?S.ref?t.push(new Ee(f,r.ref,"ref cannot reference another ref layer")):M=Yt(S.type):t.push(new Ee(f,r.ref,'ref layer "'+z+'" not found'));else if(M!=="background")if(r.source){var he=v.sources&&v.sources[r.source],Se=he&&Yt(he.type);he?Se==="vector"&&M==="raster"?t.push(new Ee(f,r.source,'layer "'+r.id+'" requires a raster source')):Se==="raster"&&M!=="raster"?t.push(new Ee(f,r.source,'layer "'+r.id+'" requires a vector source')):Se!=="vector"||r["source-layer"]?Se==="raster-dem"&&M!=="hillshade"?t.push(new Ee(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!r.paint||!r.paint["line-gradient"]||Se==="geojson"&&he.lineMetrics||t.push(new Ee(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Ee(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new Ee(f,r.source,'source "'+r.source+'" not found'))}else t.push(new Ee(f,r,'missing required property "source"'));return t=t.concat(Qs({key:f,value:r,valueSpec:g.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return aa({key:f+".type",value:r.type,valueSpec:g.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:xc,layout:function(Ye){return Qs({layer:r,key:Ye.key,value:Ye.value,style:Ye.style,styleSpec:Ye.styleSpec,objectElementValidators:{"*":function($e){return Zu(wr({layerType:M},$e))}}})},paint:function(Ye){return Qs({layer:r,key:Ye.key,value:Ye.value,style:Ye.style,styleSpec:Ye.styleSpec,objectElementValidators:{"*":function($e){return bc(wr({layerType:M},$e))}}})}}}))}function ul(e){var t=e.value,r=e.key,f=Ia(t);return f!=="string"?[new Ee(r,t,"string expected, "+f+" found")]:[]}var Xa={promoteId:function(e){var t=e.key,r=e.value;if(Ia(r)==="string")return ul({key:t,value:r});var f=[];for(var v in r)f.push.apply(f,ul({key:t+"."+v,value:r[v]}));return f}};function ju(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new Ee(r,t,'"type" is required')];var g,S=Yt(t.type);switch(S){case"vector":case"raster":case"raster-dem":return Qs({key:r,value:t,valueSpec:f["source_"+S.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:Xa});case"geojson":if(g=Qs({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:Xa}),t.cluster)for(var M in t.clusterProperties){var z=t.clusterProperties[M],Y=z[0],J=typeof Y=="string"?[Y,["accumulated"],["get",M]]:Y;g.push.apply(g,Uu({key:r+"."+M+".map",value:z[1],expressionContext:"cluster-map"})),g.push.apply(g,Uu({key:r+"."+M+".reduce",value:J,expressionContext:"cluster-reduce"}))}return g;case"video":return Qs({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return Qs({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new Ee(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return El({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function Mu(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,g=[],S=Ia(t);if(t===void 0)return g;if(S!=="object")return g.concat([new Ee("light",t,"object expected, "+S+" found")]);for(var M in t){var z=M.match(/^(.*)-transition$/);g=g.concat(z&&f[z[1]]&&f[z[1]].transition?aa({key:M,value:t[M],valueSpec:r.transition,style:v,styleSpec:r}):f[M]?aa({key:M,value:t[M],valueSpec:f[M],style:v,styleSpec:r}):[new Ee(M,t[M],'unknown property "'+M+'"')])}return g}var qs={"*":function(){return[]},array:gc,boolean:function(e){var t=e.value,r=e.key,f=Ia(t);return f!=="boolean"?[new Ee(r,t,"boolean expected, "+f+" found")]:[]},number:yc,color:function(e){var t=e.key,r=e.value,f=Ia(r);return f!=="string"?[new Ee(t,r,"color expected, "+f+" found")]:ki(r)===null?[new Ee(t,r,'color expected, "'+r+'" found')]:[]},constants:mt,enum:El,filter:xc,function:Nc,layer:Va,object:Qs,source:ju,light:Mu,string:ul,formatted:function(e){return ul(e).length===0?[]:Uu(e)},resolvedImage:function(e){return ul(e).length===0?[]:Uu(e)}};function aa(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&zu(Yt(t))?Nc(e):r.expression&&il(tr(t))?Uu(e):r.type&&qs[r.type]?qs[r.type](e):Qs(wr({},e,{valueSpec:r.type?f[r.type]:r}))}function Ba(e){var t=e.value,r=e.key,f=ul(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new Ee(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new Ee(r,t,'"glyphs" url must include a "{range}" token'))),f}function Ps(e,t){t===void 0&&(t=ue);var r=[];return r=r.concat(aa({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Ba,"*":function(){return[]}}})),e.constants&&(r=r.concat(mt({key:"constants",value:e.constants,style:e,styleSpec:t}))),ec(r)}function ec(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function du(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return ec(e.apply(this,t))}}Ps.source=du(ju),Ps.light=du(Mu),Ps.layer=du(Va),Ps.filter=du(xc),Ps.paintProperty=du(bc),Ps.layoutProperty=du(Zu);var tc=Ps,nf=tc.light,af=tc.paintProperty,ll=tc.layoutProperty;function wl(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new de(new Error(v[f].message))),r=!0;return r}var Iu=Ro;function Ro(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var g=0;g<this.d*this.d;g++){var S=v[3+g],M=v[3+g+1];f.push(S===M?null:v.subarray(S,M))}var z=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],z),this.bboxes=v.subarray(z),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var Y=0;Y<this.d*this.d;Y++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var J=r/t*e;this.min=-J,this.max=e+J}Ro.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},Ro.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ro.prototype._insertCell=function(e,t,r,f,v,g){this.cells[v].push(g)},Ro.prototype.query=function(e,t,r,f,v){var g=this.min,S=this.max;if(e<=g&&t<=g&&S<=r&&S<=f&&!v)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(e,t,r,f,this._queryCell,M,{},v),M},Ro.prototype._queryCell=function(e,t,r,f,v,g,S,M){var z=this.cells[v];if(z!==null)for(var Y=this.keys,J=this.bboxes,oe=0;oe<z.length;oe++){var he=z[oe];if(S[he]===void 0){var Se=4*he;(M?M(J[Se+0],J[Se+1],J[Se+2],J[Se+3]):e<=J[Se+2]&&t<=J[Se+3]&&r>=J[Se+0]&&f>=J[Se+1])?(S[he]=!0,g.push(Y[he])):S[he]=!1}}},Ro.prototype._forEachCell=function(e,t,r,f,v,g,S,M){for(var z=this._convertToCellCoord(e),Y=this._convertToCellCoord(t),J=this._convertToCellCoord(r),oe=this._convertToCellCoord(f),he=z;he<=J;he++)for(var Se=Y;Se<=oe;Se++){var Ye=this.d*Se+he;if((!M||M(this._convertFromCellCoord(he),this._convertFromCellCoord(Se),this._convertFromCellCoord(he+1),this._convertFromCellCoord(Se+1)))&&v.call(this,e,t,r,f,Ye,g,S,M))return}},Ro.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Ro.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Ro.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var g=t,S=0;S<e.length;S++){var M=e[S];v[3+S]=g,v.set(M,g),g+=M.length}return v[3+e.length]=g,v.set(this.keys,g),v[3+e.length+1]=g+=this.keys.length,v.set(this.bboxes,g),g+=this.bboxes.length,v.buffer};var Tl=L.ImageData,Vs=L.ImageBitmap,Eo={};function Nn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Eo[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var fo in Nn("Object",Object),Iu.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Iu.deserialize=function(e){return new Iu(e.buffer)},Nn("Grid",Iu),Nn("Color",wi),Nn("Error",Error),Nn("ResolvedImage",Gi),Nn("StylePropertyFunction",iu),Nn("StyleExpression",bl,{omit:["_evaluator"]}),Nn("ZoomDependentExpression",ol),Nn("ZoomConstantExpression",al),Nn("CompoundExpression",vo,{omit:["_evaluate"]}),Ts)Ts[fo]._classRegistryKey||Nn("Expression_"+fo,Ts[fo]);function vu(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function cl(e){return Vs&&e instanceof Vs}function eu(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(vu(e)||cl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof Tl)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,g=e;v<g.length;v+=1)f.push(eu(g[v],t));return f}if(typeof e=="object"){var S=e.constructor,M=S._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var z=S.serialize?S.serialize(e,t):{};if(!S.serialize){for(var Y in e)if(e.hasOwnProperty(Y)&&!(Eo[M].omit.indexOf(Y)>=0)){var J=e[Y];z[Y]=Eo[M].shallow.indexOf(Y)>=0?J:eu(J,t)}e instanceof Error&&(z.message=e.message)}if(z.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(z.$name=M),z}throw new Error("can't serialize object of type "+typeof e)}function Ms(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||vu(e)||cl(e)||ArrayBuffer.isView(e)||e instanceof Tl)return e;if(Array.isArray(e))return e.map(Ms);if(typeof e=="object"){var t=e.$name||"Object",r=Eo[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,g=Object.keys(e);v<g.length;v+=1){var S=g[v];if(S!=="$name"){var M=e[S];f[S]=Eo[t].shallow.indexOf(S)>=0?M:Ms(M)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var Sc=function(){this.first=!0};Sc.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var gn={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function rc(e){for(var t=0,r=e;t<r.length;t+=1)if(nc(r[t].charCodeAt(0)))return!0;return!1}function nc(e){return!(e!==746&&e!==747&&(e<4352||!(gn["Bopomofo Extended"](e)||gn.Bopomofo(e)||gn["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||gn["CJK Compatibility Ideographs"](e)||gn["CJK Compatibility"](e)||gn["CJK Radicals Supplement"](e)||gn["CJK Strokes"](e)||!(!gn["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||gn["CJK Unified Ideographs Extension A"](e)||gn["CJK Unified Ideographs"](e)||gn["Enclosed CJK Letters and Months"](e)||gn["Hangul Compatibility Jamo"](e)||gn["Hangul Jamo Extended-A"](e)||gn["Hangul Jamo Extended-B"](e)||gn["Hangul Jamo"](e)||gn["Hangul Syllables"](e)||gn.Hiragana(e)||gn["Ideographic Description Characters"](e)||gn.Kanbun(e)||gn["Kangxi Radicals"](e)||gn["Katakana Phonetic Extensions"](e)||gn.Katakana(e)&&e!==12540||!(!gn["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!gn["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||gn["Unified Canadian Aboriginal Syllabics"](e)||gn["Unified Canadian Aboriginal Syllabics Extended"](e)||gn["Vertical Forms"](e)||gn["Yijing Hexagram Symbols"](e)||gn["Yi Syllables"](e)||gn["Yi Radicals"](e))))}function Ou(e){return!(nc(e)||function(t){return!!(gn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||gn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||gn["Letterlike Symbols"](t)||gn["Number Forms"](t)||gn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||gn["Control Pictures"](t)&&t!==9251||gn["Optical Character Recognition"](t)||gn["Enclosed Alphanumerics"](t)||gn["Geometric Shapes"](t)||gn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||gn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||gn["CJK Symbols and Punctuation"](t)||gn.Katakana(t)||gn["Private Use Area"](t)||gn["CJK Compatibility Forms"](t)||gn["Small Form Variants"](t)||gn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function Ua(e){return e>=1424&&e<=2303||gn["Arabic Presentation Forms-A"](e)||gn["Arabic Presentation Forms-B"](e)}function Is(e,t){return!(!t&&Ua(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||gn.Khmer(e))}function ic(e){for(var t=0,r=e;t<r.length;t+=1)if(Ua(r[t].charCodeAt(0)))return!0;return!1}var mu=null,Os="unavailable",gu=null,zc=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Os="error"),mu&&mu(e)};function Al(){Ec.fire(new ae("pluginStateChange",{pluginStatus:Os,pluginURL:gu}))}var Ec=new Pe,Cc=function(){return Os},Gs=function(){if(Os!=="deferred"||!gu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Os="loading",Al(),gu&&Ai({url:gu},function(e){e?zc(e):(Os="loaded",Al())})},Ls={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Os==="loaded"||Ls.applyArabicShaping!=null},isLoading:function(){return Os==="loading"},setState:function(e){Os=e.pluginStatus,gu=e.pluginURL},isParsed:function(){return Ls.applyArabicShaping!=null&&Ls.processBidirectionalText!=null&&Ls.processStyledBidirectionalText!=null},getPluginURL:function(){return gu}},ta=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Sc,this.transition={})};ta.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!Is(v[f].charCodeAt(0),r))return!1;return!0}(e,Ls.isLoaded())},ta.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ta.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var yu=function(e,t){this.property=e,this.value=t,this.expression=function(r,f){if(zu(r))return new iu(r,f);if(il(r)){var v=sl(r,f);if(v.result==="error")throw new Error(v.value.map(function(S){return S.key+": "+S.message}).join(", "));return v.value}var g=r;return typeof r=="string"&&f.type==="color"&&(g=wi.parse(r)),{kind:"constant",evaluate:function(){return g}}}(t===void 0?e.specification.default:t,e.specification)};yu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},yu.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var Hs=function(e){this.property=e,this.value=new yu(e,void 0)};Hs.prototype.transitioned=function(e,t){return new Vu(this.property,this.value,t,It({},e.transition,this.transition),e.now)},Hs.prototype.untransitioned=function(){return new Vu(this.property,this.value,null,{},0)};var Uo=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Uo.prototype.getValue=function(e){return Qe(this._values[e].value.value)},Uo.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Hs(this._values[e].property)),this._values[e].value=new yu(this._values[e].property,t===null?void 0:Qe(t))},Uo.prototype.getTransition=function(e){return Qe(this._values[e].transition)},Uo.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Hs(this._values[e].property)),this._values[e].transition=Qe(t)||void 0},Uo.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var g=this.getTransition(f);g!==void 0&&(e[f+"-transition"]=g)}return e},Uo.prototype.transitioned=function(e,t){for(var r=new au(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var g=v[f];r._values[g]=this._values[g].transitioned(e,t._values[g])}return r},Uo.prototype.untransitioned=function(){for(var e=new au(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var Vu=function(e,t,r,f,v){this.property=e,this.value=t,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=r)};Vu.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),g=this.prior;if(g){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return g.possiblyEvaluate(e,t,r);var S=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,t,r),v,function(M){if(M<=0)return 0;if(M>=1)return 1;var z=M*M,Y=z*M;return 4*(M<.5?Y:3*(M-z)+Y-.75)}(S))}return v};var au=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};au.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Gu(this._properties),v=0,g=Object.keys(this._values);v<g.length;v+=1){var S=g[v];f._values[S]=this._values[S].possiblyEvaluate(e,t,r)}return f},au.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var ou=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};ou.prototype.getValue=function(e){return Qe(this._values[e].value)},ou.prototype.setValue=function(e,t){this._values[e]=new yu(this._values[e].property,t===null?void 0:Qe(t))},ou.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},ou.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Gu(this._properties),v=0,g=Object.keys(this._values);v<g.length;v+=1){var S=g[v];f._values[S]=this._values[S].possiblyEvaluate(e,t,r)}return f};var Co=function(e,t,r){this.property=e,this.value=t,this.parameters=r};Co.prototype.isConstant=function(){return this.value.kind==="constant"},Co.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},Co.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var Gu=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};Gu.prototype.get=function(e){return this._values[e]};var ni=function(e){this.specification=e};ni.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},ni.prototype.interpolate=function(e,t,r){var f=uo[this.specification.type];return f?f(e,t,r):e};var $n=function(e,t){this.specification=e,this.overrides=t};$n.prototype.possiblyEvaluate=function(e,t,r,f){return new Co(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},$n.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new Co(this,{kind:"constant",value:void 0},e.parameters);var f=uo[this.specification.type];return f?new Co(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},$n.prototype.evaluate=function(e,t,r,f,v,g){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,g)};var Pl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,g){if(r.value===void 0)return new Co(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var S=r.expression.evaluate(f,null,{},v,g),M=r.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,z=this._calculate(M,M,M,f);return new Co(this,{kind:"constant",value:z},f)}if(r.expression.kind==="camera"){var Y=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new Co(this,{kind:"constant",value:Y},f)}return new Co(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,g,S,M){if(r.kind==="source"){var z=r.evaluate(f,v,g,S,M);return this._calculate(z,z,z,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,g),r.evaluate({zoom:Math.floor(f.zoom)},v,g),r.evaluate({zoom:Math.floor(f.zoom)+1},v,g),f):r.value},t.prototype._calculate=function(r,f,v,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}($n),as=function(e){this.specification=e};as.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new ta(Math.floor(t.zoom-1),t)),e.expression.evaluate(new ta(Math.floor(t.zoom),t)),e.expression.evaluate(new ta(Math.floor(t.zoom+1),t)),t)}},as.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},as.prototype.interpolate=function(e){return e};var Ws=function(e){this.specification=e};Ws.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},Ws.prototype.interpolate=function(){return!1};var Zo=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new yu(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new Hs(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};Nn("DataDrivenProperty",$n),Nn("DataConstantProperty",ni),Nn("CrossFadedDataDrivenProperty",Pl),Nn("CrossFadedProperty",as),Nn("ColorRampProperty",Ws);var su=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new ou(f.layout)),f.paint)){for(var v in this._transitionablePaint=new Uo(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var g in r.layout)this.setLayoutProperty(g,r.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Gu(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(ll,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return re(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(af,"layers."+this.id+".paint."+r,r,f,v))return!1;if(re(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var g=this._transitionablePaint._values[r],S=g.property.specification["property-type"]==="cross-faded-data-driven",M=g.value.isDataDriven(),z=g.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var Y=this._transitionablePaint._values[r].value;return Y.isDataDriven()||M||S||this._handleOverridablePaintPropertyUpdate(r,z,Y)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Ct(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,g,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&wl(this,r.call(tc,{key:f,layerType:this.type,objectKey:v,value:g,styleSpec:ue,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof Co&&_s(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(Pe),wc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ac=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},oa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Do(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var g=wc[v.type].BYTES_PER_ELEMENT,S=r=Uc(r,Math.max(t,g)),M=v.components||1;return f=Math.max(f,g),r+=g*M,{name:v.name,type:v.type,components:M,offset:S}}),size:Uc(r,Math.max(f,t)),alignment:t}}function Uc(e,t){return Math.ceil(e/t)*t}oa.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},oa.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},oa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},oa.prototype.clear=function(){this.length=0},oa.prototype.resize=function(e){this.reserve(e),this.length=e},oa.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},oa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var xs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.int16[g+0]=f,this.int16[g+1]=v,r},t}(oa);xs.prototype.bytesPerElement=4,Nn("StructArrayLayout2i4",xs);var Ml=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var S=this.length;return this.resize(S+1),this.emplace(S,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,S){var M=4*r;return this.int16[M+0]=f,this.int16[M+1]=v,this.int16[M+2]=g,this.int16[M+3]=S,r},t}(oa);Ml.prototype.bytesPerElement=8,Nn("StructArrayLayout4i8",Ml);var Rs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,M){var z=this.length;return this.resize(z+1),this.emplace(z,r,f,v,g,S,M)},t.prototype.emplace=function(r,f,v,g,S,M,z){var Y=6*r;return this.int16[Y+0]=f,this.int16[Y+1]=v,this.int16[Y+2]=g,this.int16[Y+3]=S,this.int16[Y+4]=M,this.int16[Y+5]=z,r},t}(oa);Rs.prototype.bytesPerElement=12,Nn("StructArrayLayout2i4i12",Rs);var os=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,M){var z=this.length;return this.resize(z+1),this.emplace(z,r,f,v,g,S,M)},t.prototype.emplace=function(r,f,v,g,S,M,z){var Y=4*r,J=8*r;return this.int16[Y+0]=f,this.int16[Y+1]=v,this.uint8[J+4]=g,this.uint8[J+5]=S,this.uint8[J+6]=M,this.uint8[J+7]=z,r},t}(oa);os.prototype.bytesPerElement=8,Nn("StructArrayLayout2i4ub8",os);var fl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.float32[g+0]=f,this.float32[g+1]=v,r},t}(oa);fl.prototype.bytesPerElement=8,Nn("StructArrayLayout2f8",fl);var uu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,M,z,Y,J,oe){var he=this.length;return this.resize(he+1),this.emplace(he,r,f,v,g,S,M,z,Y,J,oe)},t.prototype.emplace=function(r,f,v,g,S,M,z,Y,J,oe,he){var Se=10*r;return this.uint16[Se+0]=f,this.uint16[Se+1]=v,this.uint16[Se+2]=g,this.uint16[Se+3]=S,this.uint16[Se+4]=M,this.uint16[Se+5]=z,this.uint16[Se+6]=Y,this.uint16[Se+7]=J,this.uint16[Se+8]=oe,this.uint16[Se+9]=he,r},t}(oa);uu.prototype.bytesPerElement=20,Nn("StructArrayLayout10ui20",uu);var oc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,M,z,Y,J,oe,he,Se){var Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,r,f,v,g,S,M,z,Y,J,oe,he,Se)},t.prototype.emplace=function(r,f,v,g,S,M,z,Y,J,oe,he,Se,Ye){var $e=12*r;return this.int16[$e+0]=f,this.int16[$e+1]=v,this.int16[$e+2]=g,this.int16[$e+3]=S,this.uint16[$e+4]=M,this.uint16[$e+5]=z,this.uint16[$e+6]=Y,this.uint16[$e+7]=J,this.int16[$e+8]=oe,this.int16[$e+9]=he,this.int16[$e+10]=Se,this.int16[$e+11]=Ye,r},t}(oa);oc.prototype.bytesPerElement=24,Nn("StructArrayLayout4i4ui4i24",oc);var Hu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var S=3*r;return this.float32[S+0]=f,this.float32[S+1]=v,this.float32[S+2]=g,r},t}(oa);Hu.prototype.bytesPerElement=12,Nn("StructArrayLayout3f12",Hu);var Wu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}(oa);Wu.prototype.bytesPerElement=4,Nn("StructArrayLayout1ul4",Wu);var Zc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,M,z,Y,J){var oe=this.length;return this.resize(oe+1),this.emplace(oe,r,f,v,g,S,M,z,Y,J)},t.prototype.emplace=function(r,f,v,g,S,M,z,Y,J,oe){var he=10*r,Se=5*r;return this.int16[he+0]=f,this.int16[he+1]=v,this.int16[he+2]=g,this.int16[he+3]=S,this.int16[he+4]=M,this.int16[he+5]=z,this.uint32[Se+3]=Y,this.uint16[he+8]=J,this.uint16[he+9]=oe,r},t}(oa);Zc.prototype.bytesPerElement=20,Nn("StructArrayLayout6i1ul2ui20",Zc);var Il=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,M){var z=this.length;return this.resize(z+1),this.emplace(z,r,f,v,g,S,M)},t.prototype.emplace=function(r,f,v,g,S,M,z){var Y=6*r;return this.int16[Y+0]=f,this.int16[Y+1]=v,this.int16[Y+2]=g,this.int16[Y+3]=S,this.int16[Y+4]=M,this.int16[Y+5]=z,r},t}(oa);Il.prototype.bytesPerElement=12,Nn("StructArrayLayout2i2i2i12",Il);var hl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S){var M=this.length;return this.resize(M+1),this.emplace(M,r,f,v,g,S)},t.prototype.emplace=function(r,f,v,g,S,M){var z=4*r,Y=8*r;return this.float32[z+0]=f,this.float32[z+1]=v,this.float32[z+2]=g,this.int16[Y+6]=S,this.int16[Y+7]=M,r},t}(oa);hl.prototype.bytesPerElement=16,Nn("StructArrayLayout2f1f2i16",hl);var jc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var S=this.length;return this.resize(S+1),this.emplace(S,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,S){var M=12*r,z=3*r;return this.uint8[M+0]=f,this.uint8[M+1]=v,this.float32[z+1]=g,this.float32[z+2]=S,r},t}(oa);jc.prototype.bytesPerElement=12,Nn("StructArrayLayout2ub2f12",jc);var Xu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var S=3*r;return this.uint16[S+0]=f,this.uint16[S+1]=v,this.uint16[S+2]=g,r},t}(oa);Xu.prototype.bytesPerElement=6,Nn("StructArrayLayout3ui6",Xu);var Lu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,M,z,Y,J,oe,he,Se,Ye,$e,gt,nt,Lt){var Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,r,f,v,g,S,M,z,Y,J,oe,he,Se,Ye,$e,gt,nt,Lt)},t.prototype.emplace=function(r,f,v,g,S,M,z,Y,J,oe,he,Se,Ye,$e,gt,nt,Lt,Ht){var pr=24*r,vr=12*r,Br=48*r;return this.int16[pr+0]=f,this.int16[pr+1]=v,this.uint16[pr+2]=g,this.uint16[pr+3]=S,this.uint32[vr+2]=M,this.uint32[vr+3]=z,this.uint32[vr+4]=Y,this.uint16[pr+10]=J,this.uint16[pr+11]=oe,this.uint16[pr+12]=he,this.float32[vr+7]=Se,this.float32[vr+8]=Ye,this.uint8[Br+36]=$e,this.uint8[Br+37]=gt,this.uint8[Br+38]=nt,this.uint32[vr+10]=Lt,this.int16[pr+22]=Ht,r},t}(oa);Lu.prototype.bytesPerElement=48,Nn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Lu);var sc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,S,M,z,Y,J,oe,he,Se,Ye,$e,gt,nt,Lt,Ht,pr,vr,Br,nn,xn,pi,kn,si,jn,na){var Ti=this.length;return this.resize(Ti+1),this.emplace(Ti,r,f,v,g,S,M,z,Y,J,oe,he,Se,Ye,$e,gt,nt,Lt,Ht,pr,vr,Br,nn,xn,pi,kn,si,jn,na)},t.prototype.emplace=function(r,f,v,g,S,M,z,Y,J,oe,he,Se,Ye,$e,gt,nt,Lt,Ht,pr,vr,Br,nn,xn,pi,kn,si,jn,na,Ti){var Jn=34*r,ha=17*r;return this.int16[Jn+0]=f,this.int16[Jn+1]=v,this.int16[Jn+2]=g,this.int16[Jn+3]=S,this.int16[Jn+4]=M,this.int16[Jn+5]=z,this.int16[Jn+6]=Y,this.int16[Jn+7]=J,this.uint16[Jn+8]=oe,this.uint16[Jn+9]=he,this.uint16[Jn+10]=Se,this.uint16[Jn+11]=Ye,this.uint16[Jn+12]=$e,this.uint16[Jn+13]=gt,this.uint16[Jn+14]=nt,this.uint16[Jn+15]=Lt,this.uint16[Jn+16]=Ht,this.uint16[Jn+17]=pr,this.uint16[Jn+18]=vr,this.uint16[Jn+19]=Br,this.uint16[Jn+20]=nn,this.uint16[Jn+21]=xn,this.uint16[Jn+22]=pi,this.uint32[ha+12]=kn,this.float32[ha+13]=si,this.float32[ha+14]=jn,this.float32[ha+15]=na,this.float32[ha+16]=Ti,r},t}(oa);sc.prototype.bytesPerElement=68,Nn("StructArrayLayout8i15ui1ul4f68",sc);var Ru=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}(oa);Ru.prototype.bytesPerElement=4,Nn("StructArrayLayout1f4",Ru);var Xs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var S=3*r;return this.int16[S+0]=f,this.int16[S+1]=v,this.int16[S+2]=g,r},t}(oa);Xs.prototype.bytesPerElement=6,Nn("StructArrayLayout3i6",Xs);var Tc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var S=4*r;return this.uint32[2*r+0]=f,this.uint16[S+2]=v,this.uint16[S+3]=g,r},t}(oa);Tc.prototype.bytesPerElement=8,Nn("StructArrayLayout1ul2ui8",Tc);var uc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.uint16[g+0]=f,this.uint16[g+1]=v,r},t}(oa);uc.prototype.bytesPerElement=4,Nn("StructArrayLayout2ui4",uc);var lc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}(oa);lc.prototype.bytesPerElement=2,Nn("StructArrayLayout1ui2",lc);var Yu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var S=this.length;return this.resize(S+1),this.emplace(S,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,S){var M=4*r;return this.float32[M+0]=f,this.float32[M+1]=v,this.float32[M+2]=g,this.float32[M+3]=S,r},t}(oa);Yu.prototype.bytesPerElement=16,Nn("StructArrayLayout4f16",Yu);var i=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new G(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(ac);i.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new i(this,r)},t}(Zc);Nn("CollisionBoxArray",u);var o=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(ac);o.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new o(this,r)},t}(Lu);Nn("PlacedSymbolArray",h);var _=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(ac);_.prototype.size=68;var C=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new _(this,r)},t}(sc);Nn("SymbolInstanceArray",C);var P=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(Ru);Nn("GlyphOffsetArray",P);var N=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(Xs);Nn("SymbolLineVertexArray",N);var K=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(ac);K.prototype.size=8;var se=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new K(this,r)},t}(Tc);Nn("FeatureIndexArray",se);var Ce=Do([{name:"a_pos",components:2,type:"Int16"}],4).members,Ae=function(e){e===void 0&&(e=[]),this.segments=e};function Ie(e,t){return 256*(e=Je(Math.floor(e),0,255))+Je(Math.floor(t),0,255)}Ae.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>Ae.MAX_VERTEX_ARRAY_LENGTH&&je("Max vertices per segment is "+Ae.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>Ae.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},Ae.prototype.get=function(){return this.segments},Ae.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},Ae.simpleSegment=function(e,t,r,f){return new Ae([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},Ae.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Nn("SegmentVector",Ae);var Ke=Do([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),We=E(function(e){e.exports=function(t,r){var f,v,g,S,M,z,Y,J;for(v=t.length-(f=3&t.length),g=r,M=3432918353,z=461845907,J=0;J<v;)Y=255&t.charCodeAt(J)|(255&t.charCodeAt(++J))<<8|(255&t.charCodeAt(++J))<<16|(255&t.charCodeAt(++J))<<24,++J,g=27492+(65535&(S=5*(65535&(g=(g^=Y=(65535&(Y=(Y=(65535&Y)*M+(((Y>>>16)*M&65535)<<16)&4294967295)<<15|Y>>>17))*z+(((Y>>>16)*z&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(Y=0,f){case 3:Y^=(255&t.charCodeAt(J+2))<<16;case 2:Y^=(255&t.charCodeAt(J+1))<<8;case 1:g^=Y=(65535&(Y=(Y=(65535&(Y^=255&t.charCodeAt(J)))*M+(((Y>>>16)*M&65535)<<16)&4294967295)<<15|Y>>>17))*z+(((Y>>>16)*z&65535)<<16)&4294967295}return g^=t.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),at=E(function(e){e.exports=function(t,r){for(var f,v=t.length,g=r^v,S=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(S)|(255&t.charCodeAt(++S))<<8|(255&t.charCodeAt(++S))<<16|(255&t.charCodeAt(++S))<<24))+((1540483477*(f>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++S;switch(v){case 3:g^=(255&t.charCodeAt(S+2))<<16;case 2:g^=(255&t.charCodeAt(S+1))<<8;case 1:g=1540483477*(65535&(g^=255&t.charCodeAt(S)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),Ze=We,st=at;Ze.murmur3=We,Ze.murmur2=st;var St=function(){this.ids=[],this.positions=[],this.indexed=!1};St.prototype.add=function(e,t,r,f){this.ids.push(xr(e)),this.positions.push(t,r,f)},St.prototype.getPositions=function(e){for(var t=xr(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var g=[];this.ids[r]===t;)g.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return g},St.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(g,S,M,z){for(;M<z;){for(var Y=g[M+z>>1],J=M-1,oe=z+1;;){do J++;while(g[J]<Y);do oe--;while(g[oe]>Y);if(J>=oe)break;hr(g,J,oe),hr(S,3*J,3*oe),hr(S,3*J+1,3*oe+1),hr(S,3*J+2,3*oe+2)}oe-M<z-oe?(v(g,S,M,oe),M=oe+1):(v(g,S,oe+1,z),z=oe)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},St.deserialize=function(e){var t=new St;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Wt=Math.pow(2,53)-1;function xr(e){var t=+e;return!isNaN(t)&&t<=Wt?t:Ze(String(e))}function hr(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}Nn("FeaturePositionMap",St);var Sr=function(e,t){this.gl=e.gl,this.location=t},Gr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(Sr),sn=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(Sr),qr=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(Sr),Mn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(Sr),ei=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(Sr),fi=function(e){function t(r,f){e.call(this,r,f),this.current=wi.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(Sr),ri=new Float32Array(16),sa=function(e){function t(r,f){e.call(this,r,f),this.current=ri}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(Sr);function Vn(e){return[Ie(255*e.r,255*e.g),Ie(255*e.b,255*e.a)]}var Si=function(e,t,r){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=r};Si.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},Si.prototype.getBinding=function(e,t,r){return this.type==="color"?new fi(e,t):new sn(e,t)};var Ui=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ui.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Ui.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},Ui.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new ei(e,t):new sn(e,t)};var ee=function(e,t,r,f){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new f};ee.prototype.populatePaintArray=function(e,t,r,f,v){var g=this.paintVertexArray.length,S=this.expression.evaluate(new ta(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(g,e,S)},ee.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},ee.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=Vn(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var g=e;g<t;g++)this.paintVertexArray.emplace(g,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},ee.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ee.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ne=function(e,t,r,f,v,g){this.expression=e,this.uniformNames=t.map(function(S){return"u_"+S+"_t"}),this.type=r,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(S){return{name:"a_"+S,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new g};ne.prototype.populatePaintArray=function(e,t,r,f,v){var g=this.expression.evaluate(new ta(this.zoom),t,{},f,[],v),S=this.expression.evaluate(new ta(this.zoom+1),t,{},f,[],v),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,g,S)},ne.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),g=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,g)},ne.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=Vn(r),g=Vn(f),S=e;S<t;S++)this.paintVertexArray.emplace(S,v[0],v[1],g[0],g[1]);else{for(var M=e;M<t;M++)this.paintVertexArray.emplace(M,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},ne.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ne.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ne.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=Je(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},ne.prototype.getBinding=function(e,t,r){return new sn(e,t)};var k=function(e,t,r,f,v,g){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=f,this.layerId=g,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};k.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},k.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},k.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],g=f[r.mid],S=f[r.max];if(v&&g&&S)for(var M=e;M<t;M++)this.zoomInPaintVertexArray.emplace(M,g.tl[0],g.tl[1],g.br[0],g.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],g.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,g.tl[0],g.tl[1],g.br[0],g.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],g.pixelRatio,S.pixelRatio)}},k.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ke.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ke.members,this.expression.isStateDependent))},k.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var F=function(e,t,r){this.binders={},this._buffers=[];var f=[];for(var v in e.paint._values)if(r(v)){var g=e.paint.get(v);if(g instanceof Co&&_s(g.property.specification)){var S=Te(v,e.type),M=g.value,z=g.property.specification.type,Y=g.property.useIntegerZoom,J=g.property.specification["property-type"],oe=J==="cross-faded"||J==="cross-faded-data-driven";if(M.kind==="constant")this.binders[v]=oe?new Ui(M.value,S):new Si(M.value,S,z),f.push("/u_"+v);else if(M.kind==="source"||oe){var he=ft(v,z,"source");this.binders[v]=oe?new k(M,z,Y,t,he,e.id):new ee(M,S,z,he),f.push("/a_"+v)}else{var Se=ft(v,z,"composite");this.binders[v]=new ne(M,S,z,Y,t,Se),f.push("/z_"+v)}}}this.cacheKey=f.sort().join("")};F.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof ee||t instanceof ne?t.maxValue:0},F.prototype.populatePaintArrays=function(e,t,r,f,v){for(var g in this.binders){var S=this.binders[g];(S instanceof ee||S instanceof ne||S instanceof k)&&S.populatePaintArray(e,t,r,f,v)}},F.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof Ui&&f.setConstantPatternPositions(e,t)}},F.prototype.updatePaintArrays=function(e,t,r,f,v){var g=!1;for(var S in e)for(var M=0,z=t.getPositions(S);M<z.length;M+=1){var Y=z[M],J=r.feature(Y.index);for(var oe in this.binders){var he=this.binders[oe];if((he instanceof ee||he instanceof ne||he instanceof k)&&he.expression.isStateDependent===!0){var Se=f.paint.get(oe);he.expression=Se.value,he.updatePaintArray(Y.start,Y.end,J,e[S],v),g=!0}}}return g},F.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof Si||r instanceof Ui)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},F.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof ee||r instanceof ne)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof k)for(var v=0;v<Ke.members.length;v++)e.push(Ke.members[v].name)}return e},F.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof Si||r instanceof Ui||r instanceof ne)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},F.prototype.getPaintVertexBuffers=function(){return this._buffers},F.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof Si||v instanceof Ui||v instanceof ne)for(var g=0,S=v.uniformNames;g<S.length;g+=1){var M=S[g];if(t[M]){var z=v.getBinding(e,t[M],M);r.push({name:M,property:f,binding:z})}}}return r},F.prototype.setUniforms=function(e,t,r,f){for(var v=0,g=t;v<g.length;v+=1){var S=g[v],M=S.name,z=S.property;this.binders[z].setUniform(S.binding,f,r.get(z),M)}},F.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof k){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof ee||r instanceof ne)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},F.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof ee||r instanceof ne||r instanceof k)&&r.upload(e)}this.updatePaintBuffers()},F.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof ee||t instanceof ne||t instanceof k)&&t.destroy()}};var ie=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var f=0,v=e;f<v.length;f+=1){var g=v[f];this.programConfigurations[g.id]=new F(g,t,r)}this.needsUpload=!1,this._featureMap=new St,this._bufferOffset=0};function Te(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function ft(e,t,r){var f={color:{source:fl,composite:Yu},number:{source:Ru,composite:fl}},v=function(g){return{"line-pattern":{source:uu,composite:uu},"fill-pattern":{source:uu,composite:uu},"fill-extrusion-pattern":{source:uu,composite:uu}}[g]}(e);return v&&v[r]||f[t][r]}ie.prototype.populatePaintArrays=function(e,t,r,f,v,g){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,t,f,v,g);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},ie.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,g=r;v<g.length;v+=1){var S=g[v];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,t,S,f)||this.needsUpload}},ie.prototype.get=function(e){return this.programConfigurations[e]},ie.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},ie.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Nn("ConstantBinder",Si),Nn("CrossFadedConstantBinder",Ui),Nn("SourceExpressionBinder",ee),Nn("CrossFadedCompositeBinder",k),Nn("CompositeExpressionBinder",ne),Nn("ProgramConfiguration",F,{omit:["_buffers"]}),Nn("ProgramConfigurationSet",ie);var Gt=Math.pow(2,14)-1,Et=-Gt-1;function Qt(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],g=0;g<v.length;g++){var S=v[g],M=Math.round(S.x*t),z=Math.round(S.y*t);S.x=Je(M,Et,Gt),S.y=Je(z,Et,Gt),(M<S.x||M>S.x+1||z<S.y||z>S.y+1)&&je("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function Fr(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Qt(e):[]}}function Bn(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var zn=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new xs,this.indexArray=new Xu,this.segments=new Ae,this.programConfigurations=new ie(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function hi(e,t){for(var r=0;r<e.length;r++)if(La(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(La(e,t[f]))return!0;return!!_a(e,t)}function ui(e,t,r){return!!La(e,t)||!!Ya(t,e,r)}function yi(e,t){if(e.length===1)return wo(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(La(e,f[v]))return!0;for(var g=0;g<e.length;g++)if(wo(t,e[g]))return!0;for(var S=0;S<t.length;S++)if(_a(e,t[S]))return!0;return!1}function Ki(e,t,r){if(e.length>1){if(_a(e,t))return!0;for(var f=0;f<t.length;f++)if(Ya(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(Ya(e[v],t,r))return!0;return!1}function _a(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],g=0;g<t.length-1;g++)if(xa(f,v,t[g],t[g+1]))return!0;return!1}function xa(e,t,r,f){return Pt(e,r,f)!==Pt(t,r,f)&&Pt(e,t,r)!==Pt(e,t,f)}function Ya(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(Na(e,t[v-1],t[v])<f)return!0;return!1}function Na(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function wo(e,t){for(var r,f,v,g=!1,S=0;S<e.length;S++)for(var M=0,z=(r=e[S]).length-1;M<r.length;z=M++)(f=r[M]).y>t.y!=(v=r[z]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(g=!g);return g}function La(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var g=e[f],S=e[v];g.y>t.y!=S.y>t.y&&t.x<(S.x-g.x)*(t.y-g.y)/(S.y-g.y)+g.x&&(r=!r)}return r}function Ea(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var g=Pt(e,t,r[0]);return g!==Pt(e,t,r[1])||g!==Pt(e,t,r[2])||g!==Pt(e,t,r[3])}function fa(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function ma(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ga(e,t,r,f,v){if(!t[0]&&!t[1])return e;var g=G.convert(t)._mult(v);r==="viewport"&&g._rotate(-f);for(var S=[],M=0;M<e.length;M++)S.push(e[M].sub(g));return S}zn.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],g=null;f.type==="circle"&&(g=f.layout.get("circle-sort-key"));for(var S=0,M=e;S<M.length;S+=1){var z=M[S],Y=z.feature,J=z.id,oe=z.index,he=z.sourceLayerIndex,Se=this.layers[0]._featureFilter.needGeometry,Ye=Fr(Y,Se);if(this.layers[0]._featureFilter.filter(new ta(this.zoom),Ye,r)){var $e=g?g.evaluate(Ye,{},r):void 0,gt={id:J,properties:Y.properties,type:Y.type,sourceLayerIndex:he,index:oe,geometry:Se?Ye.geometry:Qt(Y),patterns:{},sortKey:$e};v.push(gt)}}g&&v.sort(function(xn,pi){return xn.sortKey-pi.sortKey});for(var nt=0,Lt=v;nt<Lt.length;nt+=1){var Ht=Lt[nt],pr=Ht.geometry,vr=Ht.index,Br=Ht.sourceLayerIndex,nn=e[vr].feature;this.addFeature(Ht,pr,vr,r),t.featureIndex.insert(nn,pr,vr,Br,this.index)}},zn.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},zn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zn.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ce),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},zn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},zn.prototype.addFeature=function(e,t,r,f){for(var v=0,g=t;v<g.length;v+=1)for(var S=0,M=g[v];S<M.length;S+=1){var z=M[S],Y=z.x,J=z.y;if(!(Y<0||Y>=8192||J<0||J>=8192)){var oe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),he=oe.vertexLength;Bn(this.layoutVertexArray,Y,J,-1,-1),Bn(this.layoutVertexArray,Y,J,1,-1),Bn(this.layoutVertexArray,Y,J,1,1),Bn(this.layoutVertexArray,Y,J,-1,1),this.indexArray.emplaceBack(he,he+1,he+2),this.indexArray.emplaceBack(he,he+3,he+2),oe.vertexLength+=4,oe.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},Nn("CircleBucket",zn,{omit:["layers"]});var za=new Zo({"circle-sort-key":new $n(ue.layout_circle["circle-sort-key"])}),ko={paint:new Zo({"circle-radius":new $n(ue.paint_circle["circle-radius"]),"circle-color":new $n(ue.paint_circle["circle-color"]),"circle-blur":new $n(ue.paint_circle["circle-blur"]),"circle-opacity":new $n(ue.paint_circle["circle-opacity"]),"circle-translate":new ni(ue.paint_circle["circle-translate"]),"circle-translate-anchor":new ni(ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ni(ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ni(ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $n(ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $n(ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $n(ue.paint_circle["circle-stroke-opacity"])}),layout:za},Zi=typeof Float32Array!="undefined"?Float32Array:Array;function $o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Po(e,t,r){var f=t[0],v=t[1],g=t[2],S=t[3],M=t[4],z=t[5],Y=t[6],J=t[7],oe=t[8],he=t[9],Se=t[10],Ye=t[11],$e=t[12],gt=t[13],nt=t[14],Lt=t[15],Ht=r[0],pr=r[1],vr=r[2],Br=r[3];return e[0]=Ht*f+pr*M+vr*oe+Br*$e,e[1]=Ht*v+pr*z+vr*he+Br*gt,e[2]=Ht*g+pr*Y+vr*Se+Br*nt,e[3]=Ht*S+pr*J+vr*Ye+Br*Lt,e[4]=(Ht=r[4])*f+(pr=r[5])*M+(vr=r[6])*oe+(Br=r[7])*$e,e[5]=Ht*v+pr*z+vr*he+Br*gt,e[6]=Ht*g+pr*Y+vr*Se+Br*nt,e[7]=Ht*S+pr*J+vr*Ye+Br*Lt,e[8]=(Ht=r[8])*f+(pr=r[9])*M+(vr=r[10])*oe+(Br=r[11])*$e,e[9]=Ht*v+pr*z+vr*he+Br*gt,e[10]=Ht*g+pr*Y+vr*Se+Br*nt,e[11]=Ht*S+pr*J+vr*Ye+Br*Lt,e[12]=(Ht=r[12])*f+(pr=r[13])*M+(vr=r[14])*oe+(Br=r[15])*$e,e[13]=Ht*v+pr*z+vr*he+Br*gt,e[14]=Ht*g+pr*Y+vr*Se+Br*nt,e[15]=Ht*S+pr*J+vr*Ye+Br*Lt,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var To,Ac=Po;function Du(e,t,r){var f=t[0],v=t[1],g=t[2],S=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*g+r[12]*S,e[1]=r[1]*f+r[5]*v+r[9]*g+r[13]*S,e[2]=r[2]*f+r[6]*v+r[10]*g+r[14]*S,e[3]=r[3]*f+r[7]*v+r[11]*g+r[15]*S,e}To=new Zi(3),Zi!=Float32Array&&(To[0]=0,To[1]=0,To[2]=0),function(){var e=new Zi(4);Zi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var Ku=(function(){var e=new Zi(2);Zi!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,ko)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new zn(r)},t.prototype.queryRadius=function(r){var f=r;return fa("circle-radius",this,f)+fa("circle-stroke-width",this,f)+ma(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,S,M,z,Y){for(var J=Ga(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,z),oe=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),he=this.paint.get("circle-pitch-alignment")==="map",Se=he?J:function(nn,xn){return nn.map(function(pi){return $u(pi,xn)})}(J,Y),Ye=he?oe*z:oe,$e=0,gt=g;$e<gt.length;$e+=1)for(var nt=0,Lt=gt[$e];nt<Lt.length;nt+=1){var Ht=Lt[nt],pr=he?Ht:$u(Ht,Y),vr=Ye,Br=Du([],[Ht.x,Ht.y,0,1],Y);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?vr*=Br[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(vr*=M.cameraToCenterDistance/Br[3]),ui(Se,pr,vr))return!0}return!1},t}(su));function $u(e,t){var r=Du([],[e.x,e.y,0,1],t);return new G(r[0]/r[3],r[1]/r[3])}var Ol=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(zn);function Ju(e,t,r,f){var v=t.width,g=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*g*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*g*r);return e.width=v,e.height=g,e.data=f,e}function pl(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var g=Ju({},{width:f,height:v},r);Ll(e,g,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=g.data}}function Ll(e,t,r,f,v,g){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=e.data,M=t.data,z=0;z<v.height;z++)for(var Y=((r.y+z)*e.width+r.x)*g,J=((f.y+z)*t.width+f.x)*g,oe=0;oe<v.width*g;oe++)M[J+oe]=S[Y+oe];return t}Nn("HeatmapBucket",Ol,{omit:["layers"]});var _u=function(e,t){Ju(this,e,1,t)};_u.prototype.resize=function(e){pl(this,e,1)},_u.prototype.clone=function(){return new _u({width:this.width,height:this.height},new Uint8Array(this.data))},_u.copy=function(e,t,r,f,v){Ll(e,t,r,f,v,1)};var Mo=function(e,t){Ju(this,e,4,t)};Mo.prototype.resize=function(e){pl(this,e,4)},Mo.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},Mo.prototype.clone=function(){return new Mo({width:this.width,height:this.height},new Uint8Array(this.data))},Mo.copy=function(e,t,r,f,v){Ll(e,t,r,f,v,4)},Nn("AlphaImage",_u),Nn("RGBAImage",Mo);var Bf={paint:new Zo({"heatmap-radius":new $n(ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $n(ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ni(ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ws(ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ni(ue.paint_heatmap["heatmap-opacity"])})};function Rl(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new Mo({width:r,height:f}),g=function(Ye,$e,gt){t[e.evaluationKey]=gt;var nt=e.expression.evaluate(t);v.data[Ye+$e+0]=Math.floor(255*nt.r/nt.a),v.data[Ye+$e+1]=Math.floor(255*nt.g/nt.a),v.data[Ye+$e+2]=Math.floor(255*nt.b/nt.a),v.data[Ye+$e+3]=Math.floor(255*nt.a)};if(e.clips)for(var S=0,M=0;S<f;++S,M+=4*r)for(var z=0,Y=0;z<r;z++,Y+=4){var J=z/(r-1),oe=e.clips[S];g(M,Y,oe.start*(1-J)+oe.end*J)}else for(var he=0,Se=0;he<r;he++,Se+=4)g(0,Se,he/(r-1));return v}var of=function(e){function t(r){e.call(this,r,Bf),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Ol(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=Rl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(su),xf={paint:new Zo({"hillshade-illumination-direction":new ni(ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ni(ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ni(ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ni(ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ni(ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ni(ue.paint_hillshade["hillshade-accent-color"])})},bf=function(e){function t(r){e.call(this,r,xf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(su),Dl=Do([{name:"a_pos",components:2,type:"Int16"}],4).members,kl=Nf,Mh=Nf;function Nf(e,t,r){r=r||2;var f,v,g,S,M,z,Y,J=t&&t.length,oe=J?t[0]*r:e.length,he=zf(e,0,oe,r,!0),Se=[];if(!he||he.next===he.prev)return Se;if(J&&(he=function($e,gt,nt,Lt){var Ht,pr,vr,Br=[];for(Ht=0,pr=gt.length;Ht<pr;Ht++)(vr=zf($e,gt[Ht]*Lt,Ht<pr-1?gt[Ht+1]*Lt:$e.length,Lt,!1))===vr.next&&(vr.steiner=!0),Br.push(Zp(vr));for(Br.sort(zp),Ht=0;Ht<Br.length;Ht++)lp(Br[Ht],nt),nt=ss(nt,nt.next);return nt}(e,t,he,r)),e.length>80*r){f=g=e[0],v=S=e[1];for(var Ye=r;Ye<oe;Ye+=r)(M=e[Ye])<f&&(f=M),(z=e[Ye+1])<v&&(v=z),M>g&&(g=M),z>S&&(S=z);Y=(Y=Math.max(g-f,S-v))!==0?1/Y:0}return sf(he,Se,r,f,v,Y),Se}function zf(e,t,r,f,v){var g,S;if(v===Tf(e,t,r,f)>0)for(g=t;g<r;g+=f)S=wf(g,e[g],e[g+1],S);else for(g=r-f;g>=t;g-=f)S=wf(g,e[g],e[g+1],S);return S&&Ef(S,S.next)&&(Mc(S),S=S.next),S}function ss(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!Ef(f,f.next)&&jo(f.prev,f,f.next)!==0)f=f.next;else{if(Mc(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function sf(e,t,r,f,v,g,S){if(e){!S&&g&&function(J,oe,he,Se){var Ye=J;do Ye.z===null&&(Ye.z=Ih(Ye.x,Ye.y,oe,he,Se)),Ye.prevZ=Ye.prev,Ye.nextZ=Ye.next,Ye=Ye.next;while(Ye!==J);Ye.prevZ.nextZ=null,Ye.prevZ=null,function($e){var gt,nt,Lt,Ht,pr,vr,Br,nn,xn=1;do{for(nt=$e,$e=null,pr=null,vr=0;nt;){for(vr++,Lt=nt,Br=0,gt=0;gt<xn&&(Br++,Lt=Lt.nextZ);gt++);for(nn=xn;Br>0||nn>0&&Lt;)Br!==0&&(nn===0||!Lt||nt.z<=Lt.z)?(Ht=nt,nt=nt.nextZ,Br--):(Ht=Lt,Lt=Lt.nextZ,nn--),pr?pr.nextZ=Ht:$e=Ht,Ht.prevZ=pr,pr=Ht;nt=Lt}pr.nextZ=null,xn*=2}while(vr>1)}(Ye)}(e,f,v,g);for(var M,z,Y=e;e.prev!==e.next;)if(M=e.prev,z=e.next,g?uf(e,f,v,g):sp(e))t.push(M.i/r),t.push(e.i/r),t.push(z.i/r),Mc(e),e=z.next,Y=z.next;else if((e=z)===Y){S?S===1?sf(e=cc(ss(e),t,r),t,r,f,v,g,2):S===2&&up(e,t,r,f,v,g):sf(ss(e),t,r,f,v,g,1);break}}}function sp(e){var t=e.prev,r=e,f=e.next;if(jo(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(Sf(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&jo(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function uf(e,t,r,f){var v=e.prev,g=e,S=e.next;if(jo(v,g,S)>=0)return!1;for(var M=v.x>g.x?v.x>S.x?v.x:S.x:g.x>S.x?g.x:S.x,z=v.y>g.y?v.y>S.y?v.y:S.y:g.y>S.y?g.y:S.y,Y=Ih(v.x<g.x?v.x<S.x?v.x:S.x:g.x<S.x?g.x:S.x,v.y<g.y?v.y<S.y?v.y:S.y:g.y<S.y?g.y:S.y,t,r,f),J=Ih(M,z,t,r,f),oe=e.prevZ,he=e.nextZ;oe&&oe.z>=Y&&he&&he.z<=J;){if(oe!==e.prev&&oe!==e.next&&Sf(v.x,v.y,g.x,g.y,S.x,S.y,oe.x,oe.y)&&jo(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,he!==e.prev&&he!==e.next&&Sf(v.x,v.y,g.x,g.y,S.x,S.y,he.x,he.y)&&jo(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;oe&&oe.z>=Y;){if(oe!==e.prev&&oe!==e.next&&Sf(v.x,v.y,g.x,g.y,S.x,S.y,oe.x,oe.y)&&jo(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;he&&he.z<=J;){if(he!==e.prev&&he!==e.next&&Sf(v.x,v.y,g.x,g.y,S.x,S.y,he.x,he.y)&&jo(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function cc(e,t,r){var f=e;do{var v=f.prev,g=f.next.next;!Ef(v,g)&&ch(v,f,f.next,g)&&Pc(v,g)&&Pc(g,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(g.i/r),Mc(f),Mc(f.next),f=e=g),f=f.next}while(f!==e);return ss(f)}function up(e,t,r,f,v,g){var S=e;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&cp(S,M)){var z=Zf(S,M);return S=ss(S,S.next),z=ss(z,z.next),sf(S,t,r,f,v,g),void sf(z,t,r,f,v,g)}M=M.next}S=S.next}while(S!==e)}function zp(e,t){return e.x-t.x}function lp(e,t){if(t=function(f,v){var g,S=v,M=f.x,z=f.y,Y=-1/0;do{if(z<=S.y&&z>=S.next.y&&S.next.y!==S.y){var J=S.x+(z-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(J<=M&&J>Y){if(Y=J,J===M){if(z===S.y)return S;if(z===S.next.y)return S.next}g=S.x<S.next.x?S:S.next}}S=S.next}while(S!==v);if(!g)return null;if(M===Y)return g;var oe,he=g,Se=g.x,Ye=g.y,$e=1/0;S=g;do M>=S.x&&S.x>=Se&&M!==S.x&&Sf(z<Ye?M:Y,z,Se,Ye,z<Ye?Y:M,z,S.x,S.y)&&(oe=Math.abs(z-S.y)/(M-S.x),Pc(S,f)&&(oe<$e||oe===$e&&(S.x>g.x||S.x===g.x&&Up(g,S)))&&(g=S,$e=oe)),S=S.next;while(S!==he);return g}(e,t)){var r=Zf(t,e);ss(t,t.next),ss(r,r.next)}}function Up(e,t){return jo(e.prev,e,t.prev)<0&&jo(t.next,e,e.next)<0}function Ih(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Zp(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Sf(e,t,r,f,v,g,S,M){return(v-S)*(t-M)-(e-S)*(g-M)>=0&&(e-S)*(f-M)-(r-S)*(t-M)>=0&&(r-S)*(g-M)-(v-S)*(f-M)>=0}function cp(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&ch(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(Pc(e,t)&&Pc(t,e)&&function(r,f){var v=r,g=!1,S=(r.x+f.x)/2,M=(r.y+f.y)/2;do v.y>M!=v.next.y>M&&v.next.y!==v.y&&S<(v.next.x-v.x)*(M-v.y)/(v.next.y-v.y)+v.x&&(g=!g),v=v.next;while(v!==r);return g}(e,t)&&(jo(e.prev,e,t.prev)||jo(e,t.prev,t))||Ef(e,t)&&jo(e.prev,e,e.next)>0&&jo(t.prev,t,t.next)>0)}function jo(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Ef(e,t){return e.x===t.x&&e.y===t.y}function ch(e,t,r,f){var v=Uf(jo(e,t,r)),g=Uf(jo(e,t,f)),S=Uf(jo(r,f,e)),M=Uf(jo(r,f,t));return v!==g&&S!==M||!(v!==0||!Cf(e,r,t))||!(g!==0||!Cf(e,f,t))||!(S!==0||!Cf(r,e,f))||!(M!==0||!Cf(r,t,f))}function Cf(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Uf(e){return e>0?1:e<0?-1:0}function Pc(e,t){return jo(e.prev,e,e.next)<0?jo(e,t,e.next)>=0&&jo(e,e.prev,t)>=0:jo(e,t,e.prev)<0||jo(e,e.next,t)<0}function Zf(e,t){var r=new jf(e.i,e.x,e.y),f=new jf(t.i,t.x,t.y),v=e.next,g=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,g.next=f,f.prev=g,f}function wf(e,t,r,f){var v=new jf(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function Mc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function jf(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Tf(e,t,r,f){for(var v=0,g=t,S=r-f;g<r;g+=f)v+=(e[S]-e[g])*(e[g+1]+e[S+1]),S=g;return v}function fh(e,t,r,f,v){(function g(S,M,z,Y,J){for(;Y>z;){if(Y-z>600){var oe=Y-z+1,he=M-z+1,Se=Math.log(oe),Ye=.5*Math.exp(2*Se/3),$e=.5*Math.sqrt(Se*Ye*(oe-Ye)/oe)*(he-oe/2<0?-1:1);g(S,M,Math.max(z,Math.floor(M-he*Ye/oe+$e)),Math.min(Y,Math.floor(M+(oe-he)*Ye/oe+$e)),J)}var gt=S[M],nt=z,Lt=Y;for(Vc(S,z,M),J(S[Y],gt)>0&&Vc(S,z,Y);nt<Lt;){for(Vc(S,nt,Lt),nt++,Lt--;J(S[nt],gt)<0;)nt++;for(;J(S[Lt],gt)>0;)Lt--}J(S[z],gt)===0?Vc(S,z,Lt):Vc(S,++Lt,Y),Lt<=M&&(z=Lt+1),M<=Lt&&(Y=Lt-1)}})(e,t,r||0,f||e.length-1,v||Oh)}function Vc(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function Oh(e,t){return e<t?-1:e>t?1:0}function fc(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,g=[],S=0;S<r;S++){var M=fr(e[S]);M!==0&&(e[S].area=Math.abs(M),v===void 0&&(v=M<0),v===M<0?(f&&g.push(f),f=[e[S]]):f.push(e[S]))}if(f&&g.push(f),t>1)for(var z=0;z<g.length;z++)g[z].length<=t||(fh(g[z],t,1,g[z].length-1,hh),g[z]=g[z].slice(0,t));return g}function hh(e,t){return t.area-e.area}function lf(e,t,r){for(var f=r.patternDependencies,v=!1,g=0,S=t;g<S.length;g+=1){var M=S[g].paint.get(e+"-pattern");M.isConstant()||(v=!0);var z=M.constantOr(null);z&&(v=!0,f[z.to]=!0,f[z.from]=!0)}return v}function cf(e,t,r,f,v){for(var g=v.patternDependencies,S=0,M=t;S<M.length;S+=1){var z=M[S],Y=z.paint.get(e+"-pattern").value;if(Y.kind!=="constant"){var J=Y.evaluate({zoom:f-1},r,{},v.availableImages),oe=Y.evaluate({zoom:f},r,{},v.availableImages),he=Y.evaluate({zoom:f+1},r,{},v.availableImages);oe=oe&&oe.name?oe.name:oe,he=he&&he.name?he.name:he,g[J=J&&J.name?J.name:J]=!0,g[oe]=!0,g[he]=!0,r.patterns[z.id]={min:J,mid:oe,max:he}}}return r}Nf.deviation=function(e,t,r,f){var v=t&&t.length,g=Math.abs(Tf(e,0,v?t[0]*r:e.length,r));if(v)for(var S=0,M=t.length;S<M;S++)g-=Math.abs(Tf(e,t[S]*r,S<M-1?t[S+1]*r:e.length,r));var z=0;for(S=0;S<f.length;S+=3){var Y=f[S]*r,J=f[S+1]*r,oe=f[S+2]*r;z+=Math.abs((e[Y]-e[oe])*(e[J+1]-e[Y+1])-(e[Y]-e[J])*(e[oe+1]-e[Y+1]))}return g===0&&z===0?0:Math.abs((z-g)/g)},Nf.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var g=0;g<e[v].length;g++)for(var S=0;S<t;S++)r.vertices.push(e[v][g][S]);v>0&&r.holes.push(f+=e[v-1].length)}return r},kl.default=Mh;var lu=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xs,this.indexArray=new Xu,this.indexArray2=new uc,this.programConfigurations=new ie(e.layers,e.zoom),this.segments=new Ae,this.segments2=new Ae,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};lu.prototype.populate=function(e,t,r){this.hasPattern=lf("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],g=0,S=e;g<S.length;g+=1){var M=S[g],z=M.feature,Y=M.id,J=M.index,oe=M.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,Se=Fr(z,he);if(this.layers[0]._featureFilter.filter(new ta(this.zoom),Se,r)){var Ye=f?f.evaluate(Se,{},r,t.availableImages):void 0,$e={id:Y,properties:z.properties,type:z.type,sourceLayerIndex:oe,index:J,geometry:he?Se.geometry:Qt(z),patterns:{},sortKey:Ye};v.push($e)}}f&&v.sort(function(nn,xn){return nn.sortKey-xn.sortKey});for(var gt=0,nt=v;gt<nt.length;gt+=1){var Lt=nt[gt],Ht=Lt.geometry,pr=Lt.index,vr=Lt.sourceLayerIndex;if(this.hasPattern){var Br=cf("fill",this.layers,Lt,this.zoom,t);this.patternFeatures.push(Br)}else this.addFeature(Lt,Ht,pr,r,{});t.featureIndex.insert(e[pr].feature,Ht,pr,vr,this.index)}},lu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},lu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},lu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},lu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},lu.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dl),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},lu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},lu.prototype.addFeature=function(e,t,r,f,v){for(var g=0,S=fc(t,500);g<S.length;g+=1){for(var M=S[g],z=0,Y=0,J=M;Y<J.length;Y+=1)z+=J[Y].length;for(var oe=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray),he=oe.vertexLength,Se=[],Ye=[],$e=0,gt=M;$e<gt.length;$e+=1){var nt=gt[$e];if(nt.length!==0){nt!==M[0]&&Ye.push(Se.length/2);var Lt=this.segments2.prepareSegment(nt.length,this.layoutVertexArray,this.indexArray2),Ht=Lt.vertexLength;this.layoutVertexArray.emplaceBack(nt[0].x,nt[0].y),this.indexArray2.emplaceBack(Ht+nt.length-1,Ht),Se.push(nt[0].x),Se.push(nt[0].y);for(var pr=1;pr<nt.length;pr++)this.layoutVertexArray.emplaceBack(nt[pr].x,nt[pr].y),this.indexArray2.emplaceBack(Ht+pr-1,Ht+pr),Se.push(nt[pr].x),Se.push(nt[pr].y);Lt.vertexLength+=nt.length,Lt.primitiveLength+=nt.length}}for(var vr=kl(Se,Ye),Br=0;Br<vr.length;Br+=3)this.indexArray.emplaceBack(he+vr[Br],he+vr[Br+1],he+vr[Br+2]);oe.vertexLength+=z,oe.primitiveLength+=vr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Nn("FillBucket",lu,{omit:["layers","patternFeatures"]});var Vf=new Zo({"fill-sort-key":new $n(ue.layout_fill["fill-sort-key"])}),Gf={paint:new Zo({"fill-antialias":new ni(ue.paint_fill["fill-antialias"]),"fill-opacity":new $n(ue.paint_fill["fill-opacity"]),"fill-color":new $n(ue.paint_fill["fill-color"]),"fill-outline-color":new $n(ue.paint_fill["fill-outline-color"]),"fill-translate":new ni(ue.paint_fill["fill-translate"]),"fill-translate-anchor":new ni(ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pl(ue.paint_fill["fill-pattern"])}),layout:Vf},ff=function(e){function t(r){e.call(this,r,Gf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new lu(r)},t.prototype.queryRadius=function(){return ma(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,S,M,z){return yi(Ga(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,z),g)},t.prototype.isTileClipped=function(){return!0},t}(su),Lh=Do([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,hc=dl;function dl(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(Rh,this,t)}function Rh(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var g=f.readVarint()+f.pos;f.pos<g;){var S=v._keys[f.readVarint()],M=v._values[f.readVarint()];v.properties[S]=M}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Dh(e){for(var t,r,f=0,v=0,g=e.length,S=g-1;v<g;S=v++)f+=((r=e[S]).x-(t=e[v]).x)*(t.y+r.y);return f}dl.types=["Unknown","Point","LineString","Polygon"],dl.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,g=0,S=0,M=[];e.pos<r;){if(v<=0){var z=e.readVarint();f=7&z,v=z>>3}if(v--,f===1||f===2)g+=e.readSVarint(),S+=e.readSVarint(),f===1&&(t&&M.push(t),t=[]),t.push(new G(g,S));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&M.push(t),M},dl.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,g=0,S=1/0,M=-1/0,z=1/0,Y=-1/0;e.pos<t;){if(f<=0){var J=e.readVarint();r=7&J,f=J>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<S&&(S=v),v>M&&(M=v),(g+=e.readSVarint())<z&&(z=g),g>Y&&(Y=g);else if(r!==7)throw new Error("unknown command "+r)}return[S,z,M,Y]},dl.prototype.toGeoJSON=function(e,t,r){var f,v,g=this.extent*Math.pow(2,r),S=this.extent*e,M=this.extent*t,z=this.loadGeometry(),Y=dl.types[this.type];function J(Se){for(var Ye=0;Ye<Se.length;Ye++){var $e=Se[Ye];Se[Ye]=[360*($e.x+S)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*($e.y+M)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var oe=[];for(f=0;f<z.length;f++)oe[f]=z[f][0];J(z=oe);break;case 2:for(f=0;f<z.length;f++)J(z[f]);break;case 3:for(z=function(Se){var Ye=Se.length;if(Ye<=1)return[Se];for(var $e,gt,nt=[],Lt=0;Lt<Ye;Lt++){var Ht=Dh(Se[Lt]);Ht!==0&&(gt===void 0&&(gt=Ht<0),gt===Ht<0?($e&&nt.push($e),$e=[Se[Lt]]):$e.push(Se[Lt]))}return $e&&nt.push($e),nt}(z),f=0;f<z.length;f++)for(v=0;v<z[f].length;v++)J(z[f][v])}z.length===1?z=z[0]:Y="Multi"+Y;var he={type:"Feature",geometry:{type:Y,coordinates:z},properties:this.properties};return"id"in this&&(he.id=this.id),he};var kh=fp;function fp(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(jp,this,t),this.length=this._features.length}function jp(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,g=f.readVarint()+f.pos;f.pos<g;){var S=f.readVarint()>>3;v=S===1?f.readString():S===2?f.readFloat():S===3?f.readDouble():S===4?f.readVarint64():S===5?f.readVarint():S===6?f.readSVarint():S===7?f.readBoolean():null}return v}(r))}function Gc(e,t,r){if(e===3){var f=new kh(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}fp.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new hc(this._pbf,t,this.extent,this._keys,this._values)};var Ic={VectorTile:function(e,t){this.layers=e.readFields(Gc,{},t)},VectorTileFeature:hc,VectorTileLayer:kh},ph=Ic.VectorTileFeature.types,Hf=Math.pow(2,13);function hf(e,t,r,f,v,g,S,M){e.emplaceBack(t,r,2*Math.floor(f*Hf)+S,v*Hf*2,g*Hf*2,Math.round(M))}var Qu=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Rs,this.indexArray=new Xu,this.programConfigurations=new ie(e.layers,e.zoom),this.segments=new Ae,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function hp(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}Qu.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=lf("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var g=v[f],S=g.feature,M=g.id,z=g.index,Y=g.sourceLayerIndex,J=this.layers[0]._featureFilter.needGeometry,oe=Fr(S,J);if(this.layers[0]._featureFilter.filter(new ta(this.zoom),oe,r)){var he={id:M,sourceLayerIndex:Y,index:z,geometry:J?oe.geometry:Qt(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(cf("fill-extrusion",this.layers,he,this.zoom,t)):this.addFeature(he,he.geometry,z,r,{}),t.featureIndex.insert(S,he.geometry,z,Y,this.index,!0)}}},Qu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},Qu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Qu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Qu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Qu.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Qu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Qu.prototype.addFeature=function(e,t,r,f,v){for(var g=0,S=fc(t,500);g<S.length;g+=1){for(var M=S[g],z=0,Y=0,J=M;Y<J.length;Y+=1)z+=J[Y].length;for(var oe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),he=0,Se=M;he<Se.length;he+=1){var Ye=Se[he];if(Ye.length!==0&&!((ha=Ye).every(function(Vi){return Vi.x<0})||ha.every(function(Vi){return Vi.x>8192})||ha.every(function(Vi){return Vi.y<0})||ha.every(function(Vi){return Vi.y>8192})))for(var $e=0,gt=0;gt<Ye.length;gt++){var nt=Ye[gt];if(gt>=1){var Lt=Ye[gt-1];if(!hp(nt,Lt)){oe.vertexLength+4>Ae.MAX_VERTEX_ARRAY_LENGTH&&(oe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Ht=nt.sub(Lt)._perp()._unit(),pr=Lt.dist(nt);$e+pr>32768&&($e=0),hf(this.layoutVertexArray,nt.x,nt.y,Ht.x,Ht.y,0,0,$e),hf(this.layoutVertexArray,nt.x,nt.y,Ht.x,Ht.y,0,1,$e),hf(this.layoutVertexArray,Lt.x,Lt.y,Ht.x,Ht.y,0,0,$e+=pr),hf(this.layoutVertexArray,Lt.x,Lt.y,Ht.x,Ht.y,0,1,$e);var vr=oe.vertexLength;this.indexArray.emplaceBack(vr,vr+2,vr+1),this.indexArray.emplaceBack(vr+1,vr+2,vr+3),oe.vertexLength+=4,oe.primitiveLength+=2}}}}if(oe.vertexLength+z>Ae.MAX_VERTEX_ARRAY_LENGTH&&(oe=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray)),ph[e.type]==="Polygon"){for(var Br=[],nn=[],xn=oe.vertexLength,pi=0,kn=M;pi<kn.length;pi+=1){var si=kn[pi];if(si.length!==0){si!==M[0]&&nn.push(Br.length/2);for(var jn=0;jn<si.length;jn++){var na=si[jn];hf(this.layoutVertexArray,na.x,na.y,0,0,1,1,0),Br.push(na.x),Br.push(na.y)}}}for(var Ti=kl(Br,nn),Jn=0;Jn<Ti.length;Jn+=3)this.indexArray.emplaceBack(xn+Ti[Jn],xn+Ti[Jn+2],xn+Ti[Jn+1]);oe.primitiveLength+=Ti.length/3,oe.vertexLength+=z}}var ha;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Nn("FillExtrusionBucket",Qu,{omit:["layers","features"]});var Fl={paint:new Zo({"fill-extrusion-opacity":new ni(ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $n(ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ni(ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ni(ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pl(ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $n(ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $n(ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ni(ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Fh=function(e){function t(r){e.call(this,r,Fl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Qu(r)},t.prototype.queryRadius=function(){return ma(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,g,S,M,z,Y){var J=Ga(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,z),oe=this.paint.get("fill-extrusion-height").evaluate(f,v),he=this.paint.get("fill-extrusion-base").evaluate(f,v),Se=function($e,gt,nt,Lt){for(var Ht=[],pr=0,vr=$e;pr<vr.length;pr+=1){var Br=vr[pr],nn=[Br.x,Br.y,0,1];Du(nn,nn,gt),Ht.push(new G(nn[0]/nn[3],nn[1]/nn[3]))}return Ht}(J,Y),Ye=function($e,gt,nt,Lt){for(var Ht=[],pr=[],vr=Lt[8]*gt,Br=Lt[9]*gt,nn=Lt[10]*gt,xn=Lt[11]*gt,pi=Lt[8]*nt,kn=Lt[9]*nt,si=Lt[10]*nt,jn=Lt[11]*nt,na=0,Ti=$e;na<Ti.length;na+=1){for(var Jn=[],ha=[],Vi=0,Ca=Ti[na];Vi<Ca.length;Vi+=1){var mi=Ca[Vi],ba=mi.x,Ao=mi.y,Wo=Lt[0]*ba+Lt[4]*Ao+Lt[12],Xo=Lt[1]*ba+Lt[5]*Ao+Lt[13],Oo=Lt[2]*ba+Lt[6]*Ao+Lt[14],Qo=Lt[3]*ba+Lt[7]*Ao+Lt[15],ks=Oo+nn,Fs=Qo+xn,fu=Wo+pi,zs=Xo+kn,Ys=Oo+si,Bo=Qo+jn,Us=new G((Wo+vr)/Fs,(Xo+Br)/Fs);Us.z=ks/Fs,Jn.push(Us);var va=new G(fu/Bo,zs/Bo);va.z=Ys/Bo,ha.push(va)}Ht.push(Jn),pr.push(ha)}return[Ht,pr]}(g,he,oe,Y);return function($e,gt,nt){var Lt=1/0;yi(nt,gt)&&(Lt=Bl(nt,gt[0]));for(var Ht=0;Ht<gt.length;Ht++)for(var pr=gt[Ht],vr=$e[Ht],Br=0;Br<pr.length-1;Br++){var nn=pr[Br],xn=[nn,pr[Br+1],vr[Br+1],vr[Br],nn];hi(nt,xn)&&(Lt=Math.min(Lt,Bl(nt,xn)))}return Lt!==1/0&&Lt}(Ye[0],Ye[1],Se)},t}(su);function vl(e,t){return e.x*t.x+e.y*t.y}function Bl(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var g=t[f],S=e[0],M=r.sub(v),z=g.sub(v),Y=S.sub(v),J=vl(M,M),oe=vl(M,z),he=vl(z,z),Se=vl(Y,M),Ye=vl(Y,z),$e=J*he-oe*oe,gt=(he*Se-oe*Ye)/$e,nt=(J*Ye-oe*Se)/$e,Lt=v.z*(1-gt-nt)+r.z*gt+g.z*nt;if(isFinite(Lt))return Lt}return 1/0}for(var Ht=1/0,pr=0,vr=t;pr<vr.length;pr+=1)Ht=Math.min(Ht,vr[pr].z);return Ht}var dh=Do([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,vh=Do([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Wf=Ic.VectorTileFeature.types,Bh=Math.cos(Math.PI/180*37.5),us=Math.pow(2,14)/.5,Vo=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new os,this.layoutVertexArray2=new fl,this.indexArray=new Xu,this.programConfigurations=new ie(e.layers,e.zoom),this.segments=new Ae,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};Vo.prototype.populate=function(e,t,r){this.hasPattern=lf("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],g=0,S=e;g<S.length;g+=1){var M=S[g],z=M.feature,Y=M.id,J=M.index,oe=M.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,Se=Fr(z,he);if(this.layers[0]._featureFilter.filter(new ta(this.zoom),Se,r)){var Ye=f?f.evaluate(Se,{},r):void 0,$e={id:Y,properties:z.properties,type:z.type,sourceLayerIndex:oe,index:J,geometry:he?Se.geometry:Qt(z),patterns:{},sortKey:Ye};v.push($e)}}f&&v.sort(function(nn,xn){return nn.sortKey-xn.sortKey});for(var gt=0,nt=v;gt<nt.length;gt+=1){var Lt=nt[gt],Ht=Lt.geometry,pr=Lt.index,vr=Lt.sourceLayerIndex;if(this.hasPattern){var Br=cf("line",this.layers,Lt,this.zoom,t);this.patternFeatures.push(Br)}else this.addFeature(Lt,Ht,pr,r,{});t.featureIndex.insert(e[pr].feature,Ht,pr,vr,this.index)}},Vo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Vo.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},Vo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Vo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Vo.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,vh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Vo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Vo.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Vo.prototype.addFeature=function(e,t,r,f,v){var g=this.layers[0].layout,S=g.get("line-join").evaluate(e,{}),M=g.get("line-cap"),z=g.get("line-miter-limit"),Y=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var J=0,oe=t;J<oe.length;J+=1)this.addLine(oe[J],e,S,M,z,Y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Vo.prototype.addLine=function(e,t,r,f,v,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<e.length-1;S++)this.totalDistance+=e[S].dist(e[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Wf[t.type]==="Polygon",z=e.length;z>=2&&e[z-1].equals(e[z-2]);)z--;for(var Y=0;Y<z-1&&e[Y].equals(e[Y+1]);)Y++;if(!(z<(M?3:2))){r==="bevel"&&(v=1.05);var J,oe=this.overscaling<=16?122880/(512*this.overscaling):0,he=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray),Se=void 0,Ye=void 0,$e=void 0,gt=void 0;this.e1=this.e2=-1,M&&(gt=e[Y].sub(J=e[z-2])._unit()._perp());for(var nt=Y;nt<z;nt++)if(!(Ye=nt===z-1?M?e[Y+1]:void 0:e[nt+1])||!e[nt].equals(Ye)){gt&&($e=gt),J&&(Se=J),J=e[nt],gt=Ye?Ye.sub(J)._unit()._perp():$e;var Lt=($e=$e||gt).add(gt);Lt.x===0&&Lt.y===0||Lt._unit();var Ht=$e.x*gt.x+$e.y*gt.y,pr=Lt.x*gt.x+Lt.y*gt.y,vr=pr!==0?1/pr:1/0,Br=2*Math.sqrt(2-2*pr),nn=pr<Bh&&Se&&Ye,xn=$e.x*gt.y-$e.y*gt.x>0;if(nn&&nt>Y){var pi=J.dist(Se);if(pi>2*oe){var kn=J.sub(J.sub(Se)._mult(oe/pi)._round());this.updateDistance(Se,kn),this.addCurrentVertex(kn,$e,0,0,he),Se=kn}}var si=Se&&Ye,jn=si?r:M?"butt":f;if(si&&jn==="round"&&(vr<g?jn="miter":vr<=2&&(jn="fakeround")),jn==="miter"&&vr>v&&(jn="bevel"),jn==="bevel"&&(vr>2&&(jn="flipbevel"),vr<v&&(jn="miter")),Se&&this.updateDistance(Se,J),jn==="miter")Lt._mult(vr),this.addCurrentVertex(J,Lt,0,0,he);else if(jn==="flipbevel"){if(vr>100)Lt=gt.mult(-1);else{var na=vr*$e.add(gt).mag()/$e.sub(gt).mag();Lt._perp()._mult(na*(xn?-1:1))}this.addCurrentVertex(J,Lt,0,0,he),this.addCurrentVertex(J,Lt.mult(-1),0,0,he)}else if(jn==="bevel"||jn==="fakeround"){var Ti=-Math.sqrt(vr*vr-1),Jn=xn?Ti:0,ha=xn?0:Ti;if(Se&&this.addCurrentVertex(J,$e,Jn,ha,he),jn==="fakeround")for(var Vi=Math.round(180*Br/Math.PI/20),Ca=1;Ca<Vi;Ca++){var mi=Ca/Vi;if(mi!==.5){var ba=mi-.5;mi+=mi*ba*(mi-1)*((1.0904+Ht*(Ht*(3.55645-1.43519*Ht)-3.2452))*ba*ba+(.848013+Ht*(.215638*Ht-1.06021)))}var Ao=gt.sub($e)._mult(mi)._add($e)._unit()._mult(xn?-1:1);this.addHalfVertex(J,Ao.x,Ao.y,!1,xn,0,he)}Ye&&this.addCurrentVertex(J,gt,-Jn,-ha,he)}else if(jn==="butt")this.addCurrentVertex(J,Lt,0,0,he);else if(jn==="square"){var Wo=Se?1:-1;this.addCurrentVertex(J,Lt,Wo,Wo,he)}else jn==="round"&&(Se&&(this.addCurrentVertex(J,$e,0,0,he),this.addCurrentVertex(J,$e,1,1,he,!0)),Ye&&(this.addCurrentVertex(J,gt,-1,-1,he,!0),this.addCurrentVertex(J,gt,0,0,he)));if(nn&&nt<z-1){var Xo=J.dist(Ye);if(Xo>2*oe){var Oo=J.add(Ye.sub(J)._mult(oe/Xo)._round());this.updateDistance(J,Oo),this.addCurrentVertex(Oo,gt,0,0,he),J=Oo}}}}},Vo.prototype.addCurrentVertex=function(e,t,r,f,v,g){g===void 0&&(g=!1);var S=t.y*f-t.x,M=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,g,!1,r,v),this.addHalfVertex(e,S,M,g,!0,-f,v),this.distance>us/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,g))},Vo.prototype.addHalfVertex=function(e,t,r,f,v,g,S){var M=.5*(this.lineClips?this.scaledDistance*(us-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(g===0?0:g<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var z=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),S.primitiveLength++),v?this.e2=z:this.e1=z},Vo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Vo.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Nn("LineBucket",Vo,{omit:["layers","patternFeatures"]});var ls=new Zo({"line-cap":new ni(ue.layout_line["line-cap"]),"line-join":new $n(ue.layout_line["line-join"]),"line-miter-limit":new ni(ue.layout_line["line-miter-limit"]),"line-round-limit":new ni(ue.layout_line["line-round-limit"]),"line-sort-key":new $n(ue.layout_line["line-sort-key"])}),cu={paint:new Zo({"line-opacity":new $n(ue.paint_line["line-opacity"]),"line-color":new $n(ue.paint_line["line-color"]),"line-translate":new ni(ue.paint_line["line-translate"]),"line-translate-anchor":new ni(ue.paint_line["line-translate-anchor"]),"line-width":new $n(ue.paint_line["line-width"]),"line-gap-width":new $n(ue.paint_line["line-gap-width"]),"line-offset":new $n(ue.paint_line["line-offset"]),"line-blur":new $n(ue.paint_line["line-blur"]),"line-dasharray":new as(ue.paint_line["line-dasharray"]),"line-pattern":new Pl(ue.paint_line["line-pattern"]),"line-gradient":new Ws(ue.paint_line["line-gradient"])}),layout:ls},Xf=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new ta(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,g){return f=It({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,g)},t}($n))(cu.paint.properties["line-width"].specification);Xf.useIntegerZoom=!0;var Nh=function(e){function t(r){e.call(this,r,cu),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ns,this.gradientVersion=(this.gradientVersion+1)%_e)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=Xf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new Vo(r)},t.prototype.queryRadius=function(r){var f=r,v=zh(fa("line-width",this,f),fa("line-gap-width",this,f)),g=fa("line-offset",this,f);return v/2+Math.abs(g)+ma(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,S,M,z){var Y=Ga(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,z),J=z/2*zh(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),oe=this.paint.get("line-offset").evaluate(f,v);return oe&&(g=function(he,Se){for(var Ye=[],$e=new G(0,0),gt=0;gt<he.length;gt++){for(var nt=he[gt],Lt=[],Ht=0;Ht<nt.length;Ht++){var pr=nt[Ht],vr=nt[Ht+1],Br=Ht===0?$e:pr.sub(nt[Ht-1])._unit()._perp(),nn=Ht===nt.length-1?$e:vr.sub(pr)._unit()._perp(),xn=Br._add(nn)._unit();xn._mult(1/(xn.x*nn.x+xn.y*nn.y)),Lt.push(xn._mult(Se)._add(pr))}Ye.push(Lt)}return Ye}(g,oe*z)),function(he,Se,Ye){for(var $e=0;$e<Se.length;$e++){var gt=Se[$e];if(he.length>=3){for(var nt=0;nt<gt.length;nt++)if(La(he,gt[nt]))return!0}if(Ki(he,gt,Ye))return!0}return!1}(Y,g,J)},t.prototype.isTileClipped=function(){return!0},t}(su);function zh(e,t){return t>0?t+2*e:e}var pp=Do([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),dp=Do([{name:"a_projected_pos",components:3,type:"Float32"}],4),Uh=(Do([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Do([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Zh=(Do([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Do([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),jh=Do([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function vp(e,t,r){return e.sections.forEach(function(f){f.text=function(v,g,S){var M=g.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?v=v.toLocaleUpperCase():M==="lowercase"&&(v=v.toLocaleLowerCase()),Ls.applyArabicShaping&&(v=Ls.applyArabicShaping(v)),v}(f.text,t,r)}),e}Do([{name:"triangle",components:3,type:"Uint16"}]),Do([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Do([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Do([{type:"Float32",name:"offsetX"}]),Do([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var pf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Yf=function(e,t,r,f,v){var g,S,M=8*v-f-1,z=(1<<M)-1,Y=z>>1,J=-7,oe=r?v-1:0,he=r?-1:1,Se=e[t+oe];for(oe+=he,g=Se&(1<<-J)-1,Se>>=-J,J+=M;J>0;g=256*g+e[t+oe],oe+=he,J-=8);for(S=g&(1<<-J)-1,g>>=-J,J+=f;J>0;S=256*S+e[t+oe],oe+=he,J-=8);if(g===0)g=1-Y;else{if(g===z)return S?NaN:1/0*(Se?-1:1);S+=Math.pow(2,f),g-=Y}return(Se?-1:1)*S*Math.pow(2,g-f)},mh=function(e,t,r,f,v,g){var S,M,z,Y=8*g-v-1,J=(1<<Y)-1,oe=J>>1,he=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,Se=f?0:g-1,Ye=f?1:-1,$e=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(M=isNaN(t)?1:0,S=J):(S=Math.floor(Math.log(t)/Math.LN2),t*(z=Math.pow(2,-S))<1&&(S--,z*=2),(t+=S+oe>=1?he/z:he*Math.pow(2,1-oe))*z>=2&&(S++,z/=2),S+oe>=J?(M=0,S=J):S+oe>=1?(M=(t*z-1)*Math.pow(2,v),S+=oe):(M=t*Math.pow(2,oe-1)*Math.pow(2,v),S=0));v>=8;e[r+Se]=255&M,Se+=Ye,M/=256,v-=8);for(S=S<<v|M,Y+=v;Y>0;e[r+Se]=255&S,Se+=Ye,S/=256,Y-=8);e[r+Se-Ye]|=128*$e},Af=Ka;function Ka(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Ka.Varint=0,Ka.Fixed64=1,Ka.Bytes=2,Ka.Fixed32=5;var Vh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function pc(e){return e.type===Ka.Bytes?e.readVarint()+e.pos:e.pos+1}function Hc(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Wc(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function W(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Oe(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function et(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function ur(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Dr(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function ar(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Ar(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function jr(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Wr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function Jr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Qr(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function rn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function yn(e,t,r){e===1&&r.readMessage(Xr,t)}function Xr(e,t,r){if(e===3){var f=r.readMessage(en,{}),v=f.width,g=f.height,S=f.left,M=f.top,z=f.advance;t.push({id:f.id,bitmap:new _u({width:v+6,height:g+6},f.bitmap),metrics:{width:v,height:g,left:S,top:M,advance:z}})}}function en(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function Nt(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var g=v[f];t+=g.w*g.h,r=Math.max(r,g.w)}e.sort(function($e,gt){return gt.h-$e.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],M=0,z=0,Y=0,J=e;Y<J.length;Y+=1)for(var oe=J[Y],he=S.length-1;he>=0;he--){var Se=S[he];if(!(oe.w>Se.w||oe.h>Se.h)){if(oe.x=Se.x,oe.y=Se.y,z=Math.max(z,oe.y+oe.h),M=Math.max(M,oe.x+oe.w),oe.w===Se.w&&oe.h===Se.h){var Ye=S.pop();he<S.length&&(S[he]=Ye)}else oe.h===Se.h?(Se.x+=oe.w,Se.w-=oe.w):oe.w===Se.w?(Se.y+=oe.h,Se.h-=oe.h):(S.push({x:Se.x+oe.w,y:Se.y,w:Se.w-oe.w,h:oe.h}),Se.y+=oe.h,Se.h-=oe.h);break}}return{w:M,h:z,fill:t/(M*z)||0}}Ka.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var f=this.readVarint(),v=f>>3,g=this.pos;this.type=7&f,e(v,t,this),this.pos===g&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Jr(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=rn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Jr(this.buf,this.pos)+4294967296*Jr(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=Jr(this.buf,this.pos)+4294967296*rn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Yf(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Yf(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,f=this.buf;return t=127&(r=f[this.pos++]),r<128?t:(t|=(127&(r=f[this.pos++]))<<7,r<128?t:(t|=(127&(r=f[this.pos++]))<<14,r<128?t:(t|=(127&(r=f[this.pos++]))<<21,r<128?t:function(v,g,S){var M,z,Y=S.buf;if(M=(112&(z=Y[S.pos++]))>>4,z<128||(M|=(127&(z=Y[S.pos++]))<<3,z<128)||(M|=(127&(z=Y[S.pos++]))<<10,z<128)||(M|=(127&(z=Y[S.pos++]))<<17,z<128)||(M|=(127&(z=Y[S.pos++]))<<24,z<128)||(M|=(1&(z=Y[S.pos++]))<<31,z<128))return Hc(v,M,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Vh?function(r,f,v){return Vh.decode(r.subarray(f,v))}(this.buf,t,e):function(r,f,v){for(var g="",S=f;S<v;){var M,z,Y,J=r[S],oe=null,he=J>239?4:J>223?3:J>191?2:1;if(S+he>v)break;he===1?J<128&&(oe=J):he===2?(192&(M=r[S+1]))==128&&(oe=(31&J)<<6|63&M)<=127&&(oe=null):he===3?(z=r[S+2],(192&(M=r[S+1]))==128&&(192&z)==128&&((oe=(15&J)<<12|(63&M)<<6|63&z)<=2047||oe>=55296&&oe<=57343)&&(oe=null)):he===4&&(z=r[S+2],Y=r[S+3],(192&(M=r[S+1]))==128&&(192&z)==128&&(192&Y)==128&&((oe=(15&J)<<18|(63&M)<<12|(63&z)<<6|63&Y)<=65535||oe>=1114112)&&(oe=null)),oe===null?(oe=65533,he=1):oe>65535&&(oe-=65536,g+=String.fromCharCode(oe>>>10&1023|55296),oe=56320|1023&oe),g+=String.fromCharCode(oe),S+=he}return g}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Ka.Bytes)return e.push(this.readVarint(t));var r=pc(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Ka.Bytes)return e.push(this.readSVarint());var t=pc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Ka.Bytes)return e.push(this.readBoolean());var t=pc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Ka.Bytes)return e.push(this.readFloat());var t=pc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Ka.Bytes)return e.push(this.readDouble());var t=pc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Ka.Bytes)return e.push(this.readFixed32());var t=pc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Ka.Bytes)return e.push(this.readSFixed32());var t=pc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Ka.Bytes)return e.push(this.readFixed64());var t=pc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Ka.Bytes)return e.push(this.readSFixed64());var t=pc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Ka.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ka.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ka.Fixed32)this.pos+=4;else{if(t!==Ka.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Qr(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Qr(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Qr(this.buf,-1&e,this.pos),Qr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Qr(this.buf,-1&e,this.pos),Qr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var f,v;if(t>=0?(f=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(g,S,M){M.buf[M.pos++]=127&g|128,g>>>=7,M.buf[M.pos++]=127&g|128,g>>>=7,M.buf[M.pos++]=127&g|128,g>>>=7,M.buf[M.pos++]=127&g|128,M.buf[M.pos]=127&(g>>>=7)}(f,0,r),function(g,S){var M=(7&g)<<4;S.buf[S.pos++]|=M|((g>>>=3)?128:0),g&&(S.buf[S.pos++]=127&g|((g>>>=7)?128:0),g&&(S.buf[S.pos++]=127&g|((g>>>=7)?128:0),g&&(S.buf[S.pos++]=127&g|((g>>>=7)?128:0),g&&(S.buf[S.pos++]=127&g|((g>>>=7)?128:0),g&&(S.buf[S.pos++]=127&g)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,v,g){for(var S,M,z=0;z<v.length;z++){if((S=v.charCodeAt(z))>55295&&S<57344){if(!M){S>56319||z+1===v.length?(f[g++]=239,f[g++]=191,f[g++]=189):M=S;continue}if(S<56320){f[g++]=239,f[g++]=191,f[g++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(f[g++]=239,f[g++]=191,f[g++]=189,M=null);S<128?f[g++]=S:(S<2048?f[g++]=S>>6|192:(S<65536?f[g++]=S>>12|224:(f[g++]=S>>18|240,f[g++]=S>>12&63|128),f[g++]=S>>6&63|128),f[g++]=63&S|128)}return g}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&Wc(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),mh(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),mh(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var f=this.pos-r;f>=128&&Wc(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,r){this.writeTag(e,Ka.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,W,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Oe,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Dr,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,et,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,ur,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,ar,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Ar,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,jr,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Wr,t)},writeBytesField:function(e,t){this.writeTag(e,Ka.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Ka.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Ka.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Ka.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Ka.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Ka.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Ka.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Ka.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Ka.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Ka.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var _r=function(e,t){var r=t.pixelRatio,f=t.version,v=t.stretchX,g=t.stretchY,S=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=g,this.content=S,this.version=f},Kr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Kr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Kr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Kr.tlbr.get=function(){return this.tl.concat(this.br)},Kr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(_r.prototype,Kr);var Ln=function(e,t){var r={},f={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,f,v);var g=Nt(v),S=new Mo({width:g.w||1,height:g.h||1});for(var M in e){var z=e[M],Y=r[M].paddedRect;Mo.copy(z.data,S,{x:0,y:0},{x:Y.x+1,y:Y.y+1},z.data)}for(var J in t){var oe=t[J],he=f[J].paddedRect,Se=he.x+1,Ye=he.y+1,$e=oe.data.width,gt=oe.data.height;Mo.copy(oe.data,S,{x:0,y:0},{x:Se,y:Ye},oe.data),Mo.copy(oe.data,S,{x:0,y:gt-1},{x:Se,y:Ye-1},{width:$e,height:1}),Mo.copy(oe.data,S,{x:0,y:0},{x:Se,y:Ye+gt},{width:$e,height:1}),Mo.copy(oe.data,S,{x:$e-1,y:0},{x:Se-1,y:Ye},{width:1,height:gt}),Mo.copy(oe.data,S,{x:0,y:0},{x:Se+$e,y:Ye},{width:1,height:gt})}this.image=S,this.iconPositions=r,this.patternPositions=f};Ln.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],g={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(g),t[f]=new _r(g,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},Ln.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},Ln.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},Nn("ImagePosition",_r),Nn("ImageAtlas",Ln);var Or={horizontal:1,vertical:2,horizontalOnly:3},Sn=function(){this.scale=1,this.fontStack="",this.imageName=null};Sn.forText=function(e,t){var r=new Sn;return r.scale=e||1,r.fontStack=t,r},Sn.forImage=function(e){var t=new Sn;return t.imageName=e,t};var tn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function li(e,t,r,f,v,g,S,M,z,Y,J,oe,he,Se,Ye,$e){var gt,nt=tn.fromFeature(e,v);oe===Or.vertical&&nt.verticalizePunctuation();var Lt=Ls.processBidirectionalText,Ht=Ls.processStyledBidirectionalText;if(Lt&&nt.sections.length===1){gt=[];for(var pr=0,vr=Lt(nt.toString(),En(nt,Y,g,t,f,Se,Ye));pr<vr.length;pr+=1){var Br=vr[pr],nn=new tn;nn.text=Br,nn.sections=nt.sections;for(var xn=0;xn<Br.length;xn++)nn.sectionIndex.push(0);gt.push(nn)}}else if(Ht){gt=[];for(var pi=0,kn=Ht(nt.text,nt.sectionIndex,En(nt,Y,g,t,f,Se,Ye));pi<kn.length;pi+=1){var si=kn[pi],jn=new tn;jn.text=si[0],jn.sectionIndex=si[1],jn.sections=nt.sections,gt.push(jn)}}else gt=function(Jn,ha){for(var Vi=[],Ca=Jn.text,mi=0,ba=0,Ao=ha;ba<Ao.length;ba+=1){var Wo=Ao[ba];Vi.push(Jn.substring(mi,Wo)),mi=Wo}return mi<Ca.length&&Vi.push(Jn.substring(mi,Ca.length)),Vi}(nt,En(nt,Y,g,t,f,Se,Ye));var na=[],Ti={positionedLines:na,text:nt.toString(),top:J[1],bottom:J[1],left:J[0],right:J[0],writingMode:oe,iconsInText:!1,verticalizable:!1};return function(Jn,ha,Vi,Ca,mi,ba,Ao,Wo,Xo,Oo,Qo,ks){for(var Fs=0,fu=-17,zs=0,Ys=0,Bo=Wo==="right"?1:Wo==="left"?0:.5,Us=0,va=0,io=mi;va<io.length;va+=1){var qa=io[va];qa.trim();var wa=qa.getMaxScale(),hu=24*(wa-1),tu={positionedGlyphs:[],lineOffset:0};Jn.positionedLines[Us]=tu;var go=tu.positionedGlyphs,hs=0;if(qa.length()){for(var ru=0;ru<qa.length();ru++){var Ta=qa.getSection(ru),Rc=qa.getSectionIndex(ru),ml=qa.getCharCode(ru),Su=0,Yo=null,gl=null,zl=null,Jf=24,Ul=!(Xo===Or.horizontal||!Qo&&!nc(ml)||Qo&&(Lr[ml]||(vf=ml,gn.Arabic(vf)||gn["Arabic Supplement"](vf)||gn["Arabic Extended-A"](vf)||gn["Arabic Presentation Forms-A"](vf)||gn["Arabic Presentation Forms-B"](vf))));if(Ta.imageName){var Qf=Ca[Ta.imageName];if(!Qf)continue;zl=Ta.imageName,Jn.iconsInText=Jn.iconsInText||!0,gl=Qf.paddedRect;var Kc=Qf.displaySize;Ta.scale=24*Ta.scale/ks,Su=hu+(24-Kc[1]*Ta.scale),Jf=(Yo={width:Kc[0],height:Kc[1],left:1,top:-3,advance:Ul?Kc[1]:Kc[0]}).advance;var yh=Ul?Kc[0]*Ta.scale-24*wa:Kc[1]*Ta.scale-24*wa;yh>0&&yh>hs&&(hs=yh)}else{var _p=Vi[Ta.fontStack],_h=_p&&_p[ml];if(_h&&_h.rect)gl=_h.rect,Yo=_h.metrics;else{var Wh=ha[Ta.fontStack],xp=Wh&&Wh[ml];if(!xp)continue;Yo=xp.metrics}Su=24*(wa-Ta.scale)}Ul?(Jn.verticalizable=!0,go.push({glyph:ml,imageName:zl,x:Fs,y:fu+Su,vertical:Ul,scale:Ta.scale,fontStack:Ta.fontStack,sectionIndex:Rc,metrics:Yo,rect:gl}),Fs+=Jf*Ta.scale+Oo):(go.push({glyph:ml,imageName:zl,x:Fs,y:fu+Su,vertical:Ul,scale:Ta.scale,fontStack:Ta.fontStack,sectionIndex:Rc,metrics:Yo,rect:gl}),Fs+=Yo.advance*Ta.scale+Oo)}go.length!==0&&(zs=Math.max(Fs-Oo,zs),Ri(go,0,go.length-1,Bo,hs)),Fs=0;var bp=ba*wa+hs;tu.lineOffset=Math.max(hs,hu),fu+=bp,Ys=Math.max(bp,Ys),++Us}else fu+=ba,++Us}var vf,qf=fu- -17,If=ji(Ao),Of=If.horizontalAlign,mf=If.verticalAlign;(function(gf,Sp,Lf,Rf,yf,xh,eh,Es,Xh){var th,Ha=(Sp-Lf)*yf;th=xh!==eh?-Es*Rf- -17:(-Rf*Xh+.5)*eh;for(var rh=0,$c=gf;rh<$c.length;rh+=1)for(var dc=0,bh=$c[rh].positionedGlyphs;dc<bh.length;dc+=1){var nh=bh[dc];nh.x+=Ha,nh.y+=th}})(Jn.positionedLines,Bo,Of,mf,zs,Ys,ba,qf,mi.length),Jn.top+=-mf*qf,Jn.bottom=Jn.top+qf,Jn.left+=-Of*zs,Jn.right=Jn.left+zs}(Ti,t,r,f,gt,S,M,z,oe,Y,he,$e),!function(Jn){for(var ha=0,Vi=Jn;ha<Vi.length;ha+=1)if(Vi[ha].positionedGlyphs.length!==0)return!1;return!0}(na)&&Ti}tn.fromFeature=function(e,t){for(var r=new tn,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},tn.prototype.length=function(){return this.text.length},tn.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},tn.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},tn.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},tn.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&Ou(f)&&!pf[e[r+1]]||v&&Ou(v)&&!pf[e[r-1]]||!pf[e[r]]?e[r]:pf[e[r]]}return t}(this.text)},tn.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&Lr[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&Lr[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},tn.prototype.substring=function(e,t){var r=new tn;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},tn.prototype.toString=function(){return this.text},tn.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},tn.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(Sn.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},tn.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Sn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):je("Reached maximum number of images 6401")}else je("Can't add FormattedSection with an empty image.")},tn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Lr={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Tr={};function Xn(e,t,r,f,v,g){if(t.imageName){var S=f[t.imageName];return S?S.displaySize[0]*t.scale*24/g+v:0}var M=r[t.fontStack],z=M&&M[e];return z?z.metrics.advance*t.scale+v:0}function _n(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function $r(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function An(e,t,r,f,v,g){for(var S=null,M=_n(t,r,v,g),z=0,Y=f;z<Y.length;z+=1){var J=Y[z],oe=_n(t-J.x,r,v,g)+J.badness;oe<=M&&(S=J,M=oe)}return{index:e,x:t,priorBreak:S,badness:M}}function En(e,t,r,f,v,g,S){if(g!=="point")return[];if(!e)return[];for(var M,z=[],Y=function(gt,nt,Lt,Ht,pr,vr){for(var Br=0,nn=0;nn<gt.length();nn++){var xn=gt.getSection(nn);Br+=Xn(gt.getCharCode(nn),xn,Ht,pr,nt,vr)}return Br/Math.max(1,Math.ceil(Br/Lt))}(e,t,r,f,v,S),J=e.text.indexOf("\u200B")>=0,oe=0,he=0;he<e.length();he++){var Se=e.getSection(he),Ye=e.getCharCode(he);if(Lr[Ye]||(oe+=Xn(Ye,Se,f,v,t,S)),he<e.length()-1){var $e=!((M=Ye)<11904||!(gn["Bopomofo Extended"](M)||gn.Bopomofo(M)||gn["CJK Compatibility Forms"](M)||gn["CJK Compatibility Ideographs"](M)||gn["CJK Compatibility"](M)||gn["CJK Radicals Supplement"](M)||gn["CJK Strokes"](M)||gn["CJK Symbols and Punctuation"](M)||gn["CJK Unified Ideographs Extension A"](M)||gn["CJK Unified Ideographs"](M)||gn["Enclosed CJK Letters and Months"](M)||gn["Halfwidth and Fullwidth Forms"](M)||gn.Hiragana(M)||gn["Ideographic Description Characters"](M)||gn["Kangxi Radicals"](M)||gn["Katakana Phonetic Extensions"](M)||gn.Katakana(M)||gn["Vertical Forms"](M)||gn["Yi Radicals"](M)||gn["Yi Syllables"](M)));(Tr[Ye]||$e||Se.imageName)&&z.push(An(he+1,oe,Y,z,$r(Ye,e.getCharCode(he+1),$e&&J),!1))}}return function gt(nt){return nt?gt(nt.priorBreak).concat(nt.index):[]}(An(e.length(),oe,Y,z,0,!0))}function ji(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Ri(e,t,r,f,v){if(f||v)for(var g=e[r],S=(e[r].x+g.metrics.advance*g.scale)*f,M=t;M<=r;M++)e[M].x-=S,e[M].y+=v}function Pn(e,t,r,f,v,g){var S,M=e.image;if(M.content){var z=M.content,Y=M.pixelRatio||1;S=[z[0]/Y,z[1]/Y,M.displaySize[0]-z[2]/Y,M.displaySize[1]-z[3]/Y]}var J,oe,he,Se,Ye=t.left*g,$e=t.right*g;r==="width"||r==="both"?(Se=v[0]+Ye-f[3],oe=v[0]+$e+f[1]):oe=(Se=v[0]+(Ye+$e-M.displaySize[0])/2)+M.displaySize[0];var gt=t.top*g,nt=t.bottom*g;return r==="height"||r==="both"?(J=v[1]+gt-f[0],he=v[1]+nt+f[2]):he=(J=v[1]+(gt+nt-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:J,right:oe,bottom:he,left:Se,collisionPadding:S}}Tr[10]=!0,Tr[32]=!0,Tr[38]=!0,Tr[40]=!0,Tr[41]=!0,Tr[43]=!0,Tr[45]=!0,Tr[47]=!0,Tr[173]=!0,Tr[183]=!0,Tr[8203]=!0,Tr[8208]=!0,Tr[8211]=!0,Tr[8231]=!0;var Cn=function(e){function t(r,f,v,g){e.call(this,r,f),this.angle=v,g!==void 0&&(this.segment=g)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(G);function Ei(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ta(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,g=0;g<f.length&&f[g]<=e;)g++;for(var S=g=Math.max(0,g-1);S<f.length&&f[S]<e+1;)S++;S=Math.min(f.length-1,S);var M=f[g],z=f[S];return r.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:z,interpolationType:v}:{kind:"camera",minZoom:M,maxZoom:z,minSize:r.evaluate(new ta(M)),maxSize:r.evaluate(new ta(z)),interpolationType:v}}function Di(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?Pa(v/128,r.upperSize/128,t.uSizeT):f}function ra(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,g=v?Je(ye.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=Pa(e.minSize,e.maxSize,g):r=g}return{uSizeT:r,uSize:f}}Nn("Anchor",Cn);var yo=Object.freeze({__proto__:null,getSizeData:Ei,evaluateSizeForFeature:Di,evaluateSizeForZoom:ra,SIZE_PACK_FACTOR:128});function Fo(e,t,r,f,v){if(t.segment===void 0)return!0;for(var g=t,S=t.segment+1,M=0;M>-r/2;){if(--S<0)return!1;M-=e[S].dist(g),g=e[S]}M+=e[S].dist(e[S+1]),S++;for(var z=[],Y=0;M<r/2;){var J=e[S],oe=e[S+1];if(!oe)return!1;var he=e[S-1].angleTo(J)-J.angleTo(oe);for(he=Math.abs((he+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:M,angleDelta:he}),Y+=he;M-z[0].distance>f;)Y-=z.shift().angleDelta;if(Y>v)return!1;S++,M+=J.dist(oe)}return!0}function da(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function bs(e,t,r){return e?.6*t*r:0}function ho(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function $a(e,t,r,f,v,g){for(var S=bs(r,v,g),M=ho(r,f)*g,z=0,Y=da(e)/2,J=0;J<e.length-1;J++){var oe=e[J],he=e[J+1],Se=oe.dist(he);if(z+Se>Y){var Ye=(Y-z)/Se,$e=Pa(oe.x,he.x,Ye),gt=Pa(oe.y,he.y,Ye),nt=new Cn($e,gt,he.angleTo(oe),J);return nt._round(),!S||Fo(e,nt,M,S,t)?nt:void 0}z+=Se}}function Io(e,t,r,f,v,g,S,M,z){var Y=bs(f,g,S),J=ho(f,v),oe=J*S,he=e[0].x===0||e[0].x===z||e[0].y===0||e[0].y===z;return t-oe<t/4&&(t=oe+t/4),function Se(Ye,$e,gt,nt,Lt,Ht,pr,vr,Br){for(var nn=Ht/2,xn=da(Ye),pi=0,kn=$e-gt,si=[],jn=0;jn<Ye.length-1;jn++){for(var na=Ye[jn],Ti=Ye[jn+1],Jn=na.dist(Ti),ha=Ti.angleTo(na);kn+gt<pi+Jn;){var Vi=((kn+=gt)-pi)/Jn,Ca=Pa(na.x,Ti.x,Vi),mi=Pa(na.y,Ti.y,Vi);if(Ca>=0&&Ca<Br&&mi>=0&&mi<Br&&kn-nn>=0&&kn+nn<=xn){var ba=new Cn(Ca,mi,ha,jn);ba._round(),nt&&!Fo(Ye,ba,Ht,nt,Lt)||si.push(ba)}}pi+=Jn}return vr||si.length||pr||(si=Se(Ye,pi/2,gt,nt,Lt,Ht,pr,!0,Br)),si}(e,he?t/2*M%t:(J/2+2*g)*S*M%t,t,Y,r,oe,he,!1,z)}function cs(e,t,r,f,v){for(var g=[],S=0;S<e.length;S++)for(var M=e[S],z=void 0,Y=0;Y<M.length-1;Y++){var J=M[Y],oe=M[Y+1];J.x<t&&oe.x<t||(J.x<t?J=new G(t,J.y+(t-J.x)/(oe.x-J.x)*(oe.y-J.y))._round():oe.x<t&&(oe=new G(t,J.y+(t-J.x)/(oe.x-J.x)*(oe.y-J.y))._round()),J.y<r&&oe.y<r||(J.y<r?J=new G(J.x+(r-J.y)/(oe.y-J.y)*(oe.x-J.x),r)._round():oe.y<r&&(oe=new G(J.x+(r-J.y)/(oe.y-J.y)*(oe.x-J.x),r)._round()),J.x>=f&&oe.x>=f||(J.x>=f?J=new G(f,J.y+(f-J.x)/(oe.x-J.x)*(oe.y-J.y))._round():oe.x>=f&&(oe=new G(f,J.y+(f-J.x)/(oe.x-J.x)*(oe.y-J.y))._round()),J.y>=v&&oe.y>=v||(J.y>=v?J=new G(J.x+(v-J.y)/(oe.y-J.y)*(oe.x-J.x),v)._round():oe.y>=v&&(oe=new G(J.x+(v-J.y)/(oe.y-J.y)*(oe.x-J.x),v)._round()),z&&J.equals(z[z.length-1])||g.push(z=[J]),z.push(oe)))))}return g}function fs(e,t,r,f){var v=[],g=e.image,S=g.pixelRatio,M=g.paddedRect.w-2,z=g.paddedRect.h-2,Y=e.right-e.left,J=e.bottom-e.top,oe=g.stretchX||[[0,M]],he=g.stretchY||[[0,z]],Se=function(Ca,mi){return Ca+mi[1]-mi[0]},Ye=oe.reduce(Se,0),$e=he.reduce(Se,0),gt=M-Ye,nt=z-$e,Lt=0,Ht=Ye,pr=0,vr=$e,Br=0,nn=gt,xn=0,pi=nt;if(g.content&&f){var kn=g.content;Lt=Ss(oe,0,kn[0]),pr=Ss(he,0,kn[1]),Ht=Ss(oe,kn[0],kn[2]),vr=Ss(he,kn[1],kn[3]),Br=kn[0]-Lt,xn=kn[1]-pr,nn=kn[2]-kn[0]-Ht,pi=kn[3]-kn[1]-vr}var si=function(Ca,mi,ba,Ao){var Wo=$i(Ca.stretch-Lt,Ht,Y,e.left),Xo=Jo(Ca.fixed-Br,nn,Ca.stretch,Ye),Oo=$i(mi.stretch-pr,vr,J,e.top),Qo=Jo(mi.fixed-xn,pi,mi.stretch,$e),ks=$i(ba.stretch-Lt,Ht,Y,e.left),Fs=Jo(ba.fixed-Br,nn,ba.stretch,Ye),fu=$i(Ao.stretch-pr,vr,J,e.top),zs=Jo(Ao.fixed-xn,pi,Ao.stretch,$e),Ys=new G(Wo,Oo),Bo=new G(ks,Oo),Us=new G(ks,fu),va=new G(Wo,fu),io=new G(Xo/S,Qo/S),qa=new G(Fs/S,zs/S),wa=t*Math.PI/180;if(wa){var hu=Math.sin(wa),tu=Math.cos(wa),go=[tu,-hu,hu,tu];Ys._matMult(go),Bo._matMult(go),va._matMult(go),Us._matMult(go)}var hs=Ca.stretch+Ca.fixed,ru=mi.stretch+mi.fixed;return{tl:Ys,tr:Bo,bl:va,br:Us,tex:{x:g.paddedRect.x+1+hs,y:g.paddedRect.y+1+ru,w:ba.stretch+ba.fixed-hs,h:Ao.stretch+Ao.fixed-ru},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:io,pixelOffsetBR:qa,minFontScaleX:nn/S/Y,minFontScaleY:pi/S/J,isSDF:r}};if(f&&(g.stretchX||g.stretchY))for(var jn=Go(oe,gt,Ye),na=Go(he,nt,$e),Ti=0;Ti<jn.length-1;Ti++)for(var Jn=jn[Ti],ha=jn[Ti+1],Vi=0;Vi<na.length-1;Vi++)v.push(si(Jn,na[Vi],ha,na[Vi+1]));else v.push(si({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:z+1}));return v}function Ss(e,t,r){for(var f=0,v=0,g=e;v<g.length;v+=1){var S=g[v];f+=Math.max(t,Math.min(r,S[1]))-Math.max(t,Math.min(r,S[0]))}return f}function Go(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,g=e;v<g.length;v+=1){var S=g[v],M=S[0],z=S[1],Y=f[f.length-1];f.push({fixed:M-Y.stretch,stretch:Y.stretch}),f.push({fixed:M-Y.stretch,stretch:Y.stretch+(z-M)})}return f.push({fixed:t+1,stretch:r}),f}function $i(e,t,r,f){return e/t*r+f}function Jo(e,t,r,f){return e-t*r/f}var Ma=function(e,t,r,f,v,g,S,M,z,Y){if(this.boxStartIndex=e.length,z){var J=g.top,oe=g.bottom,he=g.collisionPadding;he&&(J-=he[1],oe+=he[3]);var Se=oe-J;Se>0&&(Se=Math.max(10,Se),this.circleDiameter=Se)}else{var Ye=g.top*S-M,$e=g.bottom*S+M,gt=g.left*S-M,nt=g.right*S+M,Lt=g.collisionPadding;if(Lt&&(gt-=Lt[0]*S,Ye-=Lt[1]*S,nt+=Lt[2]*S,$e+=Lt[3]*S),Y){var Ht=new G(gt,Ye),pr=new G(nt,Ye),vr=new G(gt,$e),Br=new G(nt,$e),nn=Y*Math.PI/180;Ht._rotate(nn),pr._rotate(nn),vr._rotate(nn),Br._rotate(nn),gt=Math.min(Ht.x,pr.x,vr.x,Br.x),nt=Math.max(Ht.x,pr.x,vr.x,Br.x),Ye=Math.min(Ht.y,pr.y,vr.y,Br.y),$e=Math.max(Ht.y,pr.y,vr.y,Br.y)}e.emplaceBack(t.x,t.y,gt,Ye,nt,$e,r,f,v)}this.boxEndIndex=e.length},_o=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=_i),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function _i(e,t){return e<t?-1:e>t?1:0}function pa(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,g=-1/0,S=-1/0,M=e[0],z=0;z<M.length;z++){var Y=M[z];(!z||Y.x<f)&&(f=Y.x),(!z||Y.y<v)&&(v=Y.y),(!z||Y.x>g)&&(g=Y.x),(!z||Y.y>S)&&(S=Y.y)}var J=Math.min(g-f,S-v),oe=J/2,he=new _o([],no);if(J===0)return new G(f,v);for(var Se=f;Se<g;Se+=J)for(var Ye=v;Ye<S;Ye+=J)he.push(new xo(Se+oe,Ye+oe,oe,e));for(var $e=function(Lt){for(var Ht=0,pr=0,vr=0,Br=Lt[0],nn=0,xn=Br.length,pi=xn-1;nn<xn;pi=nn++){var kn=Br[nn],si=Br[pi],jn=kn.x*si.y-si.x*kn.y;pr+=(kn.x+si.x)*jn,vr+=(kn.y+si.y)*jn,Ht+=3*jn}return new xo(pr/Ht,vr/Ht,0,Lt)}(e),gt=he.length;he.length;){var nt=he.pop();(nt.d>$e.d||!$e.d)&&($e=nt,r&&console.log("found best %d after %d probes",Math.round(1e4*nt.d)/1e4,gt)),nt.max-$e.d<=t||(he.push(new xo(nt.p.x-(oe=nt.h/2),nt.p.y-oe,oe,e)),he.push(new xo(nt.p.x+oe,nt.p.y-oe,oe,e)),he.push(new xo(nt.p.x-oe,nt.p.y+oe,oe,e)),he.push(new xo(nt.p.x+oe,nt.p.y+oe,oe,e)),gt+=4)}return r&&(console.log("num probes: "+gt),console.log("best distance: "+$e.d)),$e.p}function no(e,t){return t.max-e.max}function xo(e,t,r,f){this.p=new G(e,t),this.h=r,this.d=function(v,g){for(var S=!1,M=1/0,z=0;z<g.length;z++)for(var Y=g[z],J=0,oe=Y.length,he=oe-1;J<oe;he=J++){var Se=Y[J],Ye=Y[he];Se.y>v.y!=Ye.y>v.y&&v.x<(Ye.x-Se.x)*(v.y-Se.y)/(Ye.y-Se.y)+Se.x&&(S=!S),M=Math.min(M,Na(v,Se,Ye))}return(S?1:-1)*Math.sqrt(M)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}_o.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},_o.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},_o.prototype.peek=function(){return this.data[0]},_o.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,g=t[v];if(r(f,g)>=0)break;t[e]=g,e=v}t[e]=f},_o.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var g=1+(e<<1),S=t[g],M=g+1;if(M<this.length&&r(t[M],S)<0&&(g=M,S=t[M]),r(S,v)>=0)break;t[e]=S,e=g}t[e]=v};var xu=Number.POSITIVE_INFINITY;function He(e,t){return t[1]!==xu?function(r,f,v){var g=0,S=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":S=v-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-v}switch(r){case"top-right":case"bottom-right":case"right":g=-f;break;case"top-left":case"bottom-left":case"left":g=f}return[g,S]}(e,t[0],t[1]):function(r,f){var v=0,g=0;f<0&&(f=0);var S=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":g=S-7;break;case"bottom-right":case"bottom-left":g=7-S;break;case"bottom":g=7-f;break;case"top":g=f-7}switch(r){case"top-right":case"bottom-right":v=-S;break;case"top-left":case"bottom-left":v=S;break;case"left":v=f;break;case"right":v=-f}return[v,g]}(e,t[0])}function nr(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function er(e,t,r,f,v,g,S,M,z,Y,J,oe,he,Se,Ye){var $e=function(pr,vr,Br,nn,xn,pi,kn,si){for(var jn=nn.layout.get("text-rotate").evaluate(pi,{})*Math.PI/180,na=[],Ti=0,Jn=vr.positionedLines;Ti<Jn.length;Ti+=1)for(var ha=Jn[Ti],Vi=0,Ca=ha.positionedGlyphs;Vi<Ca.length;Vi+=1){var mi=Ca[Vi];if(mi.rect){var ba=mi.rect||{},Ao=4,Wo=!0,Xo=1,Oo=0,Qo=(xn||si)&&mi.vertical,ks=mi.metrics.advance*mi.scale/2;if(si&&vr.verticalizable&&(Oo=ha.lineOffset/2-(mi.imageName?-(24-mi.metrics.width*mi.scale)/2:24*(mi.scale-1))),mi.imageName){var Fs=kn[mi.imageName];Wo=Fs.sdf,Ao=1/(Xo=Fs.pixelRatio)}var fu=xn?[mi.x+ks,mi.y]:[0,0],zs=xn?[0,0]:[mi.x+ks+Br[0],mi.y+Br[1]-Oo],Ys=[0,0];Qo&&(Ys=zs,zs=[0,0]);var Bo=(mi.metrics.left-Ao)*mi.scale-ks+zs[0],Us=(-mi.metrics.top-Ao)*mi.scale+zs[1],va=Bo+ba.w*mi.scale/Xo,io=Us+ba.h*mi.scale/Xo,qa=new G(Bo,Us),wa=new G(va,Us),hu=new G(Bo,io),tu=new G(va,io);if(Qo){var go=new G(-ks,ks- -17),hs=-Math.PI/2,ru=12-ks,Ta=new G(22-ru,-(mi.imageName?ru:0)),Rc=new(Function.prototype.bind.apply(G,[null].concat(Ys)));qa._rotateAround(hs,go)._add(Ta)._add(Rc),wa._rotateAround(hs,go)._add(Ta)._add(Rc),hu._rotateAround(hs,go)._add(Ta)._add(Rc),tu._rotateAround(hs,go)._add(Ta)._add(Rc)}if(jn){var ml=Math.sin(jn),Su=Math.cos(jn),Yo=[Su,-ml,ml,Su];qa._matMult(Yo),wa._matMult(Yo),hu._matMult(Yo),tu._matMult(Yo)}var gl=new G(0,0),zl=new G(0,0);na.push({tl:qa,tr:wa,bl:hu,br:tu,tex:ba,writingMode:vr.writingMode,glyphOffset:fu,sectionIndex:mi.sectionIndex,isSDF:Wo,pixelOffsetTL:gl,pixelOffsetBR:zl,minFontScaleX:0,minFontScaleY:0})}}return na}(0,r,M,v,g,S,f,e.allowVerticalPlacement),gt=e.textSizeData,nt=null;gt.kind==="source"?(nt=[128*v.layout.get("text-size").evaluate(S,{})])[0]>32640&&je(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):gt.kind==="composite"&&((nt=[128*Se.compositeTextSizes[0].evaluate(S,{},Ye),128*Se.compositeTextSizes[1].evaluate(S,{},Ye)])[0]>32640||nt[1]>32640)&&je(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,$e,nt,M,g,S,Y,t,z.lineStartIndex,z.lineLength,he,Ye);for(var Lt=0,Ht=J;Lt<Ht.length;Lt+=1)oe[Ht[Lt]]=e.text.placedSymbolArray.length-1;return 4*$e.length}function Un(e){for(var t in e)return e[t];return null}function ua(e,t,r,f){var v=e.compareText;if(t in v){for(var g=v[t],S=g.length-1;S>=0;S--)if(f.dist(g[S])<r)return!0}else v[t]=[];return v[t].push(f),!1}var Be=Ic.VectorTileFeature.types,we=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ut(e,t,r,f,v,g,S,M,z,Y,J,oe,he){var Se=M?Math.min(32640,Math.round(M[0])):0,Ye=M?Math.min(32640,Math.round(M[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),g,S,(Se<<1)+(z?1:0),Ye,16*Y,16*J,256*oe,256*he)}function zt(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function lr(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(ic(r[t].text))return!0;return!1}var yt=function(e){this.layoutVertexArray=new oc,this.indexArray=new Xu,this.programConfigurations=e,this.segments=new Ae,this.dynamicLayoutVertexArray=new Hu,this.opacityVertexArray=new Wu,this.placedSymbolArray=new h};yt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},yt.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,dp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,we,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},yt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Nn("SymbolBuffers",yt);var dt=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new Ae,this.collisionVertexArray=new jc};dt.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Uh.members,!0)},dt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Nn("CollisionBuffers",dt);var it=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(g){return g.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=$o([]),this.placementViewportMatrix=$o([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ei(this.zoom,t["text-size"]),this.iconSizeData=Ei(this.zoom,t["icon-size"]);var r=this.layers[0].layout,f=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(g){return Or[g]})),this.stateDependentLayerIds=this.layers.filter(function(g){return g.isStateDependent()}).map(function(g){return g.id}),this.sourceID=e.sourceID};it.prototype.createArrays=function(){this.text=new yt(new ie(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new yt(new ie(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new P,this.lineVertexArray=new N,this.symbolInstances=new C},it.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var g=0;g<e.length;g++)if(t[e.charCodeAt(g)]=!0,(r||f)&&v){var S=pf[e.charAt(g)];S&&(t[S.charCodeAt(0)]=!0)}},it.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,g=v.get("text-font"),S=v.get("text-field"),M=v.get("icon-image"),z=(S.value.kind!=="constant"||S.value.value instanceof ia&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),Y=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,J=v.get("symbol-sort-key");if(this.features=[],z||Y){for(var oe=t.iconDependencies,he=t.glyphDependencies,Se=t.availableImages,Ye=new ta(this.zoom),$e=0,gt=e;$e<gt.length;$e+=1){var nt=gt[$e],Lt=nt.feature,Ht=nt.id,pr=nt.index,vr=nt.sourceLayerIndex,Br=f._featureFilter.needGeometry,nn=Fr(Lt,Br);if(f._featureFilter.filter(Ye,nn,r)){Br||(nn.geometry=Qt(Lt));var xn=void 0;if(z){var pi=f.getValueAndResolveTokens("text-field",nn,r,Se),kn=ia.factory(pi);lr(kn)&&(this.hasRTLText=!0),(!this.hasRTLText||Cc()==="unavailable"||this.hasRTLText&&Ls.isParsed())&&(xn=vp(kn,f,nn))}var si=void 0;if(Y){var jn=f.getValueAndResolveTokens("icon-image",nn,r,Se);si=jn instanceof Gi?jn:Gi.fromString(jn)}if(xn||si){var na=this.sortFeaturesByKey?J.evaluate(nn,{},r):void 0;if(this.features.push({id:Ht,text:xn,icon:si,index:pr,sourceLayerIndex:vr,geometry:nn.geometry,properties:Lt.properties,type:Be[Lt.type],sortKey:na}),si&&(oe[si.name]=!0),xn){var Ti=g.evaluate(nn,{},r).join(","),Jn=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Or.vertical)>=0;for(var ha=0,Vi=xn.sections;ha<Vi.length;ha+=1){var Ca=Vi[ha];if(Ca.image)oe[Ca.image.name]=!0;else{var mi=rc(xn.toString()),ba=Ca.fontStack||Ti,Ao=he[ba]=he[ba]||{};this.calculateGlyphDependencies(Ca.text,Ao,Jn,this.allowVerticalPlacement,mi)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(Wo){var Xo={},Oo={},Qo=[],ks=0;function Fs(go){Qo.push(Wo[go]),ks++}function fu(go,hs,ru){var Ta=Oo[go];return delete Oo[go],Oo[hs]=Ta,Qo[Ta].geometry[0].pop(),Qo[Ta].geometry[0]=Qo[Ta].geometry[0].concat(ru[0]),Ta}function zs(go,hs,ru){var Ta=Xo[hs];return delete Xo[hs],Xo[go]=Ta,Qo[Ta].geometry[0].shift(),Qo[Ta].geometry[0]=ru[0].concat(Qo[Ta].geometry[0]),Ta}function Ys(go,hs,ru){var Ta=ru?hs[0][hs[0].length-1]:hs[0][0];return go+":"+Ta.x+":"+Ta.y}for(var Bo=0;Bo<Wo.length;Bo++){var Us=Wo[Bo],va=Us.geometry,io=Us.text?Us.text.toString():null;if(io){var qa=Ys(io,va),wa=Ys(io,va,!0);if(qa in Oo&&wa in Xo&&Oo[qa]!==Xo[wa]){var hu=zs(qa,wa,va),tu=fu(qa,wa,Qo[hu].geometry);delete Xo[qa],delete Oo[wa],Oo[Ys(io,Qo[tu].geometry,!0)]=tu,Qo[hu].geometry=null}else qa in Oo?fu(qa,wa,va):wa in Xo?zs(qa,wa,va):(Fs(Bo),Xo[qa]=ks-1,Oo[wa]=ks-1)}else Fs(Bo)}return Qo.filter(function(go){return go.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Wo,Xo){return Wo.sortKey-Xo.sortKey})}},it.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},it.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},it.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},it.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},it.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},it.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},it.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),g={},S=e.segment+1;S<t.length;S++)g[S]={x:t[S].x,y:t[S].y,tileUnitDistanceFromAnchor:f},S<t.length-1&&(f+=t[S+1].dist(t[S]));for(var M=e.segment||0;M>=0;M--)g[M]={x:t[M].x,y:t[M].y,tileUnitDistanceFromAnchor:v},M>0&&(v+=t[M-1].dist(t[M]));for(var z=0;z<t.length;z++){var Y=g[z];this.lineVertexArray.emplaceBack(Y.x,Y.y,Y.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},it.prototype.addSymbols=function(e,t,r,f,v,g,S,M,z,Y,J,oe){for(var he=e.indexArray,Se=e.layoutVertexArray,Ye=e.segments.prepareSegment(4*t.length,Se,he,this.canOverlap?g.sortKey:void 0),$e=this.glyphOffsetArray.length,gt=Ye.vertexLength,nt=this.allowVerticalPlacement&&S===Or.vertical?Math.PI/2:0,Lt=g.text&&g.text.sections,Ht=0;Ht<t.length;Ht++){var pr=t[Ht],vr=pr.tl,Br=pr.tr,nn=pr.bl,xn=pr.br,pi=pr.tex,kn=pr.pixelOffsetTL,si=pr.pixelOffsetBR,jn=pr.minFontScaleX,na=pr.minFontScaleY,Ti=pr.glyphOffset,Jn=pr.isSDF,ha=pr.sectionIndex,Vi=Ye.vertexLength,Ca=Ti[1];ut(Se,M.x,M.y,vr.x,Ca+vr.y,pi.x,pi.y,r,Jn,kn.x,kn.y,jn,na),ut(Se,M.x,M.y,Br.x,Ca+Br.y,pi.x+pi.w,pi.y,r,Jn,si.x,kn.y,jn,na),ut(Se,M.x,M.y,nn.x,Ca+nn.y,pi.x,pi.y+pi.h,r,Jn,kn.x,si.y,jn,na),ut(Se,M.x,M.y,xn.x,Ca+xn.y,pi.x+pi.w,pi.y+pi.h,r,Jn,si.x,si.y,jn,na),zt(e.dynamicLayoutVertexArray,M,nt),he.emplaceBack(Vi,Vi+1,Vi+2),he.emplaceBack(Vi+1,Vi+2,Vi+3),Ye.vertexLength+=4,Ye.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ti[0]),Ht!==t.length-1&&ha===t[Ht+1].sectionIndex||e.programConfigurations.populatePaintArrays(Se.length,g,g.index,{},oe,Lt&&Lt[ha])}e.placedSymbolArray.emplaceBack(M.x,M.y,$e,this.glyphOffsetArray.length-$e,gt,z,Y,M.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],S,0,!1,0,J)},it.prototype._addCollisionDebugVertex=function(e,t,r,f,v,g){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(g.x),Math.round(g.y))},it.prototype.addCollisionDebugVertices=function(e,t,r,f,v,g,S){var M=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),z=M.vertexLength,Y=v.layoutVertexArray,J=v.collisionVertexArray,oe=S.anchorX,he=S.anchorY;this._addCollisionDebugVertex(Y,J,g,oe,he,new G(e,t)),this._addCollisionDebugVertex(Y,J,g,oe,he,new G(r,t)),this._addCollisionDebugVertex(Y,J,g,oe,he,new G(r,f)),this._addCollisionDebugVertex(Y,J,g,oe,he,new G(e,f)),M.vertexLength+=4;var Se=v.indexArray;Se.emplaceBack(z,z+1),Se.emplaceBack(z+1,z+2),Se.emplaceBack(z+2,z+3),Se.emplaceBack(z+3,z),M.primitiveLength+=4},it.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var g=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,f?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,r)}},it.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new dt(Il,Zh.members,uc),this.iconCollisionBox=new dt(Il,Zh.members,uc);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},it.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,g,S,M,z){for(var Y={},J=t;J<r;J++){var oe=e.get(J);Y.textBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},Y.textFeatureIndex=oe.featureIndex;break}for(var he=f;he<v;he++){var Se=e.get(he);Y.verticalTextBox={x1:Se.x1,y1:Se.y1,x2:Se.x2,y2:Se.y2,anchorPointX:Se.anchorPointX,anchorPointY:Se.anchorPointY},Y.verticalTextFeatureIndex=Se.featureIndex;break}for(var Ye=g;Ye<S;Ye++){var $e=e.get(Ye);Y.iconBox={x1:$e.x1,y1:$e.y1,x2:$e.x2,y2:$e.y2,anchorPointX:$e.anchorPointX,anchorPointY:$e.anchorPointY},Y.iconFeatureIndex=$e.featureIndex;break}for(var gt=M;gt<z;gt++){var nt=e.get(gt);Y.verticalIconBox={x1:nt.x1,y1:nt.y1,x2:nt.x2,y2:nt.y2,anchorPointX:nt.anchorPointX,anchorPointY:nt.anchorPointY},Y.verticalIconFeatureIndex=nt.featureIndex;break}return Y},it.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},it.prototype.hasTextData=function(){return this.text.segments.get().length>0},it.prototype.hasIconData=function(){return this.icon.segments.get().length>0},it.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},it.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},it.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},it.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},it.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],g=[],S=0;S<this.symbolInstances.length;++S){g.push(S);var M=this.symbolInstances.get(S);f.push(0|Math.round(t*M.anchorX+r*M.anchorY)),v.push(M.featureIndex)}return g.sort(function(z,Y){return f[z]-f[Y]||v[Y]-v[z]}),g},it.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},it.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(g,S,M){g>=0&&M.indexOf(g)===S&&t.addIndicesForPlacedSymbol(t.text,g)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Nn("SymbolBucket",it,{omit:["layers","collisionBoxArray","features","compareText"]}),it.MAX_GLYPHS=65535,it.addDynamicAttributes=zt;var De=new Zo({"symbol-placement":new ni(ue.layout_symbol["symbol-placement"]),"symbol-spacing":new ni(ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ni(ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $n(ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ni(ue.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ni(ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ni(ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new ni(ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ni(ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new $n(ue.layout_symbol["icon-size"]),"icon-text-fit":new ni(ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ni(ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new $n(ue.layout_symbol["icon-image"]),"icon-rotate":new $n(ue.layout_symbol["icon-rotate"]),"icon-padding":new ni(ue.layout_symbol["icon-padding"]),"icon-keep-upright":new ni(ue.layout_symbol["icon-keep-upright"]),"icon-offset":new $n(ue.layout_symbol["icon-offset"]),"icon-anchor":new $n(ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ni(ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ni(ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ni(ue.layout_symbol["text-rotation-alignment"]),"text-field":new $n(ue.layout_symbol["text-field"]),"text-font":new $n(ue.layout_symbol["text-font"]),"text-size":new $n(ue.layout_symbol["text-size"]),"text-max-width":new $n(ue.layout_symbol["text-max-width"]),"text-line-height":new ni(ue.layout_symbol["text-line-height"]),"text-letter-spacing":new $n(ue.layout_symbol["text-letter-spacing"]),"text-justify":new $n(ue.layout_symbol["text-justify"]),"text-radial-offset":new $n(ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ni(ue.layout_symbol["text-variable-anchor"]),"text-anchor":new $n(ue.layout_symbol["text-anchor"]),"text-max-angle":new ni(ue.layout_symbol["text-max-angle"]),"text-writing-mode":new ni(ue.layout_symbol["text-writing-mode"]),"text-rotate":new $n(ue.layout_symbol["text-rotate"]),"text-padding":new ni(ue.layout_symbol["text-padding"]),"text-keep-upright":new ni(ue.layout_symbol["text-keep-upright"]),"text-transform":new $n(ue.layout_symbol["text-transform"]),"text-offset":new $n(ue.layout_symbol["text-offset"]),"text-allow-overlap":new ni(ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ni(ue.layout_symbol["text-ignore-placement"]),"text-optional":new ni(ue.layout_symbol["text-optional"])}),tt={paint:new Zo({"icon-opacity":new $n(ue.paint_symbol["icon-opacity"]),"icon-color":new $n(ue.paint_symbol["icon-color"]),"icon-halo-color":new $n(ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new $n(ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $n(ue.paint_symbol["icon-halo-blur"]),"icon-translate":new ni(ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new ni(ue.paint_symbol["icon-translate-anchor"]),"text-opacity":new $n(ue.paint_symbol["text-opacity"]),"text-color":new $n(ue.paint_symbol["text-color"],{runtimeType:on,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new $n(ue.paint_symbol["text-halo-color"]),"text-halo-width":new $n(ue.paint_symbol["text-halo-width"]),"text-halo-blur":new $n(ue.paint_symbol["text-halo-blur"]),"text-translate":new ni(ue.paint_symbol["text-translate"]),"text-translate-anchor":new ni(ue.paint_symbol["text-translate-anchor"])}),layout:De},Ne=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Rn,this.defaultValue=e};Ne.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Ne.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Ne.prototype.outputDefined=function(){return!1},Ne.prototype.serialize=function(){return null},Nn("FormatSectionOverride",Ne,{omit:["defaultValue"]});var Zt=function(e){function t(r){e.call(this,r,tt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var g=[],S=0,M=v;S<M.length;S+=1){var z=M[S];g.indexOf(z)<0&&g.push(z)}this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,g){var S=this.layout.get(r).evaluate(f,{},v,g),M=this._unevaluatedLayout._values[r];return M.isDataDriven()||il(M.value)||!S?S:function(z,Y){return Y.replace(/{([^{}]+)}/g,function(J,oe){return oe in z?String(z[oe]):""})}(f.properties,S)},t.prototype.createBucket=function(r){return new it(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=tt.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var g,S=this.paint.get(v),M=new Ne(S),z=new bl(M,S.property.specification);g=S.value.kind==="constant"||S.value.kind==="source"?new al("source",z):new ol("composite",z,S.value.zoomStops,S.value._interpolationType),this.paint._values[v]=new Co(S.property,g,S.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),g=tt.paint.properties[f],S=!1,M=function(J){for(var oe=0,he=J;oe<he.length;oe+=1)if(g.overrides&&g.overrides.hasOverride(he[oe]))return void(S=!0)};if(v.value.kind==="constant"&&v.value.value instanceof ia)M(v.value.value.sections);else if(v.value.kind==="source"){var z=function(J){S||(J instanceof Hi&&Aa(J.value)===ea?M(J.value.sections):J instanceof Lo?M(J.sections):J.eachChild(z))},Y=v.value;Y._styleExpression&&z(Y._styleExpression.expression)}return S},t}(su),Kt={paint:new Zo({"background-color":new ni(ue.paint_background["background-color"]),"background-pattern":new as(ue.paint_background["background-pattern"]),"background-opacity":new ni(ue.paint_background["background-opacity"])})},Vr=function(e){function t(r){e.call(this,r,Kt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(su),cn={paint:new Zo({"raster-opacity":new ni(ue.paint_raster["raster-opacity"]),"raster-hue-rotate":new ni(ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ni(ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ni(ue.paint_raster["raster-brightness-max"]),"raster-saturation":new ni(ue.paint_raster["raster-saturation"]),"raster-contrast":new ni(ue.paint_raster["raster-contrast"]),"raster-resampling":new ni(ue.paint_raster["raster-resampling"]),"raster-fade-duration":new ni(ue.paint_raster["raster-fade-duration"])})},dn=function(e){function t(r){e.call(this,r,cn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(su),In=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(su),fn={circle:Ku,heatmap:of,hillshade:bf,fill:ff,"fill-extrusion":Fh,line:Nh,symbol:Zt,background:Vr,raster:dn},Wn=L.HTMLImageElement,Dn=L.HTMLCanvasElement,Yn=L.HTMLVideoElement,Gn=L.ImageData,Zn=L.ImageBitmap,vi=function(e,t,r,f){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,f)};vi.prototype.update=function(e,t,r){var f=e.width,v=e.height,g=!(this.size&&this.size[0]===f&&this.size[1]===v||r),S=this.context,M=S.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!t||t.premultiply!==!1)),g)this.size=[f,v],e instanceof Wn||e instanceof Dn||e instanceof Yn||e instanceof Gn||Zn&&e instanceof Zn?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,e):M.texImage2D(M.TEXTURE_2D,0,this.format,f,v,0,this.format,M.UNSIGNED_BYTE,e.data);else{var z=r||{x:0,y:0},Y=z.x,J=z.y;e instanceof Wn||e instanceof Dn||e instanceof Yn||e instanceof Gn||Zn&&e instanceof Zn?M.texSubImage2D(M.TEXTURE_2D,0,Y,J,M.RGBA,M.UNSIGNED_BYTE,e):M.texSubImage2D(M.TEXTURE_2D,0,Y,J,f,v,M.RGBA,M.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},vi.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},vi.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},vi.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ja=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Ja.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Ja.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ho=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ir(["receive","process"],this),this.invoker=new Ja(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=$t()?e:L};function Nl(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}Ho.prototype.send=function(e,t,r,f,v){var g=this;v===void 0&&(v=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[S]=r);var M=ke(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:eu(t,M)},M),{cancel:function(){r&&delete g.callbacks[S],g.target.postMessage({id:S,type:"<cancel>",targetMapId:f,sourceMapId:g.mapId})}}},Ho.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else $t()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},Ho.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Ho.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(Ms(t.error)):f(null,Ms(t.data)))}else{var v=!1,g=ke(this.globalScope)?void 0:[],S=t.hasCallback?function(J,oe){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:J?eu(J):null,data:eu(oe,g)},g)}:function(J){v=!0},M=null,z=Ms(t.data);if(this.parent[t.type])M=this.parent[t.type](t.sourceMapId,z,S);else if(this.parent.getWorkerSource){var Y=t.type.split(".");M=this.parent.getWorkerSource(t.sourceMapId,Y[0],z.source)[Y[1]](z,S)}else S(new Error("Could not find function "+t.type));!v&&M&&M.cancel&&(this.cancelCallbacks[e]=M.cancel)}},Ho.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Qa=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Qa.prototype.setNorthEast=function(e){return this._ne=e instanceof Ra?new Ra(e.lng,e.lat):Ra.convert(e),this},Qa.prototype.setSouthWest=function(e){return this._sw=e instanceof Ra?new Ra(e.lng,e.lat):Ra.convert(e),this},Qa.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof Ra)t=e,r=e;else{if(!(e instanceof Qa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Qa.convert(e)):this.extend(Ra.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new Ra(t.lng,t.lat),this._ne=new Ra(r.lng,r.lat)),this},Qa.prototype.getCenter=function(){return new Ra((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Qa.prototype.getSouthWest=function(){return this._sw},Qa.prototype.getNorthEast=function(){return this._ne},Qa.prototype.getNorthWest=function(){return new Ra(this.getWest(),this.getNorth())},Qa.prototype.getSouthEast=function(){return new Ra(this.getEast(),this.getSouth())},Qa.prototype.getWest=function(){return this._sw.lng},Qa.prototype.getSouth=function(){return this._sw.lat},Qa.prototype.getEast=function(){return this._ne.lng},Qa.prototype.getNorth=function(){return this._ne.lat},Qa.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Qa.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Qa.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Qa.prototype.contains=function(e){var t=Ra.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},Qa.convert=function(e){return!e||e instanceof Qa?e:new Qa(e)};var Ra=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ra.prototype.wrap=function(){return new Ra(Dt(this.lng,-180,180),this.lat)},Ra.prototype.toArray=function(){return[this.lng,this.lat]},Ra.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ra.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},Ra.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new Qa(new Ra(this.lng-r,this.lat-t),new Ra(this.lng+r,this.lat+t))},Ra.convert=function(e){if(e instanceof Ra)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ra(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ra(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Ns=2*Math.PI*63710088e-1;function qu(e){return Ns*Math.cos(e*Math.PI/180)}function bu(e){return(180+e)/360}function Kf(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ku(e,t){return e/qu(t)}function $f(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Oc=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Oc.fromLngLat=function(e,t){t===void 0&&(t=0);var r=Ra.convert(e);return new Oc(bu(r.lng),Kf(r.lat),ku(t,r.lat))},Oc.prototype.toLngLat=function(){return new Ra(360*this.x-180,$f(this.y))},Oc.prototype.toAltitude=function(){return this.z*qu($f(this.y))},Oc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Ns*(e=$f(this.y),1/Math.cos(e*Math.PI/180));var e};var Xc=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=gh(0,e,e,t,r)};Xc.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Xc.prototype.url=function(e,t){var r,f,v,g,S,M=(f=this.y,v=this.z,g=Nl(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),S=Nl(256*(r+1),256*(f+1),v),g[0]+","+g[1]+","+S[0]+","+S[1]),z=function(Y,J,oe){for(var he,Se="",Ye=Y;Ye>0;Ye--)Se+=(J&(he=1<<Ye-1)?1:0)+(oe&he?2:0);return Se}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",z).replace("{bbox-epsg-3857}",M)},Xc.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new G(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Xc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var mp=function(e,t){this.wrap=e,this.canonical=t,this.key=gh(e,t.z,t.z,t.x,t.y)},gs=function(e,t,r,f,v){this.overscaledZ=e,this.wrap=t,this.canonical=new Xc(r,+f,+v),this.key=gh(t,e,r,f,v)};function gh(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var g=1<<r;return(g*g*e+g*v+f).toString(36)+r.toString(36)+t.toString(36)}gs.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},gs.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new gs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gs(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},gs.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?gh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):gh(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},gs.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},gs.prototype.children=function(e){if(this.overscaledZ>=e)return[new gs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new gs(t,this.wrap,t,r,f),new gs(t,this.wrap,t,r+1,f),new gs(t,this.wrap,t,r,f+1),new gs(t,this.wrap,t,r+1,f+1)]},gs.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},gs.prototype.wrapped=function(){return new gs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},gs.prototype.unwrapTo=function(e){return new gs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},gs.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},gs.prototype.toUnwrapped=function(){return new mp(this.wrap,this.canonical)},gs.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},gs.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Oc(e.x-this.wrap,e.y))},Nn("CanonicalTileID",Xc),Nn("OverscaledTileID",gs,{omit:["posMatrix"]});var Yc=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return je('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<f;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(f,v)]=this.data[this._idx(f-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,f)]=this.data[this._idx(v,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};Yc.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},Yc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Yc.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Yc.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},Yc.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},Yc.prototype.getPixels=function(){return new Mo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Yc.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,g=r*this.dim,S=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:g=S-1;break;case 1:S=g+1}for(var M=-t*this.dim,z=-r*this.dim,Y=g;Y<S;Y++)for(var J=f;J<v;J++)this.data[this._idx(J,Y)]=e.data[this._idx(J+M,Y+z)]},Nn("DEMData",Yc);var Gh=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};Gh.prototype.encode=function(e){return this._stringToNumber[e]},Gh.prototype.decode=function(e){return this._numberToString[e]};var Pf=function(e,t,r,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=f,this.properties=e.properties,this.id=v},Hh={geometry:{configurable:!0}};Hh.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Hh.geometry.set=function(e){this._geometry=e},Pf.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Pf.prototype,Hh);var Mf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Mf.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},It(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var g in this.deletedStates[e][f]={},this.state[e][f])r[g]||(this.deletedStates[e][f][g]=null);else for(var S in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][S]===null&&delete this.deletedStates[e][f][S]},Mf.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},Mf.prototype.getState=function(e,t){var r=String(t),f=It({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var g in v)delete f[g]}return f},Mf.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},Mf.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var g in this.stateChanges[f])this.state[f][g]||(this.state[f][g]={}),It(this.state[f][g],this.stateChanges[f][g]),v[g]=this.state[f][g];r[f]=v}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var M={};if(this.deletedStates[S]===null)for(var z in this.state[S])M[z]={},this.state[S][z]={};else for(var Y in this.deletedStates[S]){if(this.deletedStates[S][Y]===null)this.state[S][Y]={};else for(var J=0,oe=Object.keys(this.deletedStates[S][Y]);J<oe.length;J+=1)delete this.state[S][Y][oe[J]];M[Y]=this.state[S][Y]}r[S]=r[S]||{},It(r[S],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var he in e)e[he].setFeatureState(r,t)};var Lc=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Iu(8192,16,0),this.grid3D=new Iu(8192,16,0),this.featureIndexArray=new se,this.promoteId=t};function gp(e,t,r,f,v){return cr(e,function(g,S){var M=t instanceof Gu?t.get(S):null;return M&&M.evaluate?M.evaluate(r,f,v):M})}function yp(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,g=0,S=e;g<S.length;g+=1){var M=S[g];t=Math.min(t,M.x),r=Math.min(r,M.y),f=Math.max(f,M.x),v=Math.max(v,M.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function Ed(e,t){return t-e}Lc.prototype.insert=function(e,t,r,f,v,g){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var M=g?this.grid3D:this.grid,z=0;z<t.length;z++){for(var Y=t[z],J=[1/0,1/0,-1/0,-1/0],oe=0;oe<Y.length;oe++){var he=Y[oe];J[0]=Math.min(J[0],he.x),J[1]=Math.min(J[1],he.y),J[2]=Math.max(J[2],he.x),J[3]=Math.max(J[3],he.y)}J[0]<8192&&J[1]<8192&&J[2]>=0&&J[3]>=0&&M.insert(S,J[0],J[1],J[2],J[3])}},Lc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Ic.VectorTile(new Af(this.rawTileData)).layers,this.sourceLayerCoder=new Gh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Lc.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var g=e.params||{},S=8192/e.tileSize/e.scale,M=$l(g.filter),z=e.queryGeometry,Y=e.queryPadding*S,J=yp(z),oe=this.grid.query(J.minX-Y,J.minY-Y,J.maxX+Y,J.maxY+Y),he=yp(e.cameraQueryGeometry),Se=this.grid3D.query(he.minX-Y,he.minY-Y,he.maxX+Y,he.maxY+Y,function(pr,vr,Br,nn){return function(xn,pi,kn,si,jn){for(var na=0,Ti=xn;na<Ti.length;na+=1){var Jn=Ti[na];if(pi<=Jn.x&&kn<=Jn.y&&si>=Jn.x&&jn>=Jn.y)return!0}var ha=[new G(pi,kn),new G(pi,jn),new G(si,jn),new G(si,kn)];if(xn.length>2){for(var Vi=0,Ca=ha;Vi<Ca.length;Vi+=1)if(La(xn,Ca[Vi]))return!0}for(var mi=0;mi<xn.length-1;mi++)if(Ea(xn[mi],xn[mi+1],ha))return!0;return!1}(e.cameraQueryGeometry,pr-Y,vr-Y,Br+Y,nn+Y)}),Ye=0,$e=Se;Ye<$e.length;Ye+=1)oe.push($e[Ye]);oe.sort(Ed);for(var gt,nt={},Lt=function(pr){var vr=oe[pr];if(vr!==gt){gt=vr;var Br=v.featureIndexArray.get(vr),nn=null;v.loadMatchingFeature(nt,Br.bucketIndex,Br.sourceLayerIndex,Br.featureIndex,M,g.layers,g.availableImages,t,r,f,function(xn,pi,kn){return nn||(nn=Qt(xn)),pi.queryIntersectsFeature(z,xn,kn,nn,v.z,e.transform,S,e.pixelPosMatrix)})}},Ht=0;Ht<oe.length;Ht++)Lt(Ht);return nt},Lc.prototype.loadMatchingFeature=function(e,t,r,f,v,g,S,M,z,Y,J){var oe=this.bucketLayerIDs[t];if(!g||function(xn,pi){for(var kn=0;kn<xn.length;kn++)if(pi.indexOf(xn[kn])>=0)return!0;return!1}(g,oe)){var he=this.sourceLayerCoder.decode(r),Se=this.vtLayers[he].feature(f);if(v.needGeometry){var Ye=Fr(Se,!0);if(!v.filter(new ta(this.tileID.overscaledZ),Ye,this.tileID.canonical))return}else if(!v.filter(new ta(this.tileID.overscaledZ),Se))return;for(var $e=this.getId(Se,he),gt=0;gt<oe.length;gt++){var nt=oe[gt];if(!(g&&g.indexOf(nt)<0)){var Lt=M[nt];if(Lt){var Ht={};$e!==void 0&&Y&&(Ht=Y.getState(Lt.sourceLayer||"_geojsonTileLayer",$e));var pr=It({},z[nt]);pr.paint=gp(pr.paint,Lt.paint,Se,Ht,S),pr.layout=gp(pr.layout,Lt.layout,Se,Ht,S);var vr=!J||J(Se,Lt,Ht);if(vr){var Br=new Pf(Se,this.z,this.x,this.y,$e);Br.layer=pr;var nn=e[nt];nn===void 0&&(nn=e[nt]=[]),nn.push({featureIndex:f,feature:Br,intersectionZ:vr})}}}}}},Lc.prototype.lookupSymbolFeatures=function(e,t,r,f,v,g,S,M){var z={};this.loadVTLayers();for(var Y=$l(v),J=0,oe=e;J<oe.length;J+=1)this.loadMatchingFeature(z,r,f,oe[J],Y,g,S,M,t);return z},Lc.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},Lc.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Nn("FeatureIndex",Lc,{omit:["rawTileData","sourceLayerCoder"]});var Ds=function(e,t){this.tileID=e,this.uid=xt(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Ds.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<Ni.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},Ds.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Ds.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(Y,J){var oe={};if(!J)return oe;for(var he=function(){var $e=Ye[Se],gt=$e.layerIds.map(function(Ht){return J.getLayer(Ht)}).filter(Boolean);if(gt.length!==0){$e.layers=gt,$e.stateDependentLayerIds&&($e.stateDependentLayers=$e.stateDependentLayerIds.map(function(Ht){return gt.filter(function(pr){return pr.id===Ht})[0]}));for(var nt=0,Lt=gt;nt<Lt.length;nt+=1)oe[Lt[nt].id]=$e}},Se=0,Ye=Y;Se<Ye.length;Se+=1)he();return oe}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof it){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var g in this.buckets){var S=this.buckets[g];if(S instanceof it&&S.hasRTLText){this.hasRTLText=!0,Ls.isLoading()||Ls.isLoaded()||Cc()!=="deferred"||Gs();break}}for(var M in this.queryPadding=0,this.buckets){var z=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(M).queryRadius(z))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},Ds.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Ds.prototype.getBucket=function(e){return this.buckets[e.id]},Ds.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vi(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vi(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},Ds.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},Ds.prototype.queryRenderedFeatures=function(e,t,r,f,v,g,S,M,z,Y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:g,tileSize:this.tileSize,pixelPosMatrix:Y,transform:M,params:S,queryPadding:this.queryPadding*z},e,t,r):{}},Ds.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",g=f._geojsonTileLayer||f[v];if(g)for(var S=$l(t&&t.filter),M=this.tileID.canonical,z=M.z,Y=M.x,J=M.y,oe={z,x:Y,y:J},he=0;he<g.length;he++){var Se=g.feature(he);if(S.needGeometry){var Ye=Fr(Se,!0);if(!S.filter(new ta(this.tileID.overscaledZ),Ye,this.tileID.canonical))continue}else if(!S.filter(new ta(this.tileID.overscaledZ),Se))continue;var $e=r.getId(Se,v),gt=new Pf(Se,z,Y,J,$e);gt.tile=oe,e.push(gt)}}},Ds.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Ds.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Ds.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=zr(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var g=this.expirationTime-t;g?this.expirationTime=f+Math.max(g,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Ds.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Ds.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],g=v.layers[0].sourceLayer||"_geojsonTileLayer",S=r[g],M=e[g];if(S&&M&&Object.keys(M).length!==0){v.update(M,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var z=t&&t.style&&t.style.getLayer(f);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(v)))}}}},Ds.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Ds.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ni.now()},Ds.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Ds.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=Ni.now()+e},Ds.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},Ds.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var g=0,S=t;g<S.length;g+=1)if(v[S[g]])return!0}}return!1};var df=L.performance,Vp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},df.mark(this._marks.start)};Vp.prototype.finish=function(){df.mark(this._marks.end);var e=df.getEntriesByName(this._marks.measure);return e.length===0&&(df.measure(this._marks.measure,this._marks.start,this._marks.end),e=df.getEntriesByName(this._marks.measure),df.clearMarks(this._marks.start),df.clearMarks(this._marks.end),df.clearMeasures(this._marks.measure)),e},p.Actor=Ho,p.AlphaImage=_u,p.CanonicalTileID=Xc,p.CollisionBoxArray=u,p.Color=wi,p.DEMData=Yc,p.DataConstantProperty=ni,p.DictionaryCoder=Gh,p.EXTENT=8192,p.ErrorEvent=de,p.EvaluationParameters=ta,p.Event=ae,p.Evented=Pe,p.FeatureIndex=Lc,p.FillBucket=lu,p.FillExtrusionBucket=Qu,p.ImageAtlas=Ln,p.ImagePosition=_r,p.LineBucket=Vo,p.LngLat=Ra,p.LngLatBounds=Qa,p.MercatorCoordinate=Oc,p.ONE_EM=24,p.OverscaledTileID=gs,p.Point=G,p.Point$1=G,p.Properties=Zo,p.Protobuf=Af,p.RGBAImage=Mo,p.RequestManager=rr,p.RequestPerformance=Vp,p.ResourceType=Mr,p.SegmentVector=Ae,p.SourceFeatureState=Mf,p.StructArrayLayout1ui2=lc,p.StructArrayLayout2f1f2i16=hl,p.StructArrayLayout2i4=xs,p.StructArrayLayout3ui6=Xu,p.StructArrayLayout4i8=Ml,p.SymbolBucket=it,p.Texture=vi,p.Tile=Ds,p.Transitionable=Uo,p.Uniform1f=sn,p.Uniform1i=Gr,p.Uniform2f=qr,p.Uniform3f=Mn,p.Uniform4f=ei,p.UniformColor=fi,p.UniformMatrix4f=sa,p.UnwrappedTileID=mp,p.ValidationError=Ee,p.WritingMode=Or,p.ZoomHistory=Sc,p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},p.addDynamicAttributes=zt,p.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),g=null;e.forEach(function(S,M){t(S,function(z,Y){z&&(g=z),v[M]=Y,--f==0&&r(g,v)})})},p.bezier=be,p.bindAll=ir,p.browser=Ni,p.cacheEntryPossiblyAdded=function(e){++Xt>wt&&(e.getActor().send("enforceCacheSizeLimit",rt),Xt=0)},p.clamp=Je,p.clearTileCache=function(e){var t=L.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=cs,p.clone=function(e){var t=new Zi(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=Qe,p.clone$2=function(e){var t=new Zi(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=jh,p.config=or,p.create=function(){var e=new Zi(16);return Zi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new Zi(9);return Zi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new Zi(4);return Zi!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=E,p.createExpression=Sl,p.createLayout=Do,p.createStyleLayer=function(e){return e.type==="custom"?new In(e):new fn[e.type](e)},p.cross=function(e,t,r){var f=t[0],v=t[1],g=t[2],S=r[0],M=r[1],z=r[2];return e[0]=v*z-g*M,e[1]=g*S-f*z,e[2]=f*M-v*S,e},p.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=Le,p.emitValidationErrors=wl,p.endsWith=re,p.enforceCacheSizeLimit=function(e){Ot(),ot&&ot.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},p.evaluateSizeForFeature=Di,p.evaluateSizeForZoom=ra,p.evaluateVariableOffset=He,p.evented=Ec,p.extend=It,p.featureFilter=$l,p.filterObject=Ct,p.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=ji,p.getAnchorJustification=nr,p.getArrayBuffer=Ai,p.getImage=le,p.getJSON=function(e,t){return Qi(It(e,{type:"json"}),t)},p.getRTLTextPluginStatus=Cc,p.getReferrer=an,p.getVideo=function(e,t){var r,f,v=L.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var g=0;g<e.length;g++){var S=L.document.createElement("source");r=e[g],f=void 0,(f=L.document.createElement("a")).href=r,(f.protocol!==L.document.location.protocol||f.host!==L.document.location.host)&&(v.crossOrigin="Anonymous"),S.src=e[g],v.appendChild(S)}return{cancel:function(){}}},p.identity=$o,p.invert=function(e,t){var r=t[0],f=t[1],v=t[2],g=t[3],S=t[4],M=t[5],z=t[6],Y=t[7],J=t[8],oe=t[9],he=t[10],Se=t[11],Ye=t[12],$e=t[13],gt=t[14],nt=t[15],Lt=r*M-f*S,Ht=r*z-v*S,pr=r*Y-g*S,vr=f*z-v*M,Br=f*Y-g*M,nn=v*Y-g*z,xn=J*$e-oe*Ye,pi=J*gt-he*Ye,kn=J*nt-Se*Ye,si=oe*gt-he*$e,jn=oe*nt-Se*$e,na=he*nt-Se*gt,Ti=Lt*na-Ht*jn+pr*si+vr*kn-Br*pi+nn*xn;return Ti?(e[0]=(M*na-z*jn+Y*si)*(Ti=1/Ti),e[1]=(v*jn-f*na-g*si)*Ti,e[2]=($e*nn-gt*Br+nt*vr)*Ti,e[3]=(he*Br-oe*nn-Se*vr)*Ti,e[4]=(z*kn-S*na-Y*pi)*Ti,e[5]=(r*na-v*kn+g*pi)*Ti,e[6]=(gt*pr-Ye*nn-nt*Ht)*Ti,e[7]=(J*nn-he*pr+Se*Ht)*Ti,e[8]=(S*jn-M*kn+Y*xn)*Ti,e[9]=(f*kn-r*jn-g*xn)*Ti,e[10]=(Ye*Br-$e*pr+nt*Lt)*Ti,e[11]=(oe*pr-J*Br-Se*Lt)*Ti,e[12]=(M*pi-S*si-z*xn)*Ti,e[13]=(r*si-f*pi+v*xn)*Ti,e[14]=($e*Ht-Ye*vr-gt*Lt)*Ti,e[15]=(J*vr-oe*Ht+he*Lt)*Ti,e):null},p.isChar=gn,p.isMapboxURL=yr,p.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},p.makeRequest=Qi,p.mapObject=cr,p.mercatorXfromLng=bu,p.mercatorYfromLat=Kf,p.mercatorZfromAltitude=ku,p.mul=Ac,p.multiply=Po,p.mvt=Ic,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],g=r*r+f*f+v*v;return g>0&&(g=1/Math.sqrt(g)),e[0]=t[0]*g,e[1]=t[1]*g,e[2]=t[2]*g,e},p.number=Pa,p.offscreenCanvasSupported=kr,p.ortho=function(e,t,r,f,v,g,S){var M=1/(t-r),z=1/(f-v),Y=1/(g-S);return e[0]=-2*M,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*z,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*Y,e[11]=0,e[12]=(t+r)*M,e[13]=(v+f)*z,e[14]=(S+g)*Y,e[15]=1,e},p.parseGlyphPBF=function(e){return new Af(e).readFields(yn,[])},p.pbf=Af,p.performSymbolLayout=function(e,t,r,f,v,g,S){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var M=e.layers[0].layout,z=e.layers[0]._unevaluatedLayout._values,Y={};if(e.textSizeData.kind==="composite"){var J=e.textSizeData,oe=J.maxZoom;Y.compositeTextSizes=[z["text-size"].possiblyEvaluate(new ta(J.minZoom),S),z["text-size"].possiblyEvaluate(new ta(oe),S)]}if(e.iconSizeData.kind==="composite"){var he=e.iconSizeData,Se=he.maxZoom;Y.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new ta(he.minZoom),S),z["icon-size"].possiblyEvaluate(new ta(Se),S)]}Y.layoutTextSize=z["text-size"].possiblyEvaluate(new ta(e.zoom+1),S),Y.layoutIconSize=z["icon-size"].possiblyEvaluate(new ta(e.zoom+1),S),Y.textMaxSize=z["text-size"].possiblyEvaluate(new ta(18));for(var Ye=24*M.get("text-line-height"),$e=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",gt=M.get("text-keep-upright"),nt=M.get("text-size"),Lt=function(){var vr=pr[Ht],Br=M.get("text-font").evaluate(vr,{},S).join(","),nn=nt.evaluate(vr,{},S),xn=Y.layoutTextSize.evaluate(vr,{},S),pi=Y.layoutIconSize.evaluate(vr,{},S),kn={horizontal:{},vertical:void 0},si=vr.text,jn=[0,0];if(si){var na=si.toString(),Ti=24*M.get("text-letter-spacing").evaluate(vr,{},S),Jn=function(va){for(var io=0,qa=va;io<qa.length;io+=1)if(wa=qa[io].charCodeAt(0),gn.Arabic(wa)||gn["Arabic Supplement"](wa)||gn["Arabic Extended-A"](wa)||gn["Arabic Presentation Forms-A"](wa)||gn["Arabic Presentation Forms-B"](wa))return!1;var wa;return!0}(na)?Ti:0,ha=M.get("text-anchor").evaluate(vr,{},S),Vi=M.get("text-variable-anchor");if(!Vi){var Ca=M.get("text-radial-offset").evaluate(vr,{},S);jn=Ca?He(ha,[24*Ca,xu]):M.get("text-offset").evaluate(vr,{},S).map(function(va){return 24*va})}var mi=$e?"center":M.get("text-justify").evaluate(vr,{},S),ba=M.get("symbol-placement"),Ao=ba==="point"?24*M.get("text-max-width").evaluate(vr,{},S):0,Wo=function(){e.allowVerticalPlacement&&rc(na)&&(kn.vertical=li(si,t,r,v,Br,Ao,Ye,ha,"left",Jn,jn,Or.vertical,!0,ba,xn,nn))};if(!$e&&Vi){for(var Xo=mi==="auto"?Vi.map(function(va){return nr(va)}):[mi],Oo=!1,Qo=0;Qo<Xo.length;Qo++){var ks=Xo[Qo];if(!kn.horizontal[ks])if(Oo)kn.horizontal[ks]=kn.horizontal[0];else{var Fs=li(si,t,r,v,Br,Ao,Ye,"center",ks,Jn,jn,Or.horizontal,!1,ba,xn,nn);Fs&&(kn.horizontal[ks]=Fs,Oo=Fs.positionedLines.length===1)}}Wo()}else{mi==="auto"&&(mi=nr(ha));var fu=li(si,t,r,v,Br,Ao,Ye,ha,mi,Jn,jn,Or.horizontal,!1,ba,xn,nn);fu&&(kn.horizontal[mi]=fu),Wo(),rc(na)&&$e&&gt&&(kn.vertical=li(si,t,r,v,Br,Ao,Ye,ha,mi,Jn,jn,Or.vertical,!1,ba,xn,nn))}}var zs=void 0,Ys=!1;if(vr.icon&&vr.icon.name){var Bo=f[vr.icon.name];Bo&&(zs=function(va,io,qa){var wa=ji(qa),hu=io[0]-va.displaySize[0]*wa.horizontalAlign,tu=io[1]-va.displaySize[1]*wa.verticalAlign;return{image:va,top:tu,bottom:tu+va.displaySize[1],left:hu,right:hu+va.displaySize[0]}}(v[vr.icon.name],M.get("icon-offset").evaluate(vr,{},S),M.get("icon-anchor").evaluate(vr,{},S)),Ys=Bo.sdf,e.sdfIcons===void 0?e.sdfIcons=Bo.sdf:e.sdfIcons!==Bo.sdf&&je("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Bo.pixelRatio!==e.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Us=Un(kn.horizontal)||kn.vertical;e.iconsInText=!!Us&&Us.iconsInText,(Us||zs)&&function(va,io,qa,wa,hu,tu,go,hs,ru,Ta,Rc){var ml=tu.textMaxSize.evaluate(io,{});ml===void 0&&(ml=go);var Su,Yo=va.layers[0].layout,gl=Yo.get("icon-offset").evaluate(io,{},Rc),zl=Un(qa.horizontal),Jf=go/24,Ul=va.tilePixelRatio*Jf,Qf=va.tilePixelRatio*ml/24,Kc=va.tilePixelRatio*hs,yh=va.tilePixelRatio*Yo.get("symbol-spacing"),_p=Yo.get("text-padding")*va.tilePixelRatio,_h=Yo.get("icon-padding")*va.tilePixelRatio,Wh=Yo.get("text-max-angle")/180*Math.PI,xp=Yo.get("text-rotation-alignment")==="map"&&Yo.get("symbol-placement")!=="point",bp=Yo.get("icon-rotation-alignment")==="map"&&Yo.get("symbol-placement")!=="point",vf=Yo.get("symbol-placement"),qf=yh/2,If=Yo.get("icon-text-fit");wa&&If!=="none"&&(va.allowVerticalPlacement&&qa.vertical&&(Su=Pn(wa,qa.vertical,If,Yo.get("icon-text-fit-padding"),gl,Jf)),zl&&(wa=Pn(wa,zl,If,Yo.get("icon-text-fit-padding"),gl,Jf)));var Of=function(Cd,Sh){Sh.x<0||Sh.x>=8192||Sh.y<0||Sh.y>=8192||function(qo,Zl,wd,Jc,Tp,Hp,Kh,Dc,$h,Eh,Jh,Ch,Ap,Wp,wh,Pp,Xp,Yp,Kp,$p,el,Qh,Mp,kc,Td){var Jp,Df,ih,ah,oh,sh=qo.addToLineVertexArray(Zl,wd),Ip=0,Qp=0,qp=0,ed=0,qh=-1,Op=-1,Qc={},td=Ze(""),Lp=0,Rp=0;if(Dc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Lp=(Jp=Dc.layout.get("text-offset").evaluate(el,{},kc).map(function(qc){return 24*qc}))[0],Rp=Jp[1]):(Lp=24*Dc.layout.get("text-radial-offset").evaluate(el,{},kc),Rp=xu),qo.allowVerticalPlacement&&Jc.vertical){var rd=Dc.layout.get("text-rotate").evaluate(el,{},kc)+90;ah=new Ma($h,Zl,Eh,Jh,Ch,Jc.vertical,Ap,Wp,wh,rd),Kh&&(oh=new Ma($h,Zl,Eh,Jh,Ch,Kh,Xp,Yp,wh,rd))}if(Tp){var ep=Dc.layout.get("icon-rotate").evaluate(el,{}),nd=Dc.layout.get("icon-text-fit")!=="none",id=fs(Tp,ep,Mp,nd),Dp=Kh?fs(Kh,ep,Mp,nd):void 0;ih=new Ma($h,Zl,Eh,Jh,Ch,Tp,Xp,Yp,!1,ep),Ip=4*id.length;var ad=qo.iconSizeData,Th=null;ad.kind==="source"?(Th=[128*Dc.layout.get("icon-size").evaluate(el,{})])[0]>32640&&je(qo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):ad.kind==="composite"&&((Th=[128*Qh.compositeIconSizes[0].evaluate(el,{},kc),128*Qh.compositeIconSizes[1].evaluate(el,{},kc)])[0]>32640||Th[1]>32640)&&je(qo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),qo.addSymbols(qo.icon,id,Th,$p,Kp,el,!1,Zl,sh.lineStartIndex,sh.lineLength,-1,kc),qh=qo.icon.placedSymbolArray.length-1,Dp&&(Qp=4*Dp.length,qo.addSymbols(qo.icon,Dp,Th,$p,Kp,el,Or.vertical,Zl,sh.lineStartIndex,sh.lineLength,-1,kc),Op=qo.icon.placedSymbolArray.length-1)}for(var od in Jc.horizontal){var tp=Jc.horizontal[od];if(!Df){td=Ze(tp.text);var Ad=Dc.layout.get("text-rotate").evaluate(el,{},kc);Df=new Ma($h,Zl,Eh,Jh,Ch,tp,Ap,Wp,wh,Ad)}var kp=tp.positionedLines.length===1;if(qp+=er(qo,Zl,tp,Hp,Dc,wh,el,Pp,sh,Jc.vertical?Or.horizontal:Or.horizontalOnly,kp?Object.keys(Jc.horizontal):[od],Qc,qh,Qh,kc),kp)break}Jc.vertical&&(ed+=er(qo,Zl,Jc.vertical,Hp,Dc,wh,el,Pp,sh,Or.vertical,["vertical"],Qc,Op,Qh,kc));var sd=Df?Df.boxStartIndex:qo.collisionBoxArray.length,ud=Df?Df.boxEndIndex:qo.collisionBoxArray.length,uh=ah?ah.boxStartIndex:qo.collisionBoxArray.length,ld=ah?ah.boxEndIndex:qo.collisionBoxArray.length,Pd=ih?ih.boxStartIndex:qo.collisionBoxArray.length,Md=ih?ih.boxEndIndex:qo.collisionBoxArray.length,Id=oh?oh.boxStartIndex:qo.collisionBoxArray.length,Od=oh?oh.boxEndIndex:qo.collisionBoxArray.length,tl=-1,_f=function(qc,cd){return qc&&qc.circleDiameter?Math.max(qc.circleDiameter,cd):cd};tl=_f(Df,tl),tl=_f(ah,tl),tl=_f(ih,tl);var lh=(tl=_f(oh,tl))>-1?1:0;lh&&(tl*=Td/24),qo.glyphOffsetArray.length>=it.MAX_GLYPHS&&je("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),el.sortKey!==void 0&&qo.addToSortKeyRanges(qo.symbolInstances.length,el.sortKey),qo.symbolInstances.emplaceBack(Zl.x,Zl.y,Qc.right>=0?Qc.right:-1,Qc.center>=0?Qc.center:-1,Qc.left>=0?Qc.left:-1,Qc.vertical||-1,qh,Op,td,sd,ud,uh,ld,Pd,Md,Id,Od,Eh,qp,ed,Ip,Qp,lh,0,Ap,Lp,Rp,tl)}(va,Sh,Cd,qa,wa,hu,Su,va.layers[0],va.collisionBoxArray,io.index,io.sourceLayerIndex,va.index,Ul,_p,xp,ru,Kc,_h,bp,gl,io,tu,Ta,Rc,go)};if(vf==="line")for(var mf=0,gf=cs(io.geometry,0,0,8192,8192);mf<gf.length;mf+=1)for(var Sp=gf[mf],Lf=0,Rf=Io(Sp,yh,Wh,qa.vertical||zl,wa,24,Qf,va.overscaling,8192);Lf<Rf.length;Lf+=1){var yf=Rf[Lf];zl&&ua(va,zl.text,qf,yf)||Of(Sp,yf)}else if(vf==="line-center")for(var xh=0,eh=io.geometry;xh<eh.length;xh+=1){var Es=eh[xh];if(Es.length>1){var Xh=$a(Es,Wh,qa.vertical||zl,wa,24,Qf);Xh&&Of(Es,Xh)}}else if(io.type==="Polygon")for(var th=0,Ha=fc(io.geometry,0);th<Ha.length;th+=1){var rh=Ha[th],$c=pa(rh,16);Of(rh[0],new Cn($c.x,$c.y,0))}else if(io.type==="LineString")for(var dc=0,bh=io.geometry;dc<bh.length;dc+=1){var nh=bh[dc];Of(nh,new Cn(nh[0].x,nh[0].y,0))}else if(io.type==="Point")for(var Ep=0,Gp=io.geometry;Ep<Gp.length;Ep+=1)for(var Cp=0,wp=Gp[Ep];Cp<wp.length;Cp+=1){var Yh=wp[Cp];Of([Yh],new Cn(Yh.x,Yh.y,0))}}(e,vr,kn,zs,f,Y,xn,pi,jn,Ys,S)},Ht=0,pr=e.features;Ht<pr.length;Ht+=1)Lt();g&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,r,f,v){var g,S=1/Math.tan(t/2);return e[0]=S/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=S,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(g=1/(f-v)),e[14]=2*v*f*g):(e[10]=-1,e[14]=-2*f),e},p.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},p.plugin=Ls,p.polygonIntersectsPolygon=hi,p.postMapLoadEvent=Xe,p.postTurnstileEvent=dr,p.potpack=Nt,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=Nn,p.registerForPluginStateChange=function(e){return e({pluginStatus:Os,pluginURL:gu}),Ec.on("pluginStateChange",e),e},p.renderColorRamp=Rl,p.rotate=function(e,t,r){var f=t[0],v=t[1],g=t[2],S=t[3],M=Math.sin(r),z=Math.cos(r);return e[0]=f*z+g*M,e[1]=v*z+S*M,e[2]=f*-M+g*z,e[3]=v*-M+S*z,e},p.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),g=t[4],S=t[5],M=t[6],z=t[7],Y=t[8],J=t[9],oe=t[10],he=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=g*v+Y*f,e[5]=S*v+J*f,e[6]=M*v+oe*f,e[7]=z*v+he*f,e[8]=Y*v-g*f,e[9]=J*v-S*f,e[10]=oe*v-M*f,e[11]=he*v-z*f,e},p.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),g=t[0],S=t[1],M=t[2],z=t[3],Y=t[4],J=t[5],oe=t[6],he=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=g*v+Y*f,e[1]=S*v+J*f,e[2]=M*v+oe*f,e[3]=z*v+he*f,e[4]=Y*v-g*f,e[5]=J*v-S*f,e[6]=oe*v-M*f,e[7]=he*v-z*f,e},p.scale=function(e,t,r){var f=r[0],v=r[1],g=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*g,e[9]=t[9]*g,e[10]=t[10]*g,e[11]=t[11]*g,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},p.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},p.setCacheLimits=function(e,t){rt=e,wt=t},p.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Os==="deferred"||Os==="loading"||Os==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");gu=Ni.resolveURL(e),Os="deferred",mu=t,Al(),r||Gs()},p.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},p.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},p.styleSpec=ue,p.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p.symbolSize=yo,p.transformMat3=function(e,t,r){var f=t[0],v=t[1],g=t[2];return e[0]=f*r[0]+v*r[3]+g*r[6],e[1]=f*r[1]+v*r[4]+g*r[7],e[2]=f*r[2]+v*r[5]+g*r[8],e},p.transformMat4=Du,p.translate=function(e,t,r){var f,v,g,S,M,z,Y,J,oe,he,Se,Ye,$e=r[0],gt=r[1],nt=r[2];return t===e?(e[12]=t[0]*$e+t[4]*gt+t[8]*nt+t[12],e[13]=t[1]*$e+t[5]*gt+t[9]*nt+t[13],e[14]=t[2]*$e+t[6]*gt+t[10]*nt+t[14],e[15]=t[3]*$e+t[7]*gt+t[11]*nt+t[15]):(v=t[1],g=t[2],S=t[3],M=t[4],z=t[5],Y=t[6],J=t[7],oe=t[8],he=t[9],Se=t[10],Ye=t[11],e[0]=f=t[0],e[1]=v,e[2]=g,e[3]=S,e[4]=M,e[5]=z,e[6]=Y,e[7]=J,e[8]=oe,e[9]=he,e[10]=Se,e[11]=Ye,e[12]=f*$e+M*gt+oe*nt+t[12],e[13]=v*$e+z*gt+he*nt+t[13],e[14]=g*$e+Y*gt+Se*nt+t[14],e[15]=S*$e+J*gt+Ye*nt+t[15]),e},p.triggerPluginCompletionEvent=zc,p.uniqueId=xt,p.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=nf,p.validateStyle=tc,p.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},p.vectorTile=Ic,p.version="1.13.2",p.warnOnce=je,p.webpSupported=ve,p.window=L,p.wrap=Dt}),b(["./shared"],function(p){"use strict";function E(q){var le=typeof q;if(le==="number"||le==="boolean"||le==="string"||q==null)return JSON.stringify(q);if(Array.isArray(q)){for(var pe="[",U=0,ae=q;U<ae.length;U+=1)pe+=E(ae[U])+",";return pe+"]"}for(var de=Object.keys(q).sort(),Pe="{",ue=0;ue<de.length;ue++)Pe+=JSON.stringify(de[ue])+":"+E(q[de[ue]])+",";return Pe+"}"}function Z(q){for(var le="",pe=0,U=p.refProperties;pe<U.length;pe+=1)le+="/"+E(q[U[pe]]);return le}var V=function(q){this.keyCache={},q&&this.replace(q)};V.prototype.replace=function(q){this._layerConfigs={},this._layers={},this.update(q,[])},V.prototype.update=function(q,le){for(var pe=this,U=0,ae=q;U<ae.length;U+=1){var de=ae[U];this._layerConfigs[de.id]=de;var Pe=this._layers[de.id]=p.createStyleLayer(de);Pe._featureFilter=p.featureFilter(Pe.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(var ue=0,Ee=le;ue<Ee.length;ue+=1){var mt=Ee[ue];delete this.keyCache[mt],delete this._layerConfigs[mt],delete this._layers[mt]}this.familiesBySource={};for(var wr=0,Yt=function(ln,on){for(var Li={},bn=0;bn<ln.length;bn++){var Ii=on&&on[ln[bn].id]||Z(ln[bn]);on&&(on[ln[bn].id]=Ii);var ea=Li[Ii];ea||(ea=Li[Ii]=[]),ea.push(ln[bn])}var ci=[];for(var qi in Li)ci.push(Li[qi]);return ci}(p.values(this._layerConfigs),this.keyCache);wr<Yt.length;wr+=1){var tr=Yt[wr].map(function(ln){return pe._layers[ln.id]}),Ur=tr[0];if(Ur.visibility!=="none"){var Fn=Ur.source||"",Rn=this.familiesBySource[Fn];Rn||(Rn=this.familiesBySource[Fn]={});var qt=Ur.sourceLayer||"_geojsonTileLayer",Tn=Rn[qt];Tn||(Tn=Rn[qt]=[]),Tn.push(tr)}}};var G=function(q){var le={},pe=[];for(var U in q){var ae=q[U],de=le[U]={};for(var Pe in ae){var ue=ae[+Pe];if(ue&&ue.bitmap.width!==0&&ue.bitmap.height!==0){var Ee={x:0,y:0,w:ue.bitmap.width+2,h:ue.bitmap.height+2};pe.push(Ee),de[Pe]={rect:Ee,metrics:ue.metrics}}}}var mt=p.potpack(pe),wr=new p.AlphaImage({width:mt.w||1,height:mt.h||1});for(var Yt in q){var tr=q[Yt];for(var Ur in tr){var Fn=tr[+Ur];if(Fn&&Fn.bitmap.width!==0&&Fn.bitmap.height!==0){var Rn=le[Yt][Ur].rect;p.AlphaImage.copy(Fn.bitmap,wr,{x:0,y:0},{x:Rn.x+1,y:Rn.y+1},Fn.bitmap)}}}this.image=wr,this.positions=le};p.register("GlyphAtlas",G);var I=function(q){this.tileID=new p.OverscaledTileID(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.uid=q.uid,this.zoom=q.zoom,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.collectResourceTiming,this.returnDependencies=!!q.returnDependencies,this.promoteId=q.promoteId};function L(q,le,pe){for(var U=new p.EvaluationParameters(le),ae=0,de=q;ae<de.length;ae+=1)de[ae].recalculate(U,pe)}function _e(q,le){var pe=p.getArrayBuffer(q.request,function(U,ae,de,Pe){U?le(U):ae&&le(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(ae)),rawData:ae,cacheControl:de,expires:Pe})});return function(){pe.cancel(),le()}}I.prototype.parse=function(q,le,pe,U,ae){var de=this;this.status="parsing",this.data=q,this.collisionBoxArray=new p.CollisionBoxArray;var Pe=new p.DictionaryCoder(Object.keys(q.layers).sort()),ue=new p.FeatureIndex(this.tileID,this.promoteId);ue.bucketLayerIDs=[];var Ee,mt,wr,Yt,tr={},Ur={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:pe},Fn=le.familiesBySource[this.source];for(var Rn in Fn){var qt=q.layers[Rn];if(qt){qt.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+Rn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Tn=Pe.encode(Rn),ln=[],on=0;on<qt.length;on++){var Li=qt.feature(on),bn=ue.getId(Li,Rn);ln.push({feature:Li,id:bn,index:on,sourceLayerIndex:Tn})}for(var Ii=0,ea=Fn[Rn];Ii<ea.length;Ii+=1){var ci=ea[Ii],qi=ci[0];qi.minzoom&&this.zoom<Math.floor(qi.minzoom)||qi.maxzoom&&this.zoom>=qi.maxzoom||qi.visibility!=="none"&&(L(ci,this.zoom,pe),(tr[qi.id]=qi.createBucket({index:ue.bucketLayerIDs.length,layers:ci,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Tn,sourceID:this.source})).populate(ln,Ur,this.tileID.canonical),ue.bucketLayerIDs.push(ci.map(function(ai){return ai.id})))}}}var zi=p.mapObject(Ur.glyphDependencies,function(ai){return Object.keys(ai).map(Number)});Object.keys(zi).length?U.send("getGlyphs",{uid:this.uid,stacks:zi},function(ai,ki){Ee||(Ee=ai,mt=ki,Bi.call(de))}):mt={};var Mi=Object.keys(Ur.iconDependencies);Mi.length?U.send("getImages",{icons:Mi,source:this.source,tileID:this.tileID,type:"icons"},function(ai,ki){Ee||(Ee=ai,wr=ki,Bi.call(de))}):wr={};var la=Object.keys(Ur.patternDependencies);function Bi(){if(Ee)return ae(Ee);if(mt&&wr&&Yt){var ai=new G(mt),ki=new p.ImageAtlas(wr,Yt);for(var wi in tr){var ro=tr[wi];ro instanceof p.SymbolBucket?(L(ro.layers,this.zoom,pe),p.performSymbolLayout(ro,mt,ai.positions,wr,ki.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ro.hasPattern&&(ro instanceof p.LineBucket||ro instanceof p.FillBucket||ro instanceof p.FillExtrusionBucket)&&(L(ro.layers,this.zoom,pe),ro.addFeatures(Ur,this.tileID.canonical,ki.patternPositions))}this.status="done",ae(null,{buckets:p.values(tr).filter(function(po){return!po.isEmpty()}),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ai.image,imageAtlas:ki,glyphMap:this.returnDependencies?mt:null,iconMap:this.returnDependencies?wr:null,glyphPositions:this.returnDependencies?ai.positions:null})}}la.length?U.send("getImages",{icons:la,source:this.source,tileID:this.tileID,type:"patterns"},function(ai,ki){Ee||(Ee=ai,Yt=ki,Bi.call(de))}):Yt={},Bi.call(this)};var be=function(q,le,pe,U){this.actor=q,this.layerIndex=le,this.availableImages=pe,this.loadVectorData=U||_e,this.loading={},this.loaded={}};be.prototype.loadTile=function(q,le){var pe=this,U=q.uid;this.loading||(this.loading={});var ae=!!(q&&q.request&&q.request.collectResourceTiming)&&new p.RequestPerformance(q.request),de=this.loading[U]=new I(q);de.abort=this.loadVectorData(q,function(Pe,ue){if(delete pe.loading[U],Pe||!ue)return de.status="done",pe.loaded[U]=de,le(Pe);var Ee=ue.rawData,mt={};ue.expires&&(mt.expires=ue.expires),ue.cacheControl&&(mt.cacheControl=ue.cacheControl);var wr={};if(ae){var Yt=ae.finish();Yt&&(wr.resourceTiming=JSON.parse(JSON.stringify(Yt)))}de.vectorTile=ue.vectorTile,de.parse(ue.vectorTile,pe.layerIndex,pe.availableImages,pe.actor,function(tr,Ur){if(tr||!Ur)return le(tr);le(null,p.extend({rawTileData:Ee.slice(0)},Ur,mt,wr))}),pe.loaded=pe.loaded||{},pe.loaded[U]=de})},be.prototype.reloadTile=function(q,le){var pe=this,U=this.loaded,ae=q.uid,de=this;if(U&&U[ae]){var Pe=U[ae];Pe.showCollisionBoxes=q.showCollisionBoxes;var ue=function(Ee,mt){var wr=Pe.reloadCallback;wr&&(delete Pe.reloadCallback,Pe.parse(Pe.vectorTile,de.layerIndex,pe.availableImages,de.actor,wr)),le(Ee,mt)};Pe.status==="parsing"?Pe.reloadCallback=ue:Pe.status==="done"&&(Pe.vectorTile?Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,ue):ue())}},be.prototype.abortTile=function(q,le){var pe=this.loading,U=q.uid;pe&&pe[U]&&pe[U].abort&&(pe[U].abort(),delete pe[U]),le()},be.prototype.removeTile=function(q,le){var pe=this.loaded,U=q.uid;pe&&pe[U]&&delete pe[U],le()};var Le=p.window.ImageBitmap,Je=function(){this.loaded={}};function Dt(q,le){if(q.length!==0){It(q[0],le);for(var pe=1;pe<q.length;pe++)It(q[pe],!le)}}function It(q,le){for(var pe=0,U=0,ae=q.length,de=ae-1;U<ae;de=U++)pe+=(q[U][0]-q[de][0])*(q[de][1]+q[U][1]);pe>=0!=!!le&&q.reverse()}Je.prototype.loadTile=function(q,le){var pe=q.uid,U=q.encoding,ae=q.rawImageData,de=Le&&ae instanceof Le?this.getImageData(ae):ae,Pe=new p.DEMData(pe,de,U);this.loaded=this.loaded||{},this.loaded[pe]=Pe,le(null,Pe)},Je.prototype.getImageData=function(q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);var le=this.offscreenCanvasContext.getImageData(-1,-1,q.width+2,q.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:le.width,height:le.height},le.data)},Je.prototype.removeTile=function(q){var le=this.loaded,pe=q.uid;le&&le[pe]&&delete le[pe]};var Ut=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,xt=function(q){this._feature=q,this.extent=p.EXTENT,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))};xt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var q=[],le=0,pe=this._feature.geometry;le<pe.length;le+=1){var U=pe[le];q.push([new p.Point$1(U[0],U[1])])}return q}for(var ae=[],de=0,Pe=this._feature.geometry;de<Pe.length;de+=1){for(var ue=[],Ee=0,mt=Pe[de];Ee<mt.length;Ee+=1){var wr=mt[Ee];ue.push(new p.Point$1(wr[0],wr[1]))}ae.push(ue)}return ae},xt.prototype.toGeoJSON=function(q,le,pe){return Ut.call(this,q,le,pe)};var bt=function(q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=q.length,this._features=q};bt.prototype.feature=function(q){return new xt(this._features[q])};var ct=p.vectorTile.VectorTileFeature,ir=re;function re(q,le){this.options=le||{},this.features=q,this.length=q.length}function cr(q,le){this.id=typeof q.id=="number"?q.id:void 0,this.type=q.type,this.rawGeometry=q.type===1?[q.geometry]:q.geometry,this.properties=q.tags,this.extent=le||4096}re.prototype.feature=function(q){return new cr(this.features[q],this.options.extent)},cr.prototype.loadGeometry=function(){var q=this.rawGeometry;this.geometry=[];for(var le=0;le<q.length;le++){for(var pe=q[le],U=[],ae=0;ae<pe.length;ae++)U.push(new p.Point$1(pe[ae][0],pe[ae][1]));this.geometry.push(U)}return this.geometry},cr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var q=this.geometry,le=1/0,pe=-1/0,U=1/0,ae=-1/0,de=0;de<q.length;de++)for(var Pe=q[de],ue=0;ue<Pe.length;ue++){var Ee=Pe[ue];le=Math.min(le,Ee.x),pe=Math.max(pe,Ee.x),U=Math.min(U,Ee.y),ae=Math.max(ae,Ee.y)}return[le,U,pe,ae]},cr.prototype.toGeoJSON=ct.prototype.toGeoJSON;var Ct=Tt,Qe=ir;function Tt(q){var le=new p.pbf;return function(pe,U){for(var ae in pe.layers)U.writeMessage(3,je,pe.layers[ae])}(q,le),le.finish()}function je(q,le){var pe;le.writeVarintField(15,q.version||1),le.writeStringField(1,q.name||""),le.writeVarintField(5,q.extent||4096);var U={keys:[],values:[],keycache:{},valuecache:{}};for(pe=0;pe<q.length;pe++)U.feature=q.feature(pe),le.writeMessage(2,Pt,U);var ae=U.keys;for(pe=0;pe<ae.length;pe++)le.writeStringField(3,ae[pe]);var de=U.values;for(pe=0;pe<de.length;pe++)le.writeMessage(4,ke,de[pe])}function Pt(q,le){var pe=q.feature;pe.id!==void 0&&le.writeVarintField(1,pe.id),le.writeMessage(2,fr,q),le.writeVarintField(3,pe.type),le.writeMessage(4,fe,pe)}function fr(q,le){var pe=q.feature,U=q.keys,ae=q.values,de=q.keycache,Pe=q.valuecache;for(var ue in pe.properties){var Ee=de[ue];Ee===void 0&&(U.push(ue),de[ue]=Ee=U.length-1),le.writeVarint(Ee);var mt=pe.properties[ue],wr=typeof mt;wr!=="string"&&wr!=="boolean"&&wr!=="number"&&(mt=JSON.stringify(mt));var Yt=wr+":"+mt,tr=Pe[Yt];tr===void 0&&(ae.push(mt),Pe[Yt]=tr=ae.length-1),le.writeVarint(tr)}}function $t(q,le){return(le<<3)+(7&q)}function zr(q){return q<<1^q>>31}function fe(q,le){for(var pe=q.loadGeometry(),U=q.type,ae=0,de=0,Pe=pe.length,ue=0;ue<Pe;ue++){var Ee=pe[ue],mt=1;U===1&&(mt=Ee.length),le.writeVarint($t(1,mt));for(var wr=U===3?Ee.length-1:Ee.length,Yt=0;Yt<wr;Yt++){Yt===1&&U!==1&&le.writeVarint($t(2,wr-1));var tr=Ee[Yt].x-ae,Ur=Ee[Yt].y-de;le.writeVarint(zr(tr)),le.writeVarint(zr(Ur)),ae+=tr,de+=Ur}U===3&&le.writeVarint($t(7,1))}}function ke(q,le){var pe=typeof q;pe==="string"?le.writeStringField(1,q):pe==="boolean"?le.writeBooleanField(7,q):pe==="number"&&(q%1!=0?le.writeDoubleField(3,q):q<0?le.writeSVarintField(6,q):le.writeVarintField(5,q))}function ge(q,le,pe,U){_t(q,pe,U),_t(le,2*pe,2*U),_t(le,2*pe+1,2*U+1)}function _t(q,le,pe){var U=q[le];q[le]=q[pe],q[pe]=U}function vt(q,le,pe,U){var ae=q-pe,de=le-U;return ae*ae+de*de}Ct.fromVectorTileJs=Tt,Ct.fromGeojsonVt=function(q,le){le=le||{};var pe={};for(var U in q)pe[U]=new ir(q[U].features,le),pe[U].name=U,pe[U].version=le.version,pe[U].extent=le.extent;return Tt({layers:pe})},Ct.GeoJSONWrapper=Qe;var jt=function(q){return q[0]},Bt=function(q){return q[1]},Nr=function(q,le,pe,U,ae){le===void 0&&(le=jt),pe===void 0&&(pe=Bt),U===void 0&&(U=64),ae===void 0&&(ae=Float64Array),this.nodeSize=U,this.points=q;for(var de=q.length<65536?Uint16Array:Uint32Array,Pe=this.ids=new de(q.length),ue=this.coords=new ae(2*q.length),Ee=0;Ee<q.length;Ee++)Pe[Ee]=Ee,ue[2*Ee]=le(q[Ee]),ue[2*Ee+1]=pe(q[Ee]);(function mt(wr,Yt,tr,Ur,Fn,Rn){if(!(Fn-Ur<=tr)){var qt=Ur+Fn>>1;(function Tn(ln,on,Li,bn,Ii,ea){for(;Ii>bn;){if(Ii-bn>600){var ci=Ii-bn+1,qi=Li-bn+1,zi=Math.log(ci),Mi=.5*Math.exp(2*zi/3),la=.5*Math.sqrt(zi*Mi*(ci-Mi)/ci)*(qi-ci/2<0?-1:1);Tn(ln,on,Li,Math.max(bn,Math.floor(Li-qi*Mi/ci+la)),Math.min(Ii,Math.floor(Li+(ci-qi)*Mi/ci+la)),ea)}var Bi=on[2*Li+ea],ai=bn,ki=Ii;for(ge(ln,on,bn,Li),on[2*Ii+ea]>Bi&&ge(ln,on,bn,Ii);ai<ki;){for(ge(ln,on,ai,ki),ai++,ki--;on[2*ai+ea]<Bi;)ai++;for(;on[2*ki+ea]>Bi;)ki--}on[2*bn+ea]===Bi?ge(ln,on,bn,ki):ge(ln,on,++ki,Ii),ki<=Li&&(bn=ki+1),Li<=ki&&(Ii=ki-1)}})(wr,Yt,qt,Ur,Fn,Rn%2),mt(wr,Yt,tr,Ur,qt-1,Rn+1),mt(wr,Yt,tr,qt+1,Fn,Rn+1)}})(Pe,ue,U,0,Pe.length-1,0)};Nr.prototype.range=function(q,le,pe,U){return function(ae,de,Pe,ue,Ee,mt,wr){for(var Yt,tr,Ur=[0,ae.length-1,0],Fn=[];Ur.length;){var Rn=Ur.pop(),qt=Ur.pop(),Tn=Ur.pop();if(qt-Tn<=wr)for(var ln=Tn;ln<=qt;ln++)tr=de[2*ln+1],(Yt=de[2*ln])>=Pe&&Yt<=Ee&&tr>=ue&&tr<=mt&&Fn.push(ae[ln]);else{var on=Math.floor((Tn+qt)/2);tr=de[2*on+1],(Yt=de[2*on])>=Pe&&Yt<=Ee&&tr>=ue&&tr<=mt&&Fn.push(ae[on]);var Li=(Rn+1)%2;(Rn===0?Pe<=Yt:ue<=tr)&&(Ur.push(Tn),Ur.push(on-1),Ur.push(Li)),(Rn===0?Ee>=Yt:mt>=tr)&&(Ur.push(on+1),Ur.push(qt),Ur.push(Li))}}return Fn}(this.ids,this.coords,q,le,pe,U,this.nodeSize)},Nr.prototype.within=function(q,le,pe){return function(U,ae,de,Pe,ue,Ee){for(var mt=[0,U.length-1,0],wr=[],Yt=ue*ue;mt.length;){var tr=mt.pop(),Ur=mt.pop(),Fn=mt.pop();if(Ur-Fn<=Ee)for(var Rn=Fn;Rn<=Ur;Rn++)vt(ae[2*Rn],ae[2*Rn+1],de,Pe)<=Yt&&wr.push(U[Rn]);else{var qt=Math.floor((Fn+Ur)/2),Tn=ae[2*qt],ln=ae[2*qt+1];vt(Tn,ln,de,Pe)<=Yt&&wr.push(U[qt]);var on=(tr+1)%2;(tr===0?de-ue<=Tn:Pe-ue<=ln)&&(mt.push(Fn),mt.push(qt-1),mt.push(on)),(tr===0?de+ue>=Tn:Pe+ue>=ln)&&(mt.push(qt+1),mt.push(Ur),mt.push(on))}}return wr}(this.ids,this.coords,q,le,pe,this.nodeSize)};var pn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(q){return q}},mn=function(q){this.options=kt(Object.create(pn),q),this.trees=new Array(this.options.maxZoom+1)};function Ni(q,le,pe,U,ae){return{x:q,y:le,zoom:1/0,id:pe,parentId:-1,numPoints:U,properties:ae}}function or(q,le){var pe=q.geometry.coordinates,U=pe[1];return{x:Ge(pe[0]),y:Re(U),zoom:1/0,index:le,parentId:-1}}function ve(q){return{type:"Feature",id:q.id,properties:Me(q),geometry:{type:"Point",coordinates:[(U=q.x,360*(U-.5)),(le=q.y,pe=(180-360*le)*Math.PI/180,360*Math.atan(Math.exp(pe))/Math.PI-90)]}};var le,pe,U}function Me(q){var le=q.numPoints,pe=le>=1e4?Math.round(le/1e3)+"k":le>=1e3?Math.round(le/100)/10+"k":le;return kt(kt({},q.properties),{cluster:!0,cluster_id:q.id,point_count:le,point_count_abbreviated:pe})}function Ge(q){return q/360+.5}function Re(q){var le=Math.sin(q*Math.PI/180),pe=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return pe<0?0:pe>1?1:pe}function kt(q,le){for(var pe in le)q[pe]=le[pe];return q}function rr(q){return q.x}function yr(q){return q.y}function Pr(q,le,pe,U,ae,de){var Pe=ae-pe,ue=de-U;if(Pe!==0||ue!==0){var Ee=((q-pe)*Pe+(le-U)*ue)/(Pe*Pe+ue*ue);Ee>1?(pe=ae,U=de):Ee>0&&(pe+=Pe*Ee,U+=ue*Ee)}return(Pe=q-pe)*Pe+(ue=le-U)*ue}function sr(q,le,pe,U){var ae={id:q===void 0?null:q,type:le,geometry:pe,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var Pe=de.geometry,ue=de.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Rr(de,Pe);else if(ue==="Polygon"||ue==="MultiLineString")for(var Ee=0;Ee<Pe.length;Ee++)Rr(de,Pe[Ee]);else if(ue==="MultiPolygon")for(Ee=0;Ee<Pe.length;Ee++)for(var mt=0;mt<Pe[Ee].length;mt++)Rr(de,Pe[Ee][mt])}(ae),ae}function Rr(q,le){for(var pe=0;pe<le.length;pe+=3)q.minX=Math.min(q.minX,le[pe]),q.minY=Math.min(q.minY,le[pe+1]),q.maxX=Math.max(q.maxX,le[pe]),q.maxY=Math.max(q.maxY,le[pe+1])}function w(q,le,pe,U){if(le.geometry){var ae=le.geometry.coordinates,de=le.geometry.type,Pe=Math.pow(pe.tolerance/((1<<pe.maxZoom)*pe.extent),2),ue=[],Ee=le.id;if(pe.promoteId?Ee=le.properties[pe.promoteId]:pe.generateId&&(Ee=U||0),de==="Point")X(ae,ue);else if(de==="MultiPoint")for(var mt=0;mt<ae.length;mt++)X(ae[mt],ue);else if(de==="LineString")Ue(ae,ue,Pe,!1);else if(de==="MultiLineString"){if(pe.lineMetrics){for(mt=0;mt<ae.length;mt++)Ue(ae[mt],ue=[],Pe,!1),q.push(sr(Ee,"LineString",ue,le.properties));return}Ve(ae,ue,Pe,!1)}else if(de==="Polygon")Ve(ae,ue,Pe,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(mt=0;mt<le.geometry.geometries.length;mt++)w(q,{id:Ee,geometry:le.geometry.geometries[mt],properties:le.properties},pe,U);return}throw new Error("Input data is not a valid GeoJSON object.")}for(mt=0;mt<ae.length;mt++){var wr=[];Ve(ae[mt],wr,Pe,!0),ue.push(wr)}}q.push(sr(Ee,de,ue,le.properties))}}function X(q,le){le.push(ot(q[0])),le.push(At(q[1])),le.push(0)}function Ue(q,le,pe,U){for(var ae,de,Pe=0,ue=0;ue<q.length;ue++){var Ee=ot(q[ue][0]),mt=At(q[ue][1]);le.push(Ee),le.push(mt),le.push(0),ue>0&&(Pe+=U?(ae*mt-Ee*de)/2:Math.sqrt(Math.pow(Ee-ae,2)+Math.pow(mt-de,2))),ae=Ee,de=mt}var wr=le.length-3;le[2]=1,function Yt(tr,Ur,Fn,Rn){for(var qt,Tn=Rn,ln=Fn-Ur>>1,on=Fn-Ur,Li=tr[Ur],bn=tr[Ur+1],Ii=tr[Fn],ea=tr[Fn+1],ci=Ur+3;ci<Fn;ci+=3){var qi=Pr(tr[ci],tr[ci+1],Li,bn,Ii,ea);if(qi>Tn)qt=ci,Tn=qi;else if(qi===Tn){var zi=Math.abs(ci-ln);zi<on&&(qt=ci,on=zi)}}Tn>Rn&&(qt-Ur>3&&Yt(tr,Ur,qt,Rn),tr[qt+2]=Tn,Fn-qt>3&&Yt(tr,qt,Fn,Rn))}(le,0,wr,pe),le[wr+2]=1,le.size=Math.abs(Pe),le.start=0,le.end=le.size}function Ve(q,le,pe,U){for(var ae=0;ae<q.length;ae++){var de=[];Ue(q[ae],de,pe,U),le.push(de)}}function ot(q){return q/360+.5}function At(q){var le=Math.sin(q*Math.PI/180),pe=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return pe<0?0:pe>1?1:pe}function Q(q,le,pe,U,ae,de,Pe,ue){if(U/=le,de>=(pe/=le)&&Pe<U)return q;if(Pe<pe||de>=U)return null;for(var Ee=[],mt=0;mt<q.length;mt++){var wr=q[mt],Yt=wr.geometry,tr=wr.type,Ur=ae===0?wr.minX:wr.minY,Fn=ae===0?wr.maxX:wr.maxY;if(Ur>=pe&&Fn<U)Ee.push(wr);else if(!(Fn<pe||Ur>=U)){var Rn=[];if(tr==="Point"||tr==="MultiPoint")Rt(Yt,Rn,pe,U,ae);else if(tr==="LineString")dr(Yt,Rn,pe,U,ae,!1,ue.lineMetrics);else if(tr==="MultiLineString")Xe(Yt,Rn,pe,U,ae,!1);else if(tr==="Polygon")Xe(Yt,Rn,pe,U,ae,!0);else if(tr==="MultiPolygon")for(var qt=0;qt<Yt.length;qt++){var Tn=[];Xe(Yt[qt],Tn,pe,U,ae,!0),Tn.length&&Rn.push(Tn)}if(Rn.length){if(ue.lineMetrics&&tr==="LineString"){for(qt=0;qt<Rn.length;qt++)Ee.push(sr(wr.id,tr,Rn[qt],wr.tags));continue}tr!=="LineString"&&tr!=="MultiLineString"||(Rn.length===1?(tr="LineString",Rn=Rn[0]):tr="MultiLineString"),tr!=="Point"&&tr!=="MultiPoint"||(tr=Rn.length===3?"Point":"MultiPoint"),Ee.push(sr(wr.id,tr,Rn,wr.tags))}}}return Ee.length?Ee:null}function Rt(q,le,pe,U,ae){for(var de=0;de<q.length;de+=3){var Pe=q[de+ae];Pe>=pe&&Pe<=U&&(le.push(q[de]),le.push(q[de+1]),le.push(q[de+2]))}}function dr(q,le,pe,U,ae,de,Pe){for(var ue,Ee,mt=Cr(q),wr=ae===0?wt:Ot,Yt=q.start,tr=0;tr<q.length-3;tr+=3){var Ur=q[tr],Fn=q[tr+1],Rn=q[tr+2],qt=q[tr+3],Tn=q[tr+4],ln=ae===0?Ur:Fn,on=ae===0?qt:Tn,Li=!1;Pe&&(ue=Math.sqrt(Math.pow(Ur-qt,2)+Math.pow(Fn-Tn,2))),ln<pe?on>pe&&(Ee=wr(mt,Ur,Fn,qt,Tn,pe),Pe&&(mt.start=Yt+ue*Ee)):ln>U?on<U&&(Ee=wr(mt,Ur,Fn,qt,Tn,U),Pe&&(mt.start=Yt+ue*Ee)):rt(mt,Ur,Fn,Rn),on<pe&&ln>=pe&&(Ee=wr(mt,Ur,Fn,qt,Tn,pe),Li=!0),on>U&&ln<=U&&(Ee=wr(mt,Ur,Fn,qt,Tn,U),Li=!0),!de&&Li&&(Pe&&(mt.end=Yt+ue*Ee),le.push(mt),mt=Cr(q)),Pe&&(Yt+=ue)}var bn=q.length-3;Ur=q[bn],Fn=q[bn+1],Rn=q[bn+2],(ln=ae===0?Ur:Fn)>=pe&&ln<=U&&rt(mt,Ur,Fn,Rn),bn=mt.length-3,de&&bn>=3&&(mt[bn]!==mt[0]||mt[bn+1]!==mt[1])&&rt(mt,mt[0],mt[1],mt[2]),mt.length&&le.push(mt)}function Cr(q){var le=[];return le.size=q.size,le.start=q.start,le.end=q.end,le}function Xe(q,le,pe,U,ae,de){for(var Pe=0;Pe<q.length;Pe++)dr(q[Pe],le,pe,U,ae,de,!1)}function rt(q,le,pe,U){q.push(le),q.push(pe),q.push(U)}function wt(q,le,pe,U,ae,de){var Pe=(de-le)/(U-le);return q.push(de),q.push(pe+(ae-pe)*Pe),q.push(1),Pe}function Ot(q,le,pe,U,ae,de){var Pe=(de-pe)/(ae-pe);return q.push(le+(U-le)*Pe),q.push(de),q.push(1),Pe}function gr(q,le){for(var pe=[],U=0;U<q.length;U++){var ae,de=q[U],Pe=de.type;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")ae=br(de.geometry,le);else if(Pe==="MultiLineString"||Pe==="Polygon"){ae=[];for(var ue=0;ue<de.geometry.length;ue++)ae.push(br(de.geometry[ue],le))}else if(Pe==="MultiPolygon")for(ae=[],ue=0;ue<de.geometry.length;ue++){for(var Ee=[],mt=0;mt<de.geometry[ue].length;mt++)Ee.push(br(de.geometry[ue][mt],le));ae.push(Ee)}pe.push(sr(de.id,Pe,ae,de.tags))}return pe}function br(q,le){var pe=[];pe.size=q.size,q.start!==void 0&&(pe.start=q.start,pe.end=q.end);for(var U=0;U<q.length;U+=3)pe.push(q[U]+le,q[U+1],q[U+2]);return pe}function Xt(q,le){if(q.transformed)return q;var pe,U,ae,de=1<<q.z,Pe=q.x,ue=q.y;for(pe=0;pe<q.features.length;pe++){var Ee=q.features[pe],mt=Ee.geometry,wr=Ee.type;if(Ee.geometry=[],wr===1)for(U=0;U<mt.length;U+=2)Ee.geometry.push(kr(mt[U],mt[U+1],le,de,Pe,ue));else for(U=0;U<mt.length;U++){var Yt=[];for(ae=0;ae<mt[U].length;ae+=2)Yt.push(kr(mt[U][ae],mt[U][ae+1],le,de,Pe,ue));Ee.geometry.push(Yt)}}return q.transformed=!0,q}function kr(q,le,pe,U,ae,de){return[Math.round(pe*(q*U-ae)),Math.round(pe*(le*U-de))]}function Mr(q,le,pe,U,ae){for(var de=le===ae.maxZoom?0:ae.tolerance/((1<<le)*ae.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:pe,y:U,z:le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<q.length;ue++){Pe.numFeatures++,un(Pe,q[ue],de,ae);var Ee=q[ue].minX,mt=q[ue].minY,wr=q[ue].maxX,Yt=q[ue].maxY;Ee<Pe.minX&&(Pe.minX=Ee),mt<Pe.minY&&(Pe.minY=mt),wr>Pe.maxX&&(Pe.maxX=wr),Yt>Pe.maxY&&(Pe.maxY=Yt)}return Pe}function un(q,le,pe,U){var ae=le.geometry,de=le.type,Pe=[];if(de==="Point"||de==="MultiPoint")for(var ue=0;ue<ae.length;ue+=3)Pe.push(ae[ue]),Pe.push(ae[ue+1]),q.numPoints++,q.numSimplified++;else if(de==="LineString")an(Pe,ae,q,pe,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(ue=0;ue<ae.length;ue++)an(Pe,ae[ue],q,pe,de==="Polygon",ue===0);else if(de==="MultiPolygon")for(var Ee=0;Ee<ae.length;Ee++){var mt=ae[Ee];for(ue=0;ue<mt.length;ue++)an(Pe,mt[ue],q,pe,!0,ue===0)}if(Pe.length){var wr=le.tags||null;if(de==="LineString"&&U.lineMetrics){for(var Yt in wr={},le.tags)wr[Yt]=le.tags[Yt];wr.mapbox_clip_start=ae.start/ae.size,wr.mapbox_clip_end=ae.end/ae.size}var tr={geometry:Pe,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:wr};le.id!==null&&(tr.id=le.id),q.features.push(tr)}}function an(q,le,pe,U,ae,de){var Pe=U*U;if(U>0&&le.size<(ae?Pe:U))pe.numPoints+=le.length/3;else{for(var ue=[],Ee=0;Ee<le.length;Ee+=3)(U===0||le[Ee+2]>Pe)&&(pe.numSimplified++,ue.push(le[Ee]),ue.push(le[Ee+1])),pe.numPoints++;ae&&function(mt,wr){for(var Yt=0,tr=0,Ur=mt.length,Fn=Ur-2;tr<Ur;Fn=tr,tr+=2)Yt+=(mt[tr]-mt[Fn])*(mt[tr+1]+mt[Fn+1]);if(Yt>0===wr)for(tr=0,Ur=mt.length;tr<Ur/2;tr+=2){var Rn=mt[tr],qt=mt[tr+1];mt[tr]=mt[Ur-2-tr],mt[tr+1]=mt[Ur-1-tr],mt[Ur-2-tr]=Rn,mt[Ur-1-tr]=qt}}(ue,de),q.push(ue)}}function Kn(q,le){var pe=(le=this.options=function(ae,de){for(var Pe in de)ae[Pe]=de[Pe];return ae}(Object.create(this.options),le)).debug;if(pe&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");var U=function(ae,de){var Pe=[];if(ae.type==="FeatureCollection")for(var ue=0;ue<ae.features.length;ue++)w(Pe,ae.features[ue],de,ue);else w(Pe,ae.type==="Feature"?ae:{geometry:ae},de);return Pe}(q,le);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(U=function(ae,de){var Pe=de.buffer/de.extent,ue=ae,Ee=Q(ae,1,-1-Pe,Pe,0,-1,2,de),mt=Q(ae,1,1-Pe,2+Pe,0,-1,2,de);return(Ee||mt)&&(ue=Q(ae,1,-Pe,1+Pe,0,-1,2,de)||[],Ee&&(ue=gr(Ee,1).concat(ue)),mt&&(ue=ue.concat(gr(mt,-1)))),ue}(U,le)).length&&this.splitTile(U,0,0,0),pe&&(U.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ti(q,le,pe){return 32*((1<<q)*pe+le)+q}function Qi(q,le){var pe=q.tileID.canonical;if(!this._geoJSONIndex)return le(null,null);var U=this._geoJSONIndex.getTile(pe.z,pe.x,pe.y);if(!U)return le(null,null);var ae=new bt(U.features),de=Ct(ae);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),le(null,{vectorTile:ae,rawData:de.buffer})}mn.prototype.load=function(q){var le=this.options,pe=le.log,U=le.minZoom,ae=le.maxZoom,de=le.nodeSize;pe&&console.time("total time");var Pe="prepare "+q.length+" points";pe&&console.time(Pe),this.points=q;for(var ue=[],Ee=0;Ee<q.length;Ee++)q[Ee].geometry&&ue.push(or(q[Ee],Ee));this.trees[ae+1]=new Nr(ue,rr,yr,de,Float32Array),pe&&console.timeEnd(Pe);for(var mt=ae;mt>=U;mt--){var wr=+Date.now();ue=this._cluster(ue,mt),this.trees[mt]=new Nr(ue,rr,yr,de,Float32Array),pe&&console.log("z%d: %d clusters in %dms",mt,ue.length,+Date.now()-wr)}return pe&&console.timeEnd("total time"),this},mn.prototype.getClusters=function(q,le){var pe=((q[0]+180)%360+360)%360-180,U=Math.max(-90,Math.min(90,q[1])),ae=q[2]===180?180:((q[2]+180)%360+360)%360-180,de=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)pe=-180,ae=180;else if(pe>ae){var Pe=this.getClusters([pe,U,180,de],le),ue=this.getClusters([-180,U,ae,de],le);return Pe.concat(ue)}for(var Ee=this.trees[this._limitZoom(le)],mt=[],wr=0,Yt=Ee.range(Ge(pe),Re(de),Ge(ae),Re(U));wr<Yt.length;wr+=1){var tr=Ee.points[Yt[wr]];mt.push(tr.numPoints?ve(tr):this.points[tr.index])}return mt},mn.prototype.getChildren=function(q){var le=this._getOriginId(q),pe=this._getOriginZoom(q),U="No cluster with the specified id.",ae=this.trees[pe];if(!ae)throw new Error(U);var de=ae.points[le];if(!de)throw new Error(U);for(var Pe=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),ue=[],Ee=0,mt=ae.within(de.x,de.y,Pe);Ee<mt.length;Ee+=1){var wr=ae.points[mt[Ee]];wr.parentId===q&&ue.push(wr.numPoints?ve(wr):this.points[wr.index])}if(ue.length===0)throw new Error(U);return ue},mn.prototype.getLeaves=function(q,le,pe){var U=[];return this._appendLeaves(U,q,le=le||10,pe=pe||0,0),U},mn.prototype.getTile=function(q,le,pe){var U=this.trees[this._limitZoom(q)],ae=Math.pow(2,q),de=this.options,Pe=de.radius/de.extent,ue=(pe-Pe)/ae,Ee=(pe+1+Pe)/ae,mt={features:[]};return this._addTileFeatures(U.range((le-Pe)/ae,ue,(le+1+Pe)/ae,Ee),U.points,le,pe,ae,mt),le===0&&this._addTileFeatures(U.range(1-Pe/ae,ue,1,Ee),U.points,ae,pe,ae,mt),le===ae-1&&this._addTileFeatures(U.range(0,ue,Pe/ae,Ee),U.points,-1,pe,ae,mt),mt.features.length?mt:null},mn.prototype.getClusterExpansionZoom=function(q){for(var le=this._getOriginZoom(q)-1;le<=this.options.maxZoom;){var pe=this.getChildren(q);if(le++,pe.length!==1)break;q=pe[0].properties.cluster_id}return le},mn.prototype._appendLeaves=function(q,le,pe,U,ae){for(var de=0,Pe=this.getChildren(le);de<Pe.length;de+=1){var ue=Pe[de],Ee=ue.properties;if(Ee&&Ee.cluster?ae+Ee.point_count<=U?ae+=Ee.point_count:ae=this._appendLeaves(q,Ee.cluster_id,pe,U,ae):ae<U?ae++:q.push(ue),q.length===pe)break}return ae},mn.prototype._addTileFeatures=function(q,le,pe,U,ae,de){for(var Pe=0,ue=q;Pe<ue.length;Pe+=1){var Ee=le[ue[Pe]],mt=Ee.numPoints,wr={type:1,geometry:[[Math.round(this.options.extent*(Ee.x*ae-pe)),Math.round(this.options.extent*(Ee.y*ae-U))]],tags:mt?Me(Ee):this.points[Ee.index].properties},Yt=void 0;mt?Yt=Ee.id:this.options.generateId?Yt=Ee.index:this.points[Ee.index].id&&(Yt=this.points[Ee.index].id),Yt!==void 0&&(wr.id=Yt),de.features.push(wr)}},mn.prototype._limitZoom=function(q){return Math.max(this.options.minZoom,Math.min(+q,this.options.maxZoom+1))},mn.prototype._cluster=function(q,le){for(var pe=[],U=this.options,ae=U.reduce,de=U.minPoints,Pe=U.radius/(U.extent*Math.pow(2,le)),ue=0;ue<q.length;ue++){var Ee=q[ue];if(!(Ee.zoom<=le)){Ee.zoom=le;for(var mt=this.trees[le+1],wr=mt.within(Ee.x,Ee.y,Pe),Yt=Ee.numPoints||1,tr=Yt,Ur=0,Fn=wr;Ur<Fn.length;Ur+=1){var Rn=mt.points[Fn[Ur]];Rn.zoom>le&&(tr+=Rn.numPoints||1)}if(tr>=de){for(var qt=Ee.x*Yt,Tn=Ee.y*Yt,ln=ae&&Yt>1?this._map(Ee,!0):null,on=(ue<<5)+(le+1)+this.points.length,Li=0,bn=wr;Li<bn.length;Li+=1){var Ii=mt.points[bn[Li]];if(!(Ii.zoom<=le)){Ii.zoom=le;var ea=Ii.numPoints||1;qt+=Ii.x*ea,Tn+=Ii.y*ea,Ii.parentId=on,ae&&(ln||(ln=this._map(Ee,!0)),ae(ln,this._map(Ii)))}}Ee.parentId=on,pe.push(Ni(qt/tr,Tn/tr,on,tr,ln))}else if(pe.push(Ee),tr>1)for(var ci=0,qi=wr;ci<qi.length;ci+=1){var zi=mt.points[qi[ci]];zi.zoom<=le||(zi.zoom=le,pe.push(zi))}}}return pe},mn.prototype._getOriginId=function(q){return q-this.points.length>>5},mn.prototype._getOriginZoom=function(q){return(q-this.points.length)%32},mn.prototype._map=function(q,le){if(q.numPoints)return le?kt({},q.properties):q.properties;var pe=this.points[q.index].properties,U=this.options.map(pe);return le&&U===pe?kt({},U):U},Kn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Kn.prototype.splitTile=function(q,le,pe,U,ae,de,Pe){for(var ue=[q,le,pe,U],Ee=this.options,mt=Ee.debug;ue.length;){U=ue.pop(),pe=ue.pop(),le=ue.pop(),q=ue.pop();var wr=1<<le,Yt=ti(le,pe,U),tr=this.tiles[Yt];if(!tr&&(mt>1&&console.time("creation"),tr=this.tiles[Yt]=Mr(q,le,pe,U,Ee),this.tileCoords.push({z:le,x:pe,y:U}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,pe,U,tr.numFeatures,tr.numPoints,tr.numSimplified),console.timeEnd("creation"));var Ur="z"+le;this.stats[Ur]=(this.stats[Ur]||0)+1,this.total++}if(tr.source=q,ae){if(le===Ee.maxZoom||le===ae)continue;var Fn=1<<ae-le;if(pe!==Math.floor(de/Fn)||U!==Math.floor(Pe/Fn))continue}else if(le===Ee.indexMaxZoom||tr.numPoints<=Ee.indexMaxPoints)continue;if(tr.source=null,q.length!==0){mt>1&&console.time("clipping");var Rn,qt,Tn,ln,on,Li,bn=.5*Ee.buffer/Ee.extent,Ii=.5-bn,ea=.5+bn,ci=1+bn;Rn=qt=Tn=ln=null,on=Q(q,wr,pe-bn,pe+ea,0,tr.minX,tr.maxX,Ee),Li=Q(q,wr,pe+Ii,pe+ci,0,tr.minX,tr.maxX,Ee),q=null,on&&(Rn=Q(on,wr,U-bn,U+ea,1,tr.minY,tr.maxY,Ee),qt=Q(on,wr,U+Ii,U+ci,1,tr.minY,tr.maxY,Ee),on=null),Li&&(Tn=Q(Li,wr,U-bn,U+ea,1,tr.minY,tr.maxY,Ee),ln=Q(Li,wr,U+Ii,U+ci,1,tr.minY,tr.maxY,Ee),Li=null),mt>1&&console.timeEnd("clipping"),ue.push(Rn||[],le+1,2*pe,2*U),ue.push(qt||[],le+1,2*pe,2*U+1),ue.push(Tn||[],le+1,2*pe+1,2*U),ue.push(ln||[],le+1,2*pe+1,2*U+1)}}},Kn.prototype.getTile=function(q,le,pe){var U=this.options,ae=U.extent,de=U.debug;if(q<0||q>24)return null;var Pe=1<<q,ue=ti(q,le=(le%Pe+Pe)%Pe,pe);if(this.tiles[ue])return Xt(this.tiles[ue],ae);de>1&&console.log("drilling down to z%d-%d-%d",q,le,pe);for(var Ee,mt=q,wr=le,Yt=pe;!Ee&&mt>0;)mt--,wr=Math.floor(wr/2),Yt=Math.floor(Yt/2),Ee=this.tiles[ti(mt,wr,Yt)];return Ee&&Ee.source?(de>1&&console.log("found parent tile z%d-%d-%d",mt,wr,Yt),de>1&&console.time("drilling down"),this.splitTile(Ee.source,mt,wr,Yt,q,le,pe),de>1&&console.timeEnd("drilling down"),this.tiles[ue]?Xt(this.tiles[ue],ae):null):null};var Ai=function(q){function le(pe,U,ae,de){q.call(this,pe,U,ae,Qi),de&&(this.loadGeoJSON=de)}return q&&(le.__proto__=q),(le.prototype=Object.create(q&&q.prototype)).constructor=le,le.prototype.loadData=function(pe,U){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=U,this._pendingLoadDataParams=pe,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},le.prototype._loadData=function(){var pe=this;if(this._pendingCallback&&this._pendingLoadDataParams){var U=this._pendingCallback,ae=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var de=!!(ae&&ae.request&&ae.request.collectResourceTiming)&&new p.RequestPerformance(ae.request);this.loadGeoJSON(ae,function(Pe,ue){if(Pe||!ue)return U(Pe);if(typeof ue!="object")return U(new Error("Input data given to '"+ae.source+"' is not a valid GeoJSON object."));(function tr(Ur,Fn){var Rn,qt=Ur&&Ur.type;if(qt==="FeatureCollection")for(Rn=0;Rn<Ur.features.length;Rn++)tr(Ur.features[Rn],Fn);else if(qt==="GeometryCollection")for(Rn=0;Rn<Ur.geometries.length;Rn++)tr(Ur.geometries[Rn],Fn);else if(qt==="Feature")tr(Ur.geometry,Fn);else if(qt==="Polygon")Dt(Ur.coordinates,Fn);else if(qt==="MultiPolygon")for(Rn=0;Rn<Ur.coordinates.length;Rn++)Dt(Ur.coordinates[Rn],Fn);return Ur})(ue,!0);try{if(ae.filter){var Ee=p.createExpression(ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ee.result==="error")throw new Error(Ee.value.map(function(tr){return tr.key+": "+tr.message}).join(", "));var mt=ue.features.filter(function(tr){return Ee.value.evaluate({zoom:0},tr)});ue={type:"FeatureCollection",features:mt}}pe._geoJSONIndex=ae.cluster?new mn(function(tr){var Ur=tr.superclusterOptions,Fn=tr.clusterProperties;if(!Fn||!Ur)return Ur;for(var Rn={},qt={},Tn={accumulated:null,zoom:0},ln={properties:null},on=Object.keys(Fn),Li=0,bn=on;Li<bn.length;Li+=1){var Ii=bn[Li],ea=Fn[Ii],ci=ea[0],qi=p.createExpression(ea[1]),zi=p.createExpression(typeof ci=="string"?[ci,["accumulated"],["get",Ii]]:ci);Rn[Ii]=qi.value,qt[Ii]=zi.value}return Ur.map=function(Mi){ln.properties=Mi;for(var la={},Bi=0,ai=on;Bi<ai.length;Bi+=1){var ki=ai[Bi];la[ki]=Rn[ki].evaluate(Tn,ln)}return la},Ur.reduce=function(Mi,la){ln.properties=la;for(var Bi=0,ai=on;Bi<ai.length;Bi+=1){var ki=ai[Bi];Tn.accumulated=Mi[ki],Mi[ki]=qt[ki].evaluate(Tn,ln)}},Ur}(ae)).load(ue.features):function(tr,Ur){return new Kn(tr,Ur)}(ue,ae.geojsonVtOptions)}catch(tr){return U(tr)}pe.loaded={};var wr={};if(de){var Yt=de.finish();Yt&&(wr.resourceTiming={},wr.resourceTiming[ae.source]=JSON.parse(JSON.stringify(Yt)))}U(null,wr)})}},le.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},le.prototype.reloadTile=function(pe,U){var ae=this.loaded;return ae&&ae[pe.uid]?q.prototype.reloadTile.call(this,pe,U):this.loadTile(pe,U)},le.prototype.loadGeoJSON=function(pe,U){if(pe.request)p.getJSON(pe.request,U);else{if(typeof pe.data!="string")return U(new Error("Input data given to '"+pe.source+"' is not a valid GeoJSON object."));try{return U(null,JSON.parse(pe.data))}catch(ae){return U(new Error("Input data given to '"+pe.source+"' is not a valid GeoJSON object."))}}},le.prototype.removeSource=function(pe,U){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),U()},le.prototype.getClusterExpansionZoom=function(pe,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(pe.clusterId))}catch(ae){U(ae)}},le.prototype.getClusterChildren=function(pe,U){try{U(null,this._geoJSONIndex.getChildren(pe.clusterId))}catch(ae){U(ae)}},le.prototype.getClusterLeaves=function(pe,U){try{U(null,this._geoJSONIndex.getLeaves(pe.clusterId,pe.limit,pe.offset))}catch(ae){U(ae)}},le}(be),Pi=function(q){var le=this;this.self=q,this.actor=new p.Actor(q,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:be,geojson:Ai},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(pe,U){if(le.workerSourceTypes[pe])throw new Error('Worker source with name "'+pe+'" already registered.');le.workerSourceTypes[pe]=U},this.self.registerRTLTextPlugin=function(pe){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=pe.applyArabicShaping,p.plugin.processBidirectionalText=pe.processBidirectionalText,p.plugin.processStyledBidirectionalText=pe.processStyledBidirectionalText}};return Pi.prototype.setReferrer=function(q,le){this.referrer=le},Pi.prototype.setImages=function(q,le,pe){for(var U in this.availableImages[q]=le,this.workerSources[q]){var ae=this.workerSources[q][U];for(var de in ae)ae[de].availableImages=le}pe()},Pi.prototype.setLayers=function(q,le,pe){this.getLayerIndex(q).replace(le),pe()},Pi.prototype.updateLayers=function(q,le,pe){this.getLayerIndex(q).update(le.layers,le.removedIds),pe()},Pi.prototype.loadTile=function(q,le,pe){this.getWorkerSource(q,le.type,le.source).loadTile(le,pe)},Pi.prototype.loadDEMTile=function(q,le,pe){this.getDEMWorkerSource(q,le.source).loadTile(le,pe)},Pi.prototype.reloadTile=function(q,le,pe){this.getWorkerSource(q,le.type,le.source).reloadTile(le,pe)},Pi.prototype.abortTile=function(q,le,pe){this.getWorkerSource(q,le.type,le.source).abortTile(le,pe)},Pi.prototype.removeTile=function(q,le,pe){this.getWorkerSource(q,le.type,le.source).removeTile(le,pe)},Pi.prototype.removeDEMTile=function(q,le){this.getDEMWorkerSource(q,le.source).removeTile(le)},Pi.prototype.removeSource=function(q,le,pe){if(this.workerSources[q]&&this.workerSources[q][le.type]&&this.workerSources[q][le.type][le.source]){var U=this.workerSources[q][le.type][le.source];delete this.workerSources[q][le.type][le.source],U.removeSource!==void 0?U.removeSource(le,pe):pe()}},Pi.prototype.loadWorkerSource=function(q,le,pe){try{this.self.importScripts(le.url),pe()}catch(U){pe(U.toString())}},Pi.prototype.syncRTLPluginState=function(q,le,pe){try{p.plugin.setState(le);var U=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&U!=null){this.self.importScripts(U);var ae=p.plugin.isParsed();pe(ae?void 0:new Error("RTL Text Plugin failed to import scripts from "+U),ae)}}catch(de){pe(de.toString())}},Pi.prototype.getAvailableImages=function(q){var le=this.availableImages[q];return le||(le=[]),le},Pi.prototype.getLayerIndex=function(q){var le=this.layerIndexes[q];return le||(le=this.layerIndexes[q]=new V),le},Pi.prototype.getWorkerSource=function(q,le,pe){var U=this;return this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][le]||(this.workerSources[q][le]={}),this.workerSources[q][le][pe]||(this.workerSources[q][le][pe]=new this.workerSourceTypes[le]({send:function(ae,de,Pe){U.actor.send(ae,de,Pe,q)}},this.getLayerIndex(q),this.getAvailableImages(q))),this.workerSources[q][le][pe]},Pi.prototype.getDEMWorkerSource=function(q,le){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][le]||(this.demWorkerSources[q][le]=new Je),this.demWorkerSources[q][le]},Pi.prototype.enforceCacheSizeLimit=function(q,le){p.enforceCacheSizeLimit(le)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Pi(self)),Pi}),b(["./shared"],function(p){"use strict";var E=p.createCommonjsModule(function(i){function u(_){return!o(_)}function o(_){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,N,K=new Blob([""],{type:"text/javascript"}),se=URL.createObjectURL(K);try{N=new Worker(se),P=!0}catch(Ce){P=!1}return N&&N.terminate(),URL.revokeObjectURL(se),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var N=P.getContext("2d");if(!N)return!1;var K=N.getImageData(0,0,1,1);return K&&K.width===P.width}()?(h[C=_&&_.failIfMajorPerformanceCaveat]===void 0&&(h[C]=function(P){var N=function(se){var Ce=document.createElement("canvas"),Ae=Object.create(u.webGLContextAttributes);return Ae.failIfMajorPerformanceCaveat=se,Ce.probablySupportsContext?Ce.probablySupportsContext("webgl",Ae)||Ce.probablySupportsContext("experimental-webgl",Ae):Ce.supportsContext?Ce.supportsContext("webgl",Ae)||Ce.supportsContext("experimental-webgl",Ae):Ce.getContext("webgl",Ae)||Ce.getContext("experimental-webgl",Ae)}(P);if(!N)return!1;var K=N.createShader(N.VERTEX_SHADER);return!(!K||N.isContextLost())&&(N.shaderSource(K,"void main() {}"),N.compileShader(K),N.getShaderParameter(K,N.COMPILE_STATUS)===!0)}(C)),h[C]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var C}i.exports?i.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=o);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Z={create:function(i,u,o){var h=p.window.document.createElement(i);return u!==void 0&&(h.className=u),o&&o.appendChild(h),h},createNS:function(i,u){return p.window.document.createElementNS(i,u)}},V=p.window.document&&p.window.document.documentElement.style;function G(i){if(!V)return i[0];for(var u=0;u<i.length;u++)if(i[u]in V)return i[u];return i[0]}var I,L=G(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Z.disableDrag=function(){V&&L&&(I=V[L],V[L]="none")},Z.enableDrag=function(){V&&L&&(V[L]=I)};var _e=G(["transform","WebkitTransform"]);Z.setTransform=function(i,u){i.style[_e]=u};var be=!1;try{var Le=Object.defineProperty({},"passive",{get:function(){be=!0}});p.window.addEventListener("test",Le,Le),p.window.removeEventListener("test",Le,Le)}catch(i){be=!1}Z.addEventListener=function(i,u,o,h){h===void 0&&(h={}),i.addEventListener(u,o,"passive"in h&&be?h:h.capture)},Z.removeEventListener=function(i,u,o,h){h===void 0&&(h={}),i.removeEventListener(u,o,"passive"in h&&be?h:h.capture)};var Je=function(i){i.preventDefault(),i.stopPropagation(),p.window.removeEventListener("click",Je,!0)};function Dt(i){var u=i.userImage;return!!(u&&u.render&&u.render())&&(i.data.replace(new Uint8Array(u.data.buffer)),!0)}Z.suppressClick=function(){p.window.addEventListener("click",Je,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",Je,!0)},0)},Z.mousePos=function(i,u){var o=i.getBoundingClientRect();return new p.Point(u.clientX-o.left-i.clientLeft,u.clientY-o.top-i.clientTop)},Z.touchPos=function(i,u){for(var o=i.getBoundingClientRect(),h=[],_=0;_<u.length;_++)h.push(new p.Point(u[_].clientX-o.left-i.clientLeft,u[_].clientY-o.top-i.clientTop));return h},Z.mouseButton=function(i){return p.window.InstallTrigger!==void 0&&i.button===2&&i.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:i.button},Z.remove=function(i){i.parentNode&&i.parentNode.removeChild(i)};var It=function(i){function u(){i.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(o){if(this.loaded!==o&&(this.loaded=o,o)){for(var h=0,_=this.requestors;h<_.length;h+=1){var C=_[h];this._notify(C.ids,C.callback)}this.requestors=[]}},u.prototype.getImage=function(o){return this.images[o]},u.prototype.addImage=function(o,h){this._validate(o,h)&&(this.images[o]=h)},u.prototype._validate=function(o,h){var _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchX" value'))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchY" value'))),_=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "content" value'))),_=!1),_},u.prototype._validateStretch=function(o,h){if(!o)return!0;for(var _=0,C=0,P=o;C<P.length;C+=1){var N=P[C];if(N[0]<_||N[1]<N[0]||h<N[1])return!1;_=N[1]}return!0},u.prototype._validateContent=function(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))},u.prototype.updateImage=function(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0},u.prototype.removeImage=function(o){var h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(o,h){var _=!0;if(!this.isLoaded())for(var C=0,P=o;C<P.length;C+=1)this.images[P[C]]||(_=!1);this.isLoaded()||_?this._notify(o,h):this.requestors.push({ids:o,callback:h})},u.prototype._notify=function(o,h){for(var _={},C=0,P=o;C<P.length;C+=1){var N=P[C];this.images[N]||this.fire(new p.Event("styleimagemissing",{id:N}));var K=this.images[N];K?_[N]={data:K.data.clone(),pixelRatio:K.pixelRatio,sdf:K.sdf,version:K.version,stretchX:K.stretchX,stretchY:K.stretchY,content:K.content,hasRenderCallback:Boolean(K.userImage&&K.userImage.render)}:p.warnOnce('Image "'+N+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,_)},u.prototype.getPixelSize=function(){var o=this.atlasImage;return{width:o.width,height:o.height}},u.prototype.getPattern=function(o){var h=this.patterns[o],_=this.getImage(o);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{var C={w:_.data.width+2,h:_.data.height+2,x:0,y:0},P=new p.ImagePosition(C,_);this.patterns[o]={bin:C,position:P}}return this._updatePatternAtlas(),this.patterns[o].position},u.prototype.bind=function(o){var h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var o=[];for(var h in this.patterns)o.push(this.patterns[h].bin);var _=p.potpack(o),C=_.w,P=_.h,N=this.atlasImage;for(var K in N.resize({width:C||1,height:P||1}),this.patterns){var se=this.patterns[K].bin,Ce=se.x+1,Ae=se.y+1,Ie=this.images[K].data,Ke=Ie.width,We=Ie.height;p.RGBAImage.copy(Ie,N,{x:0,y:0},{x:Ce,y:Ae},{width:Ke,height:We}),p.RGBAImage.copy(Ie,N,{x:0,y:We-1},{x:Ce,y:Ae-1},{width:Ke,height:1}),p.RGBAImage.copy(Ie,N,{x:0,y:0},{x:Ce,y:Ae+We},{width:Ke,height:1}),p.RGBAImage.copy(Ie,N,{x:Ke-1,y:0},{x:Ce-1,y:Ae},{width:1,height:We}),p.RGBAImage.copy(Ie,N,{x:0,y:0},{x:Ce+Ke,y:Ae},{width:1,height:We})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(o){for(var h=0,_=o;h<_.length;h+=1){var C=_[h];if(!this.callbackDispatchedThisFrame[C]){this.callbackDispatchedThisFrame[C]=!0;var P=this.images[C];Dt(P)&&this.updateImage(C,P)}}},u}(p.Evented),Ut=ct,xt=ct,bt=1e20;function ct(i,u,o,h,_,C){this.fontSize=i||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=_||"sans-serif",this.fontWeight=C||"normal",this.radius=o||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ir(i,u,o,h,_,C,P){for(var N=0;N<u;N++){for(var K=0;K<o;K++)h[K]=i[K*u+N];for(re(h,_,C,P,o),K=0;K<o;K++)i[K*u+N]=_[K]}for(K=0;K<o;K++){for(N=0;N<u;N++)h[N]=i[K*u+N];for(re(h,_,C,P,u),N=0;N<u;N++)i[K*u+N]=Math.sqrt(_[N])}}function re(i,u,o,h,_){o[0]=0,h[0]=-bt,h[1]=+bt;for(var C=1,P=0;C<_;C++){for(var N=(i[C]+C*C-(i[o[P]]+o[P]*o[P]))/(2*C-2*o[P]);N<=h[P];)P--,N=(i[C]+C*C-(i[o[P]]+o[P]*o[P]))/(2*C-2*o[P]);o[++P]=C,h[P]=N,h[P+1]=+bt}for(C=0,P=0;C<_;C++){for(;h[P+1]<C;)P++;u[C]=(C-o[P])*(C-o[P])+i[o[P]]}}ct.prototype.draw=function(i){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(i,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),o=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var _=u.data[4*h+3]/255;this.gridOuter[h]=_===1?0:_===0?bt:Math.pow(Math.max(0,.5-_),2),this.gridInner[h]=_===1?bt:_===0?0:Math.pow(Math.max(0,_-.5),2)}for(ir(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),ir(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)o[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return o},Ut.default=xt;var cr=function(i,u){this.requestManager=i,this.localIdeographFontFamily=u,this.entries={}};cr.prototype.setURL=function(i){this.url=i},cr.prototype.getGlyphs=function(i,u){var o=this,h=[];for(var _ in i)for(var C=0,P=i[_];C<P.length;C+=1)h.push({stack:_,id:P[C]});p.asyncAll(h,function(N,K){var se=N.stack,Ce=N.id,Ae=o.entries[se];Ae||(Ae=o.entries[se]={glyphs:{},requests:{},ranges:{}});var Ie=Ae.glyphs[Ce];if(Ie===void 0){if(Ie=o._tinySDF(Ae,se,Ce))return Ae.glyphs[Ce]=Ie,void K(null,{stack:se,id:Ce,glyph:Ie});var Ke=Math.floor(Ce/256);if(256*Ke>65535)K(new Error("glyphs > 65535 not supported"));else if(Ae.ranges[Ke])K(null,{stack:se,id:Ce,glyph:Ie});else{var We=Ae.requests[Ke];We||(We=Ae.requests[Ke]=[],cr.loadGlyphRange(se,Ke,o.url,o.requestManager,function(at,Ze){if(Ze){for(var st in Ze)o._doesCharSupportLocalGlyph(+st)||(Ae.glyphs[+st]=Ze[+st]);Ae.ranges[Ke]=!0}for(var St=0,Wt=We;St<Wt.length;St+=1)(0,Wt[St])(at,Ze);delete Ae.requests[Ke]})),We.push(function(at,Ze){at?K(at):Ze&&K(null,{stack:se,id:Ce,glyph:Ze[Ce]||null})})}}else K(null,{stack:se,id:Ce,glyph:Ie})},function(N,K){if(N)u(N);else if(K){for(var se={},Ce=0,Ae=K;Ce<Ae.length;Ce+=1){var Ie=Ae[Ce],Ke=Ie.stack,We=Ie.id,at=Ie.glyph;(se[Ke]||(se[Ke]={}))[We]=at&&{id:at.id,bitmap:at.bitmap.clone(),metrics:at.metrics}}u(null,se)}})},cr.prototype._doesCharSupportLocalGlyph=function(i){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](i)||p.isChar["Hangul Syllables"](i)||p.isChar.Hiragana(i)||p.isChar.Katakana(i))},cr.prototype._tinySDF=function(i,u,o){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(o)){var _=i.tinySDF;if(!_){var C="400";/bold/i.test(u)?C="900":/medium/i.test(u)?C="500":/light/i.test(u)&&(C="200"),_=i.tinySDF=new cr.TinySDF(24,3,8,.25,h,C)}return{id:o,bitmap:new p.AlphaImage({width:30,height:30},_.draw(String.fromCharCode(o))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},cr.loadGlyphRange=function(i,u,o,h,_){var C=256*u,P=C+255,N=h.transformRequest(h.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",C+"-"+P),p.ResourceType.Glyphs);p.getArrayBuffer(N,function(K,se){if(K)_(K);else if(se){for(var Ce={},Ae=0,Ie=p.parseGlyphPBF(se);Ae<Ie.length;Ae+=1){var Ke=Ie[Ae];Ce[Ke.id]=Ke}_(null,Ce)}})},cr.TinySDF=Ut;var Ct=function(){this.specification=p.styleSpec.light.position};Ct.prototype.possiblyEvaluate=function(i,u){return p.sphericalToCartesian(i.expression.evaluate(u))},Ct.prototype.interpolate=function(i,u,o){return{x:p.number(i.x,u.x,o),y:p.number(i.y,u.y,o),z:p.number(i.z,u.z,o)}};var Qe=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new Ct,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),Tt=function(i){function u(o){i.call(this),this._transitionable=new p.Transitionable(Qe),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(o,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,o,h))for(var _ in o){var C=o[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-"-transition".length),C):this._transitionable.setValue(_,C)}},u.prototype.updateTransitions=function(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(o){this.properties=this._transitioning.possiblyEvaluate(o)},u.prototype._validate=function(o,h,_){return(!_||_.validate!==!1)&&p.emitValidationErrors(this,o.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},u}(p.Evented),je=function(i,u){this.width=i,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};je.prototype.getDash=function(i,u){var o=i.join(",")+String(u);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(i,u)),this.dashEntry[o]},je.prototype.getDashRanges=function(i,u,o){var h=[],_=i.length%2==1?-i[i.length-1]*o:0,C=i[0]*o,P=!0;h.push({left:_,right:C,isDash:P,zeroLength:i[0]===0});for(var N=i[0],K=1;K<i.length;K++){var se=i[K];h.push({left:_=N*o,right:C=(N+=se)*o,isDash:P=!P,zeroLength:se===0})}return h},je.prototype.addRoundDash=function(i,u,o){for(var h=u/2,_=-o;_<=o;_++)for(var C=this.width*(this.nextRow+o+_),P=0,N=i[P],K=0;K<this.width;K++){K/N.right>1&&(N=i[++P]);var se=Math.abs(K-N.left),Ce=Math.abs(K-N.right),Ae=Math.min(se,Ce),Ie=void 0,Ke=_/o*(h+1);if(N.isDash){var We=h-Math.abs(Ke);Ie=Math.sqrt(Ae*Ae+We*We)}else Ie=h-Math.sqrt(Ae*Ae+Ke*Ke);this.data[C+K]=Math.max(0,Math.min(255,Ie+128))}},je.prototype.addRegularDash=function(i){for(var u=i.length-1;u>=0;--u){var o=i[u],h=i[u+1];o.zeroLength?i.splice(u,1):h&&h.isDash===o.isDash&&(h.left=o.left,i.splice(u,1))}var _=i[0],C=i[i.length-1];_.isDash===C.isDash&&(_.left=C.left-this.width,C.right=_.right+this.width);for(var P=this.width*this.nextRow,N=0,K=i[N],se=0;se<this.width;se++){se/K.right>1&&(K=i[++N]);var Ce=Math.abs(se-K.left),Ae=Math.abs(se-K.right),Ie=Math.min(Ce,Ae);this.data[P+se]=Math.max(0,Math.min(255,(K.isDash?Ie:-Ie)+128))}},je.prototype.addDash=function(i,u){var o=u?7:0,h=2*o+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var _=0,C=0;C<i.length;C++)_+=i[C];if(_!==0){var P=this.width/_,N=this.getDashRanges(i,this.width,P);u?this.addRoundDash(N,P,o):this.addRegularDash(N)}var K={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:_};return this.nextRow+=h,this.dirty=!0,K},je.prototype.bind=function(i){var u=i.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var Pt=function i(u,o){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),_=0;_<h.length;_++){var C=new i.Actor(h[_],o,this.id);C.name="Worker "+_,this.actors.push(C)}};function fr(i,u,o){var h=function(_,C){if(_)return o(_);if(C){var P=p.pick(p.extend(C,i),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(P.vectorLayers=C.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(N){return N.id})),P.tiles=u.canonicalizeTileset(P,i.url),o(null,P)}};return i.url?p.getJSON(u.transformRequest(u.normalizeSourceURL(i.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,i)})}Pt.prototype.broadcast=function(i,u,o){p.asyncAll(this.actors,function(h,_){h.send(i,u,_)},o=o||function(){})},Pt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Pt.prototype.remove=function(){this.actors.forEach(function(i){i.remove()}),this.actors=[],this.workerPool.release(this.id)},Pt.Actor=p.Actor;var $t=function(i,u,o){this.bounds=p.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=o||24};$t.prototype.validateBounds=function(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]},$t.prototype.contains=function(i){var u=Math.pow(2,i.z),o=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),_=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),C=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return i.x>=o&&i.x<_&&i.y>=h&&i.y<C};var zr=function(i){function u(o,h,_,C){if(i.call(this),this.id=o,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=fr(this._options,this.map._requestManager,function(h,_){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new p.ErrorEvent(h)):_&&(p.extend(o,_),_.bounds&&(o.tileBounds=new $t(_.bounds,o.minzoom,o.maxzoom)),p.postTurnstileEvent(_.tiles,o.map._requestManager._customAccessToken),p.postMapLoadEvent(_.tiles,o.map._getMapId(),o.map._requestManager._skuToken,o.map._requestManager._customAccessToken),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setSourceProperty=function(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(o){var h=this;return this.setSourceProperty(function(){h._options.tiles=o}),this},u.prototype.setUrl=function(o){var h=this;return this.setSourceProperty(function(){h.url=o,h._options.url=o}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.loadTile=function(o,h){var _=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(_,p.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(N,K){return delete o.request,o.aborted?h(null):N&&N.status!==404?h(N):(K&&K.resourceTiming&&(o.resourceTiming=K.resourceTiming),this.map._refreshExpiredTiles&&K&&o.setExpiryData(K),o.loadVectorData(K,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",C,P.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",C,P.bind(this)))},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(p.Evented),fe=function(i){function u(o,h,_,C){i.call(this),this.id=o,this.dispatcher=_,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=fr(this._options,this.map._requestManager,function(h,_){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new p.ErrorEvent(h)):_&&(p.extend(o,_),_.bounds&&(o.tileBounds=new $t(_.bounds,o.minzoom,o.maxzoom)),p.postTurnstileEvent(_.tiles),p.postMapLoadEvent(_.tiles,o.map._getMapId(),o.map._requestManager._skuToken),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.loadTile=function(o,h){var _=this,C=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);o.request=p.getImage(this.map._requestManager.transformRequest(C,p.ResourceType.Tile),function(P,N){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(P)o.state="errored",h(P);else if(N){_.map._refreshExpiredTiles&&o.setExpiryData(N),delete N.cacheControl,delete N.expires;var K=_.map.painter.context,se=K.gl;o.texture=_.map.painter.getTileTexture(N.width),o.texture?o.texture.update(N,{useMipmap:!0}):(o.texture=new p.Texture(K,N,se.RGBA,{useMipmap:!0}),o.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE,se.LINEAR_MIPMAP_NEAREST),K.extTextureFilterAnisotropic&&se.texParameterf(se.TEXTURE_2D,K.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,K.extTextureFilterAnisotropicMax)),o.state="loaded",p.cacheEntryPossiblyAdded(_.dispatcher),h(null)}})},u.prototype.abortTile=function(o,h){o.request&&(o.request.cancel(),delete o.request),h()},u.prototype.unloadTile=function(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()},u.prototype.hasTransition=function(){return!1},u}(p.Evented),ke=function(i){function u(o,h,_,C){i.call(this,o,h,_,C),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(o,h){var _=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function C(P,N){P&&(o.state="errored",h(P)),N&&(o.dem=N,o.needsHillshadePrepare=!0,o.state="loaded",h(null))}o.request=p.getImage(this.map._requestManager.transformRequest(_,p.ResourceType.Tile),function(P,N){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(P)o.state="errored",h(P);else if(N){this.map._refreshExpiredTiles&&o.setExpiryData(N),delete N.cacheControl,delete N.expires;var K=p.window.ImageBitmap&&N instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?N:p.browser.getImageData(N,1),se={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:K,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",se,C.bind(this)))}}.bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)},u.prototype._getNeighboringTiles=function(o){var h=o.canonical,_=Math.pow(2,h.z),C=(h.x-1+_)%_,P=h.x===0?o.wrap-1:o.wrap,N=(h.x+1+_)%_,K=h.x+1===_?o.wrap+1:o.wrap,se={};return se[new p.OverscaledTileID(o.overscaledZ,P,h.z,C,h.y).key]={backfilled:!1},se[new p.OverscaledTileID(o.overscaledZ,K,h.z,N,h.y).key]={backfilled:!1},h.y>0&&(se[new p.OverscaledTileID(o.overscaledZ,P,h.z,C,h.y-1).key]={backfilled:!1},se[new p.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},se[new p.OverscaledTileID(o.overscaledZ,K,h.z,N,h.y-1).key]={backfilled:!1}),h.y+1<_&&(se[new p.OverscaledTileID(o.overscaledZ,P,h.z,C,h.y+1).key]={backfilled:!1},se[new p.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},se[new p.OverscaledTileID(o.overscaledZ,K,h.z,N,h.y+1).key]={backfilled:!1}),se},u.prototype.unloadTile=function(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})},u}(fe),ge=function(i){function u(o,h,_,C){i.call(this),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=_.getActor(),this.setEventedParent(C),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var P=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*P,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*P,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*P,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)o.fire(new p.ErrorEvent(h));else{var _={dataType:"source",sourceDataType:"metadata"};o._collectResourceTiming&&o._resourceTiming&&o._resourceTiming.length>0&&(_.resourceTiming=o._resourceTiming,o._resourceTiming=[]),o.fire(new p.Event("data",_))}})},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setData=function(o){var h=this;return this._data=o,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(_){if(_)h.fire(new p.ErrorEvent(_));else{var C={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(C.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",C))}}),this},u.prototype.getClusterExpansionZoom=function(o,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},h),this},u.prototype.getClusterChildren=function(o,h){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},h),this},u.prototype.getClusterLeaves=function(o,h,_,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:h,offset:_},C),this},u.prototype._updateWorkerData=function(o){var h=this;this._loaded=!1;var _=p.extend({},this.workerOptions),C=this._data;typeof C=="string"?(_.request=this.map._requestManager.transformRequest(p.browser.resolveURL(C),p.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(C),this.actor.send(this.type+".loadData",_,function(P,N){h._removed||N&&N.abandoned||(h._loaded=!0,N&&N.resourceTiming&&N.resourceTiming[h.id]&&(h._resourceTiming=N.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:_.source},null),o(P))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(o,h){var _=this,C=o.actor?"reloadTile":"loadTile";o.actor=this.actor,o.request=this.actor.send(C,{type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,N){return delete o.request,o.unloadVectorData(),o.aborted?h(null):P?h(P):(o.loadVectorData(N,_.map.painter,C==="reloadTile"),h(null))})},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0},u.prototype.unloadTile=function(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(p.Evented),_t=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),vt=function(i){function u(o,h,_,C){i.call(this),this.id=o,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(o,h){var _=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(C,P){_._loaded=!0,C?_.fire(new p.ErrorEvent(C)):P&&(_.image=P,o&&(_.coordinates=o),h&&h(),_._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(o){var h=this;return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setCoordinates=function(o){var h=this;this.coordinates=o;var _=o.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var N=1/0,K=1/0,se=-1/0,Ce=-1/0,Ae=0,Ie=P;Ae<Ie.length;Ae+=1){var Ke=Ie[Ae];N=Math.min(N,Ke.x),K=Math.min(K,Ke.y),se=Math.max(se,Ke.x),Ce=Math.max(Ce,Ke.y)}var We=Math.max(se-N,Ce-K),at=Math.max(0,Math.floor(-Math.log(We)/Math.LN2)),Ze=Math.pow(2,at);return new p.CanonicalTileID(at,Math.floor((N+se)/2*Ze),Math.floor((K+Ce)/2*Ze))}(_),this.minzoom=this.maxzoom=this.tileID.z;var C=_.map(function(P){return h.tileID.getTilePoint(P)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(C[0].x,C[0].y,0,0),this._boundsArray.emplaceBack(C[1].x,C[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(C[3].x,C[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(C[2].x,C[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var o=this.map.painter.context,h=o.gl;for(var _ in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[_];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},u.prototype.loadTile=function(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(p.Evented),jt=function(i){function u(o,h,_,C){i.call(this,o,h,_,C),this.roundZoom=!0,this.type="video",this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1;var h=this.options;this.urls=[];for(var _=0,C=h.urls;_<C.length;_+=1)this.urls.push(this.map._requestManager.transformRequest(C[_],p.ResourceType.Source).url);p.getVideo(this.urls,function(P,N){o._loaded=!0,P?o.fire(new p.ErrorEvent(P)):N&&(o.video=N,o.video.loop=!0,o.video.addEventListener("playing",function(){o.map.triggerRepaint()}),o.map&&o.video.play(),o._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(o){if(this.video){var h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=o}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var o=this.map.painter.context,h=o.gl;for(var _ in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[_];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(vt),Bt=function(i){function u(o,h,_,C){i.call(this,o,h,_,C),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(N){return typeof N!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,_=h.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,_.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[C];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var o=0,h=[this.canvas.width,this.canvas.height];o<h.length;o+=1){var _=h[o];if(isNaN(_)||_<=0)return!0}return!1},u}(vt),Nr={vector:zr,raster:fe,"raster-dem":ke,geojson:ge,video:jt,image:vt,canvas:Bt};function pn(i,u){var o=p.identity([]);return p.translate(o,o,[1,1,0]),p.scale(o,o,[.5*i.width,.5*i.height,1]),p.multiply(o,o,i.calculatePosMatrix(u.toUnwrapped()))}function mn(i,u,o,h,_,C){var P=function(at,Ze,st){if(at)for(var St=0,Wt=at;St<Wt.length;St+=1){var xr=Ze[Wt[St]];if(xr&&xr.source===st&&xr.type==="fill-extrusion")return!0}else for(var hr in Ze){var Sr=Ze[hr];if(Sr.source===st&&Sr.type==="fill-extrusion")return!0}return!1}(_&&_.layers,u,i.id),N=C.maxPitchScaleFactor(),K=i.tilesIn(h,N,P);K.sort(Ni);for(var se=[],Ce=0,Ae=K;Ce<Ae.length;Ce+=1){var Ie=Ae[Ce];se.push({wrappedTileID:Ie.tileID.wrapped().key,queryResults:Ie.tile.queryRenderedFeatures(u,o,i._state,Ie.queryGeometry,Ie.cameraQueryGeometry,Ie.scale,_,C,N,pn(i.transform,Ie.tileID))})}var Ke=function(at){for(var Ze={},st={},St=0,Wt=at;St<Wt.length;St+=1){var xr=Wt[St],hr=xr.queryResults,Sr=xr.wrappedTileID,Gr=st[Sr]=st[Sr]||{};for(var sn in hr)for(var qr=hr[sn],Mn=Gr[sn]=Gr[sn]||{},ei=Ze[sn]=Ze[sn]||[],fi=0,ri=qr;fi<ri.length;fi+=1){var sa=ri[fi];Mn[sa.featureIndex]||(Mn[sa.featureIndex]=!0,ei.push(sa))}}return Ze}(se);for(var We in Ke)Ke[We].forEach(function(at){var Ze=at.feature,st=i.getFeatureState(Ze.layer["source-layer"],Ze.id);Ze.source=Ze.layer.source,Ze.layer["source-layer"]&&(Ze.sourceLayer=Ze.layer["source-layer"]),Ze.state=st});return Ke}function Ni(i,u){var o=i.tileID,h=u.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}var or=function(i,u){this.max=i,this.onRemove=u,this.reset()};or.prototype.reset=function(){for(var i in this.data)for(var u=0,o=this.data[i];u<o.length;u+=1){var h=o[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},or.prototype.add=function(i,u,o){var h=this,_=i.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);var C={value:u,timeout:void 0};if(o!==void 0&&(C.timeout=setTimeout(function(){h.remove(i,C)},o)),this.data[_].push(C),this.order.push(_),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},or.prototype.has=function(i){return i.wrapped().key in this.data},or.prototype.getAndRemove=function(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null},or.prototype._getAndRemoveByKey=function(i){var u=this.data[i].shift();return u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),u.value},or.prototype.getByKey=function(i){var u=this.data[i];return u?u[0].value:null},or.prototype.get=function(i){return this.has(i)?this.data[i.wrapped().key][0].value:null},or.prototype.remove=function(i,u){if(!this.has(i))return this;var o=i.wrapped().key,h=u===void 0?0:this.data[o].indexOf(u),_=this.data[o][h];return this.data[o].splice(h,1),_.timeout&&clearTimeout(_.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(_.value),this.order.splice(this.order.indexOf(o),1),this},or.prototype.setMaxSize=function(i){for(this.max=i;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},or.prototype.filter=function(i){var u=[];for(var o in this.data)for(var h=0,_=this.data[o];h<_.length;h+=1){var C=_[h];i(C.value)||u.push(C)}for(var P=0,N=u;P<N.length;P+=1){var K=N[P];this.remove(K.value.tileID,K)}};var ve=function(i,u,o){this.context=i;var h=i.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(o),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};ve.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ve.prototype.updateData=function(i){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)},ve.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Me={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ge=function(i,u,o,h){this.length=u.length,this.attributes=o,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=i;var _=i.gl;this.buffer=_.createBuffer(),i.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};Ge.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ge.prototype.updateData=function(i){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)},Ge.prototype.enableAttributes=function(i,u){for(var o=0;o<this.attributes.length;o++){var h=u.attributes[this.attributes[o].name];h!==void 0&&i.enableVertexAttribArray(h)}},Ge.prototype.setVertexAttribPointers=function(i,u,o){for(var h=0;h<this.attributes.length;h++){var _=this.attributes[h],C=u.attributes[_.name];C!==void 0&&i.vertexAttribPointer(C,_.components,i[Me[_.type]],!1,this.itemSize,_.offset+this.itemSize*(o||0))}},Ge.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Re=function(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Re.prototype.get=function(){return this.current},Re.prototype.set=function(i){},Re.prototype.getDefault=function(){return this.default},Re.prototype.setDefault=function(){this.set(this.default)};var kt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Re),rr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)},u}(Re),yr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)},u}(Re),Pr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Re),sr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)},u}(Re),Rr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)},u}(Re),w=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(o){var h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)},u}(Re),X=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)},u}(Re),Ue=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}},u}(Re),Ve=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Re),ot=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}},u}(Re),At=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)},u}(Re),Q=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}},u}(Re),Rt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.ONE,o.ZERO]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Re),dr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Re),Cr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)},u}(Re),Xe=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}},u}(Re),rt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)},u}(Re),wt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)},u}(Re),Ot=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)},u}(Re),gr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)},u}(Re),br=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Re),Xt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}},u}(Re),kr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(Re),Mr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}},u}(Re),un=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}},u}(Re),an=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1},u}(Re),Kn=function(i){function u(o){i.call(this,o),this.vao=o.extVertexArrayObject}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)},u}(Re),ti=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}},u}(Re),Qi=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}},u}(Re),Ai=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}},u}(Re),Pi=function(i){function u(o,h){i.call(this,o),this.context=o,this.parent=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(Re),q=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}},u}(Pi),le=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(Pi),pe=function(i,u,o,h){this.context=i,this.width=u,this.height=o;var _=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new q(i,_),h&&(this.depthAttachment=new le(i,_))};pe.prototype.destroy=function(){var i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){var o=this.depthAttachment.get();o&&i.deleteRenderbuffer(o)}i.deleteFramebuffer(this.framebuffer)};var U=function(i,u,o){this.func=i,this.mask=u,this.range=o};U.ReadOnly=!1,U.ReadWrite=!0,U.disabled=new U(519,U.ReadOnly,[0,1]);var ae=function(i,u,o,h,_,C){this.test=i,this.ref=u,this.mask=o,this.fail=h,this.depthFail=_,this.pass=C};ae.disabled=new ae({func:519,mask:0},0,0,7680,7680,7680);var de=function(i,u,o){this.blendFunction=i,this.blendColor=u,this.mask=o};de.disabled=new de(de.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),de.unblended=new de(de.Replace,p.Color.transparent,[!0,!0,!0,!0]),de.alphaBlended=new de([1,771],p.Color.transparent,[!0,!0,!0,!0]);var Pe=function(i,u,o){this.enable=i,this.mode=u,this.frontFace=o};Pe.disabled=new Pe(!1,1029,2305),Pe.backCCW=new Pe(!0,1029,2305);var ue=function(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new kt(this),this.clearDepth=new rr(this),this.clearStencil=new yr(this),this.colorMask=new Pr(this),this.depthMask=new sr(this),this.stencilMask=new Rr(this),this.stencilFunc=new w(this),this.stencilOp=new X(this),this.stencilTest=new Ue(this),this.depthRange=new Ve(this),this.depthTest=new ot(this),this.depthFunc=new At(this),this.blend=new Q(this),this.blendFunc=new Rt(this),this.blendColor=new dr(this),this.blendEquation=new Cr(this),this.cullFace=new Xe(this),this.cullFaceSide=new rt(this),this.frontFace=new wt(this),this.program=new Ot(this),this.activeTexture=new gr(this),this.viewport=new br(this),this.bindFramebuffer=new Xt(this),this.bindRenderbuffer=new kr(this),this.bindTexture=new Mr(this),this.bindVertexBuffer=new un(this),this.bindElementBuffer=new an(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Kn(this),this.pixelStoreUnpack=new ti(this),this.pixelStoreUnpackPremultiplyAlpha=new Qi(this),this.pixelStoreUnpackFlipY=new Ai(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)};ue.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ue.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ue.prototype.createIndexBuffer=function(i,u){return new ve(this,i,u)},ue.prototype.createVertexBuffer=function(i,u,o){return new Ge(this,i,u,o)},ue.prototype.createRenderbuffer=function(i,u,o){var h=this.gl,_=h.createRenderbuffer();return this.bindRenderbuffer.set(_),h.renderbufferStorage(h.RENDERBUFFER,i,u,o),this.bindRenderbuffer.set(null),_},ue.prototype.createFramebuffer=function(i,u,o){return new pe(this,i,u,o)},ue.prototype.clear=function(i){var u=i.color,o=i.depth,h=this.gl,_=0;u&&(_|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(_|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h.clear(_)},ue.prototype.setCullFace=function(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))},ue.prototype.setDepthMode=function(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)},ue.prototype.setStencilMode=function(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)},ue.prototype.setColorMode=function(i){p.deepEqual(i.blendFunction,de.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)},ue.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ee=function(i){function u(o,h,_){var C=this;i.call(this),this.id=o,this.dispatcher=_,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(C._sourceLoaded=!0),C._sourceLoaded&&!C._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(C.reload(),C.transform&&C.update(C.transform))}),this.on("error",function(){C._sourceErrored=!0}),this._source=function(P,N,K,se){var Ce=new Nr[N.type](P,N,K,se);if(Ce.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+Ce.id);return p.bindAll(["load","abort","unload","serialize","prepare"],Ce),Ce}(o,h,_,this),this._tiles={},this._cache=new or(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)},u.prototype.onRemove=function(o){this._source&&this._source.onRemove&&this._source.onRemove(o)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var o in this._tiles){var h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(o,h){return this._source.loadTile(o,h)},u.prototype._unloadTile=function(o){if(this._source.unloadTile)return this._source.unloadTile(o,function(){})},u.prototype._abortTile=function(o){if(this._source.abortTile)return this._source.abortTile(o,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(o){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var _=this._tiles[h];_.upload(o),_.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return p.values(this._tiles).map(function(o){return o.tileID}).sort(mt).map(function(o){return o.key})},u.prototype.getRenderableIds=function(o){var h=this,_=[];for(var C in this._tiles)this._isIdRenderable(C,o)&&_.push(this._tiles[C]);return o?_.sort(function(P,N){var K=P.tileID,se=N.tileID,Ce=new p.Point(K.canonical.x,K.canonical.y)._rotate(h.transform.angle),Ae=new p.Point(se.canonical.x,se.canonical.y)._rotate(h.transform.angle);return K.overscaledZ-se.overscaledZ||Ae.y-Ce.y||Ae.x-Ce.x}).map(function(P){return P.tileID.key}):_.map(function(P){return P.tileID}).sort(mt).map(function(P){return P.key})},u.prototype.hasRenderableParent=function(o){var h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var o in this._cache.reset(),this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")},u.prototype._reloadTile=function(o,h){var _=this._tiles[o];_&&(_.state!=="loading"&&(_.state=h),this._loadTile(_,this._tileLoaded.bind(this,_,o,h)))},u.prototype._tileLoaded=function(o,h,_,C){if(C)return o.state="errored",void(C.status!==404?this._source.fire(new p.ErrorEvent(C,{tile:o})):this.update(this.transform));o.timeAdded=p.browser.now(),_==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:o,coord:o.tileID}))},u.prototype._backfillDEM=function(o){for(var h=this.getRenderableIds(),_=0;_<h.length;_++){var C=h[_];if(o.neighboringTiles&&o.neighboringTiles[C]){var P=this.getTileByID(C);N(o,P),N(P,o)}}function N(K,se){K.needsHillshadePrepare=!0;var Ce=se.tileID.canonical.x-K.tileID.canonical.x,Ae=se.tileID.canonical.y-K.tileID.canonical.y,Ie=Math.pow(2,K.tileID.canonical.z),Ke=se.tileID.key;Ce===0&&Ae===0||Math.abs(Ae)>1||(Math.abs(Ce)>1&&(Math.abs(Ce+Ie)===1?Ce+=Ie:Math.abs(Ce-Ie)===1&&(Ce-=Ie)),se.dem&&K.dem&&(K.dem.backfillBorder(se.dem,Ce,Ae),K.neighboringTiles&&K.neighboringTiles[Ke]&&(K.neighboringTiles[Ke].backfilled=!0)))}},u.prototype.getTile=function(o){return this.getTileByID(o.key)},u.prototype.getTileByID=function(o){return this._tiles[o]},u.prototype._retainLoadedChildren=function(o,h,_,C){for(var P in this._tiles){var N=this._tiles[P];if(!(C[P]||!N.hasData()||N.tileID.overscaledZ<=h||N.tileID.overscaledZ>_)){for(var K=N.tileID;N&&N.tileID.overscaledZ>h+1;){var se=N.tileID.scaledTo(N.tileID.overscaledZ-1);(N=this._tiles[se.key])&&N.hasData()&&(K=se)}for(var Ce=K;Ce.overscaledZ>h;)if(o[(Ce=Ce.scaledTo(Ce.overscaledZ-1)).key]){C[K.key]=K;break}}}},u.prototype.findLoadedParent=function(o,h){if(o.key in this._loadedParentTiles){var _=this._loadedParentTiles[o.key];return _&&_.tileID.overscaledZ>=h?_:null}for(var C=o.overscaledZ-1;C>=h;C--){var P=o.scaledTo(C),N=this._getLoadedTile(P);if(N)return N}},u.prototype._getLoadedTile=function(o){var h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)},u.prototype.updateCacheSize=function(o){var h=Math.ceil(o.width/this._source.tileSize)+1,_=Math.ceil(o.height/this._source.tileSize)+1,C=Math.floor(h*_*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(P)},u.prototype.handleWrapJump=function(o){var h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){var _={};for(var C in this._tiles){var P=this._tiles[C];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),_[P.tileID.key]=P}for(var N in this._tiles=_,this._timers)clearTimeout(this._timers[N]),delete this._timers[N];for(var K in this._tiles)this._setTileReloadTimer(K,this._tiles[K])}},u.prototype.update=function(o){var h=this;if(this.transform=o,this._sourceLoaded&&!this._paused){var _;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?_=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Gr){return new p.OverscaledTileID(Gr.canonical.z,Gr.wrap,Gr.canonical.z,Gr.canonical.x,Gr.canonical.y)}):(_=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(_=_.filter(function(Gr){return h._source.hasTile(Gr)}))):_=[];var C=o.coveringZoomLevel(this._source),P=Math.max(C-u.maxOverzooming,this._source.minzoom),N=Math.max(C+u.maxUnderzooming,this._source.minzoom),K=this._updateRetainedTiles(_,C);if(wr(this._source.type)){for(var se={},Ce={},Ae=0,Ie=Object.keys(K);Ae<Ie.length;Ae+=1){var Ke=Ie[Ae],We=K[Ke],at=this._tiles[Ke];if(at&&!(at.fadeEndTime&&at.fadeEndTime<=p.browser.now())){var Ze=this.findLoadedParent(We,P);Ze&&(this._addTile(Ze.tileID),se[Ze.tileID.key]=Ze.tileID),Ce[Ke]=We}}for(var st in this._retainLoadedChildren(Ce,C,N,K),se)K[st]||(this._coveredTiles[st]=!0,K[st]=se[st])}for(var St in K)this._tiles[St].clearFadeHold();for(var Wt=0,xr=p.keysDifference(this._tiles,K);Wt<xr.length;Wt+=1){var hr=xr[Wt],Sr=this._tiles[hr];Sr.hasSymbolBuckets&&!Sr.holdingForFade()?Sr.setHoldDuration(this.map._fadeDuration):Sr.hasSymbolBuckets&&!Sr.symbolFadeFinished()||this._removeTile(hr)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)},u.prototype._updateRetainedTiles=function(o,h){for(var _={},C={},P=Math.max(h-u.maxOverzooming,this._source.minzoom),N=Math.max(h+u.maxUnderzooming,this._source.minzoom),K={},se=0,Ce=o;se<Ce.length;se+=1){var Ae=Ce[se],Ie=this._addTile(Ae);_[Ae.key]=Ae,Ie.hasData()||h<this._source.maxzoom&&(K[Ae.key]=Ae)}this._retainLoadedChildren(K,h,N,_);for(var Ke=0,We=o;Ke<We.length;Ke+=1){var at=We[Ke],Ze=this._tiles[at.key];if(!Ze.hasData()){if(h+1>this._source.maxzoom){var st=at.children(this._source.maxzoom)[0],St=this.getTile(st);if(St&&St.hasData()){_[st.key]=st;continue}}else{var Wt=at.children(this._source.maxzoom);if(_[Wt[0].key]&&_[Wt[1].key]&&_[Wt[2].key]&&_[Wt[3].key])continue}for(var xr=Ze.wasRequested(),hr=at.overscaledZ-1;hr>=P;--hr){var Sr=at.scaledTo(hr);if(C[Sr.key]||(C[Sr.key]=!0,!(Ze=this.getTile(Sr))&&xr&&(Ze=this._addTile(Sr)),Ze&&(_[Sr.key]=Sr,xr=Ze.wasRequested(),Ze.hasData())))break}}}return _},u.prototype._updateLoadedParentTileCache=function(){for(var o in this._loadedParentTiles={},this._tiles){for(var h=[],_=void 0,C=this._tiles[o].tileID;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){_=this._loadedParentTiles[C.key];break}h.push(C.key);var P=C.scaledTo(C.overscaledZ-1);if(_=this._getLoadedTile(P))break;C=P}for(var N=0,K=h;N<K.length;N+=1)this._loadedParentTiles[K[N]]=_}},u.prototype._addTile=function(o){var h=this._tiles[o.key];if(h)return h;(h=this._cache.getAndRemove(o))&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));var _=Boolean(h);return _||(h=new p.Tile(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))),h?(h.uses++,this._tiles[o.key]=h,_||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(o,h){var _=this;o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);var C=h.getExpiryTimeout();C&&(this._timers[o]=setTimeout(function(){_._reloadTile(o,"expired"),delete _._timers[o]},C))},u.prototype._removeTile=function(o){var h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var o in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(o);this._cache.reset()},u.prototype.tilesIn=function(o,h,_){var C=this,P=[],N=this.transform;if(!N)return P;for(var K=_?N.getCameraQueryGeometry(o):o,se=o.map(function(hr){return N.pointCoordinate(hr)}),Ce=K.map(function(hr){return N.pointCoordinate(hr)}),Ae=this.getIds(),Ie=1/0,Ke=1/0,We=-1/0,at=-1/0,Ze=0,st=Ce;Ze<st.length;Ze+=1){var St=st[Ze];Ie=Math.min(Ie,St.x),Ke=Math.min(Ke,St.y),We=Math.max(We,St.x),at=Math.max(at,St.y)}for(var Wt=function(hr){var Sr=C._tiles[Ae[hr]];if(!Sr.holdingForFade()){var Gr=Sr.tileID,sn=Math.pow(2,N.zoom-Sr.tileID.overscaledZ),qr=h*Sr.queryPadding*p.EXTENT/Sr.tileSize/sn,Mn=[Gr.getTilePoint(new p.MercatorCoordinate(Ie,Ke)),Gr.getTilePoint(new p.MercatorCoordinate(We,at))];if(Mn[0].x-qr<p.EXTENT&&Mn[0].y-qr<p.EXTENT&&Mn[1].x+qr>=0&&Mn[1].y+qr>=0){var ei=se.map(function(ri){return Gr.getTilePoint(ri)}),fi=Ce.map(function(ri){return Gr.getTilePoint(ri)});P.push({tile:Sr,tileID:Gr,queryGeometry:ei,cameraQueryGeometry:fi,scale:sn})}}},xr=0;xr<Ae.length;xr++)Wt(xr);return P},u.prototype.getVisibleCoordinates=function(o){for(var h=this,_=this.getRenderableIds(o).map(function(K){return h._tiles[K].tileID}),C=0,P=_;C<P.length;C+=1){var N=P[C];N.posMatrix=this.transform.calculatePosMatrix(N.toUnwrapped())}return _},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(wr(this._source.type))for(var o in this._tiles){var h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},u.prototype.setFeatureState=function(o,h,_){this._state.updateState(o=o||"_geojsonTileLayer",h,_)},u.prototype.removeFeatureState=function(o,h,_){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,_)},u.prototype.getFeatureState=function(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(o,h,_){var C=this._tiles[o];C&&C.setDependencies(h,_)},u.prototype.reloadTilesForDependencies=function(o,h){for(var _ in this._tiles)this._tiles[_].hasDependency(o,h)&&this._reloadTile(_,"reloading");this._cache.filter(function(C){return!C.hasDependency(o,h)})},u}(p.Evented);function mt(i,u){var o=Math.abs(2*i.wrap)-+(i.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return i.overscaledZ-u.overscaledZ||h-o||u.canonical.y-i.canonical.y||u.canonical.x-i.canonical.x}function wr(i){return i==="raster"||i==="image"||i==="video"}function Yt(){return new p.window.Worker(Yu.workerUrl)}Ee.maxOverzooming=10,Ee.maxUnderzooming=3;var tr="mapboxgl_preloaded_worker_pool",Ur=function(){this.active={}};Ur.prototype.acquire=function(i){if(!this.workers)for(this.workers=[];this.workers.length<Ur.workerCount;)this.workers.push(new Yt);return this.active[i]=!0,this.workers.slice()},Ur.prototype.release=function(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},Ur.prototype.isPreloaded=function(){return!!this.active[tr]},Ur.prototype.numActive=function(){return Object.keys(this.active).length};var Fn,Rn=Math.floor(p.browser.hardwareConcurrency/2);function qt(){return Fn||(Fn=new Ur),Fn}function Tn(i,u){var o={};for(var h in i)h!=="ref"&&(o[h]=i[h]);return p.refProperties.forEach(function(_){_ in u&&(o[_]=u[_])}),o}function ln(i){i=i.slice();for(var u=Object.create(null),o=0;o<i.length;o++)u[i[o].id]=i[o];for(var h=0;h<i.length;h++)"ref"in i[h]&&(i[h]=Tn(i[h],u[i[h].ref]));return i}Ur.workerCount=Math.max(Math.min(Rn,6),1);var on={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Li(i,u,o){o.push({command:on.addSource,args:[i,u[i]]})}function bn(i,u,o){u.push({command:on.removeSource,args:[i]}),o[i]=!0}function Ii(i,u,o,h){bn(i,o,h),Li(i,u,o)}function ea(i,u,o){var h;for(h in i[o])if(i[o].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(i[o][h],u[o][h]))return!1;for(h in u[o])if(u[o].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(i[o][h],u[o][h]))return!1;return!0}function ci(i,u,o,h,_,C){var P;for(P in u=u||{},i=i||{})i.hasOwnProperty(P)&&(p.deepEqual(i[P],u[P])||o.push({command:C,args:[h,P,u[P],_]}));for(P in u)u.hasOwnProperty(P)&&!i.hasOwnProperty(P)&&(p.deepEqual(i[P],u[P])||o.push({command:C,args:[h,P,u[P],_]}))}function qi(i){return i.id}function zi(i,u){return i[u.id]=u,i}var Mi=function(i,u){this.reset(i,u)};Mi.prototype.reset=function(i,u){this.points=i||[],this._distances=[0];for(var o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Mi.prototype.lerp=function(i){if(this.points.length===1)return this.points[0];i=p.clamp(i,0,1);for(var u=1,o=this._distances[u],h=i*this.paddedLength+this.padding;o<h&&u<this._distances.length;)o=this._distances[++u];var _=u-1,C=this._distances[_],P=o-C,N=P>0?(h-C)/P:0;return this.points[_].mult(1-N).add(this.points[u].mult(N))};var la=function(i,u,o){var h=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/o),this.yCellCount=Math.ceil(u/o);for(var C=0;C<this.xCellCount*this.yCellCount;C++)h.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function Bi(i,u,o,h,_){var C=p.create();return u?(p.scale(C,C,[1/_,1/_,1]),o||p.rotateZ(C,C,h.angle)):p.multiply(C,h.labelPlaneMatrix,i),C}function ai(i,u,o,h,_){if(u){var C=p.clone(i);return p.scale(C,C,[_,_,1]),o||p.rotateZ(C,C,-h.angle),C}return h.glCoordMatrix}function ki(i,u){var o=[i.x,i.y,0,1];Wa(o,o,u);var h=o[3];return{point:new p.Point(o[0]/h,o[1]/h),signedDistanceFromCamera:h}}function wi(i,u){return .5+i/u*.5}function ro(i,u){var o=i[0]/i[3],h=i[1]/i[3];return o>=-u[0]&&o<=u[0]&&h>=-u[1]&&h<=u[1]}function po(i,u,o,h,_,C,P,N){var K=h?i.textSizeData:i.iconSizeData,se=p.evaluateSizeForZoom(K,o.transform.zoom),Ce=[256/o.width*2+1,256/o.height*2+1],Ae=h?i.text.dynamicLayoutVertexArray:i.icon.dynamicLayoutVertexArray;Ae.clear();for(var Ie=i.lineVertexArray,Ke=h?i.text.placedSymbolArray:i.icon.placedSymbolArray,We=o.transform.width/o.transform.height,at=!1,Ze=0;Ze<Ke.length;Ze++){var st=Ke.get(Ze);if(st.hidden||st.writingMode===p.WritingMode.vertical&&!at)Hi(st.numGlyphs,Ae);else{at=!1;var St=[st.anchorX,st.anchorY,0,1];if(p.transformMat4(St,St,u),ro(St,Ce)){var Wt=wi(o.transform.cameraToCenterDistance,St[3]),xr=p.evaluateSizeForFeature(K,se,st),hr=P?xr/Wt:xr*Wt,Sr=new p.Point(st.anchorX,st.anchorY),Gr=ki(Sr,_).point,sn={},qr=Zs(st,hr,!1,N,u,_,C,i.glyphOffsetArray,Ie,Ae,Gr,Sr,sn,We);at=qr.useVertical,(qr.notEnoughRoom||at||qr.needsFlipping&&Zs(st,hr,!0,N,u,_,C,i.glyphOffsetArray,Ie,Ae,Gr,Sr,sn,We).notEnoughRoom)&&Hi(st.numGlyphs,Ae)}else Hi(st.numGlyphs,Ae)}}h?i.text.dynamicLayoutVertexBuffer.updateData(Ae):i.icon.dynamicLayoutVertexBuffer.updateData(Ae)}function ia(i,u,o,h,_,C,P,N,K,se,Ce){var Ae=N.glyphStartIndex+N.numGlyphs,Ie=N.lineStartIndex,Ke=N.lineStartIndex+N.lineLength,We=u.getoffsetX(N.glyphStartIndex),at=u.getoffsetX(Ae-1),Ze=Aa(i*We,o,h,_,C,P,N.segment,Ie,Ke,K,se,Ce);if(!Ze)return null;var st=Aa(i*at,o,h,_,C,P,N.segment,Ie,Ke,K,se,Ce);return st?{first:Ze,last:st}:null}function Gi(i,u,o,h){return i===p.WritingMode.horizontal&&Math.abs(o.y-u.y)>Math.abs(o.x-u.x)*h?{useVertical:!0}:(i===p.WritingMode.vertical?u.y<o.y:u.x>o.x)?{needsFlipping:!0}:null}function Zs(i,u,o,h,_,C,P,N,K,se,Ce,Ae,Ie,Ke){var We,at=u/24,Ze=i.lineOffsetX*at,st=i.lineOffsetY*at;if(i.numGlyphs>1){var St=i.glyphStartIndex+i.numGlyphs,Wt=i.lineStartIndex,xr=i.lineStartIndex+i.lineLength,hr=ia(at,N,Ze,st,o,Ce,Ae,i,K,C,Ie);if(!hr)return{notEnoughRoom:!0};var Sr=ki(hr.first.point,P).point,Gr=ki(hr.last.point,P).point;if(h&&!o){var sn=Gi(i.writingMode,Sr,Gr,Ke);if(sn)return sn}We=[hr.first];for(var qr=i.glyphStartIndex+1;qr<St-1;qr++)We.push(Aa(at*N.getoffsetX(qr),Ze,st,o,Ce,Ae,i.segment,Wt,xr,K,C,Ie));We.push(hr.last)}else{if(h&&!o){var Mn=ki(Ae,_).point,ei=i.lineStartIndex+i.segment+1,fi=new p.Point(K.getx(ei),K.gety(ei)),ri=ki(fi,_),sa=ri.signedDistanceFromCamera>0?ri.point:nu(Ae,fi,Mn,1,_),Vn=Gi(i.writingMode,Mn,sa,Ke);if(Vn)return Vn}var Si=Aa(at*N.getoffsetX(i.glyphStartIndex),Ze,st,o,Ce,Ae,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,K,C,Ie);if(!Si)return{notEnoughRoom:!0};We=[Si]}for(var Ui=0,ee=We;Ui<ee.length;Ui+=1){var ne=ee[Ui];p.addDynamicAttributes(se,ne.point,ne.angle)}return{}}function nu(i,u,o,h,_){var C=ki(i.add(i.sub(u)._unit()),_).point,P=o.sub(C);return o.add(P._mult(h/P.mag()))}function Aa(i,u,o,h,_,C,P,N,K,se,Ce,Ae){var Ie=h?i-u:i+u,Ke=Ie>0?1:-1,We=0;h&&(Ke*=-1,We=Math.PI),Ke<0&&(We+=Math.PI);for(var at=Ke>0?N+P:N+P+1,Ze=_,st=_,St=0,Wt=0,xr=Math.abs(Ie),hr=[];St+Wt<=xr;){if((at+=Ke)<N||at>=K)return null;if(st=Ze,hr.push(Ze),(Ze=Ae[at])===void 0){var Sr=new p.Point(se.getx(at),se.gety(at)),Gr=ki(Sr,Ce);if(Gr.signedDistanceFromCamera>0)Ze=Ae[at]=Gr.point;else{var sn=at-Ke;Ze=nu(St===0?C:new p.Point(se.getx(sn),se.gety(sn)),Sr,st,xr-St+1,Ce)}}St+=Wt,Wt=st.dist(Ze)}var qr=(xr-St)/Wt,Mn=Ze.sub(st),ei=Mn.mult(qr)._add(st);ei._add(Mn._unit()._perp()._mult(o*Ke));var fi=We+Math.atan2(Ze.y-st.y,Ze.x-st.x);return hr.push(ei),{point:ei,angle:fi,path:hr}}la.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},la.prototype.insert=function(i,u,o,h,_){this._forEachCell(u,o,h,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(_)},la.prototype.insertCircle=function(i,u,o,h){this._forEachCell(u-h,o-h,u+h,o+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(o),this.circles.push(h)},la.prototype._insertBoxCell=function(i,u,o,h,_,C){this.boxCells[_].push(C)},la.prototype._insertCircleCell=function(i,u,o,h,_,C){this.circleCells[_].push(C)},la.prototype._query=function(i,u,o,h,_,C){if(o<0||i>this.width||h<0||u>this.height)return!_&&[];var P=[];if(i<=0&&u<=0&&this.width<=o&&this.height<=h){if(_)return!0;for(var N=0;N<this.boxKeys.length;N++)P.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(var K=0;K<this.circleKeys.length;K++){var se=this.circles[3*K],Ce=this.circles[3*K+1],Ae=this.circles[3*K+2];P.push({key:this.circleKeys[K],x1:se-Ae,y1:Ce-Ae,x2:se+Ae,y2:Ce+Ae})}return C?P.filter(C):P}return this._forEachCell(i,u,o,h,this._queryCell,P,{hitTest:_,seenUids:{box:{},circle:{}}},C),_?P.length>0:P},la.prototype._queryCircle=function(i,u,o,h,_){var C=i-o,P=i+o,N=u-o,K=u+o;if(P<0||C>this.width||K<0||N>this.height)return!h&&[];var se=[];return this._forEachCell(C,N,P,K,this._queryCellCircle,se,{hitTest:h,circle:{x:i,y:u,radius:o},seenUids:{box:{},circle:{}}},_),h?se.length>0:se},la.prototype.query=function(i,u,o,h,_){return this._query(i,u,o,h,!1,_)},la.prototype.hitTest=function(i,u,o,h,_){return this._query(i,u,o,h,!0,_)},la.prototype.hitTestCircle=function(i,u,o,h){return this._queryCircle(i,u,o,!0,h)},la.prototype._queryCell=function(i,u,o,h,_,C,P,N){var K=P.seenUids,se=this.boxCells[_];if(se!==null)for(var Ce=this.bboxes,Ae=0,Ie=se;Ae<Ie.length;Ae+=1){var Ke=Ie[Ae];if(!K.box[Ke]){K.box[Ke]=!0;var We=4*Ke;if(i<=Ce[We+2]&&u<=Ce[We+3]&&o>=Ce[We+0]&&h>=Ce[We+1]&&(!N||N(this.boxKeys[Ke]))){if(P.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Ke],x1:Ce[We],y1:Ce[We+1],x2:Ce[We+2],y2:Ce[We+3]})}}}var at=this.circleCells[_];if(at!==null)for(var Ze=this.circles,st=0,St=at;st<St.length;st+=1){var Wt=St[st];if(!K.circle[Wt]){K.circle[Wt]=!0;var xr=3*Wt;if(this._circleAndRectCollide(Ze[xr],Ze[xr+1],Ze[xr+2],i,u,o,h)&&(!N||N(this.circleKeys[Wt]))){if(P.hitTest)return C.push(!0),!0;var hr=Ze[xr],Sr=Ze[xr+1],Gr=Ze[xr+2];C.push({key:this.circleKeys[Wt],x1:hr-Gr,y1:Sr-Gr,x2:hr+Gr,y2:Sr+Gr})}}}},la.prototype._queryCellCircle=function(i,u,o,h,_,C,P,N){var K=P.circle,se=P.seenUids,Ce=this.boxCells[_];if(Ce!==null)for(var Ae=this.bboxes,Ie=0,Ke=Ce;Ie<Ke.length;Ie+=1){var We=Ke[Ie];if(!se.box[We]){se.box[We]=!0;var at=4*We;if(this._circleAndRectCollide(K.x,K.y,K.radius,Ae[at+0],Ae[at+1],Ae[at+2],Ae[at+3])&&(!N||N(this.boxKeys[We])))return C.push(!0),!0}}var Ze=this.circleCells[_];if(Ze!==null)for(var st=this.circles,St=0,Wt=Ze;St<Wt.length;St+=1){var xr=Wt[St];if(!se.circle[xr]){se.circle[xr]=!0;var hr=3*xr;if(this._circlesCollide(st[hr],st[hr+1],st[hr+2],K.x,K.y,K.radius)&&(!N||N(this.circleKeys[xr])))return C.push(!0),!0}}},la.prototype._forEachCell=function(i,u,o,h,_,C,P,N){for(var K=this._convertToXCellCoord(i),se=this._convertToYCellCoord(u),Ce=this._convertToXCellCoord(o),Ae=this._convertToYCellCoord(h),Ie=K;Ie<=Ce;Ie++)for(var Ke=se;Ke<=Ae;Ke++)if(_.call(this,i,u,o,h,this.xCellCount*Ke+Ie,C,P,N))return},la.prototype._convertToXCellCoord=function(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))},la.prototype._convertToYCellCoord=function(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))},la.prototype._circlesCollide=function(i,u,o,h,_,C){var P=h-i,N=_-u,K=o+C;return K*K>P*P+N*N},la.prototype._circleAndRectCollide=function(i,u,o,h,_,C,P){var N=(C-h)/2,K=Math.abs(i-(h+N));if(K>N+o)return!1;var se=(P-_)/2,Ce=Math.abs(u-(_+se));if(Ce>se+o)return!1;if(K<=N||Ce<=se)return!0;var Ae=K-N,Ie=Ce-se;return Ae*Ae+Ie*Ie<=o*o};var No=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Hi(i,u){for(var o=0;o<i;o++){var h=u.length;u.resize(h+4),u.float32.set(No,3*h)}}function Wa(i,u,o){var h=u[0],_=u[1];return i[0]=o[0]*h+o[4]*_+o[12],i[1]=o[1]*h+o[5]*_+o[13],i[3]=o[3]*h+o[7]*_+o[15],i}var ao=function(i,u,o){u===void 0&&(u=new la(i.width+200,i.height+200,25)),o===void 0&&(o=new la(i.width+200,i.height+200,25)),this.transform=i,this.grid=u,this.ignoredGrid=o,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+100,this.screenBottomBoundary=i.height+100,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200};function ga(i,u,o){return u*(p.EXTENT/(i.tileSize*Math.pow(2,o-i.tileID.overscaledZ)))}ao.prototype.placeCollisionBox=function(i,u,o,h,_){var C=this.projectAndGetPerspectiveRatio(h,i.anchorPointX,i.anchorPointY),P=o*C.perspectiveRatio,N=i.x1*P+C.point.x,K=i.y1*P+C.point.y,se=i.x2*P+C.point.x,Ce=i.y2*P+C.point.y;return!this.isInsideGrid(N,K,se,Ce)||!u&&this.grid.hitTest(N,K,se,Ce,_)?{box:[],offscreen:!1}:{box:[N,K,se,Ce],offscreen:this.isOffscreen(N,K,se,Ce)}},ao.prototype.placeCollisionCircles=function(i,u,o,h,_,C,P,N,K,se,Ce,Ae,Ie){var Ke=[],We=new p.Point(u.anchorX,u.anchorY),at=ki(We,C),Ze=wi(this.transform.cameraToCenterDistance,at.signedDistanceFromCamera),st=(se?_/Ze:_*Ze)/p.ONE_EM,St=ki(We,P).point,Wt=ia(st,h,u.lineOffsetX*st,u.lineOffsetY*st,!1,St,We,u,o,P,{}),xr=!1,hr=!1,Sr=!0;if(Wt){for(var Gr=.5*Ae*Ze+Ie,sn=new p.Point(-100,-100),qr=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),Mn=new Mi,ei=Wt.first,fi=Wt.last,ri=[],sa=ei.path.length-1;sa>=1;sa--)ri.push(ei.path[sa]);for(var Vn=1;Vn<fi.path.length;Vn++)ri.push(fi.path[Vn]);var Si=2.5*Gr;if(N){var Ui=ri.map(function(Ki){return ki(Ki,N)});ri=Ui.some(function(Ki){return Ki.signedDistanceFromCamera<=0})?[]:Ui.map(function(Ki){return Ki.point})}var ee=[];if(ri.length>0){for(var ne=ri[0].clone(),k=ri[0].clone(),F=1;F<ri.length;F++)ne.x=Math.min(ne.x,ri[F].x),ne.y=Math.min(ne.y,ri[F].y),k.x=Math.max(k.x,ri[F].x),k.y=Math.max(k.y,ri[F].y);ee=ne.x>=sn.x&&k.x<=qr.x&&ne.y>=sn.y&&k.y<=qr.y?[ri]:k.x<sn.x||ne.x>qr.x||k.y<sn.y||ne.y>qr.y?[]:p.clipLine([ri],sn.x,sn.y,qr.x,qr.y)}for(var ie=0,Te=ee;ie<Te.length;ie+=1){var ft;Mn.reset(Te[ie],.25*Gr),ft=Mn.length<=.5*Gr?1:Math.ceil(Mn.paddedLength/Si)+1;for(var Gt=0;Gt<ft;Gt++){var Et=Gt/Math.max(ft-1,1),Qt=Mn.lerp(Et),Fr=Qt.x+100,Bn=Qt.y+100;Ke.push(Fr,Bn,Gr,0);var zn=Fr-Gr,hi=Bn-Gr,ui=Fr+Gr,yi=Bn+Gr;if(Sr=Sr&&this.isOffscreen(zn,hi,ui,yi),hr=hr||this.isInsideGrid(zn,hi,ui,yi),!i&&this.grid.hitTestCircle(Fr,Bn,Gr,Ce)&&(xr=!0,!K))return{circles:[],offscreen:!1,collisionDetected:xr}}}}return{circles:!K&&xr||!hr?[]:Ke,offscreen:Sr,collisionDetected:xr}},ao.prototype.queryRenderedSymbols=function(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],o=1/0,h=1/0,_=-1/0,C=-1/0,P=0,N=i;P<N.length;P+=1){var K=N[P],se=new p.Point(K.x+100,K.y+100);o=Math.min(o,se.x),h=Math.min(h,se.y),_=Math.max(_,se.x),C=Math.max(C,se.y),u.push(se)}for(var Ce={},Ae={},Ie=0,Ke=this.grid.query(o,h,_,C).concat(this.ignoredGrid.query(o,h,_,C));Ie<Ke.length;Ie+=1){var We=Ke[Ie],at=We.key;if(Ce[at.bucketInstanceId]===void 0&&(Ce[at.bucketInstanceId]={}),!Ce[at.bucketInstanceId][at.featureIndex]){var Ze=[new p.Point(We.x1,We.y1),new p.Point(We.x2,We.y1),new p.Point(We.x2,We.y2),new p.Point(We.x1,We.y2)];p.polygonIntersectsPolygon(u,Ze)&&(Ce[at.bucketInstanceId][at.featureIndex]=!0,Ae[at.bucketInstanceId]===void 0&&(Ae[at.bucketInstanceId]=[]),Ae[at.bucketInstanceId].push(at.featureIndex))}}return Ae},ao.prototype.insertCollisionBox=function(i,u,o,h,_){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:h,collisionGroupID:_},i[0],i[1],i[2],i[3])},ao.prototype.insertCollisionCircles=function(i,u,o,h,_){for(var C=u?this.ignoredGrid:this.grid,P={bucketInstanceId:o,featureIndex:h,collisionGroupID:_},N=0;N<i.length;N+=4)C.insertCircle(P,i[N],i[N+1],i[N+2])},ao.prototype.projectAndGetPerspectiveRatio=function(i,u,o){var h=[u,o,0,1];return Wa(h,h,i),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},ao.prototype.isOffscreen=function(i,u,o,h){return o<100||i>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},ao.prototype.isInsideGrid=function(i,u,o,h){return o>=0&&i<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},ao.prototype.getViewportMatrix=function(){var i=p.identity([]);return p.translate(i,i,[-100,-100,0]),i};var Lo=function(i,u,o,h){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):h&&o?1:0,this.placed=o};Lo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Fa=function(i,u,o,h,_){this.text=new Lo(i?i.text:null,u,o,_),this.icon=new Lo(i?i.icon:null,u,h,_)};Fa.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Cs=function(i,u,o){this.text=i,this.icon=u,this.skipFade=o},Fi=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},Ko=function(i,u,o,h,_){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=o,this.bucketIndex=h,this.tileID=_},ya=function(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}};function vo(i,u,o,h,_){var C=p.getAnchorAlignment(i),P=-(C.horizontalAlign-.5)*u,N=-(C.verticalAlign-.5)*o,K=p.evaluateVariableOffset(i,h);return new p.Point(P+K[0]*_,N+K[1]*_)}function Da(i,u,o,h,_,C){var P=i.x1,N=i.x2,K=i.y1,se=i.y2,Ce=i.anchorPointX,Ae=i.anchorPointY,Ie=new p.Point(u,o);return h&&Ie._rotate(_?C:-C),{x1:P+Ie.x,y1:K+Ie.y,x2:N+Ie.x,y2:se+Ie.y,anchorPointX:Ce,anchorPointY:Ae}}ya.prototype.get=function(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){var u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:function(o){return o.collisionGroupID===u}}}return this.collisionGroups[i]};var So=function(i,u,o,h){this.transform=i.clone(),this.collisionIndex=new ao(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ya(o),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function xe(i,u,o,h,_){i.emplaceBack(u?1:0,o?1:0,h||0,_||0),i.emplaceBack(u?1:0,o?1:0,h||0,_||0),i.emplaceBack(u?1:0,o?1:0,h||0,_||0),i.emplaceBack(u?1:0,o?1:0,h||0,_||0)}So.prototype.getBucketParts=function(i,u,o,h){var _=o.getBucket(u),C=o.latestFeatureIndex;if(_&&C&&u.id===_.layerIds[0]){var P=o.collisionBoxArray,N=_.layers[0].layout,K=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),se=o.tileSize/p.EXTENT,Ce=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),Ae=N.get("text-pitch-alignment")==="map",Ie=N.get("text-rotation-alignment")==="map",Ke=ga(o,1,this.transform.zoom),We=Bi(Ce,Ae,Ie,this.transform,Ke),at=null;if(Ae){var Ze=ai(Ce,Ae,Ie,this.transform,Ke);at=p.multiply([],this.transform.labelPlaneMatrix,Ze)}this.retainedQueryData[_.bucketInstanceId]=new Ko(_.bucketInstanceId,C,_.sourceLayerIndex,_.index,o.tileID);var st={bucket:_,layout:N,posMatrix:Ce,textLabelPlaneMatrix:We,labelToScreenMatrix:at,scale:K,textPixelRatio:se,holdingForFade:o.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(h)for(var St=0,Wt=_.sortKeyRanges;St<Wt.length;St+=1){var xr=Wt[St];i.push({sortKey:xr.sortKey,symbolInstanceStart:xr.symbolInstanceStart,symbolInstanceEnd:xr.symbolInstanceEnd,parameters:st})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:st})}},So.prototype.attemptAnchorPlacement=function(i,u,o,h,_,C,P,N,K,se,Ce,Ae,Ie,Ke,We){var at,Ze=[Ae.textOffset0,Ae.textOffset1],st=vo(i,o,h,Ze,_),St=this.collisionIndex.placeCollisionBox(Da(u,st.x,st.y,C,P,this.transform.angle),Ce,N,K,se.predicate);if(!We||this.collisionIndex.placeCollisionBox(Da(We,st.x,st.y,C,P,this.transform.angle),Ce,N,K,se.predicate).box.length!==0)return St.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Ae.crossTileID]&&this.prevPlacement.placements[Ae.crossTileID]&&this.prevPlacement.placements[Ae.crossTileID].text&&(at=this.prevPlacement.variableOffsets[Ae.crossTileID].anchor),this.variableOffsets[Ae.crossTileID]={textOffset:Ze,width:o,height:h,anchor:i,textBoxScale:_,prevAnchor:at},this.markUsedJustification(Ie,i,Ae,Ke),Ie.allowVerticalPlacement&&(this.markUsedOrientation(Ie,Ke,Ae),this.placedOrientations[Ae.crossTileID]=Ke),{shift:st,placedGlyphBoxes:St}):void 0},So.prototype.placeLayerBucketPart=function(i,u,o){var h=this,_=i.parameters,C=_.bucket,P=_.layout,N=_.posMatrix,K=_.textLabelPlaneMatrix,se=_.labelToScreenMatrix,Ce=_.textPixelRatio,Ae=_.holdingForFade,Ie=_.collisionBoxArray,Ke=_.partiallyEvaluatedTextSize,We=_.collisionGroup,at=P.get("text-optional"),Ze=P.get("icon-optional"),st=P.get("text-allow-overlap"),St=P.get("icon-allow-overlap"),Wt=P.get("text-rotation-alignment")==="map",xr=P.get("text-pitch-alignment")==="map",hr=P.get("icon-text-fit")!=="none",Sr=P.get("symbol-z-order")==="viewport-y",Gr=st&&(St||!C.hasIconData()||Ze),sn=St&&(st||!C.hasTextData()||at);!C.collisionArrays&&Ie&&C.deserializeCollisionBoxes(Ie);var qr=function(Vn,Si){if(!u[Vn.crossTileID])if(Ae)h.placements[Vn.crossTileID]=new Cs(!1,!1,!1);else{var Ui,ee=!1,ne=!1,k=!0,F=null,ie={box:null,offscreen:null},Te={box:null,offscreen:null},ft=null,Gt=null,Et=0,Qt=0,Fr=0;Si.textFeatureIndex?Et=Si.textFeatureIndex:Vn.useRuntimeCollisionCircles&&(Et=Vn.featureIndex),Si.verticalTextFeatureIndex&&(Qt=Si.verticalTextFeatureIndex);var Bn=Si.textBox;if(Bn){var zn=function(Zi){var $o=p.WritingMode.horizontal;if(C.allowVerticalPlacement&&!Zi&&h.prevPlacement){var Po=h.prevPlacement.placedOrientations[Vn.crossTileID];Po&&(h.placedOrientations[Vn.crossTileID]=Po,h.markUsedOrientation(C,$o=Po,Vn))}return $o},hi=function(Zi,$o){if(C.allowVerticalPlacement&&Vn.numVerticalGlyphVertices>0&&Si.verticalTextBox)for(var Po=0,To=C.writingModes;Po<To.length&&(To[Po]===p.WritingMode.vertical?(ie=$o(),Te=ie):ie=Zi(),!(ie&&ie.box&&ie.box.length));Po+=1);else ie=Zi()};if(P.get("text-variable-anchor")){var ui=P.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[Vn.crossTileID]){var yi=h.prevPlacement.variableOffsets[Vn.crossTileID];ui.indexOf(yi.anchor)>0&&(ui=ui.filter(function(Zi){return Zi!==yi.anchor})).unshift(yi.anchor)}var Ki=function(Zi,$o,Po){for(var To=Zi.x2-Zi.x1,Ac=Zi.y2-Zi.y1,Du=Vn.textBoxScale,Ku=hr&&!St?$o:null,$u={box:[],offscreen:!1},Ol=st?2*ui.length:ui.length,Ju=0;Ju<Ol;++Ju){var pl=h.attemptAnchorPlacement(ui[Ju%ui.length],Zi,To,Ac,Du,Wt,xr,Ce,N,We,Ju>=ui.length,Vn,C,Po,Ku);if(pl&&($u=pl.placedGlyphBoxes)&&$u.box&&$u.box.length){ee=!0,F=pl.shift;break}}return $u};hi(function(){return Ki(Bn,Si.iconBox,p.WritingMode.horizontal)},function(){var Zi=Si.verticalTextBox;return C.allowVerticalPlacement&&!(ie&&ie.box&&ie.box.length)&&Vn.numVerticalGlyphVertices>0&&Zi?Ki(Zi,Si.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),ie&&(ee=ie.box,k=ie.offscreen);var _a=zn(ie&&ie.box);if(!ee&&h.prevPlacement){var xa=h.prevPlacement.variableOffsets[Vn.crossTileID];xa&&(h.variableOffsets[Vn.crossTileID]=xa,h.markUsedJustification(C,xa.anchor,Vn,_a))}}else{var Ya=function(Zi,$o){var Po=h.collisionIndex.placeCollisionBox(Zi,st,Ce,N,We.predicate);return Po&&Po.box&&Po.box.length&&(h.markUsedOrientation(C,$o,Vn),h.placedOrientations[Vn.crossTileID]=$o),Po};hi(function(){return Ya(Bn,p.WritingMode.horizontal)},function(){var Zi=Si.verticalTextBox;return C.allowVerticalPlacement&&Vn.numVerticalGlyphVertices>0&&Zi?Ya(Zi,p.WritingMode.vertical):{box:null,offscreen:null}}),zn(ie&&ie.box&&ie.box.length)}}if(ee=(Ui=ie)&&Ui.box&&Ui.box.length>0,k=Ui&&Ui.offscreen,Vn.useRuntimeCollisionCircles){var Na=C.text.placedSymbolArray.get(Vn.centerJustifiedTextSymbolIndex),wo=p.evaluateSizeForFeature(C.textSizeData,Ke,Na),La=P.get("text-padding");ft=h.collisionIndex.placeCollisionCircles(st,Na,C.lineVertexArray,C.glyphOffsetArray,wo,N,K,se,o,xr,We.predicate,Vn.collisionCircleDiameter,La),ee=st||ft.circles.length>0&&!ft.collisionDetected,k=k&&ft.offscreen}if(Si.iconFeatureIndex&&(Fr=Si.iconFeatureIndex),Si.iconBox){var Ea=function(Zi){var $o=hr&&F?Da(Zi,F.x,F.y,Wt,xr,h.transform.angle):Zi;return h.collisionIndex.placeCollisionBox($o,St,Ce,N,We.predicate)};ne=Te&&Te.box&&Te.box.length&&Si.verticalIconBox?(Gt=Ea(Si.verticalIconBox)).box.length>0:(Gt=Ea(Si.iconBox)).box.length>0,k=k&&Gt.offscreen}var fa=at||Vn.numHorizontalGlyphVertices===0&&Vn.numVerticalGlyphVertices===0,ma=Ze||Vn.numIconVertices===0;if(fa||ma?ma?fa||(ne=ne&&ee):ee=ne&&ee:ne=ee=ne&&ee,ee&&Ui&&Ui.box&&h.collisionIndex.insertCollisionBox(Ui.box,P.get("text-ignore-placement"),C.bucketInstanceId,Te&&Te.box&&Qt?Qt:Et,We.ID),ne&&Gt&&h.collisionIndex.insertCollisionBox(Gt.box,P.get("icon-ignore-placement"),C.bucketInstanceId,Fr,We.ID),ft&&(ee&&h.collisionIndex.insertCollisionCircles(ft.circles,P.get("text-ignore-placement"),C.bucketInstanceId,Et,We.ID),o)){var Ga=C.bucketInstanceId,za=h.collisionCircleArrays[Ga];za===void 0&&(za=h.collisionCircleArrays[Ga]=new Fi);for(var ko=0;ko<ft.circles.length;ko+=4)za.circles.push(ft.circles[ko+0]),za.circles.push(ft.circles[ko+1]),za.circles.push(ft.circles[ko+2]),za.circles.push(ft.collisionDetected?1:0)}h.placements[Vn.crossTileID]=new Cs(ee||Gr,ne||sn,k||C.justReloaded),u[Vn.crossTileID]=!0}};if(Sr)for(var Mn=C.getSortedSymbolIndexes(this.transform.angle),ei=Mn.length-1;ei>=0;--ei){var fi=Mn[ei];qr(C.symbolInstances.get(fi),C.collisionArrays[fi])}else for(var ri=i.symbolInstanceStart;ri<i.symbolInstanceEnd;ri++)qr(C.symbolInstances.get(ri),C.collisionArrays[ri]);if(o&&C.bucketInstanceId in this.collisionCircleArrays){var sa=this.collisionCircleArrays[C.bucketInstanceId];p.invert(sa.invProjMatrix,N),sa.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1},So.prototype.markUsedJustification=function(i,u,o,h){var _;_=h===p.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];for(var C=0,P=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];C<P.length;C+=1){var N=P[C];N>=0&&(i.text.placedSymbolArray.get(N).crossTileID=_>=0&&N!==_?0:o.crossTileID)}},So.prototype.markUsedOrientation=function(i,u,o){for(var h=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,_=u===p.WritingMode.vertical?u:0,C=0,P=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];C<P.length;C+=1)i.text.placedSymbolArray.get(P[C]).placedOrientation=h;o.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=_)},So.prototype.commit=function(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,o=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(i):1,_=u?u.opacities:{},C=u?u.variableOffsets:{},P=u?u.placedOrientations:{};for(var N in this.placements){var K=this.placements[N],se=_[N];se?(this.opacities[N]=new Fa(se,h,K.text,K.icon),o=o||K.text!==se.text.placed||K.icon!==se.icon.placed):(this.opacities[N]=new Fa(null,h,K.text,K.icon,K.skipFade),o=o||K.text||K.icon)}for(var Ce in _){var Ae=_[Ce];if(!this.opacities[Ce]){var Ie=new Fa(Ae,h,!1,!1);Ie.isHidden()||(this.opacities[Ce]=Ie,o=o||Ae.text.placed||Ae.icon.placed)}}for(var Ke in C)this.variableOffsets[Ke]||!this.opacities[Ke]||this.opacities[Ke].isHidden()||(this.variableOffsets[Ke]=C[Ke]);for(var We in P)this.placedOrientations[We]||!this.opacities[We]||this.opacities[We].isHidden()||(this.placedOrientations[We]=P[We]);o?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)},So.prototype.updateLayerOpacities=function(i,u){for(var o={},h=0,_=u;h<_.length;h+=1){var C=_[h],P=C.getBucket(i);P&&C.latestFeatureIndex&&i.id===P.layerIds[0]&&this.updateBucketOpacities(P,o,C.collisionBoxArray)}},So.prototype.updateBucketOpacities=function(i,u,o){var h=this;i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();var _=i.layers[0].layout,C=new Fa(null,0,!1,!1,!0),P=_.get("text-allow-overlap"),N=_.get("icon-allow-overlap"),K=_.get("text-variable-anchor"),se=_.get("text-rotation-alignment")==="map",Ce=_.get("text-pitch-alignment")==="map",Ae=_.get("icon-text-fit")!=="none",Ie=new Fa(null,0,P&&(N||!i.hasIconData()||_.get("icon-optional")),N&&(P||!i.hasTextData()||_.get("text-optional")),!0);!i.collisionArrays&&o&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(o);for(var Ke=function(st,St,Wt){for(var xr=0;xr<St/4;xr++)st.opacityVertexArray.emplaceBack(Wt)},We=function(st){var St=i.symbolInstances.get(st),Wt=St.numHorizontalGlyphVertices,xr=St.numVerticalGlyphVertices,hr=St.crossTileID,Sr=h.opacities[hr];u[hr]?Sr=C:Sr||(h.opacities[hr]=Sr=Ie),u[hr]=!0;var Gr=St.numIconVertices>0,sn=h.placedOrientations[St.crossTileID],qr=sn===p.WritingMode.vertical,Mn=sn===p.WritingMode.horizontal||sn===p.WritingMode.horizontalOnly;if(Wt>0||xr>0){var ei=mo(Sr.text);Ke(i.text,Wt,qr?oo:ei),Ke(i.text,xr,Mn?oo:ei);var fi=Sr.text.isHidden();[St.rightJustifiedTextSymbolIndex,St.centerJustifiedTextSymbolIndex,St.leftJustifiedTextSymbolIndex].forEach(function(ie){ie>=0&&(i.text.placedSymbolArray.get(ie).hidden=fi||qr?1:0)}),St.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(St.verticalPlacedTextSymbolIndex).hidden=fi||Mn?1:0);var ri=h.variableOffsets[St.crossTileID];ri&&h.markUsedJustification(i,ri.anchor,St,sn);var sa=h.placedOrientations[St.crossTileID];sa&&(h.markUsedJustification(i,"left",St,sa),h.markUsedOrientation(i,sa,St))}if(Gr){var Vn=mo(Sr.icon),Si=!(Ae&&St.verticalPlacedIconSymbolIndex&&qr);St.placedIconSymbolIndex>=0&&(Ke(i.icon,St.numIconVertices,Si?Vn:oo),i.icon.placedSymbolArray.get(St.placedIconSymbolIndex).hidden=Sr.icon.isHidden()),St.verticalPlacedIconSymbolIndex>=0&&(Ke(i.icon,St.numVerticalIconVertices,Si?oo:Vn),i.icon.placedSymbolArray.get(St.verticalPlacedIconSymbolIndex).hidden=Sr.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){var Ui=i.collisionArrays[st];if(Ui){var ee=new p.Point(0,0);if(Ui.textBox||Ui.verticalTextBox){var ne=!0;if(K){var k=h.variableOffsets[hr];k?(ee=vo(k.anchor,k.width,k.height,k.textOffset,k.textBoxScale),se&&ee._rotate(Ce?h.transform.angle:-h.transform.angle)):ne=!1}Ui.textBox&&xe(i.textCollisionBox.collisionVertexArray,Sr.text.placed,!ne||qr,ee.x,ee.y),Ui.verticalTextBox&&xe(i.textCollisionBox.collisionVertexArray,Sr.text.placed,!ne||Mn,ee.x,ee.y)}var F=Boolean(!Mn&&Ui.verticalIconBox);Ui.iconBox&&xe(i.iconCollisionBox.collisionVertexArray,Sr.icon.placed,F,Ae?ee.x:0,Ae?ee.y:0),Ui.verticalIconBox&&xe(i.iconCollisionBox.collisionVertexArray,Sr.icon.placed,!F,Ae?ee.x:0,Ae?ee.y:0)}}},at=0;at<i.symbolInstances.length;at++)We(at);if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){var Ze=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Ze.invProjMatrix,i.placementViewportMatrix=Ze.viewportMatrix,i.collisionCircleArray=Ze.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}},So.prototype.symbolFadeChange=function(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},So.prototype.zoomAdjustment=function(i){return Math.max(0,(this.transform.zoom-i)/1.5)},So.prototype.hasTransitions=function(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration},So.prototype.stillRecent=function(i,u){var o=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*o>i},So.prototype.setStale=function(){this.stale=!0};var Fe=Math.pow(2,25),pt=Math.pow(2,24),Jt=Math.pow(2,17),Yr=Math.pow(2,16),Qn=Math.pow(2,9),Ci=Math.pow(2,8),Za=Math.pow(2,1);function mo(i){if(i.opacity===0&&!i.placed)return 0;if(i.opacity===1&&i.placed)return 4294967295;var u=i.placed?1:0,o=Math.floor(127*i.opacity);return o*Fe+u*pt+o*Jt+u*Yr+o*Qn+u*Ci+o*Za+u}var oo=0,es=function(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};es.prototype.continuePlacement=function(i,u,o,h,_){for(var C=this._bucketParts;this._currentTileIndex<i.length;)if(u.getBucketParts(C,h,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(function(P,N){return P.sortKey-N.sortKey}));this._currentPartIndex<C.length;)if(u.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,_())return!0;return!1};var $s=function(i,u,o,h,_,C,P){this.placement=new So(i,_,C,P),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=h,this._done=!1};$s.prototype.isDone=function(){return this._done},$s.prototype.continuePlacement=function(i,u,o){for(var h=this,_=p.browser.now(),C=function(){var K=p.browser.now()-_;return!h._forceFullPlacement&&K>2};this._currentPlacementIndex>=0;){var P=u[i[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=N)&&(!P.maxzoom||P.maxzoom>N)){if(this._inProgressLayer||(this._inProgressLayer=new es(P)),this._inProgressLayer.continuePlacement(o[P.source],this.placement,this._showCollisionBoxes,P,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},$s.prototype.commit=function(i){return this.placement.commit(i),this.placement};var ja=512/p.EXTENT/2,Fu=function(i,u,o){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=o;for(var h=0;h<u.length;h++){var _=u.get(h),C=_.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,i)})}};Fu.prototype.getScaledCoordinates=function(i,u){var o=ja/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+i.anchorX)*o),y:Math.floor((u.canonical.y*p.EXTENT+i.anchorY)*o)}},Fu.prototype.findMatches=function(i,u,o){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),_=0;_<i.length;_++){var C=i.get(_);if(!C.crossTileID){var P=this.indexedSymbolInstances[C.key];if(P)for(var N=this.getScaledCoordinates(C,u),K=0,se=P;K<se.length;K+=1){var Ce=se[K];if(Math.abs(Ce.coord.x-N.x)<=h&&Math.abs(Ce.coord.y-N.y)<=h&&!o[Ce.crossTileID]){o[Ce.crossTileID]=!0,C.crossTileID=Ce.crossTileID;break}}}}};var ts=function(){this.maxCrossTileID=0};ts.prototype.generate=function(){return++this.maxCrossTileID};var zo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};zo.prototype.handleWrapJump=function(i){var u=Math.round((i-this.lng)/360);if(u!==0)for(var o in this.indexes){var h=this.indexes[o],_={};for(var C in h){var P=h[C];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+u),_[P.tileID.key]=P}this.indexes[o]=_}this.lng=i},zo.prototype.addBucket=function(i,u,o){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});var _=this.usedCrossTileIDs[i.overscaledZ];for(var C in this.indexes){var P=this.indexes[C];if(Number(C)>i.overscaledZ)for(var N in P){var K=P[N];K.tileID.isChildOf(i)&&K.findMatches(u.symbolInstances,i,_)}else{var se=P[i.scaledTo(Number(C)).key];se&&se.findMatches(u.symbolInstances,i,_)}}for(var Ce=0;Ce<u.symbolInstances.length;Ce++){var Ae=u.symbolInstances.get(Ce);Ae.crossTileID||(Ae.crossTileID=o.generate(),_[Ae.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Fu(i,u.symbolInstances,u.bucketInstanceId),!0},zo.prototype.removeBucketCrossTileIDs=function(i,u){for(var o in u.indexedSymbolInstances)for(var h=0,_=u.indexedSymbolInstances[o];h<_.length;h+=1)delete this.usedCrossTileIDs[i][_[h].crossTileID]},zo.prototype.removeStaleBuckets=function(i){var u=!1;for(var o in this.indexes){var h=this.indexes[o];for(var _ in h)i[h[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,h[_]),delete h[_],u=!0)}return u};var so=function(){this.layerIndexes={},this.crossTileIDs=new ts,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};so.prototype.addLayer=function(i,u,o){var h=this.layerIndexes[i.id];h===void 0&&(h=this.layerIndexes[i.id]=new zo);var _=!1,C={};h.handleWrapJump(o);for(var P=0,N=u;P<N.length;P+=1){var K=N[P],se=K.getBucket(i);se&&i.id===se.layerIds[0]&&(se.bucketInstanceId||(se.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(K.tileID,se,this.crossTileIDs)&&(_=!0),C[se.bucketInstanceId]=!0)}return h.removeStaleBuckets(C)&&(_=!0),_},so.prototype.pruneUnusedLayers=function(i){var u={};for(var o in i.forEach(function(h){u[h]=!0}),this.layerIndexes)u[o]||delete this.layerIndexes[o]};var oi=function(i,u){return p.emitValidationErrors(i,u&&u.filter(function(o){return o.identifier!=="source.canvas"}))},ys=p.pick(on,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),rs=p.pick(on,["setCenter","setZoom","setBearing","setPitch"]),Bs=function(){var i={},u=p.styleSpec.$version;for(var o in p.styleSpec.$root){var h,_=p.styleSpec.$root[o];_.required&&(h=o==="version"?u:_.type==="array"?[]:{})!=null&&(i[o]=h)}return i}(),ns=function(i){function u(o,h){var _=this;h===void 0&&(h={}),i.call(this),this.map=o,this.dispatcher=new Pt(qt(),this),this.imageManager=new It,this.imageManager.setEventedParent(this),this.glyphManager=new cr(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new je(256,512),this.crossTileSymbolIndex=new so,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var C=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(P){C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(N,K){if(p.triggerPluginCompletionEvent(N),K&&K.every(function(Ce){return Ce}))for(var se in C.sourceCaches)C.sourceCaches[se].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var N=_.sourceCaches[P.sourceId];if(N){var K=N.getSource();if(K&&K.vectorLayerIds)for(var se in _._layers){var Ce=_._layers[se];Ce.source===K.id&&_._validateLayer(Ce)}}}})}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.loadURL=function(o,h){var _=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var C=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,h.accessToken);var P=this.map._requestManager.transformRequest(o,p.ResourceType.Style);this._request=p.getJSON(P,function(N,K){_._request=null,N?_.fire(new p.ErrorEvent(N)):K&&_._load(K,C)})},u.prototype.loadJSON=function(o,h){var _=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){_._request=null,_._load(o,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Bs,!1)},u.prototype._load=function(o,h){if(!h||!oi(this,p.validateStyle(o))){for(var _ in this._loaded=!0,this.stylesheet=o,o.sources)this.addSource(_,o.sources[_],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);var C=ln(this.stylesheet.layers);this._order=C.map(function(se){return se.id}),this._layers={},this._serializedLayers={};for(var P=0,N=C;P<N.length;P+=1){var K=N[P];(K=p.createStyleLayer(K)).setEventedParent(this,{layer:{id:K.id}}),this._layers[K.id]=K,this._serializedLayers[K.id]=K.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Tt(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},u.prototype._loadSprite=function(o){var h=this;this._spriteRequest=function(_,C,P){var N,K,se,Ce=p.browser.devicePixelRatio>1?"@2x":"",Ae=p.getJSON(C.transformRequest(C.normalizeSpriteURL(_,Ce,".json"),p.ResourceType.SpriteJSON),function(We,at){Ae=null,se||(se=We,N=at,Ke())}),Ie=p.getImage(C.transformRequest(C.normalizeSpriteURL(_,Ce,".png"),p.ResourceType.SpriteImage),function(We,at){Ie=null,se||(se=We,K=at,Ke())});function Ke(){if(se)P(se);else if(N&&K){var We=p.browser.getImageData(K),at={};for(var Ze in N){var st=N[Ze],St=st.width,Wt=st.height,xr=st.x,hr=st.y,Sr=st.sdf,Gr=st.pixelRatio,sn=st.stretchX,qr=st.stretchY,Mn=st.content,ei=new p.RGBAImage({width:St,height:Wt});p.RGBAImage.copy(We,ei,{x:xr,y:hr},{x:0,y:0},{width:St,height:Wt}),at[Ze]={data:ei,pixelRatio:Gr,sdf:Sr,stretchX:sn,stretchY:qr,content:Mn}}P(null,at)}}return{cancel:function(){Ae&&(Ae.cancel(),Ae=null),Ie&&(Ie.cancel(),Ie=null)}}}(o,this.map._requestManager,function(_,C){if(h._spriteRequest=null,_)h.fire(new p.ErrorEvent(_));else if(C)for(var P in C)h.imageManager.addImage(P,C[P]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(o){var h=this.sourceCaches[o.source];if(h){var _=o.sourceLayer;if(_){var C=h.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(_)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+_+'" does not exist on source "'+C.id+'" as specified by style layer "'+o.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(o){for(var h=[],_=0,C=o;_<C.length;_+=1){var P=this._layers[C[_]];P.type!=="custom"&&h.push(P.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(o){if(this._loaded){var h=this._changed;if(this._changed){var _=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);for(var P in(_.length||C.length)&&this._updateWorkerLayers(_,C),this._updatedSources){var N=this._updatedSources[P];N==="reload"?this._reloadSource(P):N==="clear"&&this._clearSource(P)}for(var K in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[K].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}var se={};for(var Ce in this.sourceCaches){var Ae=this.sourceCaches[Ce];se[Ce]=Ae.used,Ae.used=!1}for(var Ie=0,Ke=this._order;Ie<Ke.length;Ie+=1){var We=this._layers[Ke[Ie]];We.recalculate(o,this._availableImages),!We.isHidden(o.zoom)&&We.source&&(this.sourceCaches[We.source].used=!0)}for(var at in se){var Ze=this.sourceCaches[at];se[at]!==Ze.used&&Ze.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:at}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var o=Object.keys(this._changedImages);if(o.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}},u.prototype._updateWorkerLayers=function(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(o){var h=this;if(this._checkLoaded(),oi(this,p.validateStyle(o)))return!1;(o=p.clone$1(o)).layers=ln(o.layers);var _=function(P,N){if(!P)return[{command:on.setStyle,args:[N]}];var K=[];try{if(!p.deepEqual(P.version,N.version))return[{command:on.setStyle,args:[N]}];p.deepEqual(P.center,N.center)||K.push({command:on.setCenter,args:[N.center]}),p.deepEqual(P.zoom,N.zoom)||K.push({command:on.setZoom,args:[N.zoom]}),p.deepEqual(P.bearing,N.bearing)||K.push({command:on.setBearing,args:[N.bearing]}),p.deepEqual(P.pitch,N.pitch)||K.push({command:on.setPitch,args:[N.pitch]}),p.deepEqual(P.sprite,N.sprite)||K.push({command:on.setSprite,args:[N.sprite]}),p.deepEqual(P.glyphs,N.glyphs)||K.push({command:on.setGlyphs,args:[N.glyphs]}),p.deepEqual(P.transition,N.transition)||K.push({command:on.setTransition,args:[N.transition]}),p.deepEqual(P.light,N.light)||K.push({command:on.setLight,args:[N.light]});var se={},Ce=[];(function(Ie,Ke,We,at){var Ze;for(Ze in Ke=Ke||{},Ie=Ie||{})Ie.hasOwnProperty(Ze)&&(Ke.hasOwnProperty(Ze)||bn(Ze,We,at));for(Ze in Ke)Ke.hasOwnProperty(Ze)&&(Ie.hasOwnProperty(Ze)?p.deepEqual(Ie[Ze],Ke[Ze])||(Ie[Ze].type==="geojson"&&Ke[Ze].type==="geojson"&&ea(Ie,Ke,Ze)?We.push({command:on.setGeoJSONSourceData,args:[Ze,Ke[Ze].data]}):Ii(Ze,Ke,We,at)):Li(Ze,Ke,We))})(P.sources,N.sources,Ce,se);var Ae=[];P.layers&&P.layers.forEach(function(Ie){se[Ie.source]?K.push({command:on.removeLayer,args:[Ie.id]}):Ae.push(Ie)}),K=K.concat(Ce),function(Ie,Ke,We){Ke=Ke||[];var at,Ze,st,St,Wt,xr,hr,Sr=(Ie=Ie||[]).map(qi),Gr=Ke.map(qi),sn=Ie.reduce(zi,{}),qr=Ke.reduce(zi,{}),Mn=Sr.slice(),ei=Object.create(null);for(at=0,Ze=0;at<Sr.length;at++)qr.hasOwnProperty(st=Sr[at])?Ze++:(We.push({command:on.removeLayer,args:[st]}),Mn.splice(Mn.indexOf(st,Ze),1));for(at=0,Ze=0;at<Gr.length;at++)Mn[Mn.length-1-at]!==(st=Gr[Gr.length-1-at])&&(sn.hasOwnProperty(st)?(We.push({command:on.removeLayer,args:[st]}),Mn.splice(Mn.lastIndexOf(st,Mn.length-Ze),1)):Ze++,We.push({command:on.addLayer,args:[qr[st],xr=Mn[Mn.length-at]]}),Mn.splice(Mn.length-at,0,st),ei[st]=!0);for(at=0;at<Gr.length;at++)if(St=sn[st=Gr[at]],Wt=qr[st],!ei[st]&&!p.deepEqual(St,Wt))if(p.deepEqual(St.source,Wt.source)&&p.deepEqual(St["source-layer"],Wt["source-layer"])&&p.deepEqual(St.type,Wt.type)){for(hr in ci(St.layout,Wt.layout,We,st,null,on.setLayoutProperty),ci(St.paint,Wt.paint,We,st,null,on.setPaintProperty),p.deepEqual(St.filter,Wt.filter)||We.push({command:on.setFilter,args:[st,Wt.filter]}),p.deepEqual(St.minzoom,Wt.minzoom)&&p.deepEqual(St.maxzoom,Wt.maxzoom)||We.push({command:on.setLayerZoomRange,args:[st,Wt.minzoom,Wt.maxzoom]}),St)St.hasOwnProperty(hr)&&hr!=="layout"&&hr!=="paint"&&hr!=="filter"&&hr!=="metadata"&&hr!=="minzoom"&&hr!=="maxzoom"&&(hr.indexOf("paint.")===0?ci(St[hr],Wt[hr],We,st,hr.slice(6),on.setPaintProperty):p.deepEqual(St[hr],Wt[hr])||We.push({command:on.setLayerProperty,args:[st,hr,Wt[hr]]}));for(hr in Wt)Wt.hasOwnProperty(hr)&&!St.hasOwnProperty(hr)&&hr!=="layout"&&hr!=="paint"&&hr!=="filter"&&hr!=="metadata"&&hr!=="minzoom"&&hr!=="maxzoom"&&(hr.indexOf("paint.")===0?ci(St[hr],Wt[hr],We,st,hr.slice(6),on.setPaintProperty):p.deepEqual(St[hr],Wt[hr])||We.push({command:on.setLayerProperty,args:[st,hr,Wt[hr]]}))}else We.push({command:on.removeLayer,args:[st]}),xr=Mn[Mn.lastIndexOf(st)+1],We.push({command:on.addLayer,args:[Wt,xr]})}(Ae,N.layers,K)}catch(Ie){console.warn("Unable to compute style diff:",Ie),K=[{command:on.setStyle,args:[N]}]}return K}(this.serialize(),o).filter(function(P){return!(P.command in rs)});if(_.length===0)return!1;var C=_.filter(function(P){return!(P.command in ys)});if(C.length>0)throw new Error("Unimplemented: "+C.map(function(P){return P.command}).join(", ")+".");return _.forEach(function(P){P.command!=="setTransition"&&h[P.command].apply(h,P.args)}),this.stylesheet=o,!0},u.prototype.addImage=function(o,h){if(this.getImage(o))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,h),this._afterImageUpdated(o)},u.prototype.updateImage=function(o,h){this.imageManager.updateImage(o,h)},u.prototype.getImage=function(o){return this.imageManager.getImage(o)},u.prototype.removeImage=function(o){if(!this.getImage(o))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)},u.prototype._afterImageUpdated=function(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(o,h,_){var C=this;if(_===void 0&&(_={}),this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+o,h,null,_))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var P=this.sourceCaches[o]=new Ee(o,h,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:C.loaded(),source:P.serialize(),sourceId:o}}),P.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===o)return this.fire(new p.ErrorEvent(new Error('Source "'+o+'" cannot be removed while layer "'+h+'" is using it.')));var _=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],_.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),_.setEventedParent(null),_.clearTiles(),_.onRemove&&_.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(o,h){this._checkLoaded(),this.sourceCaches[o].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()},u.prototype.addLayer=function(o,h,_){_===void 0&&(_={}),this._checkLoaded();var C=o.id;if(this.getLayer(C))this.fire(new p.ErrorEvent(new Error('Layer with id "'+C+'" already exists on this map')));else{var P;if(o.type==="custom"){if(oi(this,p.validateCustomStyleLayer(o)))return;P=p.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(C,o.source),o=p.clone$1(o),o=p.extend(o,{source:C})),this._validate(p.validateStyle.layer,"layers."+C,o,{arrayIndex:-1},_))return;P=p.createStyleLayer(o),this._validateLayer(P),P.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[P.id]=P.serialize()}var N=h?this._order.indexOf(h):this._order.length;if(h&&N===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(N,0,C),this._layerOrderChanged=!0,this._layers[C]=P,this._removedLayers[C]&&P.source&&P.type!=="custom"){var K=this._removedLayers[C];delete this._removedLayers[C],K.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},u.prototype.moveLayer=function(o,h){if(this._checkLoaded(),this._changed=!0,this._layers[o]){if(o!==h){var _=this._order.indexOf(o);this._order.splice(_,1);var C=h?this._order.indexOf(h):this._order.length;h&&C===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(C,0,o),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(o){this._checkLoaded();var h=this._layers[o];if(h){h.setEventedParent(null);var _=this._order.indexOf(o);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(o){return this._layers[o]},u.prototype.hasLayer=function(o){return o in this._layers},u.prototype.setLayerZoomRange=function(o,h,_){this._checkLoaded();var C=this.getLayer(o);C?C.minzoom===h&&C.maxzoom===_||(h!=null&&(C.minzoom=h),_!=null&&(C.maxzoom=_),this._updateLayer(C)):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(o,h,_){_===void 0&&(_={}),this._checkLoaded();var C=this.getLayer(o);if(C){if(!p.deepEqual(C.filter,h))return h==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(p.validateStyle.filter,"layers."+C.id+".filter",h,null,_)||(C.filter=p.clone$1(h),this._updateLayer(C)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(o){return p.clone$1(this.getLayer(o).filter)},u.prototype.setLayoutProperty=function(o,h,_,C){C===void 0&&(C={}),this._checkLoaded();var P=this.getLayer(o);P?p.deepEqual(P.getLayoutProperty(h),_)||(P.setLayoutProperty(h,_,C),this._updateLayer(P)):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(o,h){var _=this.getLayer(o);if(_)return _.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(o,h,_,C){C===void 0&&(C={}),this._checkLoaded();var P=this.getLayer(o);P?p.deepEqual(P.getPaintProperty(h),_)||(P.setPaintProperty(h,_,C)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(o,h){return this.getLayer(o).getPaintProperty(h)},u.prototype.setFeatureState=function(o,h){this._checkLoaded();var _=o.source,C=o.sourceLayer,P=this.sourceCaches[_];if(P!==void 0){var N=P.getSource().type;N==="geojson"&&C?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):N!=="vector"||C?(o.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(C,o.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(o,h){this._checkLoaded();var _=o.source,C=this.sourceCaches[_];if(C!==void 0){var P=C.getSource().type,N=P==="vector"?o.sourceLayer:void 0;P!=="vector"||N?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(N,o.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(o){this._checkLoaded();var h=o.source,_=o.sourceLayer,C=this.sourceCaches[h];if(C!==void 0){if(C.getSource().type!=="vector"||_)return o.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),C.getFeatureState(_,o.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(o){return o.serialize()}),layers:this._serializeLayers(this._order)},function(o){return o!==void 0})},u.prototype._updateLayer=function(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(o){for(var h=this,_=function(sn){return h._layers[sn].type==="fill-extrusion"},C={},P=[],N=this._order.length-1;N>=0;N--){var K=this._order[N];if(_(K)){C[K]=N;for(var se=0,Ce=o;se<Ce.length;se+=1){var Ae=Ce[se][K];if(Ae)for(var Ie=0,Ke=Ae;Ie<Ke.length;Ie+=1)P.push(Ke[Ie])}}}P.sort(function(sn,qr){return qr.intersectionZ-sn.intersectionZ});for(var We=[],at=this._order.length-1;at>=0;at--){var Ze=this._order[at];if(_(Ze))for(var st=P.length-1;st>=0;st--){var St=P[st].feature;if(C[St.layer.id]<at)break;We.push(St),P.pop()}else for(var Wt=0,xr=o;Wt<xr.length;Wt+=1){var hr=xr[Wt][Ze];if(hr)for(var Sr=0,Gr=hr;Sr<Gr.length;Sr+=1)We.push(Gr[Sr].feature)}}return We},u.prototype.queryRenderedFeatures=function(o,h,_){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var C={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,N=h.layers;P<N.length;P+=1){var K=N[P],se=this._layers[K];if(!se)return this.fire(new p.ErrorEvent(new Error("The layer '"+K+"' does not exist in the map's style and cannot be queried for features."))),[];C[se.source]=!0}}var Ce=[];for(var Ae in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!C[Ae]||Ce.push(mn(this.sourceCaches[Ae],this._layers,this._serializedLayers,o,h,_));return this.placement&&Ce.push(function(Ie,Ke,We,at,Ze,st,St){for(var Wt={},xr=st.queryRenderedSymbols(at),hr=[],Sr=0,Gr=Object.keys(xr).map(Number);Sr<Gr.length;Sr+=1)hr.push(St[Gr[Sr]]);hr.sort(Ni);for(var sn=function(){var ri=Mn[qr],sa=ri.featureIndex.lookupSymbolFeatures(xr[ri.bucketInstanceId],Ke,ri.bucketIndex,ri.sourceLayerIndex,Ze.filter,Ze.layers,Ze.availableImages,Ie);for(var Vn in sa){var Si=Wt[Vn]=Wt[Vn]||[],Ui=sa[Vn];Ui.sort(function(k,F){var ie=ri.featureSortOrder;if(ie){var Te=ie.indexOf(k.featureIndex);return ie.indexOf(F.featureIndex)-Te}return F.featureIndex-k.featureIndex});for(var ee=0,ne=Ui;ee<ne.length;ee+=1)Si.push(ne[ee])}},qr=0,Mn=hr;qr<Mn.length;qr+=1)sn();var ei=function(ri){Wt[ri].forEach(function(sa){var Vn=sa.feature,Si=We[Ie[ri].source].getFeatureState(Vn.layer["source-layer"],Vn.id);Vn.source=Vn.layer.source,Vn.layer["source-layer"]&&(Vn.sourceLayer=Vn.layer["source-layer"]),Vn.state=Si})};for(var fi in Wt)ei(fi);return Wt}(this._layers,this._serializedLayers,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Ce)},u.prototype.querySourceFeatures=function(o,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var _=this.sourceCaches[o];return _?function(C,P){for(var N=C.getRenderableIds().map(function(Ke){return C.getTileByID(Ke)}),K=[],se={},Ce=0;Ce<N.length;Ce++){var Ae=N[Ce],Ie=Ae.tileID.canonical.key;se[Ie]||(se[Ie]=!0,Ae.querySourceFeatures(K,P))}return K}(_,h):[]},u.prototype.addSourceType=function(o,h,_){return u.getSourceType(o)?_(new Error('A source type called "'+o+'" already exists.')):(u.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},_):_(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(o,h){h===void 0&&(h={}),this._checkLoaded();var _=this.light.getLight(),C=!1;for(var P in o)if(!p.deepEqual(o[P],_[P])){C=!0;break}if(C){var N={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(N)}},u.prototype._validate=function(o,h,_,C,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&oi(this,o.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:_,styleSpec:p.styleSpec},C)))},u.prototype._remove=function(){for(var o in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[o].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(o){this.sourceCaches[o].clearTiles()},u.prototype._reloadSource=function(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()},u.prototype._updateSources=function(o){for(var h in this.sourceCaches)this.sourceCaches[h].update(o)},u.prototype._generateCollisionBoxes=function(){for(var o in this.sourceCaches)this._reloadSource(o)},u.prototype._updatePlacement=function(o,h,_,C,P){P===void 0&&(P=!1);for(var N=!1,K=!1,se={},Ce=0,Ae=this._order;Ce<Ae.length;Ce+=1){var Ie=this._layers[Ae[Ce]];if(Ie.type==="symbol"){if(!se[Ie.source]){var Ke=this.sourceCaches[Ie.source];se[Ie.source]=Ke.getRenderableIds(!0).map(function(St){return Ke.getTileByID(St)}).sort(function(St,Wt){return Wt.tileID.overscaledZ-St.tileID.overscaledZ||(St.tileID.isLessThan(Wt.tileID)?-1:1)})}var We=this.crossTileSymbolIndex.addLayer(Ie,se[Ie.source],o.center.lng);N=N||We}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),o.zoom))&&(this.pauseablePlacement=new $s(o,this._order,P,h,_,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,se),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),K=!0),N&&this.pauseablePlacement.placement.setStale()),K||N)for(var at=0,Ze=this._order;at<Ze.length;at+=1){var st=this._layers[Ze[at]];st.type==="symbol"&&this.placement.updateLayerOpacities(st,se[st.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()},u.prototype.getImages=function(o,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();var C=this.sourceCaches[h.source];C&&C.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(o,h,_){this.glyphManager.getGlyphs(h.stacks,_)},u.prototype.getResource=function(o,h,_){return p.makeRequest(h,_)},u}(p.Evented);ns.getSourceType=function(i){return Nr[i]},ns.setSourceType=function(i,u){Nr[i]=u},ns.registerForPluginStateChange=p.registerForPluginStateChange;var Pa=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),uo=Xi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),yl=Xi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),_l=Xi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Bu=Xi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Vl=Xi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Eu=Xi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),lo=Xi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),js=Xi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),ws=Xi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),m=Xi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),T=Xi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),H=Xi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Xi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ce=Xi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ye=Xi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),lt=Xi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Vt=Xi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Mt=Xi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Ir=Xi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Hr=Xi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),qn=Xi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),bi=Xi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),di=Xi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ca=Xi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Wi=Xi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ka=Xi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Xi(i,u){var o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),_=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=C?C.concat(_):_,N={};return{fragmentSource:i=i.replace(o,function(K,se,Ce,Ae,Ie){return N[Ie]=!0,se==="define"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
varying `+Ce+" "+Ae+" "+Ie+`;
#else
uniform `+Ce+" "+Ae+" u_"+Ie+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ie+`
    `+Ce+" "+Ae+" "+Ie+" = u_"+Ie+`;
#endif
`}),vertexSource:u=u.replace(o,function(K,se,Ce,Ae,Ie){var Ke=Ae==="float"?"vec2":"vec4",We=Ie.match(/color/)?"color":Ke;return N[Ie]?se==="define"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
uniform lowp float u_`+Ie+`_t;
attribute `+Ce+" "+Ke+" a_"+Ie+`;
varying `+Ce+" "+Ae+" "+Ie+`;
#else
uniform `+Ce+" "+Ae+" u_"+Ie+`;
#endif
`:We==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+Ie+" = a_"+Ie+`;
#else
    `+Ce+" "+Ae+" "+Ie+" = u_"+Ie+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+Ie+" = unpack_mix_"+We+"(a_"+Ie+", u_"+Ie+`_t);
#else
    `+Ce+" "+Ae+" "+Ie+" = u_"+Ie+`;
#endif
`:se==="define"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
uniform lowp float u_`+Ie+`_t;
attribute `+Ce+" "+Ke+" a_"+Ie+`;
#else
uniform `+Ce+" "+Ae+" u_"+Ie+`;
#endif
`:We==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+Ce+" "+Ae+" "+Ie+" = a_"+Ie+`;
#else
    `+Ce+" "+Ae+" "+Ie+" = u_"+Ie+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+Ce+" "+Ae+" "+Ie+" = unpack_mix_"+We+"(a_"+Ie+", u_"+Ie+`_t);
#else
    `+Ce+" "+Ae+" "+Ie+" = u_"+Ie+`;
#endif
`}),staticAttributes:h,staticUniforms:P}}var Yi=Object.freeze({__proto__:null,prelude:uo,background:yl,backgroundPattern:_l,circle:Bu,clippingMask:Vl,heatmap:Eu,heatmapTexture:lo,collisionBox:js,collisionCircle:ws,debug:m,fill:T,fillOutline:H,fillOutlinePattern:R,fillPattern:ce,fillExtrusion:ye,fillExtrusionPattern:lt,hillshadePrepare:Vt,hillshade:Mt,line:Ir,lineGradient:Hr,linePattern:qn,lineSDF:bi,raster:di,symbolIcon:ca,symbolSDF:Wi,symbolTextAndIcon:ka}),Js=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Cu(i){for(var u=[],o=0;o<i.length;o++)if(i[o]!==null){var h=i[o].split(" ");u.push(h.pop())}return u}Js.prototype.bind=function(i,u,o,h,_,C,P,N){this.context=i;for(var K=this.boundPaintVertexBuffers.length!==h.length,se=0;!K&&se<h.length;se++)this.boundPaintVertexBuffers[se]!==h[se]&&(K=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===o&&!K&&this.boundIndexBuffer===_&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===N?(i.bindVertexArrayOES.set(this.vao),P&&P.bind(),_&&_.dynamicDraw&&_.bind(),N&&N.bind()):this.freshBind(u,o,h,_,C,P,N)},Js.prototype.freshBind=function(i,u,o,h,_,C,P){var N,K=i.numAttributes,se=this.context,Ce=se.gl;if(se.extVertexArrayObject)this.vao&&this.destroy(),this.vao=se.extVertexArrayObject.createVertexArrayOES(),se.bindVertexArrayOES.set(this.vao),N=0,this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=h,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=P;else{N=se.currentNumAttributes||0;for(var Ae=K;Ae<N;Ae++)Ce.disableVertexAttribArray(Ae)}u.enableAttributes(Ce,i);for(var Ie=0,Ke=o;Ie<Ke.length;Ie+=1)Ke[Ie].enableAttributes(Ce,i);C&&C.enableAttributes(Ce,i),P&&P.enableAttributes(Ce,i),u.bind(),u.setVertexAttribPointers(Ce,i,_);for(var We=0,at=o;We<at.length;We+=1){var Ze=at[We];Ze.bind(),Ze.setVertexAttribPointers(Ce,i,_)}C&&(C.bind(),C.setVertexAttribPointers(Ce,i,_)),h&&h.bind(),P&&(P.bind(),P.setVertexAttribPointers(Ce,i,_)),se.currentNumAttributes=K},Js.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var xl=function(i,u,o,h,_,C){var P=i.gl;this.program=P.createProgram();for(var N=Cu(o.staticAttributes),K=h?h.getBinderAttributes():[],se=N.concat(K),Ce=o.staticUniforms?Cu(o.staticUniforms):[],Ae=h?h.getBinderUniforms():[],Ie=[],Ke=0,We=Ce.concat(Ae);Ke<We.length;Ke+=1){var at=We[Ke];Ie.indexOf(at)<0&&Ie.push(at)}var Ze=h?h.defines():[];C&&Ze.push("#define OVERDRAW_INSPECTOR;");var st=Ze.concat(uo.fragmentSource,o.fragmentSource).join(`
`),St=Ze.concat(uo.vertexSource,o.vertexSource).join(`
`),Wt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Wt,st),P.compileShader(Wt),P.attachShader(this.program,Wt);var xr=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(xr,St),P.compileShader(xr),P.attachShader(this.program,xr),this.attributes={};var hr={};this.numAttributes=se.length;for(var Sr=0;Sr<this.numAttributes;Sr++)se[Sr]&&(P.bindAttribLocation(this.program,Sr,se[Sr]),this.attributes[se[Sr]]=Sr);P.linkProgram(this.program),P.deleteShader(xr),P.deleteShader(Wt);for(var Gr=0;Gr<Ie.length;Gr++){var sn=Ie[Gr];if(sn&&!hr[sn]){var qr=P.getUniformLocation(this.program,sn);qr&&(hr[sn]=qr)}}this.fixedUniforms=_(i,hr),this.binderUniforms=h?h.getUniforms(i,hr):[]}}};function wu(i,u,o){var h=1/ga(o,1,u.transform.tileZoom),_=Math.pow(2,o.tileID.overscaledZ),C=o.tileSize*Math.pow(2,u.transform.tileZoom)/_,P=C*(o.tileID.canonical.x+o.tileID.wrap*_),N=C*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,i.fromScale,i.toScale],u_fade:i.t,u_pixel_coord_upper:[P>>16,N>>16],u_pixel_coord_lower:[65535&P,65535&N]}}xl.prototype.draw=function(i,u,o,h,_,C,P,N,K,se,Ce,Ae,Ie,Ke,We,at){var Ze,st=i.gl;if(!this.failedToCreate){for(var St in i.program.set(this.program),i.setDepthMode(o),i.setStencilMode(h),i.setColorMode(_),i.setCullFace(C),this.fixedUniforms)this.fixedUniforms[St].set(P[St]);Ke&&Ke.setUniforms(i,this.binderUniforms,Ae,{zoom:Ie});for(var Wt=(Ze={},Ze[st.LINES]=2,Ze[st.TRIANGLES]=3,Ze[st.LINE_STRIP]=1,Ze)[u],xr=0,hr=Ce.get();xr<hr.length;xr+=1){var Sr=hr[xr],Gr=Sr.vaos||(Sr.vaos={});(Gr[N]||(Gr[N]=new Js)).bind(i,this,K,Ke?Ke.getPaintVertexBuffers():[],se,Sr.vertexOffset,We,at),st.drawElements(u,Sr.primitiveLength*Wt,st.UNSIGNED_SHORT,Sr.primitiveOffset*Wt*2)}}};var ds=function(i,u,o,h){var _=u.style.light,C=_.properties.get("position"),P=[C.x,C.y,C.z],N=p.create$1();_.properties.get("anchor")==="viewport"&&p.fromRotation(N,-u.transform.angle),p.transformMat3(P,P,N);var K=_.properties.get("color");return{u_matrix:i,u_lightpos:P,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+o,u_opacity:h}},vs=function(i,u,o,h,_,C,P){return p.extend(ds(i,u,o,h),wu(C,u,P),{u_height_factor:-Math.pow(2,_.overscaledZ)/P.tileSize/8})},ms=function(i){return{u_matrix:i}},Ts=function(i,u,o,h){return p.extend(ms(i),wu(o,u,h))},co=function(i,u){return{u_matrix:i,u_world:u}},Gl=function(i,u,o,h,_){return p.extend(Ts(i,u,o,h),{u_world:_})},Hl=function(i,u,o,h){var _,C,P=i.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var N=ga(o,1,P.zoom);_=!0,C=[N,N]}else _=!1,C=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:i.translatePosMatrix(u.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:C}},is=function(i,u,o){var h=ga(o,1,u.zoom),_=Math.pow(2,u.zoom-o.tileID.overscaledZ),C=o.tileID.overscaleFactor();return{u_matrix:i,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*_),u.pixelsToGLUnits[1]/(h*_)],u_overscale_factor:C}},Wl=function(i,u,o){return{u_matrix:i,u_inv_matrix:u,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}},As=function(i,u,o){return o===void 0&&(o=1),{u_matrix:i,u_color:u,u_overlay:0,u_overlay_scale:o}},_s=function(i){return{u_matrix:i}},Xl=function(i,u,o,h){return{u_matrix:i,u_extrude_scale:ga(u,1,o),u_intensity:h}},Nu=function(i,u,o){var h=i.transform;return{u_matrix:Yl(i,u,o),u_ratio:1/ga(u,1,h.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ia=function(i,u,o,h){return p.extend(Nu(i,u,o),{u_image:0,u_image_height:h})},zu=function(i,u,o,h){var _=i.transform,C=Tu(u,_);return{u_matrix:Yl(i,u,o),u_texsize:u.imageAtlasTexture.size,u_ratio:1/ga(u,1,_.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[C,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Fc=function(i,u,o,h,_){var C=i.lineAtlas,P=Tu(u,i.transform),N=o.layout.get("line-cap")==="round",K=C.getDash(h.from,N),se=C.getDash(h.to,N),Ce=K.width*_.fromScale,Ae=se.width*_.toScale;return p.extend(Nu(i,u,o),{u_patternscale_a:[P/Ce,-K.height/2],u_patternscale_b:[P/Ae,-se.height/2],u_sdfgamma:C.width/(256*Math.min(Ce,Ae)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:K.y,u_tex_y_b:se.y,u_mix:_.t})};function Tu(i,u){return 1/ga(i,1,u.tileZoom)}function Yl(i,u,o){return i.translatePosMatrix(u.tileID.posMatrix,u,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}var Bc=function(i,u,o,h,_){return{u_matrix:i,u_tl_parent:u,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(P=_.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(C=_.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:rl(_.paint.get("raster-hue-rotate"))};var C,P};function rl(i){i*=Math.PI/180;var u=Math.sin(i),o=Math.cos(i);return[(2*o+1)/3,(-Math.sqrt(3)*u-o+1)/3,(Math.sqrt(3)*u-o+1)/3]}var nl,bl=function(i,u,o,h,_,C,P,N,K,se){var Ce=_.transform;return{u_is_size_zoom_constant:+(i==="constant"||i==="source"),u_is_size_feature_constant:+(i==="constant"||i==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:Ce.cameraToCenterDistance,u_pitch:Ce.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:Ce.width/Ce.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:P,u_coord_matrix:N,u_is_text:+K,u_pitch_with_map:+h,u_texsize:se,u_texture:0}},il=function(i,u,o,h,_,C,P,N,K,se,Ce){var Ae=_.transform;return p.extend(bl(i,u,o,h,_,C,P,N,K,se),{u_gamma_scale:h?Math.cos(Ae._pitch)*Ae.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+Ce})},Sl=function(i,u,o,h,_,C,P,N,K,se){return p.extend(il(i,u,o,h,_,C,P,N,!0,K,!0),{u_texsize_icon:se,u_texture_icon:1})},al=function(i,u,o){return{u_matrix:i,u_opacity:u,u_color:o}},ol=function(i,u,o,h,_,C){return p.extend(function(P,N,K,se){var Ce=K.imageManager.getPattern(P.from.toString()),Ae=K.imageManager.getPattern(P.to.toString()),Ie=K.imageManager.getPixelSize(),Ke=Ie.width,We=Ie.height,at=Math.pow(2,se.tileID.overscaledZ),Ze=se.tileSize*Math.pow(2,K.transform.tileZoom)/at,st=Ze*(se.tileID.canonical.x+se.tileID.wrap*at),St=Ze*se.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Ce.tl,u_pattern_br_a:Ce.br,u_pattern_tl_b:Ae.tl,u_pattern_br_b:Ae.br,u_texsize:[Ke,We],u_mix:N.t,u_pattern_size_a:Ce.displaySize,u_pattern_size_b:Ae.displaySize,u_scale_a:N.fromScale,u_scale_b:N.toScale,u_tile_units_to_pixels:1/ga(se,1,K.transform.tileZoom),u_pixel_coord_upper:[st>>16,St>>16],u_pixel_coord_lower:[65535&st,65535&St]}}(h,C,o,_),{u_matrix:i,u_opacity:u})},sl={fillExtrusion:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_lightpos:new p.Uniform3f(i,u.u_lightpos),u_lightintensity:new p.Uniform1f(i,u.u_lightintensity),u_lightcolor:new p.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(i,u.u_vertical_gradient),u_opacity:new p.Uniform1f(i,u.u_opacity)}},fillExtrusionPattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_lightpos:new p.Uniform3f(i,u.u_lightpos),u_lightintensity:new p.Uniform1f(i,u.u_lightintensity),u_lightcolor:new p.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(i,u.u_vertical_gradient),u_height_factor:new p.Uniform1f(i,u.u_height_factor),u_image:new p.Uniform1i(i,u.u_image),u_texsize:new p.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade),u_opacity:new p.Uniform1f(i,u.u_opacity)}},fill:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},fillPattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_image:new p.Uniform1i(i,u.u_image),u_texsize:new p.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade)}},fillOutline:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_world:new p.Uniform2f(i,u.u_world)}},fillOutlinePattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_world:new p.Uniform2f(i,u.u_world),u_image:new p.Uniform1i(i,u.u_image),u_texsize:new p.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade)}},circle:function(i,u){return{u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(i,u.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(i,u.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},collisionBox:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(i,u.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(i,u.u_extrude_scale),u_overscale_factor:new p.Uniform1f(i,u.u_overscale_factor)}},collisionCircle:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_inv_matrix:new p.UniformMatrix4f(i,u.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(i,u.u_viewport_size)}},debug:function(i,u){return{u_color:new p.UniformColor(i,u.u_color),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_overlay:new p.Uniform1i(i,u.u_overlay),u_overlay_scale:new p.Uniform1f(i,u.u_overlay_scale)}},clippingMask:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},heatmap:function(i,u){return{u_extrude_scale:new p.Uniform1f(i,u.u_extrude_scale),u_intensity:new p.Uniform1f(i,u.u_intensity),u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},heatmapTexture:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_world:new p.Uniform2f(i,u.u_world),u_image:new p.Uniform1i(i,u.u_image),u_color_ramp:new p.Uniform1i(i,u.u_color_ramp),u_opacity:new p.Uniform1f(i,u.u_opacity)}},hillshade:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_image:new p.Uniform1i(i,u.u_image),u_latrange:new p.Uniform2f(i,u.u_latrange),u_light:new p.Uniform2f(i,u.u_light),u_shadow:new p.UniformColor(i,u.u_shadow),u_highlight:new p.UniformColor(i,u.u_highlight),u_accent:new p.UniformColor(i,u.u_accent)}},hillshadePrepare:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_image:new p.Uniform1i(i,u.u_image),u_dimension:new p.Uniform2f(i,u.u_dimension),u_zoom:new p.Uniform1f(i,u.u_zoom),u_unpack:new p.Uniform4f(i,u.u_unpack)}},line:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels)}},lineGradient:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels),u_image:new p.Uniform1i(i,u.u_image),u_image_height:new p.Uniform1f(i,u.u_image_height)}},linePattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_texsize:new p.Uniform2f(i,u.u_texsize),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_image:new p.Uniform1i(i,u.u_image),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade)}},lineSDF:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(i,u.u_patternscale_a),u_patternscale_b:new p.Uniform2f(i,u.u_patternscale_b),u_sdfgamma:new p.Uniform1f(i,u.u_sdfgamma),u_image:new p.Uniform1i(i,u.u_image),u_tex_y_a:new p.Uniform1f(i,u.u_tex_y_a),u_tex_y_b:new p.Uniform1f(i,u.u_tex_y_b),u_mix:new p.Uniform1f(i,u.u_mix)}},raster:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_tl_parent:new p.Uniform2f(i,u.u_tl_parent),u_scale_parent:new p.Uniform1f(i,u.u_scale_parent),u_buffer_scale:new p.Uniform1f(i,u.u_buffer_scale),u_fade_t:new p.Uniform1f(i,u.u_fade_t),u_opacity:new p.Uniform1f(i,u.u_opacity),u_image0:new p.Uniform1i(i,u.u_image0),u_image1:new p.Uniform1i(i,u.u_image1),u_brightness_low:new p.Uniform1f(i,u.u_brightness_low),u_brightness_high:new p.Uniform1f(i,u.u_brightness_high),u_saturation_factor:new p.Uniform1f(i,u.u_saturation_factor),u_contrast_factor:new p.Uniform1f(i,u.u_contrast_factor),u_spin_weights:new p.Uniform3f(i,u.u_spin_weights)}},symbolIcon:function(i,u){return{u_is_size_zoom_constant:new p.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(i,u.u_size_t),u_size:new p.Uniform1f(i,u.u_size),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(i,u.u_pitch),u_rotate_symbol:new p.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(i,u.u_fade_change),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new p.Uniform1i(i,u.u_is_text),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_texsize:new p.Uniform2f(i,u.u_texsize),u_texture:new p.Uniform1i(i,u.u_texture)}},symbolSDF:function(i,u){return{u_is_size_zoom_constant:new p.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(i,u.u_size_t),u_size:new p.Uniform1f(i,u.u_size),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(i,u.u_pitch),u_rotate_symbol:new p.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(i,u.u_fade_change),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new p.Uniform1i(i,u.u_is_text),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_texsize:new p.Uniform2f(i,u.u_texsize),u_texture:new p.Uniform1i(i,u.u_texture),u_gamma_scale:new p.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(i,u.u_is_halo)}},symbolTextAndIcon:function(i,u){return{u_is_size_zoom_constant:new p.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(i,u.u_size_t),u_size:new p.Uniform1f(i,u.u_size),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(i,u.u_pitch),u_rotate_symbol:new p.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(i,u.u_fade_change),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new p.Uniform1i(i,u.u_is_text),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_texsize:new p.Uniform2f(i,u.u_texsize),u_texsize_icon:new p.Uniform2f(i,u.u_texsize_icon),u_texture:new p.Uniform1i(i,u.u_texture),u_texture_icon:new p.Uniform1i(i,u.u_texture_icon),u_gamma_scale:new p.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(i,u.u_is_halo)}},background:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_opacity:new p.Uniform1f(i,u.u_opacity),u_color:new p.UniformColor(i,u.u_color)}},backgroundPattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_opacity:new p.Uniform1f(i,u.u_opacity),u_image:new p.Uniform1i(i,u.u_image),u_pattern_tl_a:new p.Uniform2f(i,u.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(i,u.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(i,u.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(i,u.u_pattern_br_b),u_texsize:new p.Uniform2f(i,u.u_texsize),u_mix:new p.Uniform1f(i,u.u_mix),u_pattern_size_a:new p.Uniform2f(i,u.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(i,u.u_pattern_size_b),u_scale_a:new p.Uniform1f(i,u.u_scale_a),u_scale_b:new p.Uniform1f(i,u.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(i,u.u_tile_units_to_pixels)}}};function iu(i,u,o,h,_,C,P){for(var N=i.context,K=N.gl,se=i.useProgram("collisionBox"),Ce=[],Ae=0,Ie=0,Ke=0;Ke<h.length;Ke++){var We=h[Ke],at=u.getTile(We),Ze=at.getBucket(o);if(Ze){var st=We.posMatrix;_[0]===0&&_[1]===0||(st=i.translatePosMatrix(We.posMatrix,at,_,C));var St=P?Ze.textCollisionBox:Ze.iconCollisionBox,Wt=Ze.collisionCircleArray;if(Wt.length>0){var xr=p.create(),hr=st;p.mul(xr,Ze.placementInvProjMatrix,i.transform.glCoordMatrix),p.mul(xr,xr,Ze.placementViewportMatrix),Ce.push({circleArray:Wt,circleOffset:Ie,transform:hr,invTransform:xr}),Ie=Ae+=Wt.length/4}St&&se.draw(N,K.LINES,U.disabled,ae.disabled,i.colorModeForRenderPass(),Pe.disabled,is(st,i.transform,at),o.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,null,i.transform.zoom,null,null,St.collisionVertexBuffer)}}if(P&&Ce.length){var Sr=i.useProgram("collisionCircle"),Gr=new p.StructArrayLayout2f1f2i16;Gr.resize(4*Ae),Gr._trim();for(var sn=0,qr=0,Mn=Ce;qr<Mn.length;qr+=1)for(var ei=Mn[qr],fi=0;fi<ei.circleArray.length/4;fi++){var ri=4*fi,sa=ei.circleArray[ri+0],Vn=ei.circleArray[ri+1],Si=ei.circleArray[ri+2],Ui=ei.circleArray[ri+3];Gr.emplace(sn++,sa,Vn,Si,Ui,0),Gr.emplace(sn++,sa,Vn,Si,Ui,1),Gr.emplace(sn++,sa,Vn,Si,Ui,2),Gr.emplace(sn++,sa,Vn,Si,Ui,3)}(!nl||nl.length<2*Ae)&&(nl=function(ft){var Gt=2*ft,Et=new p.StructArrayLayout3ui6;Et.resize(Gt),Et._trim();for(var Qt=0;Qt<Gt;Qt++){var Fr=6*Qt;Et.uint16[Fr+0]=4*Qt+0,Et.uint16[Fr+1]=4*Qt+1,Et.uint16[Fr+2]=4*Qt+2,Et.uint16[Fr+3]=4*Qt+2,Et.uint16[Fr+4]=4*Qt+3,Et.uint16[Fr+5]=4*Qt+0}return Et}(Ae));for(var ee=N.createIndexBuffer(nl,!0),ne=N.createVertexBuffer(Gr,p.collisionCircleLayout.members,!0),k=0,F=Ce;k<F.length;k+=1){var ie=F[k],Te=Wl(ie.transform,ie.invTransform,i.transform);Sr.draw(N,K.TRIANGLES,U.disabled,ae.disabled,i.colorModeForRenderPass(),Pe.disabled,Te,o.id,ne,ee,p.SegmentVector.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,i.transform.zoom,null,null,null)}ne.destroy(),ee.destroy()}}var Qs=p.identity(new Float32Array(16));function gc(i,u,o,h,_,C){var P=p.getAnchorAlignment(i),N=-(P.horizontalAlign-.5)*u,K=-(P.verticalAlign-.5)*o,se=p.evaluateVariableOffset(i,h);return new p.Point((N/_+se[0])*C,(K/_+se[1])*C)}function yc(i,u,o,h,_,C,P,N,K,se,Ce){var Ae=i.text.placedSymbolArray,Ie=i.text.dynamicLayoutVertexArray,Ke=i.icon.dynamicLayoutVertexArray,We={};Ie.clear();for(var at=0;at<Ae.length;at++){var Ze=Ae.get(at),st=Ze.hidden||!Ze.crossTileID||i.allowVerticalPlacement&&!Ze.placedOrientation?null:h[Ze.crossTileID];if(st){var St=new p.Point(Ze.anchorX,Ze.anchorY),Wt=ki(St,o?N:P),xr=wi(C.cameraToCenterDistance,Wt.signedDistanceFromCamera),hr=_.evaluateSizeForFeature(i.textSizeData,se,Ze)*xr/p.ONE_EM;o&&(hr*=i.tilePixelRatio/K);for(var Sr=gc(st.anchor,st.width,st.height,st.textOffset,st.textBoxScale,hr),Gr=o?ki(St.add(Sr),P).point:Wt.point.add(u?Sr.rotate(-C.angle):Sr),sn=i.allowVerticalPlacement&&Ze.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,qr=0;qr<Ze.numGlyphs;qr++)p.addDynamicAttributes(Ie,Gr,sn);Ce&&Ze.associatedIconIndex>=0&&(We[Ze.associatedIconIndex]={shiftedAnchor:Gr,angle:sn})}else Hi(Ze.numGlyphs,Ie)}if(Ce){Ke.clear();for(var Mn=i.icon.placedSymbolArray,ei=0;ei<Mn.length;ei++){var fi=Mn.get(ei);if(fi.hidden)Hi(fi.numGlyphs,Ke);else{var ri=We[ei];if(ri)for(var sa=0;sa<fi.numGlyphs;sa++)p.addDynamicAttributes(Ke,ri.shiftedAnchor,ri.angle);else Hi(fi.numGlyphs,Ke)}}i.icon.dynamicLayoutVertexBuffer.updateData(Ke)}i.text.dynamicLayoutVertexBuffer.updateData(Ie)}function Nc(i,u,o){return o.iconsInText&&u?"symbolTextAndIcon":i?"symbolSDF":"symbolIcon"}function Uu(i,u,o,h,_,C,P,N,K,se,Ce,Ae){for(var Ie=i.context,Ke=Ie.gl,We=i.transform,at=N==="map",Ze=K==="map",st=at&&o.layout.get("symbol-placement")!=="point",St=at&&!Ze&&!st,Wt=o.layout.get("symbol-sort-key").constantOr(1)!==void 0,xr=!1,hr=i.depthModeForSublayer(0,U.ReadOnly),Sr=o.layout.get("text-variable-anchor"),Gr=[],sn=0,qr=h;sn<qr.length;sn+=1){var Mn=qr[sn],ei=u.getTile(Mn),fi=ei.getBucket(o);if(fi){var ri=_?fi.text:fi.icon;if(ri&&ri.segments.get().length){var sa=ri.programConfigurations.get(o.id),Vn=_||fi.sdfIcons,Si=_?fi.textSizeData:fi.iconSizeData,Ui=Ze||We.pitch!==0,ee=i.useProgram(Nc(Vn,_,fi),sa),ne=p.evaluateSizeForZoom(Si,We.zoom),k=void 0,F=[0,0],ie=void 0,Te=void 0,ft=null,Gt=void 0;if(_)ie=ei.glyphAtlasTexture,Te=Ke.LINEAR,k=ei.glyphAtlasTexture.size,fi.iconsInText&&(F=ei.imageAtlasTexture.size,ft=ei.imageAtlasTexture,Gt=Ui||i.options.rotating||i.options.zooming||Si.kind==="composite"||Si.kind==="camera"?Ke.LINEAR:Ke.NEAREST);else{var Et=o.layout.get("icon-size").constantOr(0)!==1||fi.iconsNeedLinear;ie=ei.imageAtlasTexture,Te=Vn||i.options.rotating||i.options.zooming||Et||Ui?Ke.LINEAR:Ke.NEAREST,k=ei.imageAtlasTexture.size}var Qt=ga(ei,1,i.transform.zoom),Fr=Bi(Mn.posMatrix,Ze,at,i.transform,Qt),Bn=ai(Mn.posMatrix,Ze,at,i.transform,Qt),zn=Sr&&fi.hasTextData(),hi=o.layout.get("icon-text-fit")!=="none"&&zn&&fi.hasIconData();st&&po(fi,Mn.posMatrix,i,_,Fr,Bn,Ze,se);var ui=i.translatePosMatrix(Mn.posMatrix,ei,C,P),yi=st||_&&Sr||hi?Qs:Fr,Ki=i.translatePosMatrix(Bn,ei,C,P,!0),_a=Vn&&o.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0,xa={program:ee,buffers:ri,uniformValues:Vn?fi.iconsInText?Sl(Si.kind,ne,St,Ze,i,ui,yi,Ki,k,F):il(Si.kind,ne,St,Ze,i,ui,yi,Ki,_,k,!0):bl(Si.kind,ne,St,Ze,i,ui,yi,Ki,_,k),atlasTexture:ie,atlasTextureIcon:ft,atlasInterpolation:Te,atlasInterpolationIcon:Gt,isSDF:Vn,hasHalo:_a};if(Wt&&fi.canOverlap){xr=!0;for(var Ya=0,Na=ri.segments.get();Ya<Na.length;Ya+=1){var wo=Na[Ya];Gr.push({segments:new p.SegmentVector([wo]),sortKey:wo.sortKey,state:xa})}}else Gr.push({segments:ri.segments,sortKey:0,state:xa})}}}xr&&Gr.sort(function(za,ko){return za.sortKey-ko.sortKey});for(var La=0,Ea=Gr;La<Ea.length;La+=1){var fa=Ea[La],ma=fa.state;if(Ie.activeTexture.set(Ke.TEXTURE0),ma.atlasTexture.bind(ma.atlasInterpolation,Ke.CLAMP_TO_EDGE),ma.atlasTextureIcon&&(Ie.activeTexture.set(Ke.TEXTURE1),ma.atlasTextureIcon&&ma.atlasTextureIcon.bind(ma.atlasInterpolationIcon,Ke.CLAMP_TO_EDGE)),ma.isSDF){var Ga=ma.uniformValues;ma.hasHalo&&(Ga.u_is_halo=1,El(ma.buffers,fa.segments,o,i,ma.program,hr,Ce,Ae,Ga)),Ga.u_is_halo=0}El(ma.buffers,fa.segments,o,i,ma.program,hr,Ce,Ae,ma.uniformValues)}}function El(i,u,o,h,_,C,P,N,K){var se=h.context;_.draw(se,se.gl.TRIANGLES,C,P,N,Pe.disabled,K,o.id,i.layoutVertexBuffer,i.indexBuffer,u,o.paint,h.transform.zoom,i.programConfigurations.get(o.id),i.dynamicLayoutVertexBuffer,i.opacityVertexBuffer)}function Kl(i,u,o,h,_,C,P){var N,K,se,Ce,Ae,Ie=i.context.gl,Ke=o.paint.get("fill-pattern"),We=Ke&&Ke.constantOr(1),at=o.getCrossfadeParameters();P?(K=We&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=Ie.LINES):(K=We?"fillPattern":"fill",N=Ie.TRIANGLES);for(var Ze=0,st=h;Ze<st.length;Ze+=1){var St=st[Ze],Wt=u.getTile(St);if(!We||Wt.patternsLoaded()){var xr=Wt.getBucket(o);if(xr){var hr=xr.programConfigurations.get(o.id),Sr=i.useProgram(K,hr);We&&(i.context.activeTexture.set(Ie.TEXTURE0),Wt.imageAtlasTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),hr.updatePaintBuffers(at));var Gr=Ke.constantOr(null);if(Gr&&Wt.imageAtlas){var sn=Wt.imageAtlas,qr=sn.patternPositions[Gr.to.toString()],Mn=sn.patternPositions[Gr.from.toString()];qr&&Mn&&hr.setConstantPatternPositions(qr,Mn)}var ei=i.translatePosMatrix(St.posMatrix,Wt,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(P){Ce=xr.indexBuffer2,Ae=xr.segments2;var fi=[Ie.drawingBufferWidth,Ie.drawingBufferHeight];se=K==="fillOutlinePattern"&&We?Gl(ei,i,at,Wt,fi):co(ei,fi)}else Ce=xr.indexBuffer,Ae=xr.segments,se=We?Ts(ei,i,at,Wt):ms(ei);Sr.draw(i.context,N,_,i.stencilModeForClipping(St),C,Pe.disabled,se,o.id,xr.layoutVertexBuffer,Ce,Ae,o.paint,i.transform.zoom,hr)}}}}function _c(i,u,o,h,_,C,P){for(var N=i.context,K=N.gl,se=o.paint.get("fill-extrusion-pattern"),Ce=se.constantOr(1),Ae=o.getCrossfadeParameters(),Ie=o.paint.get("fill-extrusion-opacity"),Ke=0,We=h;Ke<We.length;Ke+=1){var at=We[Ke],Ze=u.getTile(at),st=Ze.getBucket(o);if(st){var St=st.programConfigurations.get(o.id),Wt=i.useProgram(Ce?"fillExtrusionPattern":"fillExtrusion",St);Ce&&(i.context.activeTexture.set(K.TEXTURE0),Ze.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),St.updatePaintBuffers(Ae));var xr=se.constantOr(null);if(xr&&Ze.imageAtlas){var hr=Ze.imageAtlas,Sr=hr.patternPositions[xr.to.toString()],Gr=hr.patternPositions[xr.from.toString()];Sr&&Gr&&St.setConstantPatternPositions(Sr,Gr)}var sn=i.translatePosMatrix(at.posMatrix,Ze,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),qr=o.paint.get("fill-extrusion-vertical-gradient"),Mn=Ce?vs(sn,i,qr,Ie,at,Ae,Ze):ds(sn,i,qr,Ie);Wt.draw(N,N.gl.TRIANGLES,_,C,P,Pe.backCCW,Mn,o.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,o.paint,i.transform.zoom,St)}}}function $l(i,u,o,h,_,C){var P=i.context,N=P.gl,K=u.fbo;if(K){var se=i.useProgram("hillshade");P.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,K.colorAttachment.get());var Ce=function(Ae,Ie,Ke){var We=Ke.paint.get("hillshade-shadow-color"),at=Ke.paint.get("hillshade-highlight-color"),Ze=Ke.paint.get("hillshade-accent-color"),st=Ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(st-=Ae.transform.angle);var St,Wt,xr,hr=!Ae.options.moving;return{u_matrix:Ae.transform.calculatePosMatrix(Ie.tileID.toUnwrapped(),hr),u_image:0,u_latrange:(St=Ie.tileID,Wt=Math.pow(2,St.canonical.z),xr=St.canonical.y,[new p.MercatorCoordinate(0,xr/Wt).toLngLat().lat,new p.MercatorCoordinate(0,(xr+1)/Wt).toLngLat().lat]),u_light:[Ke.paint.get("hillshade-exaggeration"),st],u_shadow:We,u_highlight:at,u_accent:Ze}}(i,u,o);se.draw(P,N.TRIANGLES,h,_,C,Pe.disabled,Ce,o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}}function Jl(i,u,o,h,_,C){var P=i.context,N=P.gl,K=u.dem;if(K&&K.data){var se=K.dim,Ce=K.stride,Ae=K.getPixels();if(P.activeTexture.set(N.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||i.getTileTexture(Ce),u.demTexture){var Ie=u.demTexture;Ie.update(Ae,{premultiply:!1}),Ie.bind(N.NEAREST,N.CLAMP_TO_EDGE)}else u.demTexture=new p.Texture(P,Ae,N.RGBA,{premultiply:!1}),u.demTexture.bind(N.NEAREST,N.CLAMP_TO_EDGE);P.activeTexture.set(N.TEXTURE0);var Ke=u.fbo;if(!Ke){var We=new p.Texture(P,{width:se,height:se,data:null},N.RGBA);We.bind(N.LINEAR,N.CLAMP_TO_EDGE),(Ke=u.fbo=P.createFramebuffer(se,se,!0)).colorAttachment.set(We.texture)}P.bindFramebuffer.set(Ke.framebuffer),P.viewport.set([0,0,se,se]),i.useProgram("hillshadePrepare").draw(P,N.TRIANGLES,h,_,C,Pe.disabled,function(at,Ze){var st=Ze.stride,St=p.create();return p.ortho(St,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(St,St,[0,-p.EXTENT,0]),{u_matrix:St,u_image:1,u_dimension:[st,st],u_zoom:at.overscaledZ,u_unpack:Ze.getUnpackVector()}}(u.tileID,K),o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function Au(i,u,o,h,_){var C=h.paint.get("raster-fade-duration");if(C>0){var P=p.browser.now(),N=(P-i.timeAdded)/C,K=u?(P-u.timeAdded)/C:-1,se=o.getSource(),Ce=_.coveringZoomLevel({tileSize:se.tileSize,roundZoom:se.roundZoom}),Ae=!u||Math.abs(u.tileID.overscaledZ-Ce)>Math.abs(i.tileID.overscaledZ-Ce),Ie=Ae&&i.refreshedUponExpiration?1:p.clamp(Ae?N:1-K,0,1);return i.refreshedUponExpiration&&N>=1&&(i.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Ie}:{opacity:Ie,mix:0}}return{opacity:1,mix:0}}var Pu=new p.Color(1,0,0,1),Ql=new p.Color(0,1,0,1),ql=new p.Color(0,0,1,1),pu=new p.Color(1,0,1,1),xc=new p.Color(0,1,1,1);function Cl(i,u,o,h){Zu(i,0,u+o/2,i.transform.width,o,h)}function bc(i,u,o,h){Zu(i,u-o/2,0,o,i.transform.height,h)}function Zu(i,u,o,h,_,C){var P=i.context,N=P.gl;N.enable(N.SCISSOR_TEST),N.scissor(u*p.browser.devicePixelRatio,o*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,_*p.browser.devicePixelRatio),P.clear({color:C}),N.disable(N.SCISSOR_TEST)}function Va(i,u,o){var h=i.context,_=h.gl,C=o.posMatrix,P=i.useProgram("debug"),N=U.disabled,K=ae.disabled,se=i.colorModeForRenderPass();h.activeTexture.set(_.TEXTURE0),i.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),P.draw(h,_.LINE_STRIP,N,K,se,Pe.disabled,As(C,p.Color.red),"$debug",i.debugBuffer,i.tileBorderIndexBuffer,i.debugSegments);var Ce=u.getTileByID(o.key).latestRawTileData,Ae=Math.floor((Ce&&Ce.byteLength||0)/1024),Ie=u.getTile(o).tileSize,Ke=512/Math.min(Ie,512)*(o.overscaledZ/i.transform.zoom)*.5,We=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(We+=" => "+o.overscaledZ),function(at,Ze){at.initDebugOverlayCanvas();var st=at.debugOverlayCanvas,St=at.context.gl,Wt=at.debugOverlayCanvas.getContext("2d");Wt.clearRect(0,0,st.width,st.height),Wt.shadowColor="white",Wt.shadowBlur=2,Wt.lineWidth=1.5,Wt.strokeStyle="white",Wt.textBaseline="top",Wt.font="bold 36px Open Sans, sans-serif",Wt.fillText(Ze,5,5),Wt.strokeText(Ze,5,5),at.debugOverlayTexture.update(st),at.debugOverlayTexture.bind(St.LINEAR,St.CLAMP_TO_EDGE)}(i,We+" "+Ae+"kb"),P.draw(h,_.TRIANGLES,N,K,de.alphaBlended,Pe.disabled,As(C,p.Color.transparent,Ke),"$debug",i.debugBuffer,i.quadTriangleIndexBuffer,i.debugSegments)}var ul={symbol:function(i,u,o,h,_){if(i.renderPass==="translucent"){var C=ae.disabled,P=i.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(N,K,se,Ce,Ae,Ie,Ke){for(var We=K.transform,at=Ae==="map",Ze=Ie==="map",st=0,St=N;st<St.length;st+=1){var Wt=St[st],xr=Ce.getTile(Wt),hr=xr.getBucket(se);if(hr&&hr.text&&hr.text.segments.get().length){var Sr=p.evaluateSizeForZoom(hr.textSizeData,We.zoom),Gr=ga(xr,1,K.transform.zoom),sn=Bi(Wt.posMatrix,Ze,at,K.transform,Gr),qr=se.layout.get("icon-text-fit")!=="none"&&hr.hasIconData();if(Sr){var Mn=Math.pow(2,We.zoom-xr.tileID.overscaledZ);yc(hr,at,Ze,Ke,p.symbolSize,We,sn,Wt.posMatrix,Mn,Sr,qr)}}}}(h,i,o,u,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),_),o.paint.get("icon-opacity").constantOr(1)!==0&&Uu(i,u,o,h,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),C,P),o.paint.get("text-opacity").constantOr(1)!==0&&Uu(i,u,o,h,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),C,P),u.map.showCollisionBoxes&&(iu(i,u,o,h,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),iu(i,u,o,h,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))}},circle:function(i,u,o,h){if(i.renderPass==="translucent"){var _=o.paint.get("circle-opacity"),C=o.paint.get("circle-stroke-width"),P=o.paint.get("circle-stroke-opacity"),N=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)!==0||C.constantOr(1)!==0&&P.constantOr(1)!==0){for(var K=i.context,se=K.gl,Ce=i.depthModeForSublayer(0,U.ReadOnly),Ae=ae.disabled,Ie=i.colorModeForRenderPass(),Ke=[],We=0;We<h.length;We++){var at=h[We],Ze=u.getTile(at),st=Ze.getBucket(o);if(st){var St=st.programConfigurations.get(o.id),Wt={programConfiguration:St,program:i.useProgram("circle",St),layoutVertexBuffer:st.layoutVertexBuffer,indexBuffer:st.indexBuffer,uniformValues:Hl(i,at,Ze,o)};if(N)for(var xr=0,hr=st.segments.get();xr<hr.length;xr+=1){var Sr=hr[xr];Ke.push({segments:new p.SegmentVector([Sr]),sortKey:Sr.sortKey,state:Wt})}else Ke.push({segments:st.segments,sortKey:0,state:Wt})}}N&&Ke.sort(function(ei,fi){return ei.sortKey-fi.sortKey});for(var Gr=0,sn=Ke;Gr<sn.length;Gr+=1){var qr=sn[Gr],Mn=qr.state;Mn.program.draw(K,se.TRIANGLES,Ce,Ae,Ie,Pe.disabled,Mn.uniformValues,o.id,Mn.layoutVertexBuffer,Mn.indexBuffer,qr.segments,o.paint,i.transform.zoom,Mn.programConfiguration)}}}},heatmap:function(i,u,o,h){if(o.paint.get("heatmap-opacity")!==0)if(i.renderPass==="offscreen"){var _=i.context,C=_.gl,P=ae.disabled,N=new de([C.ONE,C.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Ke,We,at){var Ze=Ke.gl;Ke.activeTexture.set(Ze.TEXTURE1),Ke.viewport.set([0,0,We.width/4,We.height/4]);var st=at.heatmapFbo;if(st)Ze.bindTexture(Ze.TEXTURE_2D,st.colorAttachment.get()),Ke.bindFramebuffer.set(st.framebuffer);else{var St=Ze.createTexture();Ze.bindTexture(Ze.TEXTURE_2D,St),Ze.texParameteri(Ze.TEXTURE_2D,Ze.TEXTURE_WRAP_S,Ze.CLAMP_TO_EDGE),Ze.texParameteri(Ze.TEXTURE_2D,Ze.TEXTURE_WRAP_T,Ze.CLAMP_TO_EDGE),Ze.texParameteri(Ze.TEXTURE_2D,Ze.TEXTURE_MIN_FILTER,Ze.LINEAR),Ze.texParameteri(Ze.TEXTURE_2D,Ze.TEXTURE_MAG_FILTER,Ze.LINEAR),st=at.heatmapFbo=Ke.createFramebuffer(We.width/4,We.height/4,!1),function(Wt,xr,hr,Sr){var Gr=Wt.gl;Gr.texImage2D(Gr.TEXTURE_2D,0,Gr.RGBA,xr.width/4,xr.height/4,0,Gr.RGBA,Wt.extRenderToTextureHalfFloat?Wt.extTextureHalfFloat.HALF_FLOAT_OES:Gr.UNSIGNED_BYTE,null),Sr.colorAttachment.set(hr)}(Ke,We,St,st)}})(_,i,o),_.clear({color:p.Color.transparent});for(var K=0;K<h.length;K++){var se=h[K];if(!u.hasRenderableParent(se)){var Ce=u.getTile(se),Ae=Ce.getBucket(o);if(Ae){var Ie=Ae.programConfigurations.get(o.id);i.useProgram("heatmap",Ie).draw(_,C.TRIANGLES,U.disabled,P,N,Pe.disabled,Xl(se.posMatrix,Ce,i.transform.zoom,o.paint.get("heatmap-intensity")),o.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,o.paint,i.transform.zoom,Ie)}}}_.viewport.set([0,0,i.width,i.height])}else i.renderPass==="translucent"&&(i.context.setColorMode(i.colorModeForRenderPass()),function(Ke,We){var at=Ke.context,Ze=at.gl,st=We.heatmapFbo;if(st){at.activeTexture.set(Ze.TEXTURE0),Ze.bindTexture(Ze.TEXTURE_2D,st.colorAttachment.get()),at.activeTexture.set(Ze.TEXTURE1);var St=We.colorRampTexture;St||(St=We.colorRampTexture=new p.Texture(at,We.colorRamp,Ze.RGBA)),St.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE),Ke.useProgram("heatmapTexture").draw(at,Ze.TRIANGLES,U.disabled,ae.disabled,Ke.colorModeForRenderPass(),Pe.disabled,function(Wt,xr,hr,Sr){var Gr=p.create();p.ortho(Gr,0,Wt.width,Wt.height,0,0,1);var sn=Wt.context.gl;return{u_matrix:Gr,u_world:[sn.drawingBufferWidth,sn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:xr.paint.get("heatmap-opacity")}}(Ke,We),We.id,Ke.viewportBuffer,Ke.quadTriangleIndexBuffer,Ke.viewportSegments,We.paint,Ke.transform.zoom)}}(i,o))},line:function(i,u,o,h){if(i.renderPass==="translucent"){var _=o.paint.get("line-opacity"),C=o.paint.get("line-width");if(_.constantOr(1)!==0&&C.constantOr(1)!==0)for(var P=i.depthModeForSublayer(0,U.ReadOnly),N=i.colorModeForRenderPass(),K=o.paint.get("line-dasharray"),se=o.paint.get("line-pattern"),Ce=se.constantOr(1),Ae=o.paint.get("line-gradient"),Ie=o.getCrossfadeParameters(),Ke=Ce?"linePattern":K?"lineSDF":Ae?"lineGradient":"line",We=i.context,at=We.gl,Ze=!0,st=0,St=h;st<St.length;st+=1){var Wt=St[st],xr=u.getTile(Wt);if(!Ce||xr.patternsLoaded()){var hr=xr.getBucket(o);if(hr){var Sr=hr.programConfigurations.get(o.id),Gr=i.context.program.get(),sn=i.useProgram(Ke,Sr),qr=Ze||sn.program!==Gr,Mn=se.constantOr(null);if(Mn&&xr.imageAtlas){var ei=xr.imageAtlas,fi=ei.patternPositions[Mn.to.toString()],ri=ei.patternPositions[Mn.from.toString()];fi&&ri&&Sr.setConstantPatternPositions(fi,ri)}var sa=Ce?zu(i,xr,o,Ie):K?Fc(i,xr,o,K,Ie):Ae?Ia(i,xr,o,hr.lineClipsArray.length):Nu(i,xr,o);if(Ce)We.activeTexture.set(at.TEXTURE0),xr.imageAtlasTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE),Sr.updatePaintBuffers(Ie);else if(K&&(qr||i.lineAtlas.dirty))We.activeTexture.set(at.TEXTURE0),i.lineAtlas.bind(We);else if(Ae){var Vn=hr.gradients[o.id],Si=Vn.texture;if(o.gradientVersion!==Vn.version){var Ui=256;if(o.stepInterpolant){var ee=u.getSource().maxzoom,ne=Wt.canonical.z===ee?Math.ceil(1<<i.transform.maxZoom-Wt.canonical.z):1;Ui=p.clamp(p.nextPowerOfTwo(hr.maxLineLength/p.EXTENT*1024*ne),256,We.maxTextureSize)}Vn.gradient=p.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Ui,image:Vn.gradient||void 0,clips:hr.lineClipsArray}),Vn.texture?Vn.texture.update(Vn.gradient):Vn.texture=new p.Texture(We,Vn.gradient,at.RGBA),Vn.version=o.gradientVersion,Si=Vn.texture}We.activeTexture.set(at.TEXTURE0),Si.bind(o.stepInterpolant?at.NEAREST:at.LINEAR,at.CLAMP_TO_EDGE)}sn.draw(We,at.TRIANGLES,P,i.stencilModeForClipping(Wt),N,Pe.disabled,sa,o.id,hr.layoutVertexBuffer,hr.indexBuffer,hr.segments,o.paint,i.transform.zoom,Sr,hr.layoutVertexBuffer2),Ze=!1}}}}},fill:function(i,u,o,h){var _=o.paint.get("fill-color"),C=o.paint.get("fill-opacity");if(C.constantOr(1)!==0){var P=i.colorModeForRenderPass(),N=o.paint.get("fill-pattern"),K=i.opaquePassEnabledForLayer()&&!N.constantOr(1)&&_.constantOr(p.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(i.renderPass===K){var se=i.depthModeForSublayer(1,i.renderPass==="opaque"?U.ReadWrite:U.ReadOnly);Kl(i,u,o,h,se,P,!1)}if(i.renderPass==="translucent"&&o.paint.get("fill-antialias")){var Ce=i.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,U.ReadOnly);Kl(i,u,o,h,Ce,P,!0)}}},"fill-extrusion":function(i,u,o,h){var _=o.paint.get("fill-extrusion-opacity");if(_!==0&&i.renderPass==="translucent"){var C=new U(i.context.gl.LEQUAL,U.ReadWrite,i.depthRangeFor3D);if(_!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))_c(i,u,o,h,C,ae.disabled,de.disabled),_c(i,u,o,h,C,i.stencilModeFor3D(),i.colorModeForRenderPass());else{var P=i.colorModeForRenderPass();_c(i,u,o,h,C,ae.disabled,P)}}},hillshade:function(i,u,o,h){if(i.renderPass==="offscreen"||i.renderPass==="translucent"){for(var _=i.context,C=i.depthModeForSublayer(0,U.ReadOnly),P=i.colorModeForRenderPass(),N=i.renderPass==="translucent"?i.stencilConfigForOverlap(h):[{},h],K=N[0],se=0,Ce=N[1];se<Ce.length;se+=1){var Ae=Ce[se],Ie=u.getTile(Ae);Ie.needsHillshadePrepare&&i.renderPass==="offscreen"?Jl(i,Ie,o,C,ae.disabled,P):i.renderPass==="translucent"&&$l(i,Ie,o,C,K[Ae.overscaledZ],P)}_.viewport.set([0,0,i.width,i.height])}},raster:function(i,u,o,h){if(i.renderPass==="translucent"&&o.paint.get("raster-opacity")!==0&&h.length)for(var _=i.context,C=_.gl,P=u.getSource(),N=i.useProgram("raster"),K=i.colorModeForRenderPass(),se=P instanceof vt?[{},h]:i.stencilConfigForOverlap(h),Ce=se[0],Ae=se[1],Ie=Ae[Ae.length-1].overscaledZ,Ke=!i.options.moving,We=0,at=Ae;We<at.length;We+=1){var Ze=at[We],st=i.depthModeForSublayer(Ze.overscaledZ-Ie,o.paint.get("raster-opacity")===1?U.ReadWrite:U.ReadOnly,C.LESS),St=u.getTile(Ze),Wt=i.transform.calculatePosMatrix(Ze.toUnwrapped(),Ke);St.registerFadeDuration(o.paint.get("raster-fade-duration"));var xr=u.findLoadedParent(Ze,0),hr=Au(St,xr,u,o,i.transform),Sr=void 0,Gr=void 0,sn=o.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;_.activeTexture.set(C.TEXTURE0),St.texture.bind(sn,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(C.TEXTURE1),xr?(xr.texture.bind(sn,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),Sr=Math.pow(2,xr.tileID.overscaledZ-St.tileID.overscaledZ),Gr=[St.tileID.canonical.x*Sr%1,St.tileID.canonical.y*Sr%1]):St.texture.bind(sn,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var qr=Bc(Wt,Gr||[0,0],Sr||1,hr,o);P instanceof vt?N.draw(_,C.TRIANGLES,st,ae.disabled,K,Pe.disabled,qr,o.id,P.boundsBuffer,i.quadTriangleIndexBuffer,P.boundsSegments):N.draw(_,C.TRIANGLES,st,Ce[Ze.overscaledZ],K,Pe.disabled,qr,o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}},background:function(i,u,o){var h=o.paint.get("background-color"),_=o.paint.get("background-opacity");if(_!==0){var C=i.context,P=C.gl,N=i.transform,K=N.tileSize,se=o.paint.get("background-pattern");if(!i.isPatternMissing(se)){var Ce=!se&&h.a===1&&_===1&&i.opaquePassEnabledForLayer()?"opaque":"translucent";if(i.renderPass===Ce){var Ae=ae.disabled,Ie=i.depthModeForSublayer(0,Ce==="opaque"?U.ReadWrite:U.ReadOnly),Ke=i.colorModeForRenderPass(),We=i.useProgram(se?"backgroundPattern":"background"),at=N.coveringTiles({tileSize:K});se&&(C.activeTexture.set(P.TEXTURE0),i.imageManager.bind(i.context));for(var Ze=o.getCrossfadeParameters(),st=0,St=at;st<St.length;st+=1){var Wt=St[st],xr=i.transform.calculatePosMatrix(Wt.toUnwrapped()),hr=se?ol(xr,_,i,se,{tileID:Wt,tileSize:K},Ze):al(xr,_,h);We.draw(C,P.TRIANGLES,Ie,Ae,Ke,Pe.disabled,hr,o.id,i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}}}},debug:function(i,u,o){for(var h=0;h<o.length;h++)Va(i,u,o[h])},custom:function(i,u,o){var h=i.context,_=o.implementation;if(i.renderPass==="offscreen"){var C=_.prerender;C&&(i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),C.call(_,h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState())}else if(i.renderPass==="translucent"){i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),h.setStencilMode(ae.disabled);var P=_.renderingMode==="3d"?new U(i.context.gl.LEQUAL,U.ReadWrite,i.depthRangeFor3D):i.depthModeForSublayer(0,U.ReadOnly);h.setDepthMode(P),_.render(h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState(),h.bindFramebuffer.set(null)}}},Xa=function(i,u){this.context=new ue(i),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=Ee.maxUnderzooming+Ee.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new so,this.gpuTimers={}};Xa.prototype.resize=function(i,u){if(this.width=i*p.browser.devicePixelRatio,this.height=u*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var o=0,h=this.style._order;o<h.length;o+=1)this.style._layers[h[o]].resize()},Xa.prototype.setup=function(){var i=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(u,Pa.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var o=new p.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(p.EXTENT,0),o.emplaceBack(0,p.EXTENT),o.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=i.createVertexBuffer(o,Pa.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=i.createVertexBuffer(h,_t.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,Pa.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var C=new p.StructArrayLayout1ui2;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(C);var P=new p.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(P),this.emptyTexture=new p.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA);var N=this.context.gl;this.stencilClearMode=new ae({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO)},Xa.prototype.clearStencil=function(){var i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var o=p.create();p.ortho(o,0,this.width,this.height,0,0,1),p.scale(o,o,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,u.TRIANGLES,U.disabled,this.stencilClearMode,de.disabled,Pe.disabled,_s(o),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Xa.prototype._renderTileClippingMasks=function(i,u){if(this.currentStencilSource!==i.source&&i.isTileClipped()&&u&&u.length){this.currentStencilSource=i.source;var o=this.context,h=o.gl;this.nextStencilID+u.length>256&&this.clearStencil(),o.setColorMode(de.disabled),o.setDepthMode(U.disabled);var _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var C=0,P=u;C<P.length;C+=1){var N=P[C],K=this._tileClippingMaskIDs[N.key]=this.nextStencilID++;_.draw(o,h.TRIANGLES,U.disabled,new ae({func:h.ALWAYS,mask:0},K,255,h.KEEP,h.KEEP,h.REPLACE),de.disabled,Pe.disabled,_s(N.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Xa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var i=this.nextStencilID++,u=this.context.gl;return new ae({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)},Xa.prototype.stencilModeForClipping=function(i){var u=this.context.gl;return new ae({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)},Xa.prototype.stencilConfigForOverlap=function(i){var u,o=this.context.gl,h=i.sort(function(K,se){return se.overscaledZ-K.overscaledZ}),_=h[h.length-1].overscaledZ,C=h[0].overscaledZ-_+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();for(var P={},N=0;N<C;N++)P[N+_]=new ae({func:o.GEQUAL,mask:255},N+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=C,[P,h]}return[(u={},u[_]=ae.disabled,u),h]},Xa.prototype.colorModeForRenderPass=function(){var i=this.context.gl;return this._showOverdrawInspector?new de([i.CONSTANT_COLOR,i.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?de.unblended:de.alphaBlended},Xa.prototype.depthModeForSublayer=function(i,u,o){if(!this.opaquePassEnabledForLayer())return U.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new U(o||this.context.gl.LEQUAL,u,[h,h])},Xa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Xa.prototype.render=function(i,u){var o=this;this.style=i,this.options=u,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,_=this.style.sourceCaches;for(var C in _){var P=_[C];P.used&&P.prepare(this.context)}var N,K,se={},Ce={},Ae={};for(var Ie in _){var Ke=_[Ie];se[Ie]=Ke.getVisibleCoordinates(),Ce[Ie]=se[Ie].slice().reverse(),Ae[Ie]=Ke.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var We=0;We<h.length;We++)if(this.style._layers[h[We]].is3D()){this.opaquePassCutoff=We;break}this.renderPass="offscreen";for(var at=0,Ze=h;at<Ze.length;at+=1){var st=this.style._layers[Ze[at]];if(st.hasOffscreenPass()&&!st.isHidden(this.transform.zoom)){var St=Ce[st.source];(st.type==="custom"||St.length)&&this.renderLayer(this,_[st.source],st,St)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Wt=this.style._layers[h[this.currentLayer]],xr=_[Wt.source],hr=se[Wt.source];this._renderTileClippingMasks(Wt,hr),this.renderLayer(this,xr,Wt,hr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var Sr=this.style._layers[h[this.currentLayer]],Gr=_[Sr.source],sn=(Sr.type==="symbol"?Ae:Ce)[Sr.source];this._renderTileClippingMasks(Sr,se[Sr.source]),this.renderLayer(this,Gr,Sr,sn)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(qr){qr.source&&!qr.isHidden(o.transform.zoom)&&(qr.source!==(K&&K.id)&&(K=o.style.sourceCaches[qr.source]),(!N||N.getSource().maxzoom<K.getSource().maxzoom)&&(N=K))}),N&&ul.debug(this,N,N.getVisibleCoordinates())),this.options.showPadding&&function(qr){var Mn=qr.transform.padding;Cl(qr,qr.transform.height-(Mn.top||0),3,Pu),Cl(qr,Mn.bottom||0,3,Ql),bc(qr,Mn.left||0,3,ql),bc(qr,qr.transform.width-(Mn.right||0),3,pu);var ei=qr.transform.centerPoint;(function(fi,ri,sa,Vn){Zu(fi,ri-1,sa-10,2,20,Vn),Zu(fi,ri-10,sa-1,20,2,Vn)})(qr,ei.x,qr.transform.height-ei.y,xc)}(this),this.context.setDefault()},Xa.prototype.renderLayer=function(i,u,o,h){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||h.length)&&(this.id=o.id,this.gpuTimingStart(o),ul[o.type](i,u,o,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},Xa.prototype.gpuTimingStart=function(i){if(this.options.gpuTiming){var u=this.context.extTimerQuery,o=this.gpuTimers[i.id];o||(o=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),o.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,o.query)}},Xa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}},Xa.prototype.collectGpuTimers=function(){var i=this.gpuTimers;return this.gpuTimers={},i},Xa.prototype.queryGpuTimers=function(i){var u={};for(var o in i){var h=i[o],_=this.context.extTimerQuery,C=_.getQueryObjectEXT(h.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(h.query),u[o]=C}return u},Xa.prototype.translatePosMatrix=function(i,u,o,h,_){if(!o[0]&&!o[1])return i;var C=_?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(C){var P=Math.sin(C),N=Math.cos(C);o=[o[0]*N-o[1]*P,o[0]*P+o[1]*N]}var K=[_?o[0]:ga(u,o[0],this.transform.zoom),_?o[1]:ga(u,o[1],this.transform.zoom),0],se=new Float32Array(16);return p.translate(se,i,K),se},Xa.prototype.saveTileTexture=function(i){var u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]},Xa.prototype.getTileTexture=function(i){var u=this._tileTextures[i];return u&&u.length>0?u.pop():null},Xa.prototype.isPatternMissing=function(i){if(!i)return!1;if(!i.from||!i.to)return!0;var u=this.imageManager.getPattern(i.from.toString()),o=this.imageManager.getPattern(i.to.toString());return!u||!o},Xa.prototype.useProgram=function(i,u){this.cache=this.cache||{};var o=""+i+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[o]||(this.cache[o]=new xl(this.context,i,Yi[i],u,sl[i],this._showOverdrawInspector)),this.cache[o]},Xa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Xa.prototype.setBaseState=function(){var i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)},Xa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Xa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ju=function(i,u){this.points=i,this.planes=u};ju.fromInvProjectionMatrix=function(i,u,o){var h=Math.pow(2,o),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return p.transformMat4([],P,i)}).map(function(P){return p.scale$1([],P,1/P[3]/u*h)}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var N=p.sub([],_[P[0]],_[P[1]]),K=p.sub([],_[P[2]],_[P[1]]),se=p.normalize([],p.cross([],N,K)),Ce=-p.dot(se,_[P[1]]);return se.concat(Ce)});return new ju(_,C)};var Mu=function(i,u){this.min=i,this.max=u,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};Mu.prototype.quadrant=function(i){for(var u=[i%2==0,i<2],o=p.clone$2(this.min),h=p.clone$2(this.max),_=0;_<u.length;_++)o[_]=u[_]?this.min[_]:this.center[_],h[_]=u[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new Mu(o,h)},Mu.prototype.distanceX=function(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]},Mu.prototype.distanceY=function(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]},Mu.prototype.intersects=function(i){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],o=!0,h=0;h<i.planes.length;h++){for(var _=i.planes[h],C=0,P=0;P<u.length;P++)C+=p.dot$1(_,u[P])>=0;if(C===0)return 0;C!==u.length&&(o=!1)}if(o)return 2;for(var N=0;N<3;N++){for(var K=Number.MAX_VALUE,se=-Number.MAX_VALUE,Ce=0;Ce<i.points.length;Ce++){var Ae=i.points[Ce][N]-this.min[N];K=Math.min(K,Ae),se=Math.max(se,Ae)}if(se<0||K>this.max[N]-this.min[N])return 0}return 1};var qs=function(i,u,o,h){if(i===void 0&&(i=0),u===void 0&&(u=0),o===void 0&&(o=0),h===void 0&&(h=0),isNaN(i)||i<0||isNaN(u)||u<0||isNaN(o)||o<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=o,this.right=h};qs.prototype.interpolate=function(i,u,o){return u.top!=null&&i.top!=null&&(this.top=p.number(i.top,u.top,o)),u.bottom!=null&&i.bottom!=null&&(this.bottom=p.number(i.bottom,u.bottom,o)),u.left!=null&&i.left!=null&&(this.left=p.number(i.left,u.left,o)),u.right!=null&&i.right!=null&&(this.right=p.number(i.right,u.right,o)),this},qs.prototype.getCenter=function(i,u){var o=p.clamp((this.left+i-this.right)/2,0,i),h=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.Point(o,h)},qs.prototype.equals=function(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right},qs.prototype.clone=function(){return new qs(this.top,this.bottom,this.left,this.right)},qs.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var aa=function(i,u,o,h,_){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=_===void 0||_,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=o==null?0:o,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new qs,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ba={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};aa.prototype.clone=function(){var i=new aa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.tileSize=this.tileSize,i.latRange=this.latRange,i.width=this.width,i.height=this.height,i._center=this._center,i.zoom=this.zoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._calcMatrices(),i},Ba.minZoom.get=function(){return this._minZoom},Ba.minZoom.set=function(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))},Ba.maxZoom.get=function(){return this._maxZoom},Ba.maxZoom.set=function(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))},Ba.minPitch.get=function(){return this._minPitch},Ba.minPitch.set=function(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))},Ba.maxPitch.get=function(){return this._maxPitch},Ba.maxPitch.set=function(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))},Ba.renderWorldCopies.get=function(){return this._renderWorldCopies},Ba.renderWorldCopies.set=function(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i},Ba.worldSize.get=function(){return this.tileSize*this.scale},Ba.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ba.size.get=function(){return new p.Point(this.width,this.height)},Ba.bearing.get=function(){return-this.angle/Math.PI*180},Ba.bearing.set=function(i){var u=-p.wrap(i,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ba.pitch.get=function(){return this._pitch/Math.PI*180},Ba.pitch.set=function(i){var u=p.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Ba.fov.get=function(){return this._fov/Math.PI*180},Ba.fov.set=function(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())},Ba.zoom.get=function(){return this._zoom},Ba.zoom.set=function(i){var u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Ba.center.get=function(){return this._center},Ba.center.set=function(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())},Ba.padding.get=function(){return this._edgeInsets.toJSON()},Ba.padding.set=function(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())},Ba.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},aa.prototype.isPaddingEqual=function(i){return this._edgeInsets.equals(i)},aa.prototype.interpolatePadding=function(i,u,o){this._unmodified=!1,this._edgeInsets.interpolate(i,u,o),this._constrain(),this._calcMatrices()},aa.prototype.coveringZoomLevel=function(i){var u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)},aa.prototype.getVisibleUnwrappedCoordinates=function(i){var u=[new p.UnwrappedTileID(0,i)];if(this._renderWorldCopies)for(var o=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),_=this.pointCoordinate(new p.Point(this.width,this.height)),C=this.pointCoordinate(new p.Point(0,this.height)),P=Math.floor(Math.min(o.x,h.x,_.x,C.x)),N=Math.floor(Math.max(o.x,h.x,_.x,C.x)),K=P-1;K<=N+1;K++)K!==0&&u.push(new p.UnwrappedTileID(K,i));return u},aa.prototype.coveringTiles=function(i){var u=this.coveringZoomLevel(i),o=u;if(i.minzoom!==void 0&&u<i.minzoom)return[];i.maxzoom!==void 0&&u>i.maxzoom&&(u=i.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),_=Math.pow(2,u),C=[_*h.x,_*h.y,0],P=ju.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),N=i.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(N=u);var K=function(qr){return{aabb:new Mu([qr*_,0,0],[(qr+1)*_,_,0]),zoom:0,x:0,y:0,wrap:qr,fullyVisible:!1}},se=[],Ce=[],Ae=u,Ie=i.reparseOverscaled?o:u;if(this._renderWorldCopies)for(var Ke=1;Ke<=3;Ke++)se.push(K(-Ke)),se.push(K(Ke));for(se.push(K(0));se.length>0;){var We=se.pop(),at=We.x,Ze=We.y,st=We.fullyVisible;if(!st){var St=We.aabb.intersects(P);if(St===0)continue;st=St===2}var Wt=We.aabb.distanceX(C),xr=We.aabb.distanceY(C),hr=Math.max(Math.abs(Wt),Math.abs(xr));if(We.zoom===Ae||hr>3+(1<<Ae-We.zoom)-2&&We.zoom>=N)Ce.push({tileID:new p.OverscaledTileID(We.zoom===Ae?Ie:We.zoom,We.wrap,We.zoom,at,Ze),distanceSq:p.sqrLen([C[0]-.5-at,C[1]-.5-Ze])});else for(var Sr=0;Sr<4;Sr++){var Gr=(at<<1)+Sr%2,sn=(Ze<<1)+(Sr>>1);se.push({aabb:We.aabb.quadrant(Sr),zoom:We.zoom+1,x:Gr,y:sn,wrap:We.wrap,fullyVisible:st})}}return Ce.sort(function(qr,Mn){return qr.distanceSq-Mn.distanceSq}).map(function(qr){return qr.tileID})},aa.prototype.resize=function(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()},Ba.unmodified.get=function(){return this._unmodified},aa.prototype.zoomScale=function(i){return Math.pow(2,i)},aa.prototype.scaleZoom=function(i){return Math.log(i)/Math.LN2},aa.prototype.project=function(i){var u=p.clamp(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(i.lng)*this.worldSize,p.mercatorYfromLat(u)*this.worldSize)},aa.prototype.unproject=function(i){return new p.MercatorCoordinate(i.x/this.worldSize,i.y/this.worldSize).toLngLat()},Ba.point.get=function(){return this.project(this.center)},aa.prototype.setLocationAtPoint=function(i,u){var o=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(i),C=new p.MercatorCoordinate(_.x-(o.x-h.x),_.y-(o.y-h.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())},aa.prototype.locationPoint=function(i){return this.coordinatePoint(this.locationCoordinate(i))},aa.prototype.pointLocation=function(i){return this.coordinateLocation(this.pointCoordinate(i))},aa.prototype.locationCoordinate=function(i){return p.MercatorCoordinate.fromLngLat(i)},aa.prototype.coordinateLocation=function(i){return i.toLngLat()},aa.prototype.pointCoordinate=function(i){var u=[i.x,i.y,0,1],o=[i.x,i.y,1,1];p.transformMat4(u,u,this.pixelMatrixInverse),p.transformMat4(o,o,this.pixelMatrixInverse);var h=u[3],_=o[3],C=u[1]/h,P=o[1]/_,N=u[2]/h,K=o[2]/_,se=N===K?0:(0-N)/(K-N);return new p.MercatorCoordinate(p.number(u[0]/h,o[0]/_,se)/this.worldSize,p.number(C,P,se)/this.worldSize)},aa.prototype.coordinatePoint=function(i){var u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix),new p.Point(u[0]/u[3],u[1]/u[3])},aa.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},aa.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},aa.prototype.setMaxBounds=function(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},aa.prototype.calculatePosMatrix=function(i,u){u===void 0&&(u=!1);var o=i.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[o])return h[o];var _=i.canonical,C=this.worldSize/this.zoomScale(_.z),P=_.x+Math.pow(2,_.z)*i.wrap,N=p.identity(new Float64Array(16));return p.translate(N,N,[P*C,_.y*C,0]),p.scale(N,N,[C/p.EXTENT,C/p.EXTENT,1]),p.multiply(N,u?this.alignedProjMatrix:this.projMatrix,N),h[o]=new Float32Array(N),h[o]},aa.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},aa.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var i,u,o,h,_=-90,C=90,P=-180,N=180,K=this.size,se=this._unmodified;if(this.latRange){var Ce=this.latRange;_=p.mercatorYfromLat(Ce[1])*this.worldSize,i=(C=p.mercatorYfromLat(Ce[0])*this.worldSize)-_<K.y?K.y/(C-_):0}if(this.lngRange){var Ae=this.lngRange;P=p.mercatorXfromLng(Ae[0])*this.worldSize,u=(N=p.mercatorXfromLng(Ae[1])*this.worldSize)-P<K.x?K.x/(N-P):0}var Ie=this.point,Ke=Math.max(u||0,i||0);if(Ke)return this.center=this.unproject(new p.Point(u?(N+P)/2:Ie.x,i?(C+_)/2:Ie.y)),this.zoom+=this.scaleZoom(Ke),this._unmodified=se,void(this._constraining=!1);if(this.latRange){var We=Ie.y,at=K.y/2;We-at<_&&(h=_+at),We+at>C&&(h=C-at)}if(this.lngRange){var Ze=Ie.x,st=K.x/2;Ze-st<P&&(o=P+st),Ze+st>N&&(o=N-st)}o===void 0&&h===void 0||(this.center=this.unproject(new p.Point(o!==void 0?o:Ie.x,h!==void 0?h:Ie.y))),this._unmodified=se,this._constraining=!1}},aa.prototype._calcMatrices=function(){if(this.height){var i=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,o=this._fov*(.5+i.y/this.height),h=Math.sin(o)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-u-o,.01,Math.PI-.01)),_=this.point,C=_.x,P=_.y,N=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),K=this.height/50,se=new Float64Array(16);p.perspective(se,this._fov,this.width/this.height,K,N),se[8]=2*-i.x/this.width,se[9]=2*i.y/this.height,p.scale(se,se,[1,-1,1]),p.translate(se,se,[0,0,-this.cameraToCenterDistance]),p.rotateX(se,se,this._pitch),p.rotateZ(se,se,this.angle),p.translate(se,se,[-C,-P,0]),this.mercatorMatrix=p.scale([],se,[this.worldSize,this.worldSize,this.worldSize]),p.scale(se,se,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=se,this.invProjMatrix=p.invert([],this.projMatrix);var Ce=this.width%2/2,Ae=this.height%2/2,Ie=Math.cos(this.angle),Ke=Math.sin(this.angle),We=C-Math.round(C)+Ie*Ce+Ke*Ae,at=P-Math.round(P)+Ie*Ae+Ke*Ce,Ze=new Float64Array(se);if(p.translate(Ze,Ze,[We>.5?We-1:We,at>.5?at-1:at,0]),this.alignedProjMatrix=Ze,se=p.create(),p.scale(se,se,[this.width/2,-this.height/2,1]),p.translate(se,se,[1,-1,0]),this.labelPlaneMatrix=se,se=p.create(),p.scale(se,se,[1,-1,1]),p.translate(se,se,[-1,-1,0]),p.scale(se,se,[2/this.width,2/this.height,1]),this.glCoordMatrix=se,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(se=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=se,this._posMatrixCache={},this._alignedPosMatrixCache={}}},aa.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var i=this.pointCoordinate(new p.Point(0,0)),u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},aa.prototype.getCameraPoint=function(){var i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,i))},aa.prototype.getCameraQueryGeometry=function(i){var u=this.getCameraPoint();if(i.length===1)return[i[0],u];for(var o=u.x,h=u.y,_=u.x,C=u.y,P=0,N=i;P<N.length;P+=1){var K=N[P];o=Math.min(o,K.x),h=Math.min(h,K.y),_=Math.max(_,K.x),C=Math.max(C,K.y)}return[new p.Point(o,h),new p.Point(_,h),new p.Point(_,C),new p.Point(o,C),new p.Point(o,h)]},Object.defineProperties(aa.prototype,Ba);var Ps=function(i){var u,o,h,_;this._hashName=i&&encodeURIComponent(i),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),o=!1,h=null,_=function(){h=null,o&&(u(),h=setTimeout(_,300),o=!1)},function(){return o=!0,h||_(),h})};Ps.prototype.addTo=function(i){return this._map=i,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ps.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ps.prototype.getHashString=function(i){var u=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,h=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,h),C=Math.round(u.lng*_)/_,P=Math.round(u.lat*_)/_,N=this._map.getBearing(),K=this._map.getPitch(),se="";if(se+=i?"/"+C+"/"+P+"/"+o:o+"/"+P+"/"+C,(N||K)&&(se+="/"+Math.round(10*N)/10),K&&(se+="/"+Math.round(K)),this._hashName){var Ce=this._hashName,Ae=!1,Ie=p.window.location.hash.slice(1).split("&").map(function(Ke){var We=Ke.split("=")[0];return We===Ce?(Ae=!0,We+"="+se):Ke}).filter(function(Ke){return Ke});return Ae||Ie.push(Ce+"="+se),"#"+Ie.join("&")}return"#"+se},Ps.prototype._getCurrentHash=function(){var i,u=this,o=p.window.location.hash.replace("#","");return this._hashName?(o.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(i=h)}),(i&&i[1]||"").split("/")):o.split("/")},Ps.prototype._onHashChange=function(){var i=this._getCurrentHash();if(i.length>=3&&!i.some(function(o){return isNaN(o)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0}return!1},Ps.prototype._updateHashUnthrottled=function(){var i=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,i)}catch(u){}};var ec={linearity:.3,easing:p.bezier(0,0,.3,1)},du=p.extend({deceleration:2500,maxSpeed:1400},ec),tc=p.extend({deceleration:20,maxSpeed:1400},ec),nf=p.extend({deceleration:1e3,maxSpeed:360},ec),af=p.extend({deceleration:1e3,maxSpeed:90},ec),ll=function(i){this._map=i,this.clear()};function wl(i,u){(!i.duration||i.duration<u.duration)&&(i.duration=u.duration,i.easing=u.easing)}function Iu(i,u,o){var h=o.maxSpeed,_=o.linearity,C=o.deceleration,P=p.clamp(i*_/(u/1e3),-h,h),N=Math.abs(P)/(C*_);return{easing:o.easing,duration:1e3*N,amount:P*(N/2)}}ll.prototype.clear=function(){this._inertiaBuffer=[]},ll.prototype.record=function(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:i})},ll.prototype._drainInertiaBuffer=function(){for(var i=this._inertiaBuffer,u=p.browser.now();i.length>0&&u-i[0].time>160;)i.shift()},ll.prototype._onMoveEnd=function(i){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},o=0,h=this._inertiaBuffer;o<h.length;o+=1){var _=h[o].settings;u.zoom+=_.zoomDelta||0,u.bearing+=_.bearingDelta||0,u.pitch+=_.pitchDelta||0,_.panDelta&&u.pan._add(_.panDelta),_.around&&(u.around=_.around),_.pinchAround&&(u.pinchAround=_.pinchAround)}var C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(u.pan.mag()){var N=Iu(u.pan.mag(),C,p.extend({},du,i||{}));P.offset=u.pan.mult(N.amount/u.pan.mag()),P.center=this._map.transform.center,wl(P,N)}if(u.zoom){var K=Iu(u.zoom,C,tc);P.zoom=this._map.transform.zoom+K.amount,wl(P,K)}if(u.bearing){var se=Iu(u.bearing,C,nf);P.bearing=this._map.transform.bearing+p.clamp(se.amount,-179,179),wl(P,se)}if(u.pitch){var Ce=Iu(u.pitch,C,af);P.pitch=this._map.transform.pitch+Ce.amount,wl(P,Ce)}if(P.zoom||P.bearing){var Ae=u.pinchAround===void 0?u.around:u.pinchAround;P.around=Ae?this._map.unproject(Ae):this._map.getCenter()}return this.clear(),p.extend(P,{noMoveStart:!0})}};var Ro=function(i){function u(h,_,C,P){P===void 0&&(P={});var N=Z.mousePos(_.getCanvasContainer(),C),K=_.unproject(N);i.call(this,h,p.extend({point:N,lngLat:K,originalEvent:C},P)),this._defaultPrevented=!1,this.target=_}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(p.Event),Tl=function(i){function u(h,_,C){var P=h==="touchend"?C.changedTouches:C.touches,N=Z.touchPos(_.getCanvasContainer(),P),K=N.map(function(Ae){return _.unproject(Ae)}),se=N.reduce(function(Ae,Ie,Ke,We){return Ae.add(Ie.div(We.length))},new p.Point(0,0)),Ce=_.unproject(se);i.call(this,h,{points:N,point:se,lngLats:K,lngLat:Ce,originalEvent:C}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(p.Event),Vs=function(i){function u(h,_,C){i.call(this,h,{originalEvent:C}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(p.Event),Eo=function(i,u){this._map=i,this._clickTolerance=u.clickTolerance};Eo.prototype.reset=function(){delete this._mousedownPos},Eo.prototype.wheel=function(i){return this._firePreventable(new Vs(i.type,this._map,i))},Eo.prototype.mousedown=function(i,u){return this._mousedownPos=u,this._firePreventable(new Ro(i.type,this._map,i))},Eo.prototype.mouseup=function(i){this._map.fire(new Ro(i.type,this._map,i))},Eo.prototype.click=function(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Ro(i.type,this._map,i))},Eo.prototype.dblclick=function(i){return this._firePreventable(new Ro(i.type,this._map,i))},Eo.prototype.mouseover=function(i){this._map.fire(new Ro(i.type,this._map,i))},Eo.prototype.mouseout=function(i){this._map.fire(new Ro(i.type,this._map,i))},Eo.prototype.touchstart=function(i){return this._firePreventable(new Tl(i.type,this._map,i))},Eo.prototype.touchmove=function(i){this._map.fire(new Tl(i.type,this._map,i))},Eo.prototype.touchend=function(i){this._map.fire(new Tl(i.type,this._map,i))},Eo.prototype.touchcancel=function(i){this._map.fire(new Tl(i.type,this._map,i))},Eo.prototype._firePreventable=function(i){if(this._map.fire(i),i.defaultPrevented)return{}},Eo.prototype.isEnabled=function(){return!0},Eo.prototype.isActive=function(){return!1},Eo.prototype.enable=function(){},Eo.prototype.disable=function(){};var Nn=function(i){this._map=i};Nn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Nn.prototype.mousemove=function(i){this._map.fire(new Ro(i.type,this._map,i))},Nn.prototype.mousedown=function(){this._delayContextMenu=!0},Nn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ro("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Nn.prototype.contextmenu=function(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Ro(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()},Nn.prototype.isEnabled=function(){return!0},Nn.prototype.isActive=function(){return!1},Nn.prototype.enable=function(){},Nn.prototype.disable=function(){};var fo=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1};function vu(i,u){for(var o={},h=0;h<i.length;h++)o[i[h].identifier]=u[h];return o}fo.prototype.isEnabled=function(){return!!this._enabled},fo.prototype.isActive=function(){return!!this._active},fo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},fo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},fo.prototype.mousedown=function(i,u){this.isEnabled()&&i.shiftKey&&i.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},fo.prototype.mousemoveWindow=function(i,u){if(this._active){var o=u;if(!(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=o,this._box||(this._box=Z.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));var _=Math.min(h.x,o.x),C=Math.max(h.x,o.x),P=Math.min(h.y,o.y),N=Math.max(h.y,o.y);Z.setTransform(this._box,"translate("+_+"px,"+P+"px)"),this._box.style.width=C-_+"px",this._box.style.height=N-P+"px"}}},fo.prototype.mouseupWindow=function(i,u){var o=this;if(this._active&&i.button===0){var h=this._startPos,_=u;if(this.reset(),Z.suppressClick(),h.x!==_.x||h.y!==_.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:function(C){return C.fitScreenCoordinates(h,_,o._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",i)}},fo.prototype.keydown=function(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))},fo.prototype.blur=function(){this.reset()},fo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos},fo.prototype._fireEvent=function(i,u){return this._map.fire(new p.Event(i,{originalEvent:u}))};var cl=function(i){this.reset(),this.numTouches=i.numTouches};cl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},cl.prototype.touchstart=function(i,u,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),o.length===this.numTouches&&(this.centroid=function(h){for(var _=new p.Point(0,0),C=0,P=h;C<P.length;C+=1)_._add(P[C]);return _.div(h.length)}(u),this.touches=vu(o,u)))},cl.prototype.touchmove=function(i,u,o){if(!this.aborted&&this.centroid){var h=vu(o,u);for(var _ in this.touches){var C=h[_];(!C||C.dist(this.touches[_])>30)&&(this.aborted=!0)}}},cl.prototype.touchend=function(i,u,o){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var eu=function(i){this.singleTap=new cl(i),this.numTaps=i.numTaps,this.reset()};eu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},eu.prototype.touchstart=function(i,u,o){this.singleTap.touchstart(i,u,o)},eu.prototype.touchmove=function(i,u,o){this.singleTap.touchmove(i,u,o)},eu.prototype.touchend=function(i,u,o){var h=this.singleTap.touchend(i,u,o);if(h){var _=i.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(h)<30;if(_&&C||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var Ms=function(){this._zoomIn=new eu({numTouches:1,numTaps:2}),this._zoomOut=new eu({numTouches:2,numTaps:1}),this.reset()};Ms.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ms.prototype.touchstart=function(i,u,o){this._zoomIn.touchstart(i,u,o),this._zoomOut.touchstart(i,u,o)},Ms.prototype.touchmove=function(i,u,o){this._zoomIn.touchmove(i,u,o),this._zoomOut.touchmove(i,u,o)},Ms.prototype.touchend=function(i,u,o){var h=this,_=this._zoomIn.touchend(i,u,o),C=this._zoomOut.touchend(i,u,o);return _?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(_)},{originalEvent:i})}}):C?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(C)},{originalEvent:i})}}):void 0},Ms.prototype.touchcancel=function(){this.reset()},Ms.prototype.enable=function(){this._enabled=!0},Ms.prototype.disable=function(){this._enabled=!1,this.reset()},Ms.prototype.isEnabled=function(){return this._enabled},Ms.prototype.isActive=function(){return this._active};var Sc={0:1,2:2},gn=function(i){this.reset(),this._clickTolerance=i.clickTolerance||1};gn.prototype.blur=function(){this.reset()},gn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},gn.prototype._correctButton=function(i,u){return!1},gn.prototype._move=function(i,u){return{}},gn.prototype.mousedown=function(i,u){if(!this._lastPoint){var o=Z.mouseButton(i);this._correctButton(i,o)&&(this._lastPoint=u,this._eventButton=o)}},gn.prototype.mousemoveWindow=function(i,u){var o=this._lastPoint;if(o){if(i.preventDefault(),function(h,_){var C=Sc[_];return h.buttons===void 0||(h.buttons&C)!==C}(i,this._eventButton))this.reset();else if(this._moved||!(u.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(o,u)}},gn.prototype.mouseupWindow=function(i){this._lastPoint&&Z.mouseButton(i)===this._eventButton&&(this._moved&&Z.suppressClick(),this.reset())},gn.prototype.enable=function(){this._enabled=!0},gn.prototype.disable=function(){this._enabled=!1,this.reset()},gn.prototype.isEnabled=function(){return this._enabled},gn.prototype.isActive=function(){return this._active};var rc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.mousedown=function(o,h){i.prototype.mousedown.call(this,o,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(o,h){return h===0&&!o.ctrlKey},u.prototype._move=function(o,h){return{around:h,panDelta:h.sub(o)}},u}(gn),nc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var _=.8*(h.x-o.x);if(_)return this._active=!0,{bearingDelta:_}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(gn),Ou=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var _=-.5*(h.y-o.y);if(_)return this._active=!0,{pitchDelta:_}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(gn),Ua=function(i){this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset()};Ua.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},Ua.prototype.touchstart=function(i,u,o){return this._calculateTransform(i,u,o)},Ua.prototype.touchmove=function(i,u,o){if(this._active&&!(o.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,u,o)},Ua.prototype.touchend=function(i,u,o){this._calculateTransform(i,u,o),this._active&&o.length<this._minTouches&&this.reset()},Ua.prototype.touchcancel=function(){this.reset()},Ua.prototype._calculateTransform=function(i,u,o){o.length>0&&(this._active=!0);var h=vu(o,u),_=new p.Point(0,0),C=new p.Point(0,0),P=0;for(var N in h){var K=h[N],se=this._touches[N];se&&(_._add(K),C._add(K.sub(se)),P++,h[N]=K)}if(this._touches=h,!(P<this._minTouches)&&C.mag()){var Ce=C.div(P);if(this._sum._add(Ce),!(this._sum.mag()<this._clickTolerance))return{around:_.div(P),panDelta:Ce}}},Ua.prototype.enable=function(){this._enabled=!0},Ua.prototype.disable=function(){this._enabled=!1,this.reset()},Ua.prototype.isEnabled=function(){return this._enabled},Ua.prototype.isActive=function(){return this._active};var Is=function(){this.reset()};function ic(i,u,o){for(var h=0;h<i.length;h++)if(i[h].identifier===o)return u[h]}function mu(i,u){return Math.log(i/u)/Math.LN2}Is.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Is.prototype._start=function(i){},Is.prototype._move=function(i,u,o){return{}},Is.prototype.touchstart=function(i,u,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([u[0],u[1]]))},Is.prototype.touchmove=function(i,u,o){if(this._firstTwoTouches){i.preventDefault();var h=this._firstTwoTouches,_=h[1],C=ic(o,u,h[0]),P=ic(o,u,_);if(C&&P){var N=this._aroundCenter?null:C.add(P).div(2);return this._move([C,P],N,i)}}},Is.prototype.touchend=function(i,u,o){if(this._firstTwoTouches){var h=this._firstTwoTouches,_=h[1],C=ic(o,u,h[0]),P=ic(o,u,_);C&&P||(this._active&&Z.suppressClick(),this.reset())}},Is.prototype.touchcancel=function(){this.reset()},Is.prototype.enable=function(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"},Is.prototype.disable=function(){this._enabled=!1,this.reset()},Is.prototype.isEnabled=function(){return this._enabled},Is.prototype.isActive=function(){return this._active};var Os=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(o){this._startDistance=this._distance=o[0].dist(o[1])},u.prototype._move=function(o,h){var _=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(mu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:mu(this._distance,_),pinchAround:h}},u}(Is);function gu(i,u){return 180*i.angleWith(u)/Math.PI}var zc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])},u.prototype._move=function(o,h){var _=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:gu(this._vector,_),pinchAround:h}},u.prototype._isBelowThreshold=function(o){this._minDiameter=Math.min(this._minDiameter,o.mag());var h=25/(Math.PI*this._minDiameter)*360,_=gu(o,this._startVector);return Math.abs(_)<h},u}(Is);function Al(i){return Math.abs(i.y)>Math.abs(i.x)}var Ec=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(o){this._lastPoints=o,Al(o[0].sub(o[1]))&&(this._valid=!1)},u.prototype._move=function(o,h,_){var C=o[0].sub(this._lastPoints[0]),P=o[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(C,P,_.timeStamp),this._valid)return this._lastPoints=o,this._active=!0,{pitchDelta:(C.y+P.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(o,h,_){if(this._valid!==void 0)return this._valid;var C=o.mag()>=2,P=h.mag()>=2;if(C||P){if(!C||!P)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;var N=o.y>0==h.y>0;return Al(o)&&Al(h)&&N}},u}(Is),Cc={panStep:100,bearingStep:15,pitchStep:10},Gs=function(){var i=Cc;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1};function Ls(i){return i*(2-i)}Gs.prototype.blur=function(){this.reset()},Gs.prototype.reset=function(){this._active=!1},Gs.prototype.keydown=function(i){var u=this;if(!(i.altKey||i.ctrlKey||i.metaKey)){var o=0,h=0,_=0,C=0,P=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),C=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),C=1);break;case 38:i.shiftKey?_=1:(i.preventDefault(),P=-1);break;case 40:i.shiftKey?_=-1:(i.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(h=0,_=0),{cameraAnimation:function(N){var K=N.getZoom();N.easeTo({duration:300,easeId:"keyboardHandler",easing:Ls,zoom:o?Math.round(K)+o*(i.shiftKey?2:1):K,bearing:N.getBearing()+h*u._bearingStep,pitch:N.getPitch()+_*u._pitchStep,offset:[-C*u._panStep,-P*u._panStep],center:N.getCenter()},{originalEvent:i})}}}},Gs.prototype.enable=function(){this._enabled=!0},Gs.prototype.disable=function(){this._enabled=!1,this.reset()},Gs.prototype.isEnabled=function(){return this._enabled},Gs.prototype.isActive=function(){return this._active},Gs.prototype.disableRotation=function(){this._rotationDisabled=!0},Gs.prototype.enableRotation=function(){this._rotationDisabled=!1};var ta=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};ta.prototype.setZoomRate=function(i){this._defaultZoomRate=i},ta.prototype.setWheelZoomRate=function(i){this._wheelZoomRate=i},ta.prototype.isEnabled=function(){return!!this._enabled},ta.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ta.prototype.isZooming=function(){return!!this._zooming},ta.prototype.enable=function(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&i.around==="center")},ta.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ta.prototype.wheel=function(i){if(this.isEnabled()){var u=i.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,o=p.browser.now(),h=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}},ta.prototype._onTimeout=function(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)},ta.prototype._start=function(i){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=Z.mousePos(this._el,i);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ta.prototype.renderFrame=function(){var i=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var o=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*o)));this._delta<0&&h!==0&&(h=1/h);var _=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(_*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var C,P=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,N=this._startZoom,K=this._easing,se=!1;if(this._type==="wheel"&&N&&K){var Ce=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),Ae=K(Ce);C=p.number(N,P,Ae),Ce<1?this._frameId||(this._frameId=!0):se=!0}else C=P,se=!0;return this._active=!0,se&&(this._active=!1,this._finishTimeout=setTimeout(function(){i._zooming=!1,i._handler._triggerRenderFrame(),delete i._targetZoom,delete i._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!se,zoomDelta:C-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ta.prototype._smoothOutEasing=function(i){var u=p.ease;if(this._prevEase){var o=this._prevEase,h=(p.browser.now()-o.start)/o.duration,_=o.easing(h+.01)-o.easing(h),C=.27/Math.sqrt(_*_+1e-4)*.01,P=Math.sqrt(.0729-C*C);u=p.bezier(C,P,.25,1)}return this._prevEase={start:p.browser.now(),duration:i,easing:u},u},ta.prototype.blur=function(){this.reset()},ta.prototype.reset=function(){this._active=!1};var yu=function(i,u){this._clickZoom=i,this._tapZoom=u};yu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},yu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},yu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},yu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Hs=function(){this.reset()};Hs.prototype.reset=function(){this._active=!1},Hs.prototype.blur=function(){this.reset()},Hs.prototype.dblclick=function(i,u){return i.preventDefault(),{cameraAnimation:function(o){o.easeTo({duration:300,zoom:o.getZoom()+(i.shiftKey?-1:1),around:o.unproject(u)},{originalEvent:i})}}},Hs.prototype.enable=function(){this._enabled=!0},Hs.prototype.disable=function(){this._enabled=!1,this.reset()},Hs.prototype.isEnabled=function(){return this._enabled},Hs.prototype.isActive=function(){return this._active};var Uo=function(){this._tap=new eu({numTouches:1,numTaps:1}),this.reset()};Uo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Uo.prototype.touchstart=function(i,u,o){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=u[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(i,u,o))},Uo.prototype.touchmove=function(i,u,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;var h=u[0],_=h.y-this._swipePoint.y;return this._swipePoint=h,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,u,o)},Uo.prototype.touchend=function(i,u,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(i,u,o)&&(this._tapTime=i.timeStamp)},Uo.prototype.touchcancel=function(){this.reset()},Uo.prototype.enable=function(){this._enabled=!0},Uo.prototype.disable=function(){this._enabled=!1,this.reset()},Uo.prototype.isEnabled=function(){return this._enabled},Uo.prototype.isActive=function(){return this._active};var Vu=function(i,u,o){this._el=i,this._mousePan=u,this._touchPan=o};Vu.prototype.enable=function(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Vu.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Vu.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Vu.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var au=function(i,u,o){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=o};au.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},au.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},au.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},au.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var ou=function(i,u,o,h){this._el=i,this._touchZoom=u,this._touchRotate=o,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};ou.prototype.enable=function(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},ou.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},ou.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},ou.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},ou.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},ou.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Co=function(i){return i.zoom||i.drag||i.pitch||i.rotate},Gu=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u}(p.Event);function ni(i){return i.panDelta&&i.panDelta.mag()||i.zoomDelta||i.bearingDelta||i.pitchDelta}var $n=function(i,u){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ll(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);var o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[p.window,"blur",void 0]];for(var h=0,_=this._listeners;h<_.length;h+=1){var C=_[h],P=C[0];Z.addEventListener(P,C[1],P===p.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};$n.prototype.destroy=function(){for(var i=0,u=this._listeners;i<u.length;i+=1){var o=u[i],h=o[0];Z.removeEventListener(h,o[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,o[2])}},$n.prototype._addDefaultHandlers=function(i){var u=this._map,o=u.getCanvasContainer();this._add("mapEvent",new Eo(u,i));var h=u.boxZoom=new fo(u,i);this._add("boxZoom",h);var _=new Ms,C=new Hs;u.doubleClickZoom=new yu(C,_),this._add("tapZoom",_),this._add("clickZoom",C);var P=new Uo;this._add("tapDragZoom",P);var N=u.touchPitch=new Ec;this._add("touchPitch",N);var K=new nc(i),se=new Ou(i);u.dragRotate=new au(i,K,se),this._add("mouseRotate",K,["mousePitch"]),this._add("mousePitch",se,["mouseRotate"]);var Ce=new rc(i),Ae=new Ua(i);u.dragPan=new Vu(o,Ce,Ae),this._add("mousePan",Ce),this._add("touchPan",Ae,["touchZoom","touchRotate"]);var Ie=new zc,Ke=new Os;u.touchZoomRotate=new ou(o,Ke,Ie,P),this._add("touchRotate",Ie,["touchPan","touchZoom"]),this._add("touchZoom",Ke,["touchPan","touchRotate"]);var We=u.scrollZoom=new ta(u,this);this._add("scrollZoom",We,["mousePan"]);var at=u.keyboard=new Gs;this._add("keyboard",at),this._add("blockableMapEvent",new Nn(u));for(var Ze=0,st=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ze<st.length;Ze+=1){var St=st[Ze];i.interactive&&i[St]&&u[St].enable(i[St])}},$n.prototype._add=function(i,u,o){this._handlers.push({handlerName:i,handler:u,allowed:o}),this._handlersById[i]=u},$n.prototype.stop=function(i){if(!this._updatingCamera){for(var u=0,o=this._handlers;u<o.length;u+=1)o[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}},$n.prototype.isActive=function(){for(var i=0,u=this._handlers;i<u.length;i+=1)if(u[i].handler.isActive())return!0;return!1},$n.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},$n.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},$n.prototype.isMoving=function(){return Boolean(Co(this._eventsInProgress))||this.isZooming()},$n.prototype._blockedByActive=function(i,u,o){for(var h in i)if(h!==o&&(!u||u.indexOf(h)<0))return!0;return!1},$n.prototype.handleWindowEvent=function(i){this.handleEvent(i,i.type+"Window")},$n.prototype._getMapTouches=function(i){for(var u=[],o=0,h=i;o<h.length;o+=1){var _=h[o];this._el.contains(_.target)&&u.push(_)}return u},$n.prototype.handleEvent=function(i,u){this._updatingCamera=!0;for(var o=i.type==="renderFrame"?void 0:i,h={needsRenderFrame:!1},_={},C={},P=i.touches?this._getMapTouches(i.touches):void 0,N=P?Z.touchPos(this._el,P):Z.mousePos(this._el,i),K=0,se=this._handlers;K<se.length;K+=1){var Ce=se[K],Ae=Ce.handlerName,Ie=Ce.handler,Ke=Ce.allowed;if(Ie.isEnabled()){var We=void 0;this._blockedByActive(C,Ke,Ae)?Ie.reset():Ie[u||i.type]&&(We=Ie[u||i.type](i,N,P),this.mergeHandlerResult(h,_,We,Ae,o),We&&We.needsRenderFrame&&this._triggerRenderFrame()),(We||Ie.isActive())&&(C[Ae]=Ie)}}var at={};for(var Ze in this._previousActiveHandlers)C[Ze]||(at[Ze]=o);this._previousActiveHandlers=C,(Object.keys(at).length||ni(h))&&(this._changes.push([h,_,at]),this._triggerRenderFrame()),(Object.keys(C).length||ni(h))&&this._map._stop(!0),this._updatingCamera=!1;var st=h.cameraAnimation;st&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],st(this._map))},$n.prototype.mergeHandlerResult=function(i,u,o,h,_){if(o){p.extend(i,o);var C={handlerName:h,originalEvent:o.originalEvent||_};o.zoomDelta!==void 0&&(u.zoom=C),o.panDelta!==void 0&&(u.drag=C),o.pitchDelta!==void 0&&(u.pitch=C),o.bearingDelta!==void 0&&(u.rotate=C)}},$n.prototype._applyChanges=function(){for(var i={},u={},o={},h=0,_=this._changes;h<_.length;h+=1){var C=_[h],P=C[0],N=C[1],K=C[2];P.panDelta&&(i.panDelta=(i.panDelta||new p.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(i.around=P.around),P.pinchAround!==void 0&&(i.pinchAround=P.pinchAround),P.noInertia&&(i.noInertia=P.noInertia),p.extend(u,N),p.extend(o,K)}this._updateMapTransform(i,u,o),this._changes=[]},$n.prototype._updateMapTransform=function(i,u,o){var h=this._map,_=h.transform;if(!ni(i))return this._fireEvents(u,o,!0);var C=i.panDelta,P=i.zoomDelta,N=i.bearingDelta,K=i.pitchDelta,se=i.around,Ce=i.pinchAround;Ce!==void 0&&(se=Ce),h._stop(!0),se=se||h.transform.centerPoint;var Ae=_.pointLocation(C?se.sub(C):se);N&&(_.bearing+=N),K&&(_.pitch+=K),P&&(_.zoom+=P),_.setLocationAtPoint(Ae,se),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,o,!0)},$n.prototype._fireEvents=function(i,u,o){var h=this,_=Co(this._eventsInProgress),C=Co(i),P={};for(var N in i)this._eventsInProgress[N]||(P[N+"start"]=i[N].originalEvent),this._eventsInProgress[N]=i[N];for(var K in!_&&C&&this._fireEvent("movestart",C.originalEvent),P)this._fireEvent(K,P[K]);for(var se in C&&this._fireEvent("move",C.originalEvent),i)this._fireEvent(se,i[se].originalEvent);var Ce,Ae={};for(var Ie in this._eventsInProgress){var Ke=this._eventsInProgress[Ie],We=Ke.handlerName,at=Ke.originalEvent;this._handlersById[We].isActive()||(delete this._eventsInProgress[Ie],Ae[Ie+"end"]=Ce=u[We]||at)}for(var Ze in Ae)this._fireEvent(Ze,Ae[Ze]);var st=Co(this._eventsInProgress);if(o&&(_||C)&&!st){this._updatingCamera=!0;var St=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Wt=function(xr){return xr!==0&&-h._bearingSnap<xr&&xr<h._bearingSnap};St?(Wt(St.bearing||this._map.getBearing())&&(St.bearing=0),this._map.easeTo(St,{originalEvent:Ce})):(this._map.fire(new p.Event("moveend",{originalEvent:Ce})),Wt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},$n.prototype._fireEvent=function(i,u){this._map.fire(new p.Event(i,u?{originalEvent:u}:{}))},$n.prototype._requestFrame=function(){var i=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete i._frameId,i.handleEvent(new Gu("renderFrame",{timeStamp:u})),i._applyChanges()})},$n.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Pl=function(i){function u(o,h){i.call(this),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(o,h){return this.jumpTo({center:o},h)},u.prototype.panBy=function(o,h,_){return o=p.Point.convert(o).mult(-1),this.panTo(this.transform.center,p.extend({offset:o},h),_)},u.prototype.panTo=function(o,h,_){return this.easeTo(p.extend({center:o},h),_)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(o,h){return this.jumpTo({zoom:o},h),this},u.prototype.zoomTo=function(o,h,_){return this.easeTo(p.extend({zoom:o},h),_)},u.prototype.zoomIn=function(o,h){return this.zoomTo(this.getZoom()+1,o,h),this},u.prototype.zoomOut=function(o,h){return this.zoomTo(this.getZoom()-1,o,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(o,h){return this.jumpTo({bearing:o},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(o,h){return this.jumpTo({padding:o},h),this},u.prototype.rotateTo=function(o,h,_){return this.easeTo(p.extend({bearing:o},h),_)},u.prototype.resetNorth=function(o,h){return this.rotateTo(0,p.extend({duration:1e3},o),h),this},u.prototype.resetNorthPitch=function(o,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},o),h),this},u.prototype.snapToNorth=function(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(o,h){return this.jumpTo({pitch:o},h),this},u.prototype.cameraForBounds=function(o,h){o=p.LngLatBounds.convert(o);var _=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),_,h)},u.prototype._cameraForBoxAndBearing=function(o,h,_,C){var P={top:0,bottom:0,right:0,left:0};if(typeof(C=p.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){var N=C.padding;C.padding={top:N,bottom:N,right:N,left:N}}C.padding=p.extend(P,C.padding);var K=this.transform,se=K.padding,Ce=K.project(p.LngLat.convert(o)),Ae=K.project(p.LngLat.convert(h)),Ie=Ce.rotate(-_*Math.PI/180),Ke=Ae.rotate(-_*Math.PI/180),We=new p.Point(Math.max(Ie.x,Ke.x),Math.max(Ie.y,Ke.y)),at=new p.Point(Math.min(Ie.x,Ke.x),Math.min(Ie.y,Ke.y)),Ze=We.sub(at),st=(K.width-(se.left+se.right+C.padding.left+C.padding.right))/Ze.x,St=(K.height-(se.top+se.bottom+C.padding.top+C.padding.bottom))/Ze.y;if(!(St<0||st<0)){var Wt=Math.min(K.scaleZoom(K.scale*Math.min(st,St)),C.maxZoom),xr=typeof C.offset.x=="number"?new p.Point(C.offset.x,C.offset.y):p.Point.convert(C.offset),hr=new p.Point((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(_*Math.PI/180),Sr=xr.add(hr).mult(K.scale/K.zoomScale(Wt));return{center:K.unproject(Ce.add(Ae).div(2).sub(Sr)),zoom:Wt,bearing:_}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(o,h,_){return this._fitInternal(this.cameraForBounds(o,h),h,_)},u.prototype.fitScreenCoordinates=function(o,h,_,C,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(o)),this.transform.pointLocation(p.Point.convert(h)),_,C),C,P)},u.prototype._fitInternal=function(o,h,_){return o?(delete(h=p.extend(o,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this},u.prototype.jumpTo=function(o,h){this.stop();var _=this.transform,C=!1,P=!1,N=!1;return"zoom"in o&&_.zoom!==+o.zoom&&(C=!0,_.zoom=+o.zoom),o.center!==void 0&&(_.center=p.LngLat.convert(o.center)),"bearing"in o&&_.bearing!==+o.bearing&&(P=!0,_.bearing=+o.bearing),"pitch"in o&&_.pitch!==+o.pitch&&(N=!0,_.pitch=+o.pitch),o.padding==null||_.isPaddingEqual(o.padding)||(_.padding=o.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),C&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),P&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),N&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},u.prototype.easeTo=function(o,h){var _=this;this._stop(!1,o.easeId),((o=p.extend({offset:[0,0],duration:500,easing:p.ease},o)).animate===!1||!o.essential&&p.browser.prefersReducedMotion)&&(o.duration=0);var C=this.transform,P=this.getZoom(),N=this.getBearing(),K=this.getPitch(),se=this.getPadding(),Ce="zoom"in o?+o.zoom:P,Ae="bearing"in o?this._normalizeBearing(o.bearing,N):N,Ie="pitch"in o?+o.pitch:K,Ke="padding"in o?o.padding:C.padding,We=p.Point.convert(o.offset),at=C.centerPoint.add(We),Ze=C.pointLocation(at),st=p.LngLat.convert(o.center||Ze);this._normalizeCenter(st);var St,Wt,xr=C.project(Ze),hr=C.project(st).sub(xr),Sr=C.zoomScale(Ce-P);o.around&&(St=p.LngLat.convert(o.around),Wt=C.locationPoint(St));var Gr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ce!==P,this._rotating=this._rotating||N!==Ae,this._pitching=this._pitching||Ie!==K,this._padding=!C.isPaddingEqual(Ke),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,Gr),this._ease(function(sn){if(_._zooming&&(C.zoom=p.number(P,Ce,sn)),_._rotating&&(C.bearing=p.number(N,Ae,sn)),_._pitching&&(C.pitch=p.number(K,Ie,sn)),_._padding&&(C.interpolatePadding(se,Ke,sn),at=C.centerPoint.add(We)),St)C.setLocationAtPoint(St,Wt);else{var qr=C.zoomScale(C.zoom-P),Mn=Ce>P?Math.min(2,Sr):Math.max(.5,Sr),ei=Math.pow(Mn,1-sn),fi=C.unproject(xr.add(hr.mult(sn*ei)).mult(qr));C.setLocationAtPoint(C.renderWorldCopies?fi.wrap():fi,at)}_._fireMoveEvents(h)},function(sn){_._afterEase(h,sn)},o),this},u.prototype._prepareEase=function(o,h,_){_===void 0&&(_={}),this._moving=!0,h||_.moving||this.fire(new p.Event("movestart",o)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",o)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",o)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",o))},u.prototype._fireMoveEvents=function(o){this.fire(new p.Event("move",o)),this._zooming&&this.fire(new p.Event("zoom",o)),this._rotating&&this.fire(new p.Event("rotate",o)),this._pitching&&this.fire(new p.Event("pitch",o))},u.prototype._afterEase=function(o,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var _=this._zooming,C=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",o)),C&&this.fire(new p.Event("rotateend",o)),P&&this.fire(new p.Event("pitchend",o)),this.fire(new p.Event("moveend",o))}},u.prototype.flyTo=function(o,h){var _=this;if(!o.essential&&p.browser.prefersReducedMotion){var C=p.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(C,h)}this.stop(),o=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},o);var P=this.transform,N=this.getZoom(),K=this.getBearing(),se=this.getPitch(),Ce=this.getPadding(),Ae="zoom"in o?p.clamp(+o.zoom,P.minZoom,P.maxZoom):N,Ie="bearing"in o?this._normalizeBearing(o.bearing,K):K,Ke="pitch"in o?+o.pitch:se,We="padding"in o?o.padding:P.padding,at=P.zoomScale(Ae-N),Ze=p.Point.convert(o.offset),st=P.centerPoint.add(Ze),St=P.pointLocation(st),Wt=p.LngLat.convert(o.center||St);this._normalizeCenter(Wt);var xr=P.project(St),hr=P.project(Wt).sub(xr),Sr=o.curve,Gr=Math.max(P.width,P.height),sn=Gr/at,qr=hr.mag();if("minZoom"in o){var Mn=p.clamp(Math.min(o.minZoom,N,Ae),P.minZoom,P.maxZoom),ei=Gr/P.zoomScale(Mn-N);Sr=Math.sqrt(ei/qr*2)}var fi=Sr*Sr;function ri(F){var ie=(sn*sn-Gr*Gr+(F?-1:1)*fi*fi*qr*qr)/(2*(F?sn:Gr)*fi*qr);return Math.log(Math.sqrt(ie*ie+1)-ie)}function sa(F){return(Math.exp(F)-Math.exp(-F))/2}function Vn(F){return(Math.exp(F)+Math.exp(-F))/2}var Si=ri(0),Ui=function(F){return Vn(Si)/Vn(Si+Sr*F)},ee=function(F){return Gr*((Vn(Si)*(sa(ie=Si+Sr*F)/Vn(ie))-sa(Si))/fi)/qr;var ie},ne=(ri(1)-Si)/Sr;if(Math.abs(qr)<1e-6||!isFinite(ne)){if(Math.abs(Gr-sn)<1e-6)return this.easeTo(o,h);var k=sn<Gr?-1:1;ne=Math.abs(Math.log(sn/Gr))/Sr,ee=function(){return 0},Ui=function(F){return Math.exp(k*Sr*F)}}return o.duration="duration"in o?+o.duration:1e3*ne/("screenSpeed"in o?+o.screenSpeed/Sr:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=K!==Ie,this._pitching=Ke!==se,this._padding=!P.isPaddingEqual(We),this._prepareEase(h,!1),this._ease(function(F){var ie=F*ne,Te=1/Ui(ie);P.zoom=F===1?Ae:N+P.scaleZoom(Te),_._rotating&&(P.bearing=p.number(K,Ie,F)),_._pitching&&(P.pitch=p.number(se,Ke,F)),_._padding&&(P.interpolatePadding(Ce,We,F),st=P.centerPoint.add(Ze));var ft=F===1?Wt:P.unproject(xr.add(hr.mult(ee(ie))).mult(Te));P.setLocationAtPoint(P.renderWorldCopies?ft.wrap():ft,st),_._fireMoveEvents(h)},function(){return _._afterEase(h)},o),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,h)}if(!o){var C=this.handlers;C&&C.stop(!1)}return this},u.prototype._ease=function(o,h,_){_.animate===!1||_.duration===0?(o(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=_,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var o=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(o,h){o=p.wrap(o,-180,180);var _=Math.abs(o-h);return Math.abs(o-360-h)<_&&(o-=360),Math.abs(o+360-h)<_&&(o+=360),o},u.prototype._normalizeCenter=function(o){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var _=o.lng-h.center.lng;o.lng+=_>180?-360:_<-180?360:0}},u}(p.Evented),as=function(i){i===void 0&&(i={}),this.options=i,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};as.prototype.getDefaultPosition=function(){return"bottom-right"},as.prototype.onAdd=function(i){var u=this.options&&this.options.compact;return this._map=i,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},as.prototype.onRemove=function(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},as.prototype._setElementTitle=function(i,u){var o=this._map._getUIString("AttributionControl."+u);i.title=o,i.setAttribute("aria-label",o)},as.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},as.prototype._updateEditLink=function(){var i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(i){var o=u.reduce(function(h,_,C){return _.value&&(h+=_.key+"="+_.value+(C<u.length-1?"&":"")),h},"?");i.href=p.config.FEEDBACK_URL+"/"+o+(this._map._hash?this._map._hash.getHashString(!0):""),i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}},as.prototype._updateData=function(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},as.prototype._updateAttributions=function(){if(this._map.style){var i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(function(N){return typeof N!="string"?"":N})):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var o=this._map.style.sourceCaches;for(var h in o){var _=o[h];if(_.used){var C=_.getSource();C.attribution&&i.indexOf(C.attribution)<0&&i.push(C.attribution)}}i.sort(function(N,K){return N.length-K.length});var P=(i=i.filter(function(N,K){for(var se=K+1;se<i.length;se++)if(i[se].indexOf(N)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,i.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},as.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Ws=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};Ws.prototype.onAdd=function(i){this._map=i,this._container=Z.create("div","mapboxgl-ctrl");var u=Z.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Ws.prototype.onRemove=function(){Z.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Ws.prototype.getDefaultPosition=function(){return"bottom-left"},Ws.prototype._updateLogo=function(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Ws.prototype._logoRequired=function(){if(this._map.style){var i=this._map.style.sourceCaches;for(var u in i)if(i[u].getSource().mapbox_logo)return!0;return!1}},Ws.prototype._updateCompact=function(){var i=this._container.children;if(i.length){var u=i[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var Zo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Zo.prototype.add=function(i){var u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u},Zo.prototype.remove=function(i){for(var u=this._currentlyRunning,o=0,h=u?this._queue.concat(u):this._queue;o<h.length;o+=1){var _=h[o];if(_.id===i)return void(_.cancelled=!0)}},Zo.prototype.run=function(i){i===void 0&&(i=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var o=0,h=u;o<h.length;o+=1){var _=h[o];if(!_.cancelled&&(_.callback(i),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Zo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var su={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},wc=p.window.HTMLImageElement,ac=p.window.HTMLElement,oa=p.window.ImageBitmap,Do={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Uc=function(i){function u(h){var _=this;if((h=p.extend({},Do,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var C=new aa(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(i.call(this,C,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Zo,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},su,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof ac))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return _._update(!1)}),this.on("moveend",function(){return _._update(!1)}),this.on("zoom",function(){return _._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new $n(this,h),this._hash=h.hash&&new Ps(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new as({customAttribution:h.customAttribution})),this.addControl(new Ws,h.logoPosition),this.on("style.load",function(){_.transform.unmodified&&_.jumpTo(_.style.stylesheet)}),this.on("data",function(P){_._update(P.dataType==="style"),_.fire(new p.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){_.fire(new p.Event(P.dataType+"dataloading",P))})}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,_){if(_===void 0&&(_=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var C=h.onAdd(this);this._controls.push(h);var P=this._controlPositions[_];return _.indexOf("bottom")!==-1?P.insertBefore(C,P.firstChild):P.appendChild(C),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var _=this._controls.indexOf(h);return _>-1&&this._controls.splice(_,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var _=this._containerDimensions(),C=_[0],P=_[1];if(C===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(C,P),this.transform.resize(C,P),this.painter.resize(C,P);var N=!this._moving;return N&&this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),this.fire(new p.Event("resize",h)),N&&this.fire(new p.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,_,C){var P,N=this;if(h==="mouseenter"||h==="mouseover"){var K=!1;return{layer:_,listener:C,delegates:{mousemove:function(Ce){var Ae=N.getLayer(_)?N.queryRenderedFeatures(Ce.point,{layers:[_]}):[];Ae.length?K||(K=!0,C.call(N,new Ro(h,N,Ce.originalEvent,{features:Ae}))):K=!1},mouseout:function(){K=!1}}}}if(h==="mouseleave"||h==="mouseout"){var se=!1;return{layer:_,listener:C,delegates:{mousemove:function(Ce){(N.getLayer(_)?N.queryRenderedFeatures(Ce.point,{layers:[_]}):[]).length?se=!0:se&&(se=!1,C.call(N,new Ro(h,N,Ce.originalEvent)))},mouseout:function(Ce){se&&(se=!1,C.call(N,new Ro(h,N,Ce.originalEvent)))}}}}return{layer:_,listener:C,delegates:(P={},P[h]=function(Ce){var Ae=N.getLayer(_)?N.queryRenderedFeatures(Ce.point,{layers:[_]}):[];Ae.length&&(Ce.features=Ae,C.call(N,Ce),delete Ce.features)},P)}},u.prototype.on=function(h,_,C){if(C===void 0)return i.prototype.on.call(this,h,_);var P=this._createDelegatedListener(h,_,C);for(var N in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(P),P.delegates)this.on(N,P.delegates[N]);return this},u.prototype.once=function(h,_,C){if(C===void 0)return i.prototype.once.call(this,h,_);var P=this._createDelegatedListener(h,_,C);for(var N in P.delegates)this.once(N,P.delegates[N]);return this},u.prototype.off=function(h,_,C){var P=this;return C===void 0?i.prototype.off.call(this,h,_):(this._delegatedListeners&&this._delegatedListeners[h]&&function(N){for(var K=N[h],se=0;se<K.length;se++){var Ce=K[se];if(Ce.layer===_&&Ce.listener===C){for(var Ae in Ce.delegates)P.off(Ae,Ce.delegates[Ae]);return K.splice(se,1),P}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,_){if(!this.style)return[];var C;if(_!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(_=h,h=void 0),_=_||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")C=[p.Point.convert(h)];else{var P=p.Point.convert(h[0]),N=p.Point.convert(h[1]);C=[P,new p.Point(N.x,P.y),N,new p.Point(P.x,N.y),P]}return this.style.queryRenderedFeatures(C,_,this.transform)},u.prototype.querySourceFeatures=function(h,_){return this.style.querySourceFeatures(h,_)},u.prototype.setStyle=function(h,_){return(_=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},_)).diff!==!1&&_.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,_),this):(this._localIdeographFontFamily=_.localIdeographFontFamily,this._updateStyle(h,_))},u.prototype._getUIString=function(h){var _=this._locale[h];if(_==null)throw new Error("Missing UI string '"+h+"'");return _},u.prototype._updateStyle=function(h,_){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new ns(this,_||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ns(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,_){var C=this;if(typeof h=="string"){var P=this._requestManager.normalizeStyleURL(h),N=this._requestManager.transformRequest(P,p.ResourceType.Style);p.getJSON(N,function(K,se){K?C.fire(new p.ErrorEvent(K)):se&&C._updateDiff(se,_)})}else typeof h=="object"&&this._updateDiff(h,_)},u.prototype._updateDiff=function(h,_){try{this.style.setState(h)&&this._update(!0)}catch(C){p.warnOnce("Unable to perform style diff: "+(C.message||C.error||C)+".  Rebuilding the style from scratch."),this._updateStyle(h,_)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,_){return this._lazyInitEmptyStyle(),this.style.addSource(h,_),this._update(!0)},u.prototype.isSourceLoaded=function(h){var _=this.style&&this.style.sourceCaches[h];if(_!==void 0)return _.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var _ in h){var C=h[_]._tiles;for(var P in C){var N=C[P];if(N.state!=="loaded"&&N.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,_,C){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,_,C)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,_,C){C===void 0&&(C={});var P=C.pixelRatio;P===void 0&&(P=1);var N=C.sdf;N===void 0&&(N=!1);var K=C.stretchX,se=C.stretchY,Ce=C.content;if(this._lazyInitEmptyStyle(),_ instanceof wc||oa&&_ instanceof oa){var Ae=p.browser.getImageData(_);this.style.addImage(h,{data:new p.RGBAImage({width:Ae.width,height:Ae.height},Ae.data),pixelRatio:P,stretchX:K,stretchY:se,content:Ce,sdf:N,version:0})}else{if(_.width===void 0||_.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ie=_;this.style.addImage(h,{data:new p.RGBAImage({width:_.width,height:_.height},new Uint8Array(_.data)),pixelRatio:P,stretchX:K,stretchY:se,content:Ce,sdf:N,version:0,userImage:Ie}),Ie.onAdd&&Ie.onAdd(this,h)}},u.prototype.updateImage=function(h,_){var C=this.style.getImage(h);if(!C)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=_ instanceof wc||oa&&_ instanceof oa?p.browser.getImageData(_):_,N=P.width,K=P.height,se=P.data;return N===void 0||K===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):N!==C.data.width||K!==C.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(C.data.replace(se,!(_ instanceof wc||oa&&_ instanceof oa)),void this.style.updateImage(h,C))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,_){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),_)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,_){return this._lazyInitEmptyStyle(),this.style.addLayer(h,_),this._update(!0)},u.prototype.moveLayer=function(h,_){return this.style.moveLayer(h,_),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,_,C){return this.style.setLayerZoomRange(h,_,C),this._update(!0)},u.prototype.setFilter=function(h,_,C){return C===void 0&&(C={}),this.style.setFilter(h,_,C),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,_,C,P){return P===void 0&&(P={}),this.style.setPaintProperty(h,_,C,P),this._update(!0)},u.prototype.getPaintProperty=function(h,_){return this.style.getPaintProperty(h,_)},u.prototype.setLayoutProperty=function(h,_,C,P){return P===void 0&&(P={}),this.style.setLayoutProperty(h,_,C,P),this._update(!0)},u.prototype.getLayoutProperty=function(h,_){return this.style.getLayoutProperty(h,_)},u.prototype.setLight=function(h,_){return _===void 0&&(_={}),this._lazyInitEmptyStyle(),this.style.setLight(h,_),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,_){return this.style.setFeatureState(h,_),this._update()},u.prototype.removeFeatureState=function(h,_){return this.style.removeFeatureState(h,_),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,_=0;return this._container&&(h=this._container.clientWidth||400,_=this._container.clientHeight||300),[h,_]},u.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var _=this._canvasContainer=Z.create("div","mapboxgl-canvas-container",h);this._interactive&&_.classList.add("mapboxgl-interactive"),this._canvas=Z.create("canvas","mapboxgl-canvas",_),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var C=this._containerDimensions();this._resizeCanvas(C[0],C[1]);var P=this._controlContainer=Z.create("div","mapboxgl-control-container",h),N=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(K){N[K]=Z.create("div","mapboxgl-ctrl-"+K,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,_){var C=p.browser.devicePixelRatio||1;this._canvas.width=C*h,this._canvas.height=C*_,this._canvas.style.width=h+"px",this._canvas.style.height=_+"px"},u.prototype._setupPainter=function(){var h=p.extend({},E.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),_=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);_?(this.painter=new Xa(_,this.transform),p.webpSupported.testSupport(_)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var _,C=this,P=0,N=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(_=N.createQueryEXT(),N.beginQueryEXT(N.TIME_ELAPSED_EXT,_),P=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var K=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var se=this.transform.zoom,Ce=p.browser.now();this.style.zoomHistory.update(se,Ce);var Ae=new p.EvaluationParameters(se,{now:Ce,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ie=Ae.crossFadingFactor();Ie===1&&Ie===this._crossFadingFactor||(K=!0,this._crossFadingFactor=Ie),this.style.update(Ae)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||K)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ke=p.browser.now()-P;N.endQueryEXT(N.TIME_ELAPSED_EXT,_),setTimeout(function(){var Ze=N.getQueryObjectEXT(_,N.QUERY_RESULT_EXT)/1e6;N.deleteQueryEXT(_),C.fire(new p.Event("gpu-timing-frame",{cpuTime:Ke,gpuTime:Ze}))},50)}if(this.listens("gpu-timing-layer")){var We=this.painter.collectGpuTimers();setTimeout(function(){var Ze=C.painter.queryGpuTimers(We);C.fire(new p.Event("gpu-timing-layer",{layerTimes:Ze}))},50)}var at=this._sourcesDirty||this._styleDirty||this._placementDirty;return at||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||at||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,_=this._controls;h<_.length;h+=1)_[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),xs(this._canvasContainer),xs(this._controlContainer),xs(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(_){h._frame=null,h._render(_)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,_){p.setCacheLimits(h,_)},o.version.get=function(){return p.version},Object.defineProperties(u.prototype,o),u}(Pl);function xs(i){i.parentNode&&i.parentNode.removeChild(i)}var Ml={showCompass:!0,showZoom:!0,visualizePitch:!1},Rs=function(i){var u=this;this.options=p.extend({},Ml,i),this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(o){return o.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(o){return u._map.zoomIn({},{originalEvent:o})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(o){return u._map.zoomOut({},{originalEvent:o})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(o){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:o}):u._map.resetNorth({},{originalEvent:o})}),this._compassIcon=Z.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Rs.prototype._updateZoomButtons=function(){var i=this._map.getZoom(),u=i===this._map.getMaxZoom(),o=i===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},Rs.prototype._rotateCompassArrow=function(){var i=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=i},Rs.prototype.onAdd=function(i){return this._map=i,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new os(this._map,this._compass,this.options.visualizePitch)),this._container},Rs.prototype.onRemove=function(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Rs.prototype._createButton=function(i,u){var o=Z.create("button",i,this._container);return o.type="button",o.addEventListener("click",u),o},Rs.prototype._setButtonTitle=function(i,u){var o=this._map._getUIString("NavigationControl."+u);i.title=o,i.setAttribute("aria-label",o)};var os=function(i,u,o){o===void 0&&(o=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new nc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,o&&(this.mousePitch=new Ou({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Z.addEventListener(u,"mousedown",this.mousedown),Z.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(u,"touchmove",this.touchmove),Z.addEventListener(u,"touchend",this.touchend),Z.addEventListener(u,"touchcancel",this.reset)};function fl(i,u,o){if(i=new p.LngLat(i.lng,i.lat),u){var h=new p.LngLat(i.lng-360,i.lat),_=new p.LngLat(i.lng+360,i.lat),C=o.locationPoint(i).distSqr(u);o.locationPoint(h).distSqr(u)<C?i=h:o.locationPoint(_).distSqr(u)<C&&(i=_)}for(;Math.abs(i.lng-o.center.lng)>180;){var P=o.locationPoint(i);if(P.x>=0&&P.y>=0&&P.x<=o.width&&P.y<=o.height)break;i.lng>o.center.lng?i.lng-=360:i.lng+=360}return i}os.prototype.down=function(i,u){this.mouseRotate.mousedown(i,u),this.mousePitch&&this.mousePitch.mousedown(i,u),Z.disableDrag()},os.prototype.move=function(i,u){var o=this.map,h=this.mouseRotate.mousemoveWindow(i,u);if(h&&h.bearingDelta&&o.setBearing(o.getBearing()+h.bearingDelta),this.mousePitch){var _=this.mousePitch.mousemoveWindow(i,u);_&&_.pitchDelta&&o.setPitch(o.getPitch()+_.pitchDelta)}},os.prototype.off=function(){var i=this.element;Z.removeEventListener(i,"mousedown",this.mousedown),Z.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(i,"touchmove",this.touchmove),Z.removeEventListener(i,"touchend",this.touchend),Z.removeEventListener(i,"touchcancel",this.reset),this.offTemp()},os.prototype.offTemp=function(){Z.enableDrag(),Z.removeEventListener(p.window,"mousemove",this.mousemove),Z.removeEventListener(p.window,"mouseup",this.mouseup)},os.prototype.mousedown=function(i){this.down(p.extend({},i,{ctrlKey:!0,preventDefault:function(){return i.preventDefault()}}),Z.mousePos(this.element,i)),Z.addEventListener(p.window,"mousemove",this.mousemove),Z.addEventListener(p.window,"mouseup",this.mouseup)},os.prototype.mousemove=function(i){this.move(i,Z.mousePos(this.element,i))},os.prototype.mouseup=function(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()},os.prototype.touchstart=function(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return i.preventDefault()}},this._startPos))},os.prototype.touchmove=function(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:function(){return i.preventDefault()}},this._lastPos))},os.prototype.touchend=function(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},os.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var uu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function oc(i,u,o){var h=i.classList;for(var _ in uu)h.remove("mapboxgl-"+o+"-anchor-"+_);h.add("mapboxgl-"+o+"-anchor-"+u)}var Hu,Wu=function(i){function u(o,h){if(i.call(this),(o instanceof p.window.HTMLElement||h)&&(o=p.extend({element:o},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=p.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div"),this._element.setAttribute("aria-label","Map marker");var _=Z.createNS("http://www.w3.org/2000/svg","svg");_.setAttributeNS(null,"display","block"),_.setAttributeNS(null,"height","41px"),_.setAttributeNS(null,"width","27px"),_.setAttributeNS(null,"viewBox","0 0 27 41");var C=Z.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");var P=Z.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var N=Z.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(3.0, 29.0)"),N.setAttributeNS(null,"fill","#000000");for(var K=0,se=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];K<se.length;K+=1){var Ce=se[K],Ae=Z.createNS("http://www.w3.org/2000/svg","ellipse");Ae.setAttributeNS(null,"opacity","0.04"),Ae.setAttributeNS(null,"cx","10.5"),Ae.setAttributeNS(null,"cy","5.80029008"),Ae.setAttributeNS(null,"rx",Ce.rx),Ae.setAttributeNS(null,"ry",Ce.ry),N.appendChild(Ae)}var Ie=Z.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"fill",this._color);var Ke=Z.createNS("http://www.w3.org/2000/svg","path");Ke.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ie.appendChild(Ke);var We=Z.createNS("http://www.w3.org/2000/svg","g");We.setAttributeNS(null,"opacity","0.25"),We.setAttributeNS(null,"fill","#000000");var at=Z.createNS("http://www.w3.org/2000/svg","path");at.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),We.appendChild(at);var Ze=Z.createNS("http://www.w3.org/2000/svg","g");Ze.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ze.setAttributeNS(null,"fill","#FFFFFF");var st=Z.createNS("http://www.w3.org/2000/svg","g");st.setAttributeNS(null,"transform","translate(8.0, 8.0)");var St=Z.createNS("http://www.w3.org/2000/svg","circle");St.setAttributeNS(null,"fill","#000000"),St.setAttributeNS(null,"opacity","0.25"),St.setAttributeNS(null,"cx","5.5"),St.setAttributeNS(null,"cy","5.5"),St.setAttributeNS(null,"r","5.4999962");var Wt=Z.createNS("http://www.w3.org/2000/svg","circle");Wt.setAttributeNS(null,"fill","#FFFFFF"),Wt.setAttributeNS(null,"cx","5.5"),Wt.setAttributeNS(null,"cy","5.5"),Wt.setAttributeNS(null,"r","5.4999962"),st.appendChild(St),st.appendChild(Wt),P.appendChild(N),P.appendChild(Ie),P.appendChild(We),P.appendChild(Ze),P.appendChild(st),_.appendChild(P),_.setAttributeNS(null,"height",41*this._scale+"px"),_.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(_),this._offset=p.Point.convert(o&&o.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(xr){xr.preventDefault()}),this._element.addEventListener("mousedown",function(xr){xr.preventDefault()}),oc(this._element,this._anchor,"marker"),this._popup=null}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(o){var h=o.code,_=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&_!==32&&_!==13||this.togglePopup()},u.prototype._onMapClick=function(o){var h=o.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this},u.prototype._update=function(o){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=fl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_="rotateX("+this._map.getPitch()+"deg)"),o&&o.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,uu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+_+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(o){return this._offset=p.Point.convert(o),this._update(),this},u.prototype._onMove=function(o){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(o){return this._rotation=o||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(o){return this._rotationAlignment=o||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(p.Evented),Zc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Il=0,hl=!1,jc=function(i){function u(o){i.call(this),this.options=p.extend({},Zc,o),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(o){var h;return this._map=o,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,Hu!==void 0?h(Hu):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(_){h(Hu=_.state!=="denied")}):h(Hu=!!p.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Il=0,hl=!1},u.prototype._isOutOfMapMaxBounds=function(o){var h=this._map.getMaxBounds(),_=o.coords;return h&&(_.longitude<h.getWest()||_.longitude>h.getEast()||_.latitude<h.getSouth()||_.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(o){if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",o)),this._finish()}},u.prototype._updateCamera=function(o){var h=new p.LngLat(o.coords.longitude,o.coords.latitude),_=o.coords.accuracy,C=this._map.getBearing(),P=p.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(_),P,{geolocateSource:!0})},u.prototype._updateMarker=function(o){if(o){var h=new p.LngLat(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var o=this._map._container.clientHeight/2,h=this._map.unproject([0,o]),_=this._map.unproject([1,o]),C=h.distanceTo(_),P=Math.ceil(2*this._accuracy/C);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(o){if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&hl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",o)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(o){var h=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=Z.create("button","mapboxgl-ctrl-geolocate",this._container),Z.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",o===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var _=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=_,this._geolocateButton.setAttribute("aria-label",_)}else{var C=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Wu(this._dotElement),this._circleElement=Z.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||h._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Il--,hl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var o;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Il>1?(o={maximumAge:6e5,timeout:0},hl=!0):(o=this.options.positionOptions,hl=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,o)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(p.Evented),Xu={maxWidth:100,unit:"metric"},Lu=function(i){this.options=p.extend({},Xu,i),p.bindAll(["_onMove","setUnit"],this)};function sc(i,u,o){var h=o&&o.maxWidth||100,_=i._container.clientHeight/2,C=i.unproject([0,_]),P=i.unproject([h,_]),N=C.distanceTo(P);if(o&&o.unit==="imperial"){var K=3.2808*N;K>5280?Ru(u,h,K/5280,i._getUIString("ScaleControl.Miles")):Ru(u,h,K,i._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Ru(u,h,N/1852,i._getUIString("ScaleControl.NauticalMiles")):N>=1e3?Ru(u,h,N/1e3,i._getUIString("ScaleControl.Kilometers")):Ru(u,h,N,i._getUIString("ScaleControl.Meters"))}function Ru(i,u,o,h){var _,C,P,N=(_=o,(C=Math.pow(10,(""+Math.floor(_)).length-1))*(P=(P=_/C)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(K){var se=Math.pow(10,Math.ceil(-Math.log(K)/Math.LN10));return Math.round(K*se)/se}(P)));i.style.width=u*(N/o)+"px",i.innerHTML=N+"&nbsp;"+h}Lu.prototype.getDefaultPosition=function(){return"bottom-left"},Lu.prototype._onMove=function(){sc(this._map,this._container,this.options)},Lu.prototype.onAdd=function(i){return this._map=i,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",i.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Lu.prototype.onRemove=function(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Lu.prototype.setUnit=function(i){this.options.unit=i,sc(this._map,this._container,this.options)};var Xs=function(i){this._fullscreen=!1,i&&i.container&&(i.container instanceof p.window.HTMLElement?this._container=i.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};Xs.prototype.onAdd=function(i){return this._map=i,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Xs.prototype.onRemove=function(){Z.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Xs.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},Xs.prototype._setupUI=function(){var i=this._fullscreenButton=Z.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z.create("span","mapboxgl-ctrl-icon",i).setAttribute("aria-hidden",!0),i.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Xs.prototype._updateTitle=function(){var i=this._getTitle();this._fullscreenButton.setAttribute("aria-label",i),this._fullscreenButton.title=i},Xs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Xs.prototype._isFullscreen=function(){return this._fullscreen},Xs.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Xs.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Tc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},uc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),lc=function(i){function u(o){i.call(this),this.options=p.extend(Object.create(Tc),o),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(o){return this._map&&this.remove(),this._map=o,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(o){return this.setDOMContent(p.window.document.createTextNode(o))},u.prototype.setHTML=function(o){var h,_=p.window.document.createDocumentFragment(),C=p.window.document.createElement("body");for(C.innerHTML=o;h=C.firstChild;)_.appendChild(h);return this.setDOMContent(_)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(o){return this.options.maxWidth=o,this._update(),this},u.prototype.setDOMContent=function(o){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(o),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(o){this._container&&this._container.classList.add(o)},u.prototype.removeClassName=function(o){this._container&&this._container.classList.remove(o)},u.prototype.setOffset=function(o){return this.options.offset=o,this._update(),this},u.prototype.toggleClassName=function(o){if(this._container)return this._container.classList.toggle(o)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Z.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(o){this._update(o.point)},u.prototype._onMouseMove=function(o){this._update(o.point)},u.prototype._onDrag=function(o){this._update(o.point)},u.prototype._update=function(o){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Z.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Z.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Ae){return h._container.classList.add(Ae)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=fl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||o)){var _=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat),C=this.options.anchor,P=function Ae(Ie){if(Ie){if(typeof Ie=="number"){var Ke=Math.round(Math.sqrt(.5*Math.pow(Ie,2)));return{center:new p.Point(0,0),top:new p.Point(0,Ie),"top-left":new p.Point(Ke,Ke),"top-right":new p.Point(-Ke,Ke),bottom:new p.Point(0,-Ie),"bottom-left":new p.Point(Ke,-Ke),"bottom-right":new p.Point(-Ke,-Ke),left:new p.Point(Ie,0),right:new p.Point(-Ie,0)}}if(Ie instanceof p.Point||Array.isArray(Ie)){var We=p.Point.convert(Ie);return{center:We,top:We,"top-left":We,"top-right":We,bottom:We,"bottom-left":We,"bottom-right":We,left:We,right:We}}return{center:p.Point.convert(Ie.center||[0,0]),top:p.Point.convert(Ie.top||[0,0]),"top-left":p.Point.convert(Ie["top-left"]||[0,0]),"top-right":p.Point.convert(Ie["top-right"]||[0,0]),bottom:p.Point.convert(Ie.bottom||[0,0]),"bottom-left":p.Point.convert(Ie["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(Ie["bottom-right"]||[0,0]),left:p.Point.convert(Ie.left||[0,0]),right:p.Point.convert(Ie.right||[0,0])}}return Ae(new p.Point(0,0))}(this.options.offset);if(!C){var N,K=this._container.offsetWidth,se=this._container.offsetHeight;N=_.y+P.bottom.y<se?["top"]:_.y>this._map.transform.height-se?["bottom"]:[],_.x<K/2?N.push("left"):_.x>this._map.transform.width-K/2&&N.push("right"),C=N.length===0?"bottom":N.join("-")}var Ce=_.add(P[C]).round();Z.setTransform(this._container,uu[C]+" translate("+Ce.x+"px,"+Ce.y+"px)"),oc(this._container,C,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var o=this._container.querySelector(uc);o&&o.focus()}},u.prototype._onClose=function(){this.remove()},u}(p.Evented),Yu={version:p.version,supported:E,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:Uc,NavigationControl:Rs,GeolocateControl:jc,AttributionControl:as,ScaleControl:Lu,FullscreenControl:Xs,Popup:lc,Marker:Wu,Style:ns,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){qt().acquire(tr)},clearPrewarmedResources:function(){var i=Fn;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(tr),Fn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(i){p.config.ACCESS_TOKEN=i},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(i){p.config.API_URL=i},get workerCount(){return Ur.workerCount},set workerCount(i){Ur.workerCount=i},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(i){p.config.MAX_PARALLEL_IMAGE_REQUESTS=i},clearStorage:function(i){p.clearTileCache(i)},workerUrl:""};return Yu}),j})},28660:function(qe,D,y){var j=y(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var b;(function(p){(function(E){var Z=typeof y.g=="object"?y.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),V=G(p);typeof Z.Reflect=="undefined"?Z.Reflect=p:V=G(Z.Reflect,V),E(V);function G(I,L){return function(_e,be){typeof I[_e]!="function"&&Object.defineProperty(I,_e,{configurable:!0,writable:!0,value:be}),L&&L(_e,be)}}})(function(E){var Z=Object.prototype.hasOwnProperty,V=typeof Symbol=="function",G=V&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",I=V&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",L=typeof Object.create=="function",_e={__proto__:[]}instanceof Array,be=!L&&!_e,Le={create:L?function(){return Cr(Object.create(null))}:_e?function(){return Cr({__proto__:null})}:function(){return Cr({})},has:be?function(Xe,rt){return Z.call(Xe,rt)}:function(Xe,rt){return rt in Xe},get:be?function(Xe,rt){return Z.call(Xe,rt)?Xe[rt]:void 0}:function(Xe,rt){return Xe[rt]}},Je=Object.getPrototypeOf(Function),Dt=typeof j=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",It=!Dt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Q(),Ut=!Dt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Rt(),xt=!Dt&&typeof WeakMap=="function"?WeakMap:dr(),bt=new xt;function ct(Xe,rt,wt,Ot){if(mn(wt)){if(!yr(Xe))throw new TypeError;if(!sr(rt))throw new TypeError;return $t(Xe,rt)}else{if(!yr(Xe))throw new TypeError;if(!ve(rt))throw new TypeError;if(!ve(Ot)&&!mn(Ot)&&!Ni(Ot))throw new TypeError;return Ni(Ot)&&(Ot=void 0),wt=rr(wt),zr(Xe,rt,wt,Ot)}}E("decorate",ct);function ir(Xe,rt){function wt(Ot,gr){if(!ve(Ot))throw new TypeError;if(!mn(gr)&&!Rr(gr))throw new TypeError;jt(Xe,rt,Ot,gr)}return wt}E("metadata",ir);function re(Xe,rt,wt,Ot){if(!ve(wt))throw new TypeError;return mn(Ot)||(Ot=rr(Ot)),jt(Xe,rt,wt,Ot)}E("defineMetadata",re);function cr(Xe,rt,wt){if(!ve(rt))throw new TypeError;return mn(wt)||(wt=rr(wt)),ke(Xe,rt,wt)}E("hasMetadata",cr);function Ct(Xe,rt,wt){if(!ve(rt))throw new TypeError;return mn(wt)||(wt=rr(wt)),ge(Xe,rt,wt)}E("hasOwnMetadata",Ct);function Qe(Xe,rt,wt){if(!ve(rt))throw new TypeError;return mn(wt)||(wt=rr(wt)),_t(Xe,rt,wt)}E("getMetadata",Qe);function Tt(Xe,rt,wt){if(!ve(rt))throw new TypeError;return mn(wt)||(wt=rr(wt)),vt(Xe,rt,wt)}E("getOwnMetadata",Tt);function je(Xe,rt){if(!ve(Xe))throw new TypeError;return mn(rt)||(rt=rr(rt)),Bt(Xe,rt)}E("getMetadataKeys",je);function Pt(Xe,rt){if(!ve(Xe))throw new TypeError;return mn(rt)||(rt=rr(rt)),Nr(Xe,rt)}E("getOwnMetadataKeys",Pt);function fr(Xe,rt,wt){if(!ve(rt))throw new TypeError;mn(wt)||(wt=rr(wt));var Ot=fe(rt,wt,!1);if(mn(Ot)||!Ot.delete(Xe))return!1;if(Ot.size>0)return!0;var gr=bt.get(rt);return gr.delete(wt),gr.size>0||bt.delete(rt),!0}E("deleteMetadata",fr);function $t(Xe,rt){for(var wt=Xe.length-1;wt>=0;--wt){var Ot=Xe[wt],gr=Ot(rt);if(!mn(gr)&&!Ni(gr)){if(!sr(gr))throw new TypeError;rt=gr}}return rt}function zr(Xe,rt,wt,Ot){for(var gr=Xe.length-1;gr>=0;--gr){var br=Xe[gr],Xt=br(rt,wt,Ot);if(!mn(Xt)&&!Ni(Xt)){if(!ve(Xt))throw new TypeError;Ot=Xt}}return Ot}function fe(Xe,rt,wt){var Ot=bt.get(Xe);if(mn(Ot)){if(!wt)return;Ot=new It,bt.set(Xe,Ot)}var gr=Ot.get(rt);if(mn(gr)){if(!wt)return;gr=new It,Ot.set(rt,gr)}return gr}function ke(Xe,rt,wt){var Ot=ge(Xe,rt,wt);if(Ot)return!0;var gr=At(rt);return Ni(gr)?!1:ke(Xe,gr,wt)}function ge(Xe,rt,wt){var Ot=fe(rt,wt,!1);return mn(Ot)?!1:Re(Ot.has(Xe))}function _t(Xe,rt,wt){var Ot=ge(Xe,rt,wt);if(Ot)return vt(Xe,rt,wt);var gr=At(rt);if(!Ni(gr))return _t(Xe,gr,wt)}function vt(Xe,rt,wt){var Ot=fe(rt,wt,!1);if(!mn(Ot))return Ot.get(Xe)}function jt(Xe,rt,wt,Ot){var gr=fe(wt,Ot,!0);gr.set(Xe,rt)}function Bt(Xe,rt){var wt=Nr(Xe,rt),Ot=At(Xe);if(Ot===null)return wt;var gr=Bt(Ot,rt);if(gr.length<=0)return wt;if(wt.length<=0)return gr;for(var br=new Ut,Xt=[],kr=0,Mr=wt;kr<Mr.length;kr++){var un=Mr[kr],an=br.has(un);an||(br.add(un),Xt.push(un))}for(var Kn=0,ti=gr;Kn<ti.length;Kn++){var un=ti[Kn],an=br.has(un);an||(br.add(un),Xt.push(un))}return Xt}function Nr(Xe,rt){var wt=[],Ot=fe(Xe,rt,!1);if(mn(Ot))return wt;for(var gr=Ot.keys(),br=X(gr),Xt=0;;){var kr=Ve(br);if(!kr)return wt.length=Xt,wt;var Mr=Ue(kr);try{wt[Xt]=Mr}catch(un){try{ot(br)}finally{throw un}}Xt++}}function pn(Xe){if(Xe===null)return 1;switch(typeof Xe){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Xe===null?1:6;default:return 6}}function mn(Xe){return Xe===void 0}function Ni(Xe){return Xe===null}function or(Xe){return typeof Xe=="symbol"}function ve(Xe){return typeof Xe=="object"?Xe!==null:typeof Xe=="function"}function Me(Xe,rt){switch(pn(Xe)){case 0:return Xe;case 1:return Xe;case 2:return Xe;case 3:return Xe;case 4:return Xe;case 5:return Xe}var wt=rt===3?"string":rt===5?"number":"default",Ot=w(Xe,G);if(Ot!==void 0){var gr=Ot.call(Xe,wt);if(ve(gr))throw new TypeError;return gr}return Ge(Xe,wt==="default"?"number":wt)}function Ge(Xe,rt){if(rt==="string"){var wt=Xe.toString;if(Pr(wt)){var Ot=wt.call(Xe);if(!ve(Ot))return Ot}var gr=Xe.valueOf;if(Pr(gr)){var Ot=gr.call(Xe);if(!ve(Ot))return Ot}}else{var gr=Xe.valueOf;if(Pr(gr)){var Ot=gr.call(Xe);if(!ve(Ot))return Ot}var br=Xe.toString;if(Pr(br)){var Ot=br.call(Xe);if(!ve(Ot))return Ot}}throw new TypeError}function Re(Xe){return!!Xe}function kt(Xe){return""+Xe}function rr(Xe){var rt=Me(Xe,3);return or(rt)?rt:kt(rt)}function yr(Xe){return Array.isArray?Array.isArray(Xe):Xe instanceof Object?Xe instanceof Array:Object.prototype.toString.call(Xe)==="[object Array]"}function Pr(Xe){return typeof Xe=="function"}function sr(Xe){return typeof Xe=="function"}function Rr(Xe){switch(pn(Xe)){case 3:return!0;case 4:return!0;default:return!1}}function w(Xe,rt){var wt=Xe[rt];if(wt!=null){if(!Pr(wt))throw new TypeError;return wt}}function X(Xe){var rt=w(Xe,I);if(!Pr(rt))throw new TypeError;var wt=rt.call(Xe);if(!ve(wt))throw new TypeError;return wt}function Ue(Xe){return Xe.value}function Ve(Xe){var rt=Xe.next();return rt.done?!1:rt}function ot(Xe){var rt=Xe.return;rt&&rt.call(Xe)}function At(Xe){var rt=Object.getPrototypeOf(Xe);if(typeof Xe!="function"||Xe===Je||rt!==Je)return rt;var wt=Xe.prototype,Ot=wt&&Object.getPrototypeOf(wt);if(Ot==null||Ot===Object.prototype)return rt;var gr=Ot.constructor;return typeof gr!="function"||gr===Xe?rt:gr}function Q(){var Xe={},rt=[],wt=function(){function Xt(kr,Mr,un){this._index=0,this._keys=kr,this._values=Mr,this._selector=un}return Xt.prototype["@@iterator"]=function(){return this},Xt.prototype[I]=function(){return this},Xt.prototype.next=function(){var kr=this._index;if(kr>=0&&kr<this._keys.length){var Mr=this._selector(this._keys[kr],this._values[kr]);return kr+1>=this._keys.length?(this._index=-1,this._keys=rt,this._values=rt):this._index++,{value:Mr,done:!1}}return{value:void 0,done:!0}},Xt.prototype.throw=function(kr){throw this._index>=0&&(this._index=-1,this._keys=rt,this._values=rt),kr},Xt.prototype.return=function(kr){return this._index>=0&&(this._index=-1,this._keys=rt,this._values=rt),{value:kr,done:!0}},Xt}();return function(){function Xt(){this._keys=[],this._values=[],this._cacheKey=Xe,this._cacheIndex=-2}return Object.defineProperty(Xt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Xt.prototype.has=function(kr){return this._find(kr,!1)>=0},Xt.prototype.get=function(kr){var Mr=this._find(kr,!1);return Mr>=0?this._values[Mr]:void 0},Xt.prototype.set=function(kr,Mr){var un=this._find(kr,!0);return this._values[un]=Mr,this},Xt.prototype.delete=function(kr){var Mr=this._find(kr,!1);if(Mr>=0){for(var un=this._keys.length,an=Mr+1;an<un;an++)this._keys[an-1]=this._keys[an],this._values[an-1]=this._values[an];return this._keys.length--,this._values.length--,kr===this._cacheKey&&(this._cacheKey=Xe,this._cacheIndex=-2),!0}return!1},Xt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Xe,this._cacheIndex=-2},Xt.prototype.keys=function(){return new wt(this._keys,this._values,Ot)},Xt.prototype.values=function(){return new wt(this._keys,this._values,gr)},Xt.prototype.entries=function(){return new wt(this._keys,this._values,br)},Xt.prototype["@@iterator"]=function(){return this.entries()},Xt.prototype[I]=function(){return this.entries()},Xt.prototype._find=function(kr,Mr){return this._cacheKey!==kr&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=kr)),this._cacheIndex<0&&Mr&&(this._cacheIndex=this._keys.length,this._keys.push(kr),this._values.push(void 0)),this._cacheIndex},Xt}();function Ot(Xt,kr){return Xt}function gr(Xt,kr){return kr}function br(Xt,kr){return[Xt,kr]}}function Rt(){return function(){function Xe(){this._map=new It}return Object.defineProperty(Xe.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Xe.prototype.has=function(rt){return this._map.has(rt)},Xe.prototype.add=function(rt){return this._map.set(rt,rt),this},Xe.prototype.delete=function(rt){return this._map.delete(rt)},Xe.prototype.clear=function(){this._map.clear()},Xe.prototype.keys=function(){return this._map.keys()},Xe.prototype.values=function(){return this._map.values()},Xe.prototype.entries=function(){return this._map.entries()},Xe.prototype["@@iterator"]=function(){return this.keys()},Xe.prototype[I]=function(){return this.keys()},Xe}()}function dr(){var Xe=16,rt=Le.create(),wt=Ot();return function(){function Mr(){this._key=Ot()}return Mr.prototype.has=function(un){var an=gr(un,!1);return an!==void 0?Le.has(an,this._key):!1},Mr.prototype.get=function(un){var an=gr(un,!1);return an!==void 0?Le.get(an,this._key):void 0},Mr.prototype.set=function(un,an){var Kn=gr(un,!0);return Kn[this._key]=an,this},Mr.prototype.delete=function(un){var an=gr(un,!1);return an!==void 0?delete an[this._key]:!1},Mr.prototype.clear=function(){this._key=Ot()},Mr}();function Ot(){var Mr;do Mr="@@WeakMap@@"+kr();while(Le.has(rt,Mr));return rt[Mr]=!0,Mr}function gr(Mr,un){if(!Z.call(Mr,wt)){if(!un)return;Object.defineProperty(Mr,wt,{value:Le.create()})}return Mr[wt]}function br(Mr,un){for(var an=0;an<un;++an)Mr[an]=Math.random()*255|0;return Mr}function Xt(Mr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Mr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Mr)):br(new Uint8Array(Mr),Mr):br(new Array(Mr),Mr)}function kr(){var Mr=Xt(Xe);Mr[6]=Mr[6]&79|64,Mr[8]=Mr[8]&191|128;for(var un="",an=0;an<Xe;++an){var Kn=Mr[an];(an===4||an===6||an===8)&&(un+="-"),Kn<16&&(un+="0"),un+=Kn.toString(16).toLowerCase()}return un}}function Cr(Xe){return Xe.__=void 0,delete Xe.__,Xe}})})(b||(b={}))},69848:function(qe){(function(D,y){qe.exports=y()})(this,function(){"use strict";function D(Ct,Qe,Tt,je,Pt,fr){if(!(Pt-je<=Tt)){var $t=je+Pt>>1;y(Ct,Qe,$t,je,Pt,fr%2),D(Ct,Qe,Tt,je,$t-1,fr+1),D(Ct,Qe,Tt,$t+1,Pt,fr+1)}}function y(Ct,Qe,Tt,je,Pt,fr){for(;Pt>je;){if(Pt-je>600){var $t=Pt-je+1,zr=Tt-je+1,fe=Math.log($t),ke=.5*Math.exp(2*fe/3),ge=.5*Math.sqrt(fe*ke*($t-ke)/$t)*(zr-$t/2<0?-1:1),_t=Math.max(je,Math.floor(Tt-zr*ke/$t+ge)),vt=Math.min(Pt,Math.floor(Tt+($t-zr)*ke/$t+ge));y(Ct,Qe,Tt,_t,vt,fr)}var jt=Qe[2*Tt+fr],Bt=je,Nr=Pt;for(j(Ct,Qe,je,Tt),Qe[2*Pt+fr]>jt&&j(Ct,Qe,je,Pt);Bt<Nr;){for(j(Ct,Qe,Bt,Nr),Bt++,Nr--;Qe[2*Bt+fr]<jt;)Bt++;for(;Qe[2*Nr+fr]>jt;)Nr--}Qe[2*je+fr]===jt?j(Ct,Qe,je,Nr):(Nr++,j(Ct,Qe,Nr,Pt)),Nr<=Tt&&(je=Nr+1),Tt<=Nr&&(Pt=Nr-1)}}function j(Ct,Qe,Tt,je){b(Ct,Tt,je),b(Qe,2*Tt,2*je),b(Qe,2*Tt+1,2*je+1)}function b(Ct,Qe,Tt){var je=Ct[Qe];Ct[Qe]=Ct[Tt],Ct[Tt]=je}function p(Ct,Qe,Tt,je,Pt,fr,$t){for(var zr=[0,Ct.length-1,0],fe=[],ke,ge;zr.length;){var _t=zr.pop(),vt=zr.pop(),jt=zr.pop();if(vt-jt<=$t){for(var Bt=jt;Bt<=vt;Bt++)ke=Qe[2*Bt],ge=Qe[2*Bt+1],ke>=Tt&&ke<=Pt&&ge>=je&&ge<=fr&&fe.push(Ct[Bt]);continue}var Nr=Math.floor((jt+vt)/2);ke=Qe[2*Nr],ge=Qe[2*Nr+1],ke>=Tt&&ke<=Pt&&ge>=je&&ge<=fr&&fe.push(Ct[Nr]);var pn=(_t+1)%2;(_t===0?Tt<=ke:je<=ge)&&(zr.push(jt),zr.push(Nr-1),zr.push(pn)),(_t===0?Pt>=ke:fr>=ge)&&(zr.push(Nr+1),zr.push(vt),zr.push(pn))}return fe}function E(Ct,Qe,Tt,je,Pt,fr){for(var $t=[0,Ct.length-1,0],zr=[],fe=Pt*Pt;$t.length;){var ke=$t.pop(),ge=$t.pop(),_t=$t.pop();if(ge-_t<=fr){for(var vt=_t;vt<=ge;vt++)Z(Qe[2*vt],Qe[2*vt+1],Tt,je)<=fe&&zr.push(Ct[vt]);continue}var jt=Math.floor((_t+ge)/2),Bt=Qe[2*jt],Nr=Qe[2*jt+1];Z(Bt,Nr,Tt,je)<=fe&&zr.push(Ct[jt]);var pn=(ke+1)%2;(ke===0?Tt-Pt<=Bt:je-Pt<=Nr)&&($t.push(_t),$t.push(jt-1),$t.push(pn)),(ke===0?Tt+Pt>=Bt:je+Pt>=Nr)&&($t.push(jt+1),$t.push(ge),$t.push(pn))}return zr}function Z(Ct,Qe,Tt,je){var Pt=Ct-Tt,fr=Qe-je;return Pt*Pt+fr*fr}var V=function(Ct){return Ct[0]},G=function(Ct){return Ct[1]},I=function(Qe,Tt,je,Pt,fr){Tt===void 0&&(Tt=V),je===void 0&&(je=G),Pt===void 0&&(Pt=64),fr===void 0&&(fr=Float64Array),this.nodeSize=Pt,this.points=Qe;for(var $t=Qe.length<65536?Uint16Array:Uint32Array,zr=this.ids=new $t(Qe.length),fe=this.coords=new fr(Qe.length*2),ke=0;ke<Qe.length;ke++)zr[ke]=ke,fe[2*ke]=Tt(Qe[ke]),fe[2*ke+1]=je(Qe[ke]);D(zr,fe,Pt,0,zr.length-1,0)};I.prototype.range=function(Qe,Tt,je,Pt){return p(this.ids,this.coords,Qe,Tt,je,Pt,this.nodeSize)},I.prototype.within=function(Qe,Tt,je){return E(this.ids,this.coords,Qe,Tt,je,this.nodeSize)};var L={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Ct){return Ct}},_e=Math.fround||function(Ct){return function(Qe){return Ct[0]=+Qe,Ct[0]}}(new Float32Array(1)),be=function(Qe){this.options=ir(Object.create(L),Qe),this.trees=new Array(this.options.maxZoom+1)};be.prototype.load=function(Qe){var Tt=this.options,je=Tt.log,Pt=Tt.minZoom,fr=Tt.maxZoom,$t=Tt.nodeSize;je&&console.time("total time");var zr="prepare "+Qe.length+" points";je&&console.time(zr),this.points=Qe;for(var fe=[],ke=0;ke<Qe.length;ke++)!Qe[ke].geometry||fe.push(Je(Qe[ke],ke));this.trees[fr+1]=new I(fe,re,cr,$t,Float32Array),je&&console.timeEnd(zr);for(var ge=fr;ge>=Pt;ge--){var _t=+Date.now();fe=this._cluster(fe,ge),this.trees[ge]=new I(fe,re,cr,$t,Float32Array),je&&console.log("z%d: %d clusters in %dms",ge,fe.length,+Date.now()-_t)}return je&&console.timeEnd("total time"),this},be.prototype.getClusters=function(Qe,Tt){var je=((Qe[0]+180)%360+360)%360-180,Pt=Math.max(-90,Math.min(90,Qe[1])),fr=Qe[2]===180?180:((Qe[2]+180)%360+360)%360-180,$t=Math.max(-90,Math.min(90,Qe[3]));if(Qe[2]-Qe[0]>=360)je=-180,fr=180;else if(je>fr){var zr=this.getClusters([je,Pt,180,$t],Tt),fe=this.getClusters([-180,Pt,fr,$t],Tt);return zr.concat(fe)}for(var ke=this.trees[this._limitZoom(Tt)],ge=ke.range(Ut(je),xt($t),Ut(fr),xt(Pt)),_t=[],vt=0,jt=ge;vt<jt.length;vt+=1){var Bt=jt[vt],Nr=ke.points[Bt];_t.push(Nr.numPoints?Dt(Nr):this.points[Nr.index])}return _t},be.prototype.getChildren=function(Qe){var Tt=this._getOriginId(Qe),je=this._getOriginZoom(Qe),Pt="No cluster with the specified id.",fr=this.trees[je];if(!fr)throw new Error(Pt);var $t=fr.points[Tt];if(!$t)throw new Error(Pt);for(var zr=this.options.radius/(this.options.extent*Math.pow(2,je-1)),fe=fr.within($t.x,$t.y,zr),ke=[],ge=0,_t=fe;ge<_t.length;ge+=1){var vt=_t[ge],jt=fr.points[vt];jt.parentId===Qe&&ke.push(jt.numPoints?Dt(jt):this.points[jt.index])}if(ke.length===0)throw new Error(Pt);return ke},be.prototype.getLeaves=function(Qe,Tt,je){Tt=Tt||10,je=je||0;var Pt=[];return this._appendLeaves(Pt,Qe,Tt,je,0),Pt},be.prototype.getTile=function(Qe,Tt,je){var Pt=this.trees[this._limitZoom(Qe)],fr=Math.pow(2,Qe),$t=this.options,zr=$t.extent,fe=$t.radius,ke=fe/zr,ge=(je-ke)/fr,_t=(je+1+ke)/fr,vt={features:[]};return this._addTileFeatures(Pt.range((Tt-ke)/fr,ge,(Tt+1+ke)/fr,_t),Pt.points,Tt,je,fr,vt),Tt===0&&this._addTileFeatures(Pt.range(1-ke/fr,ge,1,_t),Pt.points,fr,je,fr,vt),Tt===fr-1&&this._addTileFeatures(Pt.range(0,ge,ke/fr,_t),Pt.points,-1,je,fr,vt),vt.features.length?vt:null},be.prototype.getClusterExpansionZoom=function(Qe){for(var Tt=this._getOriginZoom(Qe)-1;Tt<=this.options.maxZoom;){var je=this.getChildren(Qe);if(Tt++,je.length!==1)break;Qe=je[0].properties.cluster_id}return Tt},be.prototype._appendLeaves=function(Qe,Tt,je,Pt,fr){for(var $t=this.getChildren(Tt),zr=0,fe=$t;zr<fe.length;zr+=1){var ke=fe[zr],ge=ke.properties;if(ge&&ge.cluster?fr+ge.point_count<=Pt?fr+=ge.point_count:fr=this._appendLeaves(Qe,ge.cluster_id,je,Pt,fr):fr<Pt?fr++:Qe.push(ke),Qe.length===je)break}return fr},be.prototype._addTileFeatures=function(Qe,Tt,je,Pt,fr,$t){for(var zr=0,fe=Qe;zr<fe.length;zr+=1){var ke=fe[zr],ge=Tt[ke],_t=ge.numPoints,vt=void 0,jt=void 0,Bt=void 0;if(_t)vt=It(ge),jt=ge.x,Bt=ge.y;else{var Nr=this.points[ge.index];vt=Nr.properties,jt=Ut(Nr.geometry.coordinates[0]),Bt=xt(Nr.geometry.coordinates[1])}var pn={type:1,geometry:[[Math.round(this.options.extent*(jt*fr-je)),Math.round(this.options.extent*(Bt*fr-Pt))]],tags:vt},mn=void 0;_t?mn=ge.id:this.options.generateId?mn=ge.index:this.points[ge.index].id&&(mn=this.points[ge.index].id),mn!==void 0&&(pn.id=mn),$t.features.push(pn)}},be.prototype._limitZoom=function(Qe){return Math.max(this.options.minZoom,Math.min(+Qe,this.options.maxZoom+1))},be.prototype._cluster=function(Qe,Tt){for(var je=[],Pt=this.options,fr=Pt.radius,$t=Pt.extent,zr=Pt.reduce,fe=Pt.minPoints,ke=fr/($t*Math.pow(2,Tt)),ge=0;ge<Qe.length;ge++){var _t=Qe[ge];if(!(_t.zoom<=Tt)){_t.zoom=Tt;for(var vt=this.trees[Tt+1],jt=vt.within(_t.x,_t.y,ke),Bt=_t.numPoints||1,Nr=Bt,pn=0,mn=jt;pn<mn.length;pn+=1){var Ni=mn[pn],or=vt.points[Ni];or.zoom>Tt&&(Nr+=or.numPoints||1)}if(Nr>=fe){for(var ve=_t.x*Bt,Me=_t.y*Bt,Ge=zr&&Bt>1?this._map(_t,!0):null,Re=(ge<<5)+(Tt+1)+this.points.length,kt=0,rr=jt;kt<rr.length;kt+=1){var yr=rr[kt],Pr=vt.points[yr];if(!(Pr.zoom<=Tt)){Pr.zoom=Tt;var sr=Pr.numPoints||1;ve+=Pr.x*sr,Me+=Pr.y*sr,Pr.parentId=Re,zr&&(Ge||(Ge=this._map(_t,!0)),zr(Ge,this._map(Pr)))}}_t.parentId=Re,je.push(Le(ve/Nr,Me/Nr,Re,Nr,Ge))}else if(je.push(_t),Nr>1)for(var Rr=0,w=jt;Rr<w.length;Rr+=1){var X=w[Rr],Ue=vt.points[X];Ue.zoom<=Tt||(Ue.zoom=Tt,je.push(Ue))}}}return je},be.prototype._getOriginId=function(Qe){return Qe-this.points.length>>5},be.prototype._getOriginZoom=function(Qe){return(Qe-this.points.length)%32},be.prototype._map=function(Qe,Tt){if(Qe.numPoints)return Tt?ir({},Qe.properties):Qe.properties;var je=this.points[Qe.index].properties,Pt=this.options.map(je);return Tt&&Pt===je?ir({},Pt):Pt};function Le(Ct,Qe,Tt,je,Pt){return{x:_e(Ct),y:_e(Qe),zoom:Infinity,id:Tt,parentId:-1,numPoints:je,properties:Pt}}function Je(Ct,Qe){var Tt=Ct.geometry.coordinates,je=Tt[0],Pt=Tt[1];return{x:_e(Ut(je)),y:_e(xt(Pt)),zoom:Infinity,index:Qe,parentId:-1}}function Dt(Ct){return{type:"Feature",id:Ct.id,properties:It(Ct),geometry:{type:"Point",coordinates:[bt(Ct.x),ct(Ct.y)]}}}function It(Ct){var Qe=Ct.numPoints,Tt=Qe>=1e4?Math.round(Qe/1e3)+"k":Qe>=1e3?Math.round(Qe/100)/10+"k":Qe;return ir(ir({},Ct.properties),{cluster:!0,cluster_id:Ct.id,point_count:Qe,point_count_abbreviated:Tt})}function Ut(Ct){return Ct/360+.5}function xt(Ct){var Qe=Math.sin(Ct*Math.PI/180),Tt=.5-.25*Math.log((1+Qe)/(1-Qe))/Math.PI;return Tt<0?0:Tt>1?1:Tt}function bt(Ct){return(Ct-.5)*360}function ct(Ct){var Qe=(180-Ct*360)*Math.PI/180;return 360*Math.atan(Math.exp(Qe))/Math.PI-90}function ir(Ct,Qe){for(var Tt in Qe)Ct[Tt]=Qe[Tt];return Ct}function re(Ct){return Ct.x}function cr(Ct){return Ct.y}return be})},75752:function(qe){qe.exports.RADIUS=6378137,qe.exports.FLATTENING=1/298.257223563,qe.exports.POLAR_RADIUS=63567523142e-4}}]);
